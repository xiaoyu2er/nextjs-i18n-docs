---
source-updated-at: 2025-05-16T04:52:11.000Z
translation-updated-at: 2025-06-06T17:42:00.029Z
title: Guide d'adoption progressive du routeur App
nav_title: Migration vers le routeur App
description: Apprenez √† mettre √† niveau votre application Next.js existante du routeur Pages vers le routeur App.
---

Ce guide vous aidera √† :

- [Mettre √† jour votre application Next.js de la version 12 √† la version 13](#nextjs-version)
- [Am√©liorer les fonctionnalit√©s qui fonctionnent √† la fois dans les r√©pertoires `pages` et `app`](#upgrading-new-features)
- [Migrer progressivement votre application existante de `pages` vers `app`](#migrating-from-pages-to-app)

## Mise √† niveau

### Version de Node.js

La version minimale de Node.js est d√©sormais **v16.14**. Consultez la [documentation de Node.js](https://nodejs.org/docs/latest-v16.x/api/) pour plus d'informations.

### Version de Next.js

Pour mettre √† jour vers Next.js version 13, ex√©cutez la commande suivante avec votre gestionnaire de paquets pr√©f√©r√© :

```bash filename="Terminal"
npm install next@latest react@latest react-dom@latest
```

### Version d'ESLint

Si vous utilisez ESLint, vous devez mettre √† jour votre version d'ESLint :

```bash filename="Terminal"
npm install -D eslint-config-next@latest
```

> **Bon √† savoir** : Vous devrez peut-√™tre red√©marrer le serveur ESLint dans VS Code pour que les modifications prennent effet. Ouvrez la palette de commandes (`cmd+shift+p` sur Mac ; `ctrl+shift+p` sur Windows) et recherchez `ESLint: Restart ESLint Server`.

## Prochaines √©tapes

Apr√®s la mise √† jour, consultez les sections suivantes pour les prochaines √©tapes :

- [Am√©liorer les nouvelles fonctionnalit√©s](#upgrading-new-features) : Un guide pour vous aider √† passer aux nouvelles fonctionnalit√©s telles que les composants Image et Link am√©lior√©s.
- [Migrer du r√©pertoire `pages` vers `app`](#migrating-from-pages-to-app) : Un guide √©tape par √©tape pour vous aider √† migrer progressivement du r√©pertoire `pages` vers `app`.

## Am√©lioration des nouvelles fonctionnalit√©s

Next.js 13 a introduit le nouveau [routeur App](/docs/app/building-your-application/routing) avec de nouvelles fonctionnalit√©s et conventions. Le nouveau routeur est disponible dans le r√©pertoire `app` et coexiste avec le r√©pertoire `pages`.

La mise √† niveau vers Next.js 13 ne n√©cessite **pas** l'utilisation du nouveau [routeur App](/docs/app/building-your-application/routing#the-app-router). Vous pouvez continuer √† utiliser `pages` avec les nouvelles fonctionnalit√©s qui fonctionnent dans les deux r√©pertoires, telles que le [composant Image](#image-component) mis √† jour, le [composant Link](#link-component), le [composant Script](#script-component) et l'[optimisation des polices](#font-optimization).

### Composant `<Image/>`

Next.js 12 a introduit des am√©liorations pour le composant Image avec une importation temporaire : `next/future/image`. Ces am√©liorations incluaient moins de JavaScript c√¥t√© client, des moyens plus simples d'√©tendre et de styliser les images, une meilleure accessibilit√© et un chargement paresseux natif du navigateur.

Dans la version 13, ce nouveau comportement est d√©sormais la valeur par d√©faut pour `next/image`.

Il existe deux codemods pour vous aider √† migrer vers le nouveau composant Image :

- [**Codemod `next-image-to-legacy-image`**](/docs/app/building-your-application/upgrading/codemods#next-image-to-legacy-image) : Renomme de mani√®re s√ªre et automatique les imports `next/image` en `next/legacy/image`. Les composants existants conserveront le m√™me comportement.
- [**Codemod `next-image-experimental`**](/docs/app/building-your-application/upgrading/codemods#next-image-experimental) : Ajoute de mani√®re risqu√©e des styles en ligne et supprime les props inutilis√©s. Cela modifiera le comportement des composants existants pour correspondre aux nouvelles valeurs par d√©faut. Pour utiliser ce codemod, vous devez d'abord ex√©cuter le codemod `next-image-to-legacy-image`.

### Composant `<Link>`

Le [composant `<Link>`](/docs/app/building-your-application/routing/linking-and-navigating#link-component) ne n√©cessite plus d'ajouter manuellement une balise `<a>` comme enfant. Ce comportement a √©t√© ajout√© comme option exp√©rimentale dans la [version 12.2](https://nextjs.org/blog/next-12-2) et est d√©sormais la valeur par d√©faut. Dans Next.js 13, `<Link>` rend toujours `<a>` et vous permet de transmettre des props √† la balise sous-jacente.

Par exemple :

```jsx
import Link from 'next/link'

// Next.js 12 : `<a>` doit √™tre imbriqu√© sinon il est exclu
<Link href="/about">
  <a>About</a>
</Link>

// Next.js 13 : `<Link>` rend toujours `<a>` en arri√®re-plan
<Link href="/about">
  About
</Link>
```

Pour mettre √† niveau vos liens vers Next.js 13, vous pouvez utiliser le [codemod `new-link`](/docs/app/building-your-application/upgrading/codemods#new-link).

### Composant `<Script>`

Le comportement de [`next/script`](/docs/app/api-reference/components/script) a √©t√© mis √† jour pour prendre en charge √† la fois `pages` et `app`, mais certaines modifications doivent √™tre apport√©es pour garantir une migration fluide :

- D√©placez tous les scripts `beforeInteractive` que vous aviez pr√©c√©demment inclus dans `_document.js` vers le fichier de disposition racine (`app/layout.tsx`).
- La strat√©gie exp√©rimentale `worker` ne fonctionne pas encore dans `app` et les scripts utilisant cette strat√©gie devront √™tre supprim√©s ou modifi√©s pour utiliser une autre strat√©gie (par exemple `lazyOnload`).
- Les gestionnaires `onLoad`, `onReady` et `onError` ne fonctionneront pas dans les composants serveur, assurez-vous donc de les d√©placer vers un [composant client](/docs/app/building-your-application/rendering/server-components) ou de les supprimer compl√®tement.

### Optimisation des polices

Auparavant, Next.js vous aidait √† optimiser les polices en [int√©grant le CSS des polices](/docs/app/building-your-application/optimizing/fonts). La version 13 introduit le nouveau module [`next/font`](/docs/app/building-your-application/optimizing/fonts) qui vous permet de personnaliser votre exp√©rience de chargement des polices tout en garantissant des performances et une confidentialit√© optimales. `next/font` est pris en charge √† la fois dans les r√©pertoires `pages` et `app`.

Bien que [l'int√©gration du CSS](/docs/app/building-your-application/optimizing/fonts) fonctionne toujours dans `pages`, elle ne fonctionne pas dans `app`. Vous devez utiliser [`next/font`](/docs/app/building-your-application/optimizing/fonts) √† la place.

Consultez la page [Optimisation des polices](/docs/app/building-your-application/optimizing/fonts) pour apprendre √† utiliser `next/font`.

## Migration de `pages` vers `app`

> **üé• Regardez** : Apprenez √† adopter progressivement le routeur App ‚Üí [YouTube (16 minutes)](https://www.youtube.com/watch?v=YQMSietiFm0).

Passer au routeur App peut √™tre la premi√®re fois que vous utilisez des fonctionnalit√©s React sur lesquelles Next.js s'appuie, telles que les composants serveur, Suspense, et plus encore. Combin√©es avec les nouvelles fonctionnalit√©s de Next.js telles que les [fichiers sp√©ciaux](/docs/app/building-your-application/routing#file-conventions) et les [dispositions](/docs/app/building-your-application/routing/pages-and-layouts#layouts), la migration implique de nouveaux concepts, mod√®les mentaux et changements de comportement √† apprendre.

Nous recommandons de r√©duire la complexit√© combin√©e de ces mises √† jour en divisant votre migration en √©tapes plus petites. Le r√©pertoire `app` est con√ßu intentionnellement pour fonctionner simultan√©ment avec le r√©pertoire `pages` afin de permettre une migration page par page progressive.

- Le r√©pertoire `app` prend en charge les routes imbriqu√©es _et_ les dispositions. [En savoir plus](/docs/app/building-your-application/routing).
- Utilisez des dossiers imbriqu√©s pour [d√©finir des routes](/docs/app/building-your-application/routing/defining-routes) et un fichier sp√©cial `page.js` pour rendre un segment de route accessible publiquement. [En savoir plus](#step-4-migrating-pages).
- Les [conventions de fichiers sp√©ciaux](/docs/app/building-your-application/routing#file-conventions) sont utilis√©es pour cr√©er l'interface utilisateur de chaque segment de route. Les fichiers sp√©ciaux les plus courants sont `page.js` et `layout.js`.
  - Utilisez `page.js` pour d√©finir une interface utilisateur unique √† une route.
  - Utilisez `layout.js` pour d√©finir une interface utilisateur partag√©e entre plusieurs routes.
  - Les extensions de fichiers `.js`, `.jsx` ou `.tsx` peuvent √™tre utilis√©es pour les fichiers sp√©ciaux.
- Vous pouvez colocaliser d'autres fichiers dans le r√©pertoire `app`, tels que des composants, des styles, des tests, et plus encore. [En savoir plus](/docs/app/building-your-application/routing).
- Les fonctions de r√©cup√©ration de donn√©es comme `getServerSideProps` et `getStaticProps` ont √©t√© remplac√©es par [une nouvelle API](/docs/app/building-your-application/data-fetching) dans `app`. `getStaticPaths` a √©t√© remplac√© par [`generateStaticParams`](/docs/app/api-reference/functions/generate-static-params).
- `pages/_app.js` et `pages/_document.js` ont √©t√© remplac√©s par une seule disposition racine `app/layout.js`. [En savoir plus](/docs/app/building-your-application/routing/pages-and-layouts#root-layout-required).
- `pages/_error.js` a √©t√© remplac√© par des fichiers sp√©ciaux `error.js` plus granulaires. [En savoir plus](/docs/app/building-your-application/routing/error-handling).
- `pages/404.js` a √©t√© remplac√© par le fichier [`not-found.js`](/docs/app/api-reference/file-conventions/not-found).
- `pages/api/*` reste actuellement dans le r√©pertoire `pages`.

### √âtape 1 : Cr√©ation du r√©pertoire `app`

Mettez √† jour vers la derni√®re version de Next.js (n√©cessite la version 13.4 ou sup√©rieure) :

```bash
npm install next@latest
```

Ensuite, cr√©ez un nouveau r√©pertoire `app` √† la racine de votre projet (ou dans le r√©pertoire `src/`).

### √âtape 2 : Cr√©ation d'une disposition racine

Cr√©ez un nouveau fichier `app/layout.tsx` dans le r√©pertoire `app`. Il s'agit d'une [disposition racine](/docs/app/building-your-application/routing/pages-and-layouts#root-layout-required) qui s'appliquera √† toutes les routes dans `app`.

```tsx filename="app/layout.tsx" switcher
export default function RootLayout({
  // Les dispositions doivent accepter une prop children.
  // Ceci sera rempli avec des dispositions ou des pages imbriqu√©es
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  )
}
```

```jsx filename="app/layout.js" switcher
export default function RootLayout({
  // Les dispositions doivent accepter une prop children.
  // Ceci sera rempli avec des dispositions ou des pages imbriqu√©es
  children,
}) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  )
}
```

- Le r√©pertoire `app` **doit** inclure une disposition racine.
- La disposition racine doit d√©finir les balises `<html>` et `<body>` car Next.js ne les cr√©e pas automatiquement.
- La disposition racine remplace les fichiers `pages/_app.tsx` et `pages/_document.tsx`.
- Les extensions `.js`, `.jsx` ou `.tsx` peuvent √™tre utilis√©es pour les fichiers de disposition.

Pour g√©rer les √©l√©ments HTML `<head>`, vous pouvez utiliser la [prise en charge SEO int√©gr√©e](/docs/app/building-your-application/optimizing/metadata) :

```tsx filename="app/layout.tsx" switcher
import { Metadata } from 'next'

export const metadata: Metadata = {
  title: 'Home',
  description: 'Welcome to Next.js',
}
```

```jsx filename="app/layout.js" switcher
export const metadata = {
  title: 'Home',
  description: 'Welcome to Next.js',
}
```

#### Migration de `_document.js` et `_app.js`

Si vous avez un fichier `_app` ou `_document` existant, vous pouvez copier son contenu (par exemple, les styles globaux) dans la disposition racine (`app/layout.tsx`). Les styles dans `app/layout.tsx` ne s'appliqueront _pas_ √† `pages/*`. Vous devez conserver `_app`/`_document` pendant la migration pour √©viter de casser vos routes `pages/*`. Une fois la migration termin√©e, vous pouvez les supprimer en toute s√©curit√©.

Si vous utilisez des fournisseurs de contexte React, ils devront √™tre d√©plac√©s vers un [composant client](/docs/app/building-your-application/rendering/client-components).

#### Migration du mod√®le `getLayout()` vers les dispositions (Optionnel)

Next.js recommandait d'ajouter une [propri√©t√© aux composants Page](/docs/pages/building-your-application/routing/pages-and-layouts#layout-pattern#per-page-layouts) pour obtenir des dispositions par page dans le r√©pertoire `pages`. Ce mod√®le peut √™tre remplac√© par la prise en charge native des [dispositions imbriqu√©es](/docs/app/building-your-application/routing/pages-and-layouts#layouts) dans le r√©pertoire `app`.

<details>
  <summary>Voir un exemple avant/apr√®s</summary>

**Avant**

```jsx filename="components/DashboardLayout.js"
export default function DashboardLayout({ children }) {
  return (
    <div>
      <h2>My Dashboard</h2>
      {children}
    </div>
  )
}
```

```jsx filename="pages/dashboard/index.js"
import DashboardLayout from '../components/DashboardLayout'

export default function Page() {
  return <p>My Page</p>
}

Page.getLayout = function getLayout(page) {
  return <DashboardLayout>{page}</DashboardLayout>
}
```

**Apr√®s**

- Supprimez la propri√©t√© `Page.getLayout` de `pages/dashboard/index.js` et suivez les [√©tapes pour migrer les pages](#step-4-migrating-pages) vers le r√©pertoire `app`.

  ```jsx filename="app/dashboard/page.js"
  export default function Page() {
    return <p>My Page</p>
  }
  ```

- D√©placez le contenu de `DashboardLayout` dans un nouveau [composant client](/docs/app/building-your-application/rendering/client-components) pour conserver le comportement du r√©pertoire `pages`.

  ```jsx filename="app/dashboard/DashboardLayout.js"
  'use client' // cette directive doit √™tre en haut du fichier, avant tout import.

  // Ceci est un composant client
  export default function DashboardLayout({ children }) {
    return (
      <div>
        <h2>My Dashboard</h2>
        {children}
      </div>
    )
  }
  ```

- Importez `DashboardLayout` dans un nouveau fichier `layout.js` dans le r√©pertoire `app`.

  ```jsx filename="app/dashboard/layout.js"
  import DashboardLayout from './DashboardLayout'

  // Ceci est un composant serveur
  export default function Layout({ children }) {
    return <DashboardLayout>{children}</DashboardLayout>
  }
  ```

- Vous pouvez d√©placer progressivement les parties non interactives de `DashboardLayout.js` (composant client) vers `layout.js` (composant serveur) pour r√©duire la quantit√© de JavaScript de composant envoy√©e au client.

</details>

### √âtape 3 : Migration de `next/head`

Dans le r√©pertoire `pages`, le composant React `next/head` est utilis√© pour g√©rer les √©l√©ments HTML `<head>` tels que `title` et `meta`. Dans le r√©pertoire `app`, `next/head` est remplac√© par la nouvelle [prise en charge SEO int√©gr√©e](/docs/app/building-your-application/optimizing/metadata).

**Avant :**

```tsx filename="pages/index.tsx" switcher
import Head from 'next/head'

export default function Page() {
  return (
    <>
      <Head>
        <title>My page title</title>
      </Head>
    </>
  )
}
```

```jsx filename="pages/index.js" switcher
import Head from 'next/head'

export default function Page() {
  return (
    <>
      <Head>
        <title>My page title</title>
      </Head>
    </>
  )
}
```

**Apr√®s :**

```tsx filename="app/page.tsx" switcher
import { Metadata } from 'next'

export const metadata: Metadata = {
  title: 'My Page Title',
}

export default function Page() {
  return '...'
}
```

```jsx filename="app/page.js" switcher
export const metadata = {
  title: 'My Page Title',
}

export default function Page() {
  return '...'
}
```

[Voir toutes les options de m√©tadonn√©es](/docs/app/api-reference/functions/generate-metadata).

### √âtape 4 : Migration des pages

- Les pages dans le [r√©pertoire `app`](/docs/app/building-your-application/routing) sont par d√©faut des [Composants Serveur (Server Components)](/docs/app/building-your-application/rendering/server-components). Cela diff√®re du r√©pertoire `pages` o√π les pages sont des [Composants Client (Client Components)](/docs/app/building-your-application/rendering/client-components).
- La [r√©cup√©ration de donn√©es (Data fetching)](/docs/app/building-your-application/data-fetching) a chang√© dans `app`. `getServerSideProps`, `getStaticProps` et `getInitialProps` ont √©t√© remplac√©s par une API plus simple.
- Le r√©pertoire `app` utilise des dossiers imbriqu√©s pour [d√©finir les routes (defining routes)](/docs/app/building-your-application/routing/defining-routes) et un fichier sp√©cial `page.js` pour rendre un segment de route accessible publiquement.
- | R√©pertoire `pages` | R√©pertoire `app`       | Route          |
  | ----------------- | --------------------- | -------------- |
  | `index.js`        | `page.js`             | `/`            |
  | `about.js`        | `about/page.js`       | `/about`       |
  | `blog/[slug].js`  | `blog/[slug]/page.js` | `/blog/post-1` |

Nous recommandons de d√©composer la migration d'une page en deux √©tapes principales :

- √âtape 1 : D√©placer le composant de page export√© par d√©faut dans un nouveau Composant Client.
- √âtape 2 : Importer le nouveau Composant Client dans un fichier `page.js` √† l'int√©rieur du r√©pertoire `app`.

> **Bon √† savoir** : C'est le chemin de migration le plus simple car il offre le comportement le plus comparable au r√©pertoire `pages`.

**√âtape 1 : Cr√©er un nouveau Composant Client**

- Cr√©ez un nouveau fichier s√©par√© dans le r√©pertoire `app` (par exemple `app/home-page.tsx` ou similaire) qui exporte un Composant Client. Pour d√©finir des Composants Client, ajoutez la directive `'use client'` en haut du fichier (avant toute importation).
- D√©placez le composant de page export√© par d√©faut de `pages/index.js` vers `app/home-page.tsx`.

```tsx filename="app/home-page.tsx" switcher
'use client'

// Ceci est un Composant Client. Il re√ßoit des donn√©es comme props et
// a acc√®s √† l'√©tat et aux effets, tout comme les composants de page
// dans le r√©pertoire `pages`.
export default function HomePage({ recentPosts }) {
  return (
    <div>
      {recentPosts.map((post) => (
        <div key={post.id}>{post.title}</div>
      ))}
    </div>
  )
}
```

```jsx filename="app/home-page.js" switcher
'use client'

// Ceci est un Composant Client. Il re√ßoit des donn√©es comme props et
// a acc√®s √† l'√©tat et aux effets, tout comme les composants de page
// dans le r√©pertoire `pages`.
export default function HomePage({ recentPosts }) {
  return (
    <div>
      {recentPosts.map((post) => (
        <div key={post.id}>{post.title}</div>
      ))}
    </div>
  )
}
```

**√âtape 2 : Cr√©er une nouvelle page**

- Cr√©ez un nouveau fichier `app/page.tsx` dans le r√©pertoire `app`. Par d√©faut, c'est un Composant Serveur.
- Importez le Composant Client `home-page.tsx` dans la page.
- Si vous r√©cup√©riez des donn√©es dans `pages/index.js`, d√©placez la logique de r√©cup√©ration de donn√©es directement dans le Composant Serveur en utilisant les nouvelles [API de r√©cup√©ration de donn√©es (data fetching APIs)](/docs/app/building-your-application/data-fetching/fetching-caching-and-revalidating). Consultez le [guide de mise √† niveau de la r√©cup√©ration de donn√©es](#step-6-migrating-data-fetching-methods) pour plus de d√©tails.

  ```tsx filename="app/page.tsx" switcher
  // Importez votre Composant Client
  import HomePage from './home-page'

  async function getPosts() {
    const res = await fetch('https://...')
    const posts = await res.json()
    return posts
  }

  export default async function Page() {
    // R√©cup√©rez les donn√©es directement dans un Composant Serveur
    const recentPosts = await getPosts()
    // Transmettez les donn√©es r√©cup√©r√©es √† votre Composant Client
    return <HomePage recentPosts={recentPosts} />
  }
  ```

  ```jsx filename="app/page.js" switcher
  // Importez votre Composant Client
  import HomePage from './home-page'

  async function getPosts() {
    const res = await fetch('https://...')
    const posts = await res.json()
    return posts
  }

  export default async function Page() {
    // R√©cup√©rez les donn√©es directement dans un Composant Serveur
    const recentPosts = await getPosts()
    // Transmettez les donn√©es r√©cup√©r√©es √† votre Composant Client
    return <HomePage recentPosts={recentPosts} />
  }
  ```

- Si votre page pr√©c√©dente utilisait `useRouter`, vous devrez passer aux nouveaux hooks de routage. [En savoir plus](/docs/app/api-reference/functions/use-router).
- D√©marrez votre serveur de d√©veloppement et visitez [`http://localhost:3000`](http://localhost:3000). Vous devriez voir votre route d'index existante, d√©sormais servie via le r√©pertoire `app`.

### √âtape 5 : Migration des hooks de routage

Un nouveau routeur a √©t√© ajout√© pour prendre en charge le nouveau comportement dans le r√©pertoire `app`.

Dans `app`, vous devez utiliser les trois nouveaux hooks import√©s depuis `next/navigation` : [`useRouter()`](/docs/app/api-reference/functions/use-router), [`usePathname()`](/docs/app/api-reference/functions/use-pathname) et [`useSearchParams()`](/docs/app/api-reference/functions/use-search-params).

- Le nouveau hook `useRouter` est import√© depuis `next/navigation` et a un comportement diff√©rent du hook `useRouter` dans `pages` qui est import√© depuis `next/router`.
  - Le [hook `useRouter` import√© depuis `next/router`](/docs/pages/api-reference/functions/use-router) n'est pas pris en charge dans le r√©pertoire `app` mais peut continuer √† √™tre utilis√© dans le r√©pertoire `pages`.
- Le nouveau `useRouter` ne renvoie pas la cha√Æne `pathname`. Utilisez plut√¥t le hook s√©par√© `usePathname`.
- Le nouveau `useRouter` ne renvoie pas l'objet `query`. Utilisez plut√¥t le hook s√©par√© `useSearchParams`.
- Vous pouvez utiliser `useSearchParams` et `usePathname` ensemble pour √©couter les changements de page. Consultez la section [√âv√©nements du routeur (Router Events)](/docs/app/api-reference/functions/use-router#router-events) pour plus de d√©tails.
- Ces nouveaux hooks ne sont pris en charge que dans les Composants Client. Ils ne peuvent pas √™tre utilis√©s dans les Composants Serveur.

```tsx filename="app/example-client-component.tsx" switcher
'use client'

import { useRouter, usePathname, useSearchParams } from 'next/navigation'

export default function ExampleClientComponent() {
  const router = useRouter()
  const pathname = usePathname()
  const searchParams = useSearchParams()

  // ...
}
```

```jsx filename="app/example-client-component.js" switcher
'use client'

import { useRouter, usePathname, useSearchParams } from 'next/navigation'

export default function ExampleClientComponent() {
  const router = useRouter()
  const pathname = usePathname()
  const searchParams = useSearchParams()

  // ...
}
```

De plus, le nouveau hook `useRouter` a les changements suivants :

- `isFallback` a √©t√© supprim√© car `fallback` a [√©t√© remplac√©](#replacing-fallback).
- Les valeurs `locale`, `locales`, `defaultLocales`, `domainLocales` ont √©t√© supprim√©es car les fonctionnalit√©s i18n int√©gr√©es de Next.js ne sont plus n√©cessaires dans le r√©pertoire `app`. [En savoir plus sur i18n](/docs/pages/building-your-application/routing/internationalization).
- `basePath` a √©t√© supprim√©. L'alternative ne fera pas partie de `useRouter`. Elle n'a pas encore √©t√© impl√©ment√©e.
- `asPath` a √©t√© supprim√© car le concept de `as` a √©t√© retir√© du nouveau routeur.
- `isReady` a √©t√© supprim√© car il n'est plus n√©cessaire. Lors du [rendu statique (static rendering)](/docs/app/building-your-application/rendering/server-components#static-rendering-default), tout composant qui utilise le hook [`useSearchParams()`](/docs/app/api-reference/functions/use-params) ignorera l'√©tape de pr√©-rendu et sera plut√¥t rendu c√¥t√© client au moment de l'ex√©cution.

[Voir la r√©f√©rence de l'API `useRouter()`](/docs/app/api-reference/functions/use-router).

### √âtape 6 : Migration des m√©thodes de r√©cup√©ration de donn√©es

Le r√©pertoire `pages` utilise `getServerSideProps` et `getStaticProps` pour r√©cup√©rer des donn√©es pour les pages. Dans le r√©pertoire `app`, ces anciennes fonctions de r√©cup√©ration de donn√©es sont remplac√©es par une [API plus simple](/docs/app/building-your-application/data-fetching) bas√©e sur `fetch()` et les Composants Serveur React asynchrones.

```tsx filename="app/page.tsx" switcher
export default async function Page() {
  // Cette requ√™te doit √™tre mise en cache jusqu'√† invalidation manuelle.
  // Similaire √† `getStaticProps`.
  // `force-cache` est la valeur par d√©faut et peut √™tre omis.
  const staticData = await fetch(`https://...`, { cache: 'force-cache' })

  // Cette requ√™te doit √™tre r√©cup√©r√©e √† chaque demande.
  // Similaire √† `getServerSideProps`.
  const dynamicData = await fetch(`https://...`, { cache: 'no-store' })

  // Cette requ√™te doit √™tre mise en cache avec une dur√©e de vie de 10 secondes.
  // Similaire √† `getStaticProps` avec l'option `revalidate`.
  const revalidatedData = await fetch(`https://...`, {
    next: { revalidate: 10 },
  })

  return <div>...</div>
}
```

```jsx filename="app/page.js" switcher
export default async function Page() {
  // Cette requ√™te doit √™tre mise en cache jusqu'√† invalidation manuelle.
  // Similaire √† `getStaticProps`.
  // `force-cache` est la valeur par d√©faut et peut √™tre omis.
  const staticData = await fetch(`https://...`, { cache: 'force-cache' })

  // Cette requ√™te doit √™tre r√©cup√©r√©e √† chaque demande.
  // Similaire √† `getServerSideProps`.
  const dynamicData = await fetch(`https://...`, { cache: 'no-store' })

  // Cette requ√™te doit √™tre mise en cache avec une dur√©e de vie de 10 secondes.
  // Similaire √† `getStaticProps` avec l'option `revalidate`.
  const revalidatedData = await fetch(`https://...`, {
    next: { revalidate: 10 },
  })

  return <div>...</div>
}
```

#### Rendu c√¥t√© serveur (`getServerSideProps`)

Dans le r√©pertoire `pages`, `getServerSideProps` est utilis√© pour r√©cup√©rer des donn√©es c√¥t√© serveur et transmettre des props au composant React export√© par d√©faut dans le fichier. Le HTML initial de la page est pr√©-rendu depuis le serveur, suivi par "l'hydratation" de la page dans le navigateur (la rendant interactive).

```jsx filename="pages/dashboard.js"
// R√©pertoire `pages`

export async function getServerSideProps() {
  const res = await fetch(`https://...`)
  const projects = await res.json()

  return { props: { projects } }
}

export default function Dashboard({ projects }) {
  return (
    <ul>
      {projects.map((project) => (
        <li key={project.id}>{project.name}</li>
      ))}
    </ul>
  )
}
```

Dans le r√©pertoire `app`, nous pouvons colocaliser notre r√©cup√©ration de donn√©es √† l'int√©rieur de nos composants React en utilisant des [Composants Serveur (Server Components)](/docs/app/building-your-application/rendering/server-components). Cela nous permet d'envoyer moins de JavaScript au client, tout en conservant le HTML rendu depuis le serveur.

En d√©finissant l'option `cache` sur `no-store`, nous pouvons indiquer que les donn√©es r√©cup√©r√©es ne doivent [jamais √™tre mises en cache](/docs/app/building-your-application/data-fetching/fetching-caching-and-revalidating). C'est similaire √† `getServerSideProps` dans le r√©pertoire `pages`.

```tsx filename="app/dashboard/page.tsx" switcher
// R√©pertoire `app`

// Cette fonction peut √™tre nomm√©e comme vous le souhaitez
async function getProjects() {
  const res = await fetch(`https://...`, { cache: 'no-store' })
  const projects = await res.json()

  return projects
}

export default async function Dashboard() {
  const projects = await getProjects()

  return (
    <ul>
      {projects.map((project) => (
        <li key={project.id}>{project.name}</li>
      ))}
    </ul>
  )
}
```

```jsx filename="app/dashboard/page.js" switcher
// R√©pertoire `app`

// Cette fonction peut √™tre nomm√©e comme vous le souhaitez
async function getProjects() {
  const res = await fetch(`https://...`, { cache: 'no-store' })
  const projects = await res.json()

  return projects
}

export default async function Dashboard() {
  const projects = await getProjects()

  return (
    <ul>
      {projects.map((project) => (
        <li key={project.id}>{project.name}</li>
      ))}
    </ul>
  )
}
```

#### Acc√®s √† l'objet Request

Dans le r√©pertoire `pages`, vous pouvez r√©cup√©rer des donn√©es bas√©es sur la requ√™te en utilisant l'API HTTP de Node.js.

Par exemple, vous pouvez r√©cup√©rer l'objet `req` depuis `getServerSideProps` et l'utiliser pour r√©cup√©rer les cookies et les en-t√™tes de la requ√™te.

```jsx filename="pages/index.js"
// R√©pertoire `pages`

export async function getServerSideProps({ req, query }) {
  const authHeader = req.getHeaders()['authorization'];
  const theme = req.cookies['theme'];

  return { props: { ... }}
}

export default function Page(props) {
  return ...
}
```

Le r√©pertoire `app` expose de nouvelles fonctions en lecture seule pour r√©cup√©rer les donn√©es de requ√™te :

- [`headers()`](/docs/app/api-reference/functions/headers) : Bas√©e sur l'API Web Headers, et peut √™tre utilis√©e dans les [Composants Serveur (Server Components)](/docs/app/building-your-application/rendering/server-components) pour r√©cup√©rer les en-t√™tes de requ√™te.
- [`cookies()`](/docs/app/api-reference/functions/cookies) : Bas√©e sur l'API Web Cookies, et peut √™tre utilis√©e dans les [Composants Serveur (Server Components)](/docs/app/building-your-application/rendering/server-components) pour r√©cup√©rer les cookies.

```tsx filename="app/page.tsx" switcher
// R√©pertoire `app`
import { cookies, headers } from 'next/headers'

async function getData() {
  const authHeader = headers().get('authorization')

  return '...'
}

export default async function Page() {
  // Vous pouvez utiliser `cookies()` ou `headers()` directement dans les Composants Serveur
  // ou dans votre fonction de r√©cup√©ration de donn√©es
  const theme = cookies().get('theme')
  const data = await getData()
  return '...'
}
```

```jsx filename="app/page.js" switcher
// R√©pertoire `app`
import { cookies, headers } from 'next/headers'

async function getData() {
  const authHeader = headers().get('authorization')

  return '...'
}

export default async function Page() {
  // Vous pouvez utiliser `cookies()` ou `headers()` directement dans les Composants Serveur
  // ou dans votre fonction de r√©cup√©ration de donn√©es
  const theme = cookies().get('theme')
  const data = await getData()
  return '...'
}
```

#### G√©n√©ration de site statique (`getStaticProps`)

Dans le r√©pertoire `pages`, la fonction `getStaticProps` est utilis√©e pour pr√©-rendre une page au moment de la construction. Cette fonction peut √™tre utilis√©e pour r√©cup√©rer des donn√©es depuis une API externe ou directement depuis une base de donn√©es, et transmettre ces donn√©es √† l'ensemble de la page lors de sa g√©n√©ration pendant la construction.

```jsx filename="pages/index.js"
// R√©pertoire `pages`

export async function getStaticProps() {
  const res = await fetch(`https://...`)
  const projects = await res.json()

  return { props: { projects } }
}

export default function Index({ projects }) {
  return projects.map((project) => <div>{project.name}</div>)
}
```

Dans le r√©pertoire `app`, la r√©cup√©ration de donn√©es avec [`fetch()`](/docs/app/api-reference/functions/fetch) utilisera par d√©faut `cache: 'force-cache'`, ce qui mettra en cache les donn√©es de requ√™te jusqu'√† invalidation manuelle. C'est similaire √† `getStaticProps` dans le r√©pertoire `pages`.

```jsx filename="app/page.js"
// R√©pertoire `app`

// Cette fonction peut √™tre nomm√©e comme vous le souhaitez
async function getProjects() {
  const res = await fetch(`https://...`)
  const projects = await res.json()

  return projects
}

export default async function Index() {
  const projects = await getProjects()

  return projects.map((project) => <div>{project.name}</div>)
}
```

#### Chemins dynamiques (`getStaticPaths`)

Dans le r√©pertoire `pages`, la fonction `getStaticPaths` est utilis√©e pour d√©finir les chemins dynamiques qui doivent √™tre pr√©-rendus au moment de la construction.

```jsx filename="pages/posts/[id].js"
// R√©pertoire `pages`
import PostLayout from '@/components/post-layout'

export async function getStaticPaths() {
  return {
    paths: [{ params: { id: '1' } }, { params: { id: '2' } }],
  }
}

export async function getStaticProps({ params }) {
  const res = await fetch(`https://.../posts/${params.id}`)
  const post = await res.json()

  return { props: { post } }
}

export default function Post({ post }) {
  return <PostLayout post={post} />
}
```

Dans le r√©pertoire `app`, `getStaticPaths` est remplac√© par [`generateStaticParams`](/docs/app/api-reference/functions/generate-static-params).

[`generateStaticParams`](/docs/app/api-reference/functions/generate-static-params) se comporte de mani√®re similaire √† `getStaticPaths`, mais propose une API simplifi√©e pour retourner les param√®tres de route et peut √™tre utilis√©e √† l'int√©rieur des [layouts](/docs/app/building-your-application/routing/pages-and-layouts). La forme retourn√©e par `generateStaticParams` est un tableau de segments au lieu d'un tableau d'objets `param` imbriqu√©s ou d'une cha√Æne de chemins r√©solus.

```jsx filename="app/posts/[id]/page.js"
// R√©pertoire `app`
import PostLayout from '@/components/post-layout'

export async function generateStaticParams() {
  return [{ id: '1' }, { id: '2' }]
}

async function getPost(params) {
  const res = await fetch(`https://.../posts/${params.id}`)
  const post = await res.json()

  return post
}

export default async function Post({ params }) {
  const post = await getPost(params)

  return <PostLayout post={post} />
}
```

L'utilisation du nom `generateStaticParams` est plus appropri√©e que `getStaticPaths` pour le nouveau mod√®le dans le r√©pertoire `app`. Le pr√©fixe `get` est remplac√© par un terme plus descriptif `generate`, qui se suffit mieux maintenant que `getStaticProps` et `getServerSideProps` ne sont plus n√©cessaires. Le suffixe `Paths` est remplac√© par `Params`, qui est plus adapt√© pour le routage imbriqu√© avec plusieurs segments dynamiques.

---

#### Remplacer `fallback`

Dans le r√©pertoire `pages`, la propri√©t√© `fallback` retourn√©e par `getStaticPaths` est utilis√©e pour d√©finir le comportement d'une page qui n'est pas pr√©-rendue au moment de la construction. Cette propri√©t√© peut √™tre d√©finie √† `true` pour afficher une page de secours pendant que la page est g√©n√©r√©e, `false` pour afficher une page 404, ou `blocking` pour g√©n√©rer la page au moment de la requ√™te.

```jsx filename="pages/posts/[id].js"
// R√©pertoire `pages`

export async function getStaticPaths() {
  return {
    paths: [],
    fallback: 'blocking'
  };
}

export async function getStaticProps({ params }) {
  ...
}

export default function Post({ post }) {
  return ...
}
```

Dans le r√©pertoire `app`, la propri√©t√© [`config.dynamicParams`](/docs/app/api-reference/file-conventions/route-segment-config#dynamicparams) contr√¥le la gestion des param√®tres non inclus dans [`generateStaticParams`](/docs/app/api-reference/functions/generate-static-params) :

- **`true`** : (par d√©faut) Les segments dynamiques non inclus dans `generateStaticParams` sont g√©n√©r√©s √† la demande.
- **`false`** : Les segments dynamiques non inclus dans `generateStaticParams` retourneront une erreur 404.

Cela remplace l'option `fallback: true | false | 'blocking'` de `getStaticPaths` dans le r√©pertoire `pages`. L'option `fallback: 'blocking'` n'est pas incluse dans `dynamicParams` car la diff√©rence entre `'blocking'` et `true` est n√©gligeable avec le streaming.

```jsx filename="app/posts/[id]/page.js"
// R√©pertoire `app`

export const dynamicParams = true;

export async function generateStaticParams() {
  return [...]
}

async function getPost(params) {
  ...
}

export default async function Post({ params }) {
  const post = await getPost(params);

  return ...
}
```

Avec [`dynamicParams`](/docs/app/api-reference/file-conventions/route-segment-config#dynamicparams) d√©fini √† `true` (par d√©faut), lorsqu'un segment de route est demand√© et n'a pas √©t√© g√©n√©r√©, il sera rendu c√¥t√© serveur et mis en cache.

#### R√©g√©n√©ration statique incr√©mentale (`getStaticProps` avec `revalidate`)

Dans le r√©pertoire `pages`, la fonction `getStaticProps` permet d'ajouter un champ `revalidate` pour r√©g√©n√©rer automatiquement une page apr√®s un certain temps.

```jsx filename="pages/index.js"
// R√©pertoire `pages`

export async function getStaticProps() {
  const res = await fetch(`https://.../posts`)
  const posts = await res.json()

  return {
    props: { posts },
    revalidate: 60,
  }
}

export default function Index({ posts }) {
  return (
    <Layout>
      <PostList posts={posts} />
    </Layout>
  )
}
```

Dans le r√©pertoire `app`, la r√©cup√©ration de donn√©es avec [`fetch()`](/docs/app/api-reference/functions/fetch) peut utiliser `revalidate`, qui mettra en cache la requ√™te pour un nombre de secondes sp√©cifi√©.

```jsx filename="app/page.js"
// R√©pertoire `app`

async function getPosts() {
  const res = await fetch(`https://.../posts`, { next: { revalidate: 60 } })
  const data = await res.json()

  return data.posts
}

export default async function PostList() {
  const posts = await getPosts()

  return posts.map((post) => <div>{post.name}</div>)
}
```

#### Routes API

Les routes API continuent de fonctionner dans le r√©pertoire `pages/api` sans aucun changement. Cependant, elles ont √©t√© remplac√©es par les [Route Handlers](/docs/app/building-your-application/routing/route-handlers) dans le r√©pertoire `app`.

Les Route Handlers permettent de cr√©er des gestionnaires de requ√™tes personnalis√©s pour une route donn√©e en utilisant les API Web [Request](https://developer.mozilla.org/docs/Web/API/Request) et [Response](https://developer.mozilla.org/docs/Web/API/Response).

```ts filename="app/api/route.ts" switcher
export async function GET(request: Request) {}
```

```js filename="app/api/route.js" switcher
export async function GET(request) {}
```

> **Bon √† savoir** : Si vous utilisiez auparavant les routes API pour appeler une API externe depuis le client, vous pouvez maintenant utiliser les [Composants Serveur](/docs/app/building-your-application/rendering/server-components) pour r√©cup√©rer des donn√©es de mani√®re s√©curis√©e. En savoir plus sur la [r√©cup√©ration de donn√©es](/docs/app/building-your-application/data-fetching/fetching-caching-and-revalidating).

### √âtape 7 : Stylisation

Dans le r√©pertoire `pages`, les feuilles de style globales √©taient limit√©es √† `pages/_app.js`. Avec le r√©pertoire `app`, cette restriction a √©t√© lev√©e. Les styles globaux peuvent √™tre ajout√©s √† n'importe quel layout, page ou composant.

- [Modules CSS](/docs/app/building-your-application/styling/css-modules)
- [Tailwind CSS](/docs/app/building-your-application/styling/tailwind-css)
- [Styles globaux](/docs/app/building-your-application/styling/css-modules#global-styles)
- [CSS-in-JS](/docs/app/building-your-application/styling/css-in-js)
- [Feuilles de style externes](/docs/app/building-your-application/styling/css-modules#external-stylesheets)
- [Sass](/docs/app/building-your-application/styling/sass)

#### Tailwind CSS

Si vous utilisez Tailwind CSS, vous devrez ajouter le r√©pertoire `app` √† votre fichier `tailwind.config.js` :

```js filename="tailwind.config.js"
module.exports = {
  content: [
    './app/**/*.{js,ts,jsx,tsx,mdx}', // <-- Ajoutez cette ligne
    './pages/**/*.{js,ts,jsx,tsx,mdx}',
    './components/**/*.{js,ts,jsx,tsx,mdx}',
  ],
}
```

Vous devrez √©galement importer vos styles globaux dans votre fichier `app/layout.js` :

```jsx filename="app/layout.js"
import '../styles/globals.css'

export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  )
}
```

En savoir plus sur la [stylisation avec Tailwind CSS](/docs/app/building-your-application/styling/tailwind-css)

## Codemods

Next.js fournit des transformations Codemod pour aider √† mettre √† jour votre base de code lorsqu'une fonctionnalit√© est d√©pr√©ci√©e. Voir [Codemods](/docs/app/building-your-application/upgrading/codemods) pour plus d'informations.
