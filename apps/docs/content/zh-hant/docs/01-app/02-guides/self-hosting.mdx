---
source-updated-at: 2025-06-08T05:18:05.000Z
translation-updated-at: 2025-06-08T20:55:41.320Z
title: å¦‚ä½•è‡ªè¡Œè¨—ç®¡ Next.js æ‡‰ç”¨ç¨‹å¼
nav_title: è‡ªè¡Œè¨—ç®¡
description: å­¸ç¿’å¦‚ä½•åœ¨ Node.js ä¼ºæœå™¨ã€Docker æ˜ åƒæˆ–éœæ…‹ HTML æª”æ¡ˆï¼ˆéœæ…‹åŒ¯å‡ºï¼‰ä¸Šè‡ªè¡Œè¨—ç®¡æ‚¨çš„ Next.js æ‡‰ç”¨ç¨‹å¼ã€‚
---

{/* æ­¤æ–‡ä»¶å…§å®¹åœ¨æ‡‰ç”¨ç¨‹å¼è·¯ç”±å™¨å’Œé é¢è·¯ç”±å™¨ä¹‹é–“å…±äº«ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ `<PagesOnly>å…§å®¹</PagesOnly>` å…ƒä»¶ä¾†æ–°å¢ç‰¹å®šæ–¼é é¢è·¯ç”±å™¨çš„å…§å®¹ã€‚ä»»ä½•å…±äº«å…§å®¹ä¸æ‡‰åŒ…è£¹åœ¨å…ƒä»¶ä¸­ã€‚ */}

ç•¶[éƒ¨ç½²](/docs/app/getting-started/deploying)æ‚¨çš„ Next.js æ‡‰ç”¨ç¨‹å¼æ™‚ï¼Œæ‚¨å¯èƒ½å¸Œæœ›æ ¹æ“šåŸºç¤æ¶æ§‹é…ç½®ä¸åŒåŠŸèƒ½çš„è™•ç†æ–¹å¼ã€‚

> **ğŸ¥ è§€çœ‹å½±ç‰‡ï¼š** æ·±å…¥äº†è§£è‡ªè¡Œè¨—ç®¡ Next.js â†’ [YouTube (45 åˆ†é˜)](https://www.youtube.com/watch?v=sIVL4JMqRfc)ã€‚

## åœ–ç‰‡æœ€ä½³åŒ–

é€é `next/image` é€²è¡Œçš„[åœ–ç‰‡æœ€ä½³åŒ–](/docs/app/api-reference/components/image)åœ¨è‡ªè¡Œè¨—ç®¡æ™‚ä½¿ç”¨ `next start` éƒ¨ç½²æ™‚ç„¡éœ€é…ç½®å³å¯å·¥ä½œã€‚å¦‚æœæ‚¨å¸Œæœ›ä½¿ç”¨å–®ç¨çš„æœå‹™ä¾†æœ€ä½³åŒ–åœ–ç‰‡ï¼Œå¯ä»¥[é…ç½®åœ–ç‰‡è¼‰å…¥å™¨](/docs/app/api-reference/components/image#loader)ã€‚

åœ–ç‰‡æœ€ä½³åŒ–å¯ä»¥èˆ‡[éœæ…‹åŒ¯å‡º](/docs/app/guides/static-exports#image-optimization)ä¸€èµ·ä½¿ç”¨ï¼Œæ–¹æ³•æ˜¯åœ¨ `next.config.js` ä¸­å®šç¾©è‡ªè¨‚åœ–ç‰‡è¼‰å…¥å™¨ã€‚è«‹æ³¨æ„ï¼Œåœ–ç‰‡æ˜¯åœ¨åŸ·è¡Œæ™‚æœ€ä½³åŒ–ï¼Œè€Œéå»ºç½®æœŸé–“ã€‚

> **é ˆçŸ¥äº‹é …ï¼š**
>
> - åœ¨åŸºæ–¼ glibc çš„ Linux ç³»çµ±ä¸Šï¼Œåœ–ç‰‡æœ€ä½³åŒ–å¯èƒ½éœ€è¦[é¡å¤–é…ç½®](https://sharp.pixelplumbing.com/install#linux-memory-allocator)ä»¥é˜²æ­¢éåº¦è¨˜æ†¶é«”ä½¿ç”¨ã€‚
> - æ·±å…¥äº†è§£[æœ€ä½³åŒ–åœ–ç‰‡çš„å¿«å–è¡Œç‚º](/docs/app/api-reference/components/image#minimumcachettl)ä»¥åŠå¦‚ä½•é…ç½® TTLã€‚
> - æ‚¨ä¹Ÿå¯ä»¥[åœç”¨åœ–ç‰‡æœ€ä½³åŒ–](/docs/app/api-reference/components/image#unoptimized)ï¼ŒåŒæ™‚ä¿ç•™ä½¿ç”¨ `next/image` çš„å…¶ä»–å¥½è™•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨è‡ªè¡Œå–®ç¨æœ€ä½³åŒ–åœ–ç‰‡ã€‚

## ä¸­ä»‹è»Ÿé«”

[ä¸­ä»‹è»Ÿé«”](/docs/app/building-your-application/routing/middleware)åœ¨è‡ªè¡Œè¨—ç®¡æ™‚ä½¿ç”¨ `next start` éƒ¨ç½²æ™‚ç„¡éœ€é…ç½®å³å¯å·¥ä½œã€‚ç”±æ–¼å®ƒéœ€è¦å­˜å–å‚³å…¥è«‹æ±‚ï¼Œå› æ­¤åœ¨ä½¿ç”¨[éœæ…‹åŒ¯å‡º](/docs/app/guides/static-exports)æ™‚ä¸å—æ”¯æ´ã€‚

ä¸­ä»‹è»Ÿé«”ä½¿ç”¨[é‚Šç·£é‹è¡Œæ™‚](/docs/app/api-reference/edge)ï¼Œé€™æ˜¯æ‰€æœ‰å¯ç”¨ Node.js API çš„å­é›†ï¼Œä»¥å¹«åŠ©ç¢ºä¿ä½å»¶é²ï¼Œå› ç‚ºå®ƒå¯èƒ½åœ¨æ‡‰ç”¨ç¨‹å¼çš„æ¯å€‹è·¯ç”±æˆ–è³‡æºä¹‹å‰é‹è¡Œã€‚å¦‚æœæ‚¨ä¸å¸Œæœ›é€™æ¨£ï¼Œå¯ä»¥ä½¿ç”¨[å®Œæ•´çš„ Node.js é‹è¡Œæ™‚](/blog/next-15-2#nodejs-middleware-experimental)ä¾†é‹è¡Œä¸­ä»‹è»Ÿé«”ã€‚

å¦‚æœæ‚¨å¸Œæœ›æ–°å¢éœ€è¦æ‰€æœ‰ Node.js API çš„é‚è¼¯ï¼ˆæˆ–ä½¿ç”¨å¤–éƒ¨å¥—ä»¶ï¼‰ï¼Œæ‚¨å¯ä»¥å°‡æ­¤é‚è¼¯ç§»è‡³[ä½ˆå±€](/docs/app/api-reference/file-conventions/layout)ä½œç‚º[ä¼ºæœå™¨å…ƒä»¶](/docs/app/getting-started/server-and-client-components)ã€‚ä¾‹å¦‚ï¼Œæª¢æŸ¥[æ¨™é ­](/docs/app/api-reference/functions/headers)å’Œ[é‡æ–°å°å‘](/docs/app/api-reference/functions/redirect)ã€‚æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨æ¨™é ­ã€Cookie æˆ–æŸ¥è©¢åƒæ•¸é€é `next.config.js` é€²è¡Œ[é‡æ–°å°å‘](/docs/app/api-reference/config/next-config-js/redirects#header-cookie-and-query-matching)æˆ–[é‡å¯«](/docs/app/api-reference/config/next-config-js/rewrites#header-cookie-and-query-matching)ã€‚å¦‚æœé€™ä¸èµ·ä½œç”¨ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨[è‡ªè¨‚ä¼ºæœå™¨](/docs/pages/guides/custom-server)ã€‚

## ç’°å¢ƒè®Šæ•¸

Next.js æ”¯æ´å»ºç½®æ™‚å’ŒåŸ·è¡Œæ™‚ç’°å¢ƒè®Šæ•¸ã€‚

**é è¨­æƒ…æ³ä¸‹ï¼Œç’°å¢ƒè®Šæ•¸åƒ…åœ¨ä¼ºæœå™¨ä¸Šå¯ç”¨**ã€‚è¦å°‡ç’°å¢ƒè®Šæ•¸å…¬é–‹çµ¦ç€è¦½å™¨ï¼Œå¿…é ˆåŠ ä¸Š `NEXT_PUBLIC_` å‰ç¶´ã€‚ç„¶è€Œï¼Œé€™äº›å…¬é–‹ç’°å¢ƒè®Šæ•¸å°‡åœ¨ `next build` æœŸé–“å…§åµŒåˆ° JavaScript å¥—ä»¶ä¸­ã€‚

<PagesOnly>

è¦è®€å–åŸ·è¡Œæ™‚ç’°å¢ƒè®Šæ•¸ï¼Œæˆ‘å€‘å»ºè­°ä½¿ç”¨ `getServerSideProps` æˆ–[é€æ­¥æ¡ç”¨æ‡‰ç”¨ç¨‹å¼è·¯ç”±å™¨](/docs/app/guides/migrating/app-router-migration)ã€‚

</PagesOnly>

<AppOnly>

æ‚¨å¯ä»¥åœ¨å‹•æ…‹æ¸²æŸ“æœŸé–“å®‰å…¨åœ°åœ¨ä¼ºæœå™¨ä¸Šè®€å–ç’°å¢ƒè®Šæ•¸ã€‚

```tsx filename="app/page.ts" switcher
import { connection } from 'next/server'

export default async function Component() {
  await connection()
  // cookiesã€headers å’Œå…¶ä»–å‹•æ…‹ API
  // ä¹Ÿæœƒé¸æ“‡å‹•æ…‹æ¸²æŸ“ï¼Œæ„å‘³è‘—
  // æ­¤ç’°å¢ƒè®Šæ•¸åœ¨åŸ·è¡Œæ™‚è©•ä¼°
  const value = process.env.MY_VALUE
  // ...
}
```

```jsx filename="app/page.js" switcher
import { connection } from 'next/server'

export default async function Component() {
  await connection()
  // cookiesã€headers å’Œå…¶ä»–å‹•æ…‹ API
  // ä¹Ÿæœƒé¸æ“‡å‹•æ…‹æ¸²æŸ“ï¼Œæ„å‘³è‘—
  // æ­¤ç’°å¢ƒè®Šæ•¸åœ¨åŸ·è¡Œæ™‚è©•ä¼°
  const value = process.env.MY_VALUE
  // ...
}
```

</AppOnly>

é€™å…è¨±æ‚¨ä½¿ç”¨å–®ä¸€çš„ Docker æ˜ åƒï¼Œå¯ä»¥åœ¨å¤šå€‹ç’°å¢ƒä¸­æ¨å»£ï¼Œä¸¦ä½¿ç”¨ä¸åŒçš„å€¼ã€‚

> **é ˆçŸ¥äº‹é …ï¼š**
>
> - æ‚¨å¯ä»¥ä½¿ç”¨ [`register` å‡½å¼](/docs/app/guides/instrumentation)åœ¨ä¼ºæœå™¨å•Ÿå‹•æ™‚åŸ·è¡Œç¨‹å¼ç¢¼ã€‚
> - æˆ‘å€‘ä¸å»ºè­°ä½¿ç”¨ [runtimeConfig](/docs/pages/api-reference/config/next-config-js/runtime-configuration) é¸é …ï¼Œå› ç‚ºé€™ä¸é©ç”¨æ–¼ç¨ç«‹è¼¸å‡ºæ¨¡å¼ã€‚ç›¸åï¼Œæˆ‘å€‘å»ºè­°[é€æ­¥æ¡ç”¨](/docs/app/guides/migrating/app-router-migration)æ‡‰ç”¨ç¨‹å¼è·¯ç”±å™¨ã€‚

## å¿«å–èˆ‡ ISR

Next.js å¯ä»¥å¿«å–å›æ‡‰ã€ç”Ÿæˆçš„éœæ…‹é é¢ã€å»ºç½®è¼¸å‡ºä»¥åŠå…¶ä»–éœæ…‹è³‡æºï¼Œå¦‚åœ–ç‰‡ã€å­—å‹å’Œè…³æœ¬ã€‚

å¿«å–å’Œé‡æ–°é©—è­‰é é¢ï¼ˆä½¿ç”¨[å¢é‡éœæ…‹å†ç”Ÿ](/docs/app/guides/incremental-static-regeneration)ï¼‰ä½¿ç”¨**ç›¸åŒçš„å…±äº«å¿«å–**ã€‚é è¨­æƒ…æ³ä¸‹ï¼Œæ­¤å¿«å–å„²å­˜åœ¨ Next.js ä¼ºæœå™¨çš„æª”æ¡ˆç³»çµ±ï¼ˆç£ç¢Ÿï¼‰ä¸Šã€‚**é€™åœ¨è‡ªè¡Œè¨—ç®¡æ™‚è‡ªå‹•å·¥ä½œ**ï¼Œé©ç”¨æ–¼é é¢å’Œæ‡‰ç”¨ç¨‹å¼è·¯ç”±å™¨ã€‚

å¦‚æœæ‚¨å¸Œæœ›å°‡å¿«å–çš„é é¢å’Œè³‡æ–™æŒä¹…åŒ–åˆ°æŒä¹…å„²å­˜ï¼Œæˆ–åœ¨å¤šå€‹å®¹å™¨æˆ– Next.js æ‡‰ç”¨ç¨‹å¼å¯¦ä¾‹ä¹‹é–“å…±äº«å¿«å–ï¼Œå¯ä»¥é…ç½® Next.js å¿«å–ä½ç½®ã€‚

### è‡ªå‹•å¿«å–

- Next.js ç‚ºçœŸæ­£ä¸å¯è®Šçš„è³‡æºè¨­å®š `Cache-Control` æ¨™é ­ç‚º `public, max-age=31536000, immutable`ã€‚é€™ç„¡æ³•è¦†è“‹ã€‚é€™äº›ä¸å¯è®Šæª”æ¡ˆåœ¨æª”æ¡ˆåç¨±ä¸­åŒ…å« SHA é›œæ¹Šï¼Œå› æ­¤å¯ä»¥å®‰å…¨åœ°æ°¸ä¹…å¿«å–ã€‚ä¾‹å¦‚ï¼Œ[éœæ…‹åœ–ç‰‡åŒ¯å…¥](/docs/app/getting-started/images#local-images)ã€‚æ‚¨å¯ä»¥ç‚ºåœ–ç‰‡[é…ç½® TTL](/docs/app/api-reference/components/image#minimumcachettl)ã€‚
- å¢é‡éœæ…‹å†ç”Ÿ (ISR) è¨­å®š `Cache-Control` æ¨™é ­ç‚º `s-maxage: <åœ¨ getStaticProps ä¸­é‡æ–°é©—è­‰>, stale-while-revalidate`ã€‚æ­¤é‡æ–°é©—è­‰æ™‚é–“åœ¨æ‚¨çš„ [`getStaticProps` å‡½å¼](/docs/pages/building-your-application/data-fetching/get-static-props)ä¸­ä»¥ç§’ç‚ºå–®ä½å®šç¾©ã€‚å¦‚æœæ‚¨è¨­å®š `revalidate: false`ï¼Œå®ƒå°‡é è¨­ç‚ºä¸€å¹´çš„å¿«å–æŒçºŒæ™‚é–“ã€‚
- å‹•æ…‹æ¸²æŸ“çš„é é¢è¨­å®š `Cache-Control` æ¨™é ­ç‚º `private, no-cache, no-store, max-age=0, must-revalidate` ä»¥é˜²æ­¢ä½¿ç”¨è€…ç‰¹å®šè³‡æ–™è¢«å¿«å–ã€‚é€™é©ç”¨æ–¼æ‡‰ç”¨ç¨‹å¼è·¯ç”±å™¨å’Œé é¢è·¯ç”±å™¨ã€‚é€™ä¹ŸåŒ…æ‹¬[è‰ç¨¿æ¨¡å¼](/docs/app/guides/draft-mode)ã€‚

### éœæ…‹è³‡æº

å¦‚æœæ‚¨å¸Œæœ›åœ¨ä¸åŒçš„ç¶²åŸŸæˆ– CDN ä¸Šè¨—ç®¡éœæ…‹è³‡æºï¼Œå¯ä»¥åœ¨ `next.config.js` ä¸­ä½¿ç”¨ `assetPrefix` [é…ç½®](/docs/app/api-reference/config/next-config-js/assetPrefix)ã€‚Next.js å°‡åœ¨æª¢ç´¢ JavaScript æˆ– CSS æª”æ¡ˆæ™‚ä½¿ç”¨æ­¤è³‡æºå‰ç¶´ã€‚å°‡è³‡æºåˆ†é›¢åˆ°ä¸åŒçš„ç¶²åŸŸæœƒå¸¶ä¾† DNS å’Œ TLS è§£æçš„é¡å¤–æ™‚é–“é–‹éŠ·ã€‚

[æ·±å…¥äº†è§£ `assetPrefix`](/docs/app/api-reference/config/next-config-js/assetPrefix)ã€‚

### é…ç½®å¿«å–

é è¨­æƒ…æ³ä¸‹ï¼Œç”Ÿæˆçš„å¿«å–è³‡æºå°‡å„²å­˜åœ¨è¨˜æ†¶é«”ä¸­ï¼ˆé è¨­ç‚º 50mbï¼‰å’Œç£ç¢Ÿä¸Šã€‚å¦‚æœæ‚¨ä½¿ç”¨å®¹å™¨ç·¨æ’å¹³å°ï¼ˆå¦‚ Kubernetesï¼‰è¨—ç®¡ Next.jsï¼Œæ¯å€‹ pod å°‡æ“æœ‰å¿«å–çš„å‰¯æœ¬ã€‚ç‚ºé˜²æ­¢é¡¯ç¤ºéæ™‚è³‡æ–™ï¼ˆå› ç‚ºé è¨­æƒ…æ³ä¸‹å¿«å–ä¸åœ¨ pod ä¹‹é–“å…±äº«ï¼‰ï¼Œæ‚¨å¯ä»¥é…ç½® Next.js å¿«å–ä»¥æä¾›å¿«å–è™•ç†ç¨‹å¼ä¸¦åœç”¨è¨˜æ†¶é«”å¿«å–ã€‚

è¦åœ¨è‡ªè¡Œè¨—ç®¡æ™‚é…ç½® ISR/è³‡æ–™å¿«å–ä½ç½®ï¼Œå¯ä»¥åœ¨ `next.config.js` æª”æ¡ˆä¸­é…ç½®è‡ªè¨‚è™•ç†ç¨‹å¼ï¼š

```jsx filename="next.config.js"
module.exports = {
  cacheHandler: require.resolve('./cache-handler.js'),
  cacheMaxMemorySize: 0, // åœç”¨é è¨­è¨˜æ†¶é«”å¿«å–
}
```

ç„¶å¾Œï¼Œåœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„ä¸­å»ºç«‹ `cache-handler.js`ï¼Œä¾‹å¦‚ï¼š

```jsx filename="cache-handler.js"
const cache = new Map()

module.exports = class CacheHandler {
  constructor(options) {
    this.options = options
  }

  async get(key) {
    // é€™å¯ä»¥å„²å­˜åœ¨ä»»ä½•åœ°æ–¹ï¼Œä¾‹å¦‚æŒä¹…å„²å­˜
    return cache.get(key)
  }

  async set(key, data, ctx) {
    // é€™å¯ä»¥å„²å­˜åœ¨ä»»ä½•åœ°æ–¹ï¼Œä¾‹å¦‚æŒä¹…å„²å­˜
    cache.set(key, {
      value: data,
      lastModified: Date.now(),
      tags: ctx.tags,
    })
  }

  async revalidateTag(tags) {
    // tags æ˜¯å­—ä¸²æˆ–å­—ä¸²é™£åˆ—
    tags = [tags].flat()
    // éæ­·å¿«å–ä¸­çš„æ‰€æœ‰æ¢ç›®
    for (let [key, value] of cache) {
      // å¦‚æœå€¼çš„æ¨™ç±¤åŒ…å«æŒ‡å®šçš„æ¨™ç±¤ï¼Œåˆªé™¤æ­¤æ¢ç›®
      if (value.tags.some((tag) => tags.includes(tag))) {
        cache.delete(key)
      }
    }
  }

  // å¦‚æœæ‚¨å¸Œæœ›ç‚ºå–®ä¸€è«‹æ±‚æ“æœ‰è‡¨æ™‚è¨˜æ†¶é«”å¿«å–ï¼Œä¸¦åœ¨ä¸‹ä¸€å€‹è«‹æ±‚ä¹‹å‰é‡ç½®
  // æ‚¨å¯ä»¥åˆ©ç”¨æ­¤æ–¹æ³•
  resetRequestCache() {}
}
```

ä½¿ç”¨è‡ªè¨‚å¿«å–è™•ç†ç¨‹å¼å¯ä»¥ç¢ºä¿æ‰€æœ‰è¨—ç®¡ Next.js æ‡‰ç”¨ç¨‹å¼çš„ pod ä¹‹é–“çš„ä¸€è‡´æ€§ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°‡å¿«å–å€¼å„²å­˜åœ¨ä»»ä½•åœ°æ–¹ï¼Œå¦‚ [Redis](https://github.com/vercel/next.js/tree/canary/examples/cache-handler-redis) æˆ– AWS S3ã€‚

> **é ˆçŸ¥äº‹é …ï¼š**
>
> - `revalidatePath` æ˜¯å¿«å–æ¨™ç±¤ä¸Šçš„ä¾¿åˆ©å±¤ã€‚å‘¼å« `revalidatePath` å°‡ä½¿ç”¨æä¾›çš„é é¢çš„ç‰¹æ®Šé è¨­æ¨™ç±¤å‘¼å« `revalidateTag` å‡½å¼ã€‚

## å»ºç½®å¿«å–

Next.js åœ¨ `next build` æœŸé–“ç”Ÿæˆä¸€å€‹ ID ä¾†è­˜åˆ¥æ­£åœ¨æä¾›çš„æ‡‰ç”¨ç¨‹å¼ç‰ˆæœ¬ã€‚ç›¸åŒçš„å»ºç½®æ‡‰åœ¨å¤šå€‹å®¹å™¨ä¸­ä½¿ç”¨å’Œå•Ÿå‹•ã€‚

å¦‚æœæ‚¨ç‚ºç’°å¢ƒçš„æ¯å€‹éšæ®µé‡æ–°å»ºç½®ï¼Œå‰‡éœ€è¦ç”Ÿæˆä¸€è‡´çš„å»ºç½® ID ä»¥åœ¨å®¹å™¨ä¹‹é–“ä½¿ç”¨ã€‚åœ¨ `next.config.js` ä¸­ä½¿ç”¨ `generateBuildId` å‘½ä»¤ï¼š

```jsx filename="next.config.js"
module.exports = {
  generateBuildId: async () => {
    // é€™å¯ä»¥æ˜¯ä»»ä½•å…§å®¹ï¼Œä½¿ç”¨æœ€æ–°çš„ git é›œæ¹Š
    return process.env.GIT_HASH
  },
}
```

## ç‰ˆæœ¬åå·®

Next.js å°‡è‡ªå‹•ç·©è§£å¤§å¤šæ•¸[ç‰ˆæœ¬åå·®](https://www.industrialempathy.com/posts/version-skew/)å¯¦ä¾‹ï¼Œä¸¦åœ¨æª¢æ¸¬åˆ°æ™‚è‡ªå‹•é‡æ–°è¼‰å…¥æ‡‰ç”¨ç¨‹å¼ä»¥æª¢ç´¢æ–°è³‡æºã€‚ä¾‹å¦‚ï¼Œå¦‚æœ `deploymentId` ä¸åŒ¹é…ï¼Œé é¢ä¹‹é–“çš„è½‰æ›å°‡åŸ·è¡Œç¡¬å°èˆªè€Œéä½¿ç”¨é å–å€¼ã€‚

ç•¶æ‡‰ç”¨ç¨‹å¼é‡æ–°è¼‰å…¥æ™‚ï¼Œå¦‚æœæœªè¨­è¨ˆç‚ºåœ¨é é¢å°èˆªä¹‹é–“æŒä¹…åŒ–ï¼Œå‰‡å¯èƒ½æœƒä¸Ÿå¤±æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ URL ç‹€æ…‹æˆ–æœ¬åœ°å„²å­˜å°‡åœ¨é é¢é‡æ–°æ•´ç†å¾ŒæŒä¹…åŒ–ç‹€æ…‹ã€‚ç„¶è€Œï¼Œå…ƒä»¶ç‹€æ…‹å¦‚ `useState` å°‡åœ¨æ­¤é¡å°èˆªä¸­ä¸Ÿå¤±ã€‚

<AppOnly>

## ä¸²æµèˆ‡ Suspense

Next.js æ‡‰ç”¨ç¨‹å¼è·¯ç”±å™¨åœ¨è‡ªè¡Œè¨—ç®¡æ™‚æ”¯æ´[ä¸²æµå›æ‡‰](/docs/app/api-reference/file-conventions/loading)ã€‚å¦‚æœæ‚¨ä½¿ç”¨ Nginx æˆ–é¡ä¼¼ä»£ç†ï¼Œå‰‡éœ€è¦é…ç½®å®ƒä»¥åœç”¨ç·©è¡ä»¥å•Ÿç”¨ä¸²æµã€‚

ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥é€éå°‡ `X-Accel-Buffering` è¨­å®šç‚º `no` ä¾†åœ¨ Nginx ä¸­åœç”¨ç·©è¡ï¼š

```js filename="next.config.js"
module.exports = {
  async headers() {
    return [
      {
        source: '/:path*{/}?',
        headers: [
          {
            key: 'X-Accel-Buffering',
            value: 'no',
          },
        ],
      },
    ]
  },
}
```

## éƒ¨åˆ†é æ¸²æŸ“

[éƒ¨åˆ†é æ¸²æŸ“ï¼ˆå¯¦é©—æ€§ï¼‰](/docs/app/getting-started/partial-prerendering)é è¨­èˆ‡ Next.js ä¸€èµ·å·¥ä½œï¼Œä¸¦éåƒ…é™æ–¼ CDN çš„åŠŸèƒ½ã€‚é€™åŒ…æ‹¬ä½œç‚º Node.js ä¼ºæœå™¨ï¼ˆé€é `next start`ï¼‰éƒ¨ç½²ä»¥åŠèˆ‡ Docker å®¹å™¨ä¸€èµ·ä½¿ç”¨æ™‚ã€‚

## èˆ‡ CDN ä¸€èµ·ä½¿ç”¨

ç•¶åœ¨ Next.js æ‡‰ç”¨ç¨‹å¼å‰ä½¿ç”¨ CDN æ™‚ï¼Œé é¢å°‡åœ¨å­˜å–å‹•æ…‹ API æ™‚åŒ…å« `Cache-Control: private` å›æ‡‰æ¨™é ­ã€‚é€™ç¢ºä¿ç”Ÿæˆçš„ HTML é é¢æ¨™è¨˜ç‚ºä¸å¯å¿«å–ã€‚å¦‚æœé é¢å®Œå…¨é æ¸²æŸ“ç‚ºéœæ…‹ï¼Œå®ƒå°‡åŒ…å« `Cache-Control: public` ä»¥å…è¨±é é¢åœ¨ CDN ä¸Šå¿«å–ã€‚

å¦‚æœæ‚¨ä¸éœ€è¦æ··åˆéœæ…‹å’Œå‹•æ…‹å…ƒä»¶ï¼Œå¯ä»¥ä½¿æ•´å€‹è·¯ç”±éœæ…‹ä¸¦åœ¨ CDN ä¸Šå¿«å–è¼¸å‡º HTMLã€‚å¦‚æœæœªä½¿ç”¨å‹•æ…‹ APIï¼Œå‰‡æ­¤è‡ªå‹•éœæ…‹æœ€ä½³åŒ–æ˜¯åŸ·è¡Œ `next build` æ™‚çš„é è¨­è¡Œç‚ºã€‚

éš¨è‘—éƒ¨åˆ†é æ¸²æŸ“è¶¨æ–¼ç©©å®šï¼Œæˆ‘å€‘å°‡é€ééƒ¨ç½²é©é…å™¨ API æä¾›æ”¯æ´ã€‚

</AppOnly>

<AppOnly>

## `after`

[`after`](/docs/app/api-reference/functions/after) åœ¨ä½¿ç”¨ `next start` è‡ªè¡Œè¨—ç®¡æ™‚å®Œå…¨æ”¯æ´ã€‚

åœæ­¢ä¼ºæœå™¨æ™‚ï¼Œè«‹ç¢ºä¿é€éç™¼é€ `SIGINT` æˆ– `SIGTERM` ä¿¡è™Ÿä¸¦ç­‰å¾…ä¾†å¯¦ç¾å„ªé›…é—œæ©Ÿã€‚é€™å…è¨± Next.js ä¼ºæœå™¨ç­‰å¾…ï¼Œç›´åˆ° `after` å…§ä½¿ç”¨çš„å¾…è™•ç†å›å‘¼å‡½å¼æˆ– Promise å®Œæˆã€‚

</AppOnly>

<PagesOnly>

## æ‰‹å‹•å„ªé›…é—œæ©Ÿ

è‡ªè¡Œè¨—ç®¡æ™‚ï¼Œæ‚¨å¯èƒ½å¸Œæœ›åœ¨ä¼ºæœå™¨é—œé–‰æ™‚åœ¨ `SIGTERM` æˆ– `SIGINT` ä¿¡è™Ÿä¸ŠåŸ·è¡Œç¨‹å¼ç¢¼ã€‚

æ‚¨å¯ä»¥å°‡ç’°å¢ƒè®Šæ•¸ `NEXT_MANUAL_SIG_HANDLE` è¨­å®šç‚º `true`ï¼Œç„¶å¾Œåœ¨ `_document.js` æª”æ¡ˆä¸­ç‚ºè©²ä¿¡è™Ÿè¨»å†Šè™•ç†ç¨‹å¼ã€‚æ‚¨éœ€è¦ç›´æ¥åœ¨ `package.json` è…³æœ¬ä¸­è¨»å†Šç’°å¢ƒè®Šæ•¸ï¼Œè€Œä¸æ˜¯åœ¨ `.env` æª”æ¡ˆä¸­ã€‚

> **é ˆçŸ¥äº‹é …**ï¼šæ‰‹å‹•ä¿¡è™Ÿè™•ç†åœ¨ `next dev` ä¸­ä¸å¯ç”¨ã€‚

```json filename="package.json"
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "NEXT_MANUAL_SIG_HANDLE=true next start"
  }
}
```

```js filename="pages/_document.js"
if (process.env.NEXT_MANUAL_SIG_HANDLE) {
  process.on('SIGTERM', () => {
    console.log('æ”¶åˆ° SIGTERMï¼šæ¸…ç†ä¸­')
    process.exit(0)
  })
  process.on('SIGINT', () => {
    console.log('æ”¶åˆ° SIGINTï¼šæ¸…ç†ä¸­')
    process.exit(0)
  })
}
```

</PagesOnly>