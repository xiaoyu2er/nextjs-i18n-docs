---
source-updated-at: 2025-05-21T18:33:43.000Z
translation-updated-at: 2025-05-25T20:37:54.750Z
title: å¦‚ä½•è‡ªè¨—ç®¡ä½ çš„ Next.js æ‡‰ç”¨ç¨‹å¼
nav_title: è‡ªè¨—ç®¡
description: å­¸ç¿’å¦‚ä½•åœ¨ Node.js ä¼ºæœå™¨ã€Docker æ˜ åƒæˆ–éœæ…‹ HTML æª”æ¡ˆï¼ˆéœæ…‹åŒ¯å‡ºï¼‰ä¸Šè‡ªè¨—ç®¡ä½ çš„ Next.js æ‡‰ç”¨ç¨‹å¼ã€‚
---

{/* æ­¤æ–‡ä»¶å…§å®¹åœ¨ app å’Œ pages è·¯ç”±é–“å…±äº«ã€‚ä½ å¯ä»¥ä½¿ç”¨ `<PagesOnly>å…§å®¹</PagesOnly>` å…ƒä»¶ä¾†æ–°å¢å°ˆå±¬æ–¼ Pages Router çš„å…§å®¹ã€‚ä»»ä½•å…±äº«å…§å®¹ä¸æ‡‰åŒ…è£¹åœ¨å…ƒä»¶ä¸­ã€‚ */}

ç•¶[éƒ¨ç½²](/docs/app/getting-started/deploying)ä½ çš„ Next.js æ‡‰ç”¨ç¨‹å¼æ™‚ï¼Œä½ å¯èƒ½æœƒæƒ³æ ¹æ“šåŸºç¤æ¶æ§‹ä¾†é…ç½®ä¸åŒåŠŸèƒ½çš„è™•ç†æ–¹å¼ã€‚

> **ğŸ¥ è§€çœ‹å½±ç‰‡ï¼š** æ·±å…¥äº†è§£è‡ªè¨—ç®¡ Next.js â†’ [YouTube (45 åˆ†é˜)](https://www.youtube.com/watch?v=sIVL4JMqRfc)ã€‚

## åœ–ç‰‡æœ€ä½³åŒ–

é€é `next/image` é€²è¡Œçš„[åœ–ç‰‡æœ€ä½³åŒ–](/docs/app/api-reference/components/image)åœ¨ä½¿ç”¨ `next start` éƒ¨ç½²æ™‚ï¼Œç„¡éœ€é…ç½®å³å¯è‡ªè¨—ç®¡é‹ä½œã€‚å¦‚æœä½ åå¥½ä½¿ç”¨ç¨ç«‹æœå‹™ä¾†æœ€ä½³åŒ–åœ–ç‰‡ï¼Œå¯ä»¥[é…ç½®åœ–ç‰‡è¼‰å…¥å™¨](/docs/app/api-reference/components/image#loader)ã€‚

åœ–ç‰‡æœ€ä½³åŒ–å¯èˆ‡[éœæ…‹åŒ¯å‡º](/docs/app/guides/static-exports#image-optimization)ä¸€èµ·ä½¿ç”¨ï¼Œåªéœ€åœ¨ `next.config.js` ä¸­å®šç¾©è‡ªè¨‚åœ–ç‰‡è¼‰å…¥å™¨ã€‚è«‹æ³¨æ„ï¼Œåœ–ç‰‡æ˜¯åœ¨åŸ·è¡Œéšæ®µæœ€ä½³åŒ–ï¼Œè€Œéå»ºç½®æœŸé–“ã€‚

> **é ˆçŸ¥äº‹é …ï¼š**
>
> - åœ¨åŸºæ–¼ glibc çš„ Linux ç³»çµ±ä¸Šï¼Œåœ–ç‰‡æœ€ä½³åŒ–å¯èƒ½éœ€è¦[é¡å¤–é…ç½®](https://sharp.pixelplumbing.com/install#linux-memory-allocator)ä»¥é¿å…éåº¦è¨˜æ†¶é«”ä½¿ç”¨ã€‚
> - æ·±å…¥äº†è§£[æœ€ä½³åŒ–åœ–ç‰‡çš„å¿«å–è¡Œç‚º](/docs/app/api-reference/components/image#minimumcachettl)åŠå¦‚ä½•é…ç½® TTLã€‚
> - ä½ ä¹Ÿå¯ä»¥[åœç”¨åœ–ç‰‡æœ€ä½³åŒ–](/docs/app/api-reference/components/image#unoptimized)ä¸¦ä¿ç•™ä½¿ç”¨ `next/image` çš„å…¶ä»–å¥½è™•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å·²è‡ªè¡Œåˆ†é–‹æœ€ä½³åŒ–åœ–ç‰‡ã€‚

## ä¸­ä»‹è»Ÿé«”

[ä¸­ä»‹è»Ÿé«”](/docs/app/building-your-application/routing/middleware)åœ¨ä½¿ç”¨ `next start` éƒ¨ç½²æ™‚ï¼Œç„¡éœ€é…ç½®å³å¯è‡ªè¨—ç®¡é‹ä½œã€‚ç”±æ–¼å®ƒéœ€è¦å­˜å–å‚³å…¥è«‹æ±‚ï¼Œå› æ­¤ä¸æ”¯æ´[éœæ…‹åŒ¯å‡º](/docs/app/guides/static-exports)ã€‚

ä¸­ä»‹è»Ÿé«”ä½¿ç”¨[é‚Šç·£åŸ·è¡Œç’°å¢ƒ (Edge runtime)](/docs/app/api-reference/edge)ï¼Œé€™æ˜¯æ‰€æœ‰å¯ç”¨ Node.js API çš„å­é›†ï¼Œæœ‰åŠ©æ–¼ç¢ºä¿ä½å»¶é²ï¼Œå› ç‚ºå®ƒå¯èƒ½åœ¨æ‡‰ç”¨ç¨‹å¼çš„æ¯å€‹è·¯ç”±æˆ–è³‡ç”¢å‰åŸ·è¡Œã€‚å¦‚æœä¸å¸Œæœ›å¦‚æ­¤ï¼Œä½ å¯ä»¥ä½¿ç”¨[å®Œæ•´çš„ Node.js åŸ·è¡Œç’°å¢ƒ](/blog/next-15-2#nodejs-middleware-experimental)ä¾†åŸ·è¡Œä¸­ä»‹è»Ÿé«”ã€‚

å¦‚æœä½ æƒ³æ–°å¢éœ€è¦æ‰€æœ‰ Node.js API çš„é‚è¼¯ï¼ˆæˆ–ä½¿ç”¨å¤–éƒ¨å¥—ä»¶ï¼‰ï¼Œå¯ä»¥è€ƒæ…®å°‡æ­¤é‚è¼¯ç§»è‡³[ç‰ˆé¢é…ç½® (layout)](/docs/app/building-your-application/routing/layouts-and-templates#layouts) ä½œç‚º[ä¼ºæœå™¨å…ƒä»¶ (Server Component)](/docs/app/getting-started/server-and-client-components)ã€‚ä¾‹å¦‚ï¼Œæª¢æŸ¥[æ¨™é ­ (headers)](/docs/app/api-reference/functions/headers) å’Œ[é‡æ–°å°å‘ (redirecting)](/docs/app/api-reference/functions/redirect)ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æ¨™é ­ã€Cookie æˆ–æŸ¥è©¢åƒæ•¸é€é `next.config.js` é€²è¡Œ[é‡æ–°å°å‘](/docs/app/api-reference/config/next-config-js/redirects#header-cookie-and-query-matching)æˆ–[é‡å¯«](/docs/app/api-reference/config/next-config-js/rewrites#header-cookie-and-query-matching)ã€‚å¦‚æœé€™ä¸å¯è¡Œï¼Œä½ é‚„å¯ä»¥ä½¿ç”¨[è‡ªè¨‚ä¼ºæœå™¨](/docs/pages/guides/custom-server)ã€‚

## ç’°å¢ƒè®Šæ•¸

Next.js æ”¯æ´å»ºç½®æ™‚å’ŒåŸ·è¡Œéšæ®µçš„ç’°å¢ƒè®Šæ•¸ã€‚

**é è¨­æƒ…æ³ä¸‹ï¼Œç’°å¢ƒè®Šæ•¸åƒ…åœ¨ä¼ºæœå™¨ç«¯å¯ç”¨**ã€‚è¦å°‡ç’°å¢ƒè®Šæ•¸æš´éœ²çµ¦ç€è¦½å™¨ï¼Œå¿…é ˆåŠ ä¸Š `NEXT_PUBLIC_` å‰ç¶´ã€‚ç„¶è€Œï¼Œé€™äº›å…¬é–‹çš„ç’°å¢ƒè®Šæ•¸æœƒåœ¨ `next build` æœŸé–“å…§åµŒåˆ° JavaScript å¥—ä»¶ä¸­ã€‚

<PagesOnly>

è¦è®€å–åŸ·è¡Œéšæ®µçš„ç’°å¢ƒè®Šæ•¸ï¼Œæˆ‘å€‘å»ºè­°ä½¿ç”¨ `getServerSideProps` æˆ–[é€æ­¥æ¡ç”¨ App Router](/docs/app/guides/migrating/app-router-migration)ã€‚

</PagesOnly>

<AppOnly>

ä½ å¯ä»¥åœ¨å‹•æ…‹æ¸²æŸ“æœŸé–“å®‰å…¨åœ°åœ¨ä¼ºæœå™¨ç«¯è®€å–ç’°å¢ƒè®Šæ•¸ã€‚

```tsx filename="app/page.ts" switcher
import { connection } from 'next/server'

export default async function Component() {
  await connection()
  // cookiesã€headers å’Œå…¶ä»–å‹•æ…‹ API
  // ä¹Ÿæœƒå•Ÿç”¨å‹•æ…‹æ¸²æŸ“ï¼Œæ„å‘³è‘—
  // æ­¤ç’°å¢ƒè®Šæ•¸æœƒåœ¨åŸ·è¡Œéšæ®µè©•ä¼°
  const value = process.env.MY_VALUE
  // ...
}
```

```jsx filename="app/page.js" switcher
import { connection } from 'next/server'

export default async function Component() {
  await connection()
  // cookiesã€headers å’Œå…¶ä»–å‹•æ…‹ API
  // ä¹Ÿæœƒå•Ÿç”¨å‹•æ…‹æ¸²æŸ“ï¼Œæ„å‘³è‘—
  // æ­¤ç’°å¢ƒè®Šæ•¸æœƒåœ¨åŸ·è¡Œéšæ®µè©•ä¼°
  const value = process.env.MY_VALUE
  // ...
}
```

</AppOnly>

é€™è®“ä½ å¯ä»¥ä½¿ç”¨å–®ä¸€çš„ Docker æ˜ åƒï¼Œä¸¦åœ¨å¤šå€‹ç’°å¢ƒä¸­æ¨å»£ï¼ŒåŒæ™‚ä½¿ç”¨ä¸åŒçš„å€¼ã€‚

> **é ˆçŸ¥äº‹é …ï¼š**
>
> - ä½ å¯ä»¥ä½¿ç”¨ [`register` å‡½å¼](/docs/app/guides/instrumentation)åœ¨ä¼ºæœå™¨å•Ÿå‹•æ™‚åŸ·è¡Œç¨‹å¼ç¢¼ã€‚
> - æˆ‘å€‘ä¸å»ºè­°ä½¿ç”¨ [runtimeConfig](/docs/pages/api-reference/config/next-config-js/runtime-configuration) é¸é …ï¼Œå› ç‚ºé€™ä¸æ”¯æ´ç¨ç«‹è¼¸å‡ºæ¨¡å¼ã€‚ç›¸åï¼Œæˆ‘å€‘å»ºè­°[é€æ­¥æ¡ç”¨](/docs/app/guides/migrating/app-router-migration) App Routerã€‚

## å¿«å–èˆ‡ ISR

Next.js å¯ä»¥å¿«å–å›æ‡‰ã€ç”Ÿæˆçš„éœæ…‹é é¢ã€å»ºç½®è¼¸å‡ºä»¥åŠå…¶ä»–éœæ…‹è³‡ç”¢ï¼Œå¦‚åœ–ç‰‡ã€å­—å‹å’Œè…³æœ¬ã€‚

å¿«å–å’Œé‡æ–°é©—è­‰é é¢ï¼ˆä½¿ç”¨[å¢é‡éœæ…‹å†ç”Ÿ (ISR)](/docs/app/guides/incremental-static-regeneration)ï¼‰ä½¿ç”¨**ç›¸åŒçš„å…±äº«å¿«å–**ã€‚é è¨­æƒ…æ³ä¸‹ï¼Œæ­¤å¿«å–æœƒå„²å­˜åœ¨ Next.js ä¼ºæœå™¨çš„æª”æ¡ˆç³»çµ±ï¼ˆç£ç¢Ÿï¼‰ä¸Šã€‚**é€™åœ¨ä½¿ç”¨ Pages å’Œ App Router è‡ªè¨—ç®¡æ™‚æœƒè‡ªå‹•é‹ä½œ**ã€‚

å¦‚æœä½ æƒ³å°‡å¿«å–çš„é é¢å’Œè³‡æ–™æŒä¹…åŒ–åˆ°è€ä¹…æ€§å„²å­˜ï¼Œæˆ–åœ¨å¤šå€‹å®¹å™¨æˆ– Next.js æ‡‰ç”¨ç¨‹å¼å¯¦ä¾‹é–“å…±äº«å¿«å–ï¼Œå¯ä»¥é…ç½® Next.js å¿«å–ä½ç½®ã€‚

### è‡ªå‹•å¿«å–

- Next.js ç‚ºçœŸæ­£ä¸å¯è®Šçš„è³‡ç”¢è¨­å®š `Cache-Control` æ¨™é ­ç‚º `public, max-age=31536000, immutable`ã€‚é€™ç„¡æ³•è¢«è¦†å¯«ã€‚é€™äº›ä¸å¯è®Šæª”æ¡ˆåœ¨æª”åä¸­åŒ…å« SHA é›œæ¹Šï¼Œå› æ­¤å¯ä»¥å®‰å…¨åœ°æ°¸ä¹…å¿«å–ã€‚ä¾‹å¦‚ï¼Œ[éœæ…‹åœ–ç‰‡åŒ¯å…¥](/docs/app/getting-started/images#local-images)ã€‚ä½ å¯ä»¥ç‚ºåœ–ç‰‡[é…ç½® TTL](/docs/app/api-reference/components/image#minimumcachettl)ã€‚
- å¢é‡éœæ…‹å†ç”Ÿ (ISR) è¨­å®š `Cache-Control` æ¨™é ­ç‚º `s-maxage: <åœ¨ getStaticProps ä¸­è¨­å®šçš„é‡æ–°é©—è­‰æ™‚é–“>, stale-while-revalidate`ã€‚æ­¤é‡æ–°é©—è­‰æ™‚é–“åœ¨ä½ çš„ [`getStaticProps` å‡½å¼](/docs/pages/building-your-application/data-fetching/get-static-props)ä¸­ä»¥ç§’ç‚ºå–®ä½å®šç¾©ã€‚å¦‚æœè¨­å®š `revalidate: false`ï¼Œå‰‡é è¨­ç‚ºä¸€å¹´çš„å¿«å–æœŸé™ã€‚
- å‹•æ…‹æ¸²æŸ“çš„é é¢è¨­å®š `Cache-Control` æ¨™é ­ç‚º `private, no-cache, no-store, max-age=0, must-revalidate`ï¼Œä»¥é˜²æ­¢ä½¿ç”¨è€…ç‰¹å®šè³‡æ–™è¢«å¿«å–ã€‚é€™é©ç”¨æ–¼ App Router å’Œ Pages Routerã€‚é€™ä¹ŸåŒ…æ‹¬[è‰ç¨¿æ¨¡å¼ (Draft Mode)](/docs/app/guides/draft-mode)ã€‚

### éœæ…‹è³‡ç”¢

å¦‚æœä½ æƒ³åœ¨ä¸åŒçš„ç¶²åŸŸæˆ– CDN ä¸Šè¨—ç®¡éœæ…‹è³‡ç”¢ï¼Œå¯ä»¥åœ¨ `next.config.js` ä¸­ä½¿ç”¨ `assetPrefix` [é…ç½®](/docs/app/api-reference/config/next-config-js/assetPrefix)ã€‚Next.js æœƒåœ¨æ“·å– JavaScript æˆ– CSS æª”æ¡ˆæ™‚ä½¿ç”¨æ­¤è³‡ç”¢å‰ç¶´ã€‚å°‡è³‡ç”¢åˆ†é›¢åˆ°ä¸åŒç¶²åŸŸçš„ç¼ºé»æ˜¯éœ€è¦é¡å¤–çš„ DNS å’Œ TLS è§£ææ™‚é–“ã€‚

[æ·±å…¥äº†è§£ `assetPrefix`](/docs/app/api-reference/config/next-config-js/assetPrefix)ã€‚

### é…ç½®å¿«å–

é è¨­æƒ…æ³ä¸‹ï¼Œç”Ÿæˆçš„å¿«å–è³‡ç”¢æœƒå„²å­˜åœ¨è¨˜æ†¶é«”ä¸­ï¼ˆé è¨­ç‚º 50mbï¼‰å’Œç£ç¢Ÿä¸Šã€‚å¦‚æœä½ ä½¿ç”¨ Kubernetes ç­‰å®¹å™¨ç·¨æ’å¹³å°è¨—ç®¡ Next.jsï¼Œæ¯å€‹ pod éƒ½æœƒæœ‰ä¸€ä»½å¿«å–å‰¯æœ¬ã€‚ç‚ºé¿å…å› é è¨­æƒ…æ³ä¸‹ pod é–“ä¸å…±äº«å¿«å–è€Œé¡¯ç¤ºéæ™‚è³‡æ–™ï¼Œä½ å¯ä»¥é…ç½® Next.js å¿«å–ä»¥æä¾›å¿«å–è™•ç†å™¨ä¸¦åœç”¨è¨˜æ†¶é«”å¿«å–ã€‚

è¦åœ¨è‡ªè¨—ç®¡æ™‚é…ç½® ISR/è³‡æ–™å¿«å–ä½ç½®ï¼Œå¯ä»¥åœ¨ `next.config.js` æª”æ¡ˆä¸­é…ç½®è‡ªè¨‚è™•ç†å™¨ï¼š

```jsx filename="next.config.js"
module.exports = {
  cacheHandler: require.resolve('./cache-handler.js'),
  cacheMaxMemorySize: 0, // åœç”¨é è¨­çš„è¨˜æ†¶é«”å¿«å–
}
```

ç„¶å¾Œï¼Œåœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„å»ºç«‹ `cache-handler.js`ï¼Œä¾‹å¦‚ï¼š

```jsx filename="cache-handler.js"
const cache = new Map()

module.exports = class CacheHandler {
  constructor(options) {
    this.options = options
  }

  async get(key) {
    // é€™å¯ä»¥å„²å­˜åœ¨ä»»ä½•åœ°æ–¹ï¼Œå¦‚è€ä¹…æ€§å„²å­˜
    return cache.get(key)
  }

  async set(key, data, ctx) {
    // é€™å¯ä»¥å„²å­˜åœ¨ä»»ä½•åœ°æ–¹ï¼Œå¦‚è€ä¹…æ€§å„²å­˜
    cache.set(key, {
      value: data,
      lastModified: Date.now(),
      tags: ctx.tags,
    })
  }

  async revalidateTag(tags) {
    // tags å¯ä»¥æ˜¯å­—ä¸²æˆ–å­—ä¸²é™£åˆ—
    tags = [tags].flat()
    // éæ­·å¿«å–ä¸­çš„æ‰€æœ‰æ¢ç›®
    for (let [key, value] of cache) {
      // å¦‚æœå€¼çš„æ¨™ç±¤åŒ…å«æŒ‡å®šçš„æ¨™ç±¤ï¼Œå‰‡åˆªé™¤æ­¤æ¢ç›®
      if (value.tags.some((tag) => tags.includes(tag))) {
        cache.delete(key)
      }
    }
  }

  // å¦‚æœä½ æƒ³ç‚ºå–®ä¸€è«‹æ±‚è¨­å®šè‡¨æ™‚è¨˜æ†¶é«”å¿«å–ï¼Œä¸¦åœ¨ä¸‹ä¸€å€‹è«‹æ±‚å‰é‡ç½®
  // å¯ä»¥åˆ©ç”¨æ­¤æ–¹æ³•
  resetRequestCache() {}
}
```

ä½¿ç”¨è‡ªè¨‚å¿«å–è™•ç†å™¨å¯ä»¥ç¢ºä¿æ‰€æœ‰è¨—ç®¡ Next.js æ‡‰ç”¨ç¨‹å¼çš„ pod ä¹‹é–“çš„ä¸€è‡´æ€§ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å°‡å¿«å–å€¼å„²å­˜åœ¨ä»»ä½•åœ°æ–¹ï¼Œå¦‚ [Redis](https://github.com/vercel/next.js/tree/canary/examples/cache-handler-redis) æˆ– AWS S3ã€‚

> **é ˆçŸ¥äº‹é …ï¼š**
>
> - `revalidatePath` æ˜¯å¿«å–æ¨™ç±¤ä¸Šçš„ä¾¿åˆ©å±¤ã€‚å‘¼å« `revalidatePath` æœƒä½¿ç”¨é è¨­çš„ç‰¹æ®Šæ¨™ç±¤å‘¼å« `revalidateTag` å‡½å¼ã€‚

## å»ºç½®å¿«å–

Next.js åœ¨ `next build` æœŸé–“ç”Ÿæˆä¸€å€‹ IDï¼Œä»¥è­˜åˆ¥æ­£åœ¨æä¾›æœå‹™çš„æ‡‰ç”¨ç¨‹å¼ç‰ˆæœ¬ã€‚ç›¸åŒçš„å»ºç½®æ‡‰è¢«ä½¿ç”¨ä¸¦åœ¨å¤šå€‹å®¹å™¨ä¸­å•Ÿå‹•ã€‚

å¦‚æœä½ ç‚ºç’°å¢ƒçš„æ¯å€‹éšæ®µé‡æ–°å»ºç½®ï¼Œå‰‡éœ€è¦ç”Ÿæˆä¸€è‡´çš„å»ºç½® ID ä»¥åœ¨å®¹å™¨é–“ä½¿ç”¨ã€‚åœ¨ `next.config.js` ä¸­ä½¿ç”¨ `generateBuildId` æŒ‡ä»¤ï¼š

```jsx filename="next.config.js"
module.exports = {
  generateBuildId: async () => {
    // é€™å¯ä»¥æ˜¯ä»»ä½•å…§å®¹ï¼Œä½¿ç”¨æœ€æ–°çš„ git é›œæ¹Š
    return process.env.GIT_HASH
  },
}
```

## ç‰ˆæœ¬åå·®

Next.js æœƒè‡ªå‹•ç·©è§£å¤§å¤šæ•¸[ç‰ˆæœ¬åå·® (version skew)](https://www.industrialempathy.com/posts/version-skew/) çš„æƒ…æ³ï¼Œä¸¦åœ¨æª¢æ¸¬åˆ°æ™‚è‡ªå‹•é‡æ–°è¼‰å…¥æ‡‰ç”¨ç¨‹å¼ä»¥æ“·å–æ–°è³‡ç”¢ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ `deploymentId` ä¸åŒ¹é…ï¼Œé é¢é–“çš„è½‰æ›æœƒåŸ·è¡Œç¡¬å°èˆªè€Œéä½¿ç”¨é å…ˆæ“·å–çš„å€¼ã€‚

ç•¶æ‡‰ç”¨ç¨‹å¼é‡æ–°è¼‰å…¥æ™‚ï¼Œå¦‚æœæœªè¨­è¨ˆç‚ºåœ¨é é¢å°èˆªé–“æŒä¹…åŒ–ï¼Œå¯èƒ½æœƒéºå¤±æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ URL ç‹€æ…‹æˆ–æœ¬åœ°å„²å­˜æœƒåœ¨é é¢é‡æ–°æ•´ç†å¾Œä¿ç•™ç‹€æ…‹ã€‚ç„¶è€Œï¼Œå…ƒä»¶ç‹€æ…‹å¦‚ `useState` æœƒåœ¨æ­¤é¡å°èˆªä¸­éºå¤±ã€‚

<AppOnly>

## ä¸²æµèˆ‡ Suspense

Next.js App Router åœ¨è‡ªè¨—ç®¡æ™‚æ”¯æ´[ä¸²æµå›æ‡‰](/docs/app/building-your-application/routing/loading-ui-and-streaming)ã€‚å¦‚æœä½¿ç”¨ Nginx æˆ–é¡ä¼¼ä»£ç†ï¼Œéœ€é…ç½®å…¶åœç”¨ç·©è¡ä»¥å•Ÿç”¨ä¸²æµã€‚

ä¾‹å¦‚ï¼Œä½ å¯ä»¥é€éè¨­å®š `X-Accel-Buffering` ç‚º `no` ä¾†åœç”¨ Nginx çš„ç·©è¡ï¼š

```js filename="next.config.js"
module.exports = {
  async headers() {
    return [
      {
        source: '/:path*{/}?',
        headers: [
          {
            key: 'X-Accel-Buffering',
            value: 'no',
          },
        ],
      },
    ]
  },
}
```

## éƒ¨åˆ†é æ¸²æŸ“

[éƒ¨åˆ†é æ¸²æŸ“ (å¯¦é©—æ€§)](/docs/app/getting-started/partial-prerendering) é è¨­èˆ‡ Next.js ä¸€èµ·é‹ä½œï¼Œä¸¦éåƒ…é™ CDN çš„åŠŸèƒ½ã€‚é€™åŒ…æ‹¬ä½œç‚º Node.js ä¼ºæœå™¨éƒ¨ç½²ï¼ˆé€é `next start`ï¼‰å’Œä½¿ç”¨ Docker å®¹å™¨æ™‚ã€‚

## èˆ‡ CDN ä¸€èµ·ä½¿ç”¨

åœ¨ Next.js æ‡‰ç”¨ç¨‹å¼å‰ä½¿ç”¨ CDN æ™‚ï¼Œç•¶å­˜å–å‹•æ…‹ API æ™‚ï¼Œé é¢æœƒåŒ…å« `Cache-Control: private` å›æ‡‰æ¨™é ­ã€‚é€™ç¢ºä¿ç”Ÿæˆçš„ HTML é é¢è¢«æ¨™è¨˜ç‚ºä¸å¯å¿«å–ã€‚å¦‚æœé é¢å®Œå…¨é æ¸²æŸ“ç‚ºéœæ…‹ï¼Œå‰‡æœƒåŒ…å« `Cache-Control: public` ä»¥å…è¨±é é¢åœ¨ CDN ä¸Šå¿«å–ã€‚

å¦‚æœä¸éœ€è¦æ··åˆéœæ…‹å’Œå‹•æ…‹å…ƒä»¶ï¼Œå¯ä»¥å°‡æ•´å€‹è·¯ç”±è¨­ç‚ºéœæ…‹ä¸¦åœ¨ CDN ä¸Šå¿«å–è¼¸å‡º HTMLã€‚å¦‚æœæœªä½¿ç”¨å‹•æ…‹ APIï¼Œæ­¤è‡ªå‹•éœæ…‹æœ€ä½³åŒ–æ˜¯åŸ·è¡Œ `next build` æ™‚çš„é è¨­è¡Œç‚ºã€‚

éš¨è‘—éƒ¨åˆ†é æ¸²æŸ“è¶¨æ–¼ç©©å®šï¼Œæˆ‘å€‘å°‡é€ééƒ¨ç½²é©é…å™¨ API æä¾›æ”¯æ´ã€‚

</AppOnly>

<AppOnly>

## `after`

[`after`](/docs/app/api-reference/functions/after) åœ¨ä½¿ç”¨ `next start` è‡ªè¨—ç®¡æ™‚å®Œå…¨æ”¯æ´ã€‚

åœæ­¢ä¼ºæœå™¨æ™‚ï¼Œè«‹é€éç™¼é€ `SIGINT` æˆ– `SIGTERM` è¨Šè™Ÿä¸¦ç­‰å¾…ä¾†ç¢ºä¿å„ªé›…é—œæ©Ÿã€‚é€™è®“ Next.js ä¼ºæœå™¨èƒ½ç­‰å¾… `after` å…§ä½¿ç”¨çš„å¾…è™•ç†å›å‘¼å‡½å¼æˆ– Promise å®Œæˆã€‚

</AppOnly>

<PagesOnly>

## æ‰‹å‹•å„ªé›…é—œæ©Ÿ

è‡ªè¨—ç®¡æ™‚ï¼Œä½ å¯èƒ½æƒ³åœ¨ä¼ºæœå™¨å›  `SIGTERM` æˆ– `SIGINT` è¨Šè™Ÿé—œé–‰æ™‚åŸ·è¡Œç¨‹å¼ç¢¼ã€‚

ä½ å¯ä»¥å°‡ç’°å¢ƒè®Šæ•¸ `NEXT_MANUAL_SIG_HANDLE` è¨­ç‚º `true`ï¼Œç„¶å¾Œåœ¨ `_document.js` æª”æ¡ˆä¸­ç‚ºè©²è¨Šè™Ÿè¨»å†Šè™•ç†å™¨ã€‚ä½ éœ€è¦åœ¨ `package.json` è…³æœ¬ä¸­ç›´æ¥è¨»å†Šç’°å¢ƒè®Šæ•¸ï¼Œè€Œéåœ¨ `.env` æª”æ¡ˆä¸­ã€‚

> **é ˆçŸ¥äº‹é …**ï¼šæ‰‹å‹•è¨Šè™Ÿè™•ç†åœ¨ `next dev` ä¸­ä¸å¯ç”¨ã€‚

```json filename="package.json"
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "NEXT_MANUAL_SIG_HANDLE=true next start"
  }
}
```

```js filename="pages/_document.js"
if (process.env.NEXT_MANUAL_SIG_HANDLE) {
  process.on('SIGTERM', () => {
    console.log('æ”¶åˆ° SIGTERM: æ¸…ç†ä¸­')
    process.exit(0)
  })
  process.on('SIGINT', () => {
    console.log('æ”¶åˆ° SIGINT: æ¸…ç†ä¸­')
    process.exit(0)
  })
}
```

</PagesOnly>