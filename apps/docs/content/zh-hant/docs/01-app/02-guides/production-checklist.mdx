---
source-updated-at: 2025-05-21T18:33:43.000Z
translation-updated-at: 2025-05-25T20:38:59.879Z
title: 如何優化 Next.js 應用程式以投入生產環境
nav_title: 生產環境
description: 在將 Next.js 應用程式投入生產環境前，確保最佳效能和使用者體驗的建議事項。
---

在將 Next.js 應用程式投入生產環境前，您應考慮實施一些優化和模式，以獲得最佳的使用者體驗、效能和安全性。

本頁提供了最佳實踐，您可以在[開發應用程式時](#during-development)和[投入生產環境前](#before-going-to-production)作為參考，同時也列出了您應該了解的[Next.js 自動優化功能](#automatic-optimizations)。

## 自動優化

以下 Next.js 優化功能預設啟用且無需配置：

<AppOnly>

- **[伺服器元件 (Server Components)](/docs/app/getting-started/server-and-client-components):** Next.js 預設使用伺服器元件。伺服器元件在伺服器端運行，無需客戶端 JavaScript 即可渲染，因此不會影響客戶端 JavaScript 套件的大小。您可視需要搭配使用[客戶端元件 (Client Components)](/docs/app/getting-started/server-and-client-components) 來實現互動功能。
- **[程式碼分割 (Code-splitting)](/docs/app/building-your-application/routing/linking-and-navigating#how-routing-and-navigation-works):** 伺服器元件能按路由區段自動進行程式碼分割。您也可視情況[延遲載入 (lazy loading)](/docs/app/guides/lazy-loading) 客戶端元件和第三方函式庫。
- **[預取 (Prefetching)](/docs/app/building-your-application/routing/linking-and-navigating#2-prefetching):** 當使用者視窗內出現新路由連結時，Next.js 會在背景預取該路由，使導航幾乎瞬間完成。您可視情況選擇關閉預取功能。
- **[靜態渲染 (Static Rendering)](/docs/app/getting-started/partial-prerendering#static-rendering):** Next.js 會在建置時於伺服器端靜態渲染伺服器和客戶端元件，並快取渲染結果以提升應用程式效能。您可視情況針對特定路由選擇[動態渲染 (Dynamic Rendering)](/docs/app/getting-started/partial-prerendering#dynamic-rendering)。 {/* TODO: 待 PPR 穩定後更新 */}
- **[快取 (Caching)](/docs/app/deep-dive/caching):** Next.js 會快取資料請求、伺服器和客戶端元件的渲染結果、靜態資源等，以減少對伺服器、資料庫和後端服務的網路請求次數。您可視情況選擇關閉快取功能。

</AppOnly>

<PagesOnly>

- **[程式碼分割 (Code-splitting)](/docs/pages/building-your-application/routing/pages-and-layouts):** Next.js 會按頁面自動分割應用程式程式碼，確保導航時僅載入當前頁面所需的程式碼。您也可視情況[延遲載入 (lazy loading)](/docs/pages/guides/lazy-loading) 第三方函式庫。
- **[預取 (Prefetching)](/docs/pages/api-reference/components/link#prefetch):** 當使用者視窗內出現新路由連結時，Next.js 會在背景預取該路由，使導航幾乎瞬間完成。您可視情況選擇關閉預取功能。
- **[自動靜態優化 (Automatic Static Optimization)](/docs/pages/building-your-application/rendering/automatic-static-optimization):** 若頁面無需阻塞式資料請求，Next.js 會自動判定其為靜態頁面（可預渲染）。優化後的頁面可被快取，並從多個 CDN 節點提供給終端使用者。您可視情況選擇啟用[伺服器端渲染 (Server-side Rendering)](/docs/pages/building-your-application/data-fetching/get-server-side-props)。

</PagesOnly>

這些預設功能旨在提升應用程式效能，並減少每個網路請求的資料傳輸量和成本。

## 開發期間

在開發應用程式時，我們建議使用以下功能以確保最佳效能和使用者體驗：

### 路由與渲染

<AppOnly>

- **[版面配置 (Layouts)](/docs/app/building-your-application/routing/layouts-and-templates#layouts):** 使用版面配置跨頁面共享 UI，並啟用導航時的[部分渲染 (partial rendering)](/docs/app/building-your-application/routing/linking-and-navigating#4-partial-rendering)。
- **[`<Link>` 元件](/docs/app/building-your-application/routing/linking-and-navigating#link-component):** 使用 `<Link>` 元件實現[客戶端導航和預取功能](/docs/app/building-your-application/routing/linking-and-navigating#how-routing-and-navigation-works)。
- **[錯誤處理 (Error Handling)](/docs/app/building-your-application/routing/error-handling):** 透過建立自訂錯誤頁面，優雅處理生產環境中的[全域錯誤 (catch-all errors)](/docs/app/building-your-application/routing/error-handling) 和 [404 錯誤](/docs/app/api-reference/file-conventions/not-found)。
- **[客戶端與伺服器元件 (Client and Server Components)](/docs/app/getting-started/server-and-client-components#examples):** 遵循伺服器和客戶端元件的推薦組合模式，並檢查 [`"use client"` 邊界](/docs/app/getting-started/server-and-client-components#examples#moving-client-components-down-the-tree)的放置位置，避免不必要地增加客戶端 JavaScript 套件大小。
- **[動態 API (Dynamic APIs)](/docs/app/getting-started/partial-prerendering#dynamic-rendering):** 注意 [`cookies`](/docs/app/api-reference/functions/cookies) 和 [`searchParams`](/docs/app/api-reference/file-conventions/page#searchparams-optional) 等動態 API 會使整個路由轉為[動態渲染 (Dynamic Rendering)](/docs/app/getting-started/partial-prerendering#dynamic-rendering)（若用於[根版面配置 (Root Layout)](/docs/app/building-your-application/routing/layouts-and-templates#root-layout-required) 則影響整個應用程式）。確保動態 API 的使用是經過規劃的，並視情況用 `<Suspense>` 邊界包裹它們。

> **須知**: [部分預渲染 (Partial Prerendering) (實驗性功能)](/blog/next-14#partial-prerendering-preview) 將允許路由部分動態化，而無需將整個路由轉為動態渲染。

</AppOnly>

<PagesOnly>

- **[`<Link>` 元件](/docs/pages/building-your-application/routing/linking-and-navigating):** 使用 `<Link>` 元件實現客戶端導航和預取功能。
- **[自訂錯誤頁面 (Custom Errors)](/docs/pages/building-your-application/routing/custom-error):** 優雅處理 [500](/docs/pages/building-your-application/routing/custom-error#500-page) 和 [404 錯誤](/docs/pages/building-your-application/routing/custom-error#404-page)。

</PagesOnly>

### 資料獲取與快取

<AppOnly>

- **[伺服器元件 (Server Components)](/docs/app/building-your-application/data-fetching/fetching):** 善用伺服器元件在伺服器端獲取資料的優勢。
- **[路由處理器 (Route Handlers)](/docs/app/building-your-application/routing/route-handlers):** 使用路由處理器從客戶端元件存取後端資源，但避免從伺服器元件呼叫路由處理器，以免產生額外的伺服器請求。
- **[串流 (Streaming)](/docs/app/building-your-application/routing/loading-ui-and-streaming):** 使用載入 UI 和 React Suspense 逐步從伺服器向客戶端發送 UI，防止整個路由在資料獲取期間被阻塞。
- **[平行資料獲取 (Parallel Data Fetching)](/docs/app/getting-started/fetching-data#parallel-data-fetching):** 適時平行獲取資料以減少網路瀑布流。同時可視情況考慮[預載資料 (preloading data)](/docs/app/getting-started/fetching-data#preloading-data)。
- **[資料快取 (Data Caching)](/docs/app/deep-dive/caching#data-cache):** 確認您的資料請求是否被快取，並適時啟用快取功能。確保未使用 `fetch` 的請求也能被[快取](/docs/app/api-reference/functions/unstable_cache)。
- **[靜態圖片 (Static Images)](/docs/app/api-reference/file-conventions/public-folder):** 使用 `public` 目錄自動快取應用程式的靜態資源（例如圖片）。

</AppOnly>

<PagesOnly>

- **[API 路由 (API Routes)](/docs/pages/building-your-application/routing/api-routes):** 使用路由處理器存取後端資源，避免敏感資訊暴露給客戶端。
- **[資料快取 (Data Caching)](/docs/pages/building-your-application/data-fetching/get-static-props):** 確認您的資料請求是否被快取，並適時啟用快取功能。確保未使用 `getStaticProps` 的請求也能在適當時機被快取。
- **[增量靜態再生 (Incremental Static Regeneration)](/docs/pages/guides/incremental-static-regeneration):** 使用增量靜態再生在建置後更新靜態頁面，無需重新建置整個網站。
- **[靜態圖片 (Static Images)](/docs/pages/api-reference/file-conventions/public-folder):** 使用 `public` 目錄自動快取應用程式的靜態資源（例如圖片）。

</PagesOnly>

### UI 與無障礙性

<AppOnly>

- **[表單與驗證 (Forms and Validation)](/docs/app/building-your-application/data-fetching/server-actions-and-mutations#forms):** 使用伺服器動作 (Server Actions) 處理表單提交、伺服器端驗證和錯誤處理。

</AppOnly>

- **[字體模組 (Font Module)](/docs/app/api-reference/components/font):** 使用字體模組優化字體，該功能會自動託管您的字體檔案與其他靜態資源，移除外部網路請求並減少[版面偏移 (layout shift)](https://web.dev/articles/cls)。
- **[`<Image>` 元件](/docs/app/api-reference/components/image):** 使用圖片元件優化圖片，該元件會自動優化圖片、防止版面偏移，並以 WebP 等現代格式提供。
- **[`<Script>` 元件](/docs/app/guides/scripts):** 使用指令碼元件優化第三方指令碼，該元件會自動延遲載入指令碼，防止其阻塞主執行緒。
- **[ESLint](/docs/architecture/accessibility#linting):** 使用內建的 `eslint-plugin-jsx-a11y` 插件及早發現無障礙性問題。

### 安全性

<AppOnly>

- **[標記污染 (Tainting)](/docs/app/api-reference/config/next-config-js/taint):** 透過標記資料物件或特定值，防止敏感資料暴露給客戶端。
- **[伺服器動作 (Server Actions)](/docs/app/building-your-application/data-fetching/server-actions-and-mutations#authentication-and-authorization):** 確保使用者有權限呼叫伺服器動作。請檢閱推薦的[安全實踐](/blog/security-nextjs-server-components-actions)。

</AppOnly>

- **[環境變數 (Environment Variables)](/docs/app/guides/environment-variables):** 確保您的 `.env.*` 檔案已加入 `.gitignore`，且僅公開變數以 `NEXT_PUBLIC_` 為前綴。
- **[內容安全政策 (Content Security Policy)](/docs/app/guides/content-security-policy):** 考慮新增內容安全政策，保護應用程式免受跨站腳本、點擊劫持和其他程式碼注入攻擊等安全威脅。

### 元資料與 SEO

<AppOnly>

- **[元資料 API (Metadata API)](/docs/app/getting-started/metadata-and-og-images):** 使用元資料 API 新增頁面標題、描述等資訊，提升應用程式的搜尋引擎優化 (SEO)。
- **[開放圖譜 (OG) 圖片](/docs/app/api-reference/file-conventions/metadata/opengraph-image):** 建立 OG 圖片為社交分享做準備。
- **[網站地圖 (Sitemaps)](/docs/app/api-reference/functions/generate-sitemaps) 與 [robots 檔案](/docs/app/api-reference/file-conventions/metadata/robots):** 透過產生網站地圖和 robots 檔案，協助搜尋引擎爬取和索引您的頁面。

</AppOnly>

<PagesOnly>

- **[`<Head>` 元件](/docs/pages/api-reference/components/head):** 使用 `next/head` 元件新增頁面標題、描述等資訊。

</PagesOnly>

### 型別安全

- **TypeScript 與 [TS 插件](/docs/app/api-reference/config/typescript):** 使用 TypeScript 和 TypeScript 插件提升型別安全性，幫助您及早發現錯誤。

## 投入生產環境前

在投入生產環境前，您可以執行 `next build` 在本機建置應用程式並捕捉任何建置錯誤，然後執行 `next start` 在類生產環境中測量應用程式效能。

### 核心網頁指標

- **[Lighthouse](https://developers.google.com/web/tools/lighthouse):** 在無痕模式下執行 Lighthouse，更深入了解使用者體驗並找出改進點。這是模擬測試，應搭配實際數據（如核心網頁指標）一起檢視。

<AppOnly>

- **[`useReportWebVitals` 鉤子](/docs/app/api-reference/functions/use-report-web-vitals):** 使用此鉤子將[核心網頁指標 (Core Web Vitals)](https://web.dev/articles/vitals) 資料傳送至分析工具。

</AppOnly>

### 分析套件

使用 [`@next/bundle-analyzer` 插件](/docs/app/guides/package-bundling#analyzing-javascript-bundles) 分析 JavaScript 套件大小，找出可能影響應用程式效能的大型模組和依賴項。

此外，以下工具可幫助您了解新增依賴項對應用程式的影響：

- [Import Cost](https://marketplace.visualstudio.com/items?itemName=wix.vscode-import-cost)
- [Package Phobia](https://packagephobia.com/)
- [Bundle Phobia](https://bundlephobia.com/)
- [bundlejs](https://bundlejs.com/)