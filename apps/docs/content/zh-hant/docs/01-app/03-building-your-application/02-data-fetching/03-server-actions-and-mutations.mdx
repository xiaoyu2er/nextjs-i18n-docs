---
source-updated-at: 2025-05-25T15:16:02.000Z
translation-updated-at: 2025-05-25T21:03:11.599Z
title: ä¼ºæœå™¨æ“ä½œèˆ‡è³‡æ–™ç•°å‹•
nav_title: ä¼ºæœå™¨æ“ä½œèˆ‡è³‡æ–™ç•°å‹•
description: å­¸ç¿’å¦‚ä½•ä½¿ç”¨ Next.js è™•ç†è¡¨å–®æäº¤èˆ‡è³‡æ–™ç•°å‹•ã€‚
related:
  description: äº†è§£å¦‚ä½•åœ¨ Next.js ä¸­è¨­å®šä¼ºæœå™¨æ“ä½œ
  links:
    - app/api-reference/config/next-config-js/serverActions
---

[ä¼ºæœå™¨æ“ä½œ (Server Actions)](https://react.dev/reference/rsc/server-actions) æ˜¯åœ¨ä¼ºæœå™¨ç«¯åŸ·è¡Œçš„**éåŒæ­¥å‡½å¼**ã€‚å¯åœ¨ä¼ºæœå™¨èˆ‡å®¢æˆ¶ç«¯å…ƒä»¶ä¸­å‘¼å«ï¼Œç”¨æ–¼è™•ç† Next.js æ‡‰ç”¨ç¨‹å¼ä¸­çš„è¡¨å–®æäº¤èˆ‡è³‡æ–™ç•°å‹•ã€‚

> **ğŸ¥ è§€çœ‹å½±ç‰‡ï¼š** æ·±å…¥äº†è§£ä½¿ç”¨ä¼ºæœå™¨æ“ä½œé€²è¡Œè³‡æ–™ç•°å‹• â†’ [YouTube (10 åˆ†é˜)](https://youtu.be/dDpZfOQBMaU?si=cJZHlUu_jFhCzHUg)ã€‚

## æ…£ä¾‹

ä¼ºæœå™¨æ“ä½œå¯ä½¿ç”¨ React çš„ [`"use server"`](https://react.dev/reference/react/use-server) æŒ‡ä»¤å®šç¾©ã€‚æ‚¨å¯å°‡æŒ‡ä»¤ç½®æ–¼ `async` å‡½å¼é ‚ç«¯æ¨™è¨˜è©²å‡½å¼ç‚ºä¼ºæœå™¨æ“ä½œï¼Œæˆ–ç½®æ–¼ç¨ç«‹æª”æ¡ˆé ‚ç«¯æ¨™è¨˜è©²æª”æ¡ˆæ‰€æœ‰åŒ¯å‡ºç‚ºä¼ºæœå™¨æ“ä½œã€‚

### ä¼ºæœå™¨å…ƒä»¶

ä¼ºæœå™¨å…ƒä»¶å¯ä½¿ç”¨è¡Œå…§å‡½å¼å±¤ç´šæˆ–æ¨¡çµ„å±¤ç´šçš„ `"use server"` æŒ‡ä»¤ã€‚è‹¥è¦è¡Œå…§å®šç¾©ä¼ºæœå™¨æ“ä½œï¼Œè«‹åœ¨å‡½å¼ä¸»é«”é ‚ç«¯åŠ å…¥ `"use server"`ï¼š

```tsx filename="app/page.tsx" switcher
export default function Page() {
  // ä¼ºæœå™¨æ“ä½œ
  async function create() {
    'use server'
    // ç•°å‹•è³‡æ–™
  }

  return '...'
}
```

```jsx filename="app/page.js" switcher
export default function Page() {
  // ä¼ºæœå™¨æ“ä½œ
  async function create() {
    'use server'
    // ç•°å‹•è³‡æ–™
  }

  return '...'
}
```

### å®¢æˆ¶ç«¯å…ƒä»¶

è¦åœ¨å®¢æˆ¶ç«¯å…ƒä»¶ä¸­å‘¼å«[ä¼ºæœå™¨å‡½å¼](/docs/app/getting-started/updating-data#server-functions)ï¼Œè«‹å»ºç«‹æ–°æª”æ¡ˆä¸¦åœ¨é ‚ç«¯åŠ å…¥ `"use server"` æŒ‡ä»¤ã€‚æª”æ¡ˆå…§æ‰€æœ‰åŒ¯å‡ºå‡½å¼å°‡è¢«æ¨™è¨˜ç‚ºå¯åœ¨å®¢æˆ¶ç«¯èˆ‡ä¼ºæœå™¨å…ƒä»¶ä¸­é‡è¤‡ä½¿ç”¨çš„ä¼ºæœå™¨å‡½å¼ï¼š

```tsx filename="app/actions.ts" switcher
'use server'

export async function create() {}
```

```js filename="app/actions.js" switcher
'use server'

export async function create() {}
```

```tsx filename="app/button.tsx" switcher
'use client'

import { create } from './actions'

export function Button() {
  return <button onClick={() => create()}>å»ºç«‹</button>
}
```

```jsx filename="app/button.js" switcher
'use client'

import { create } from './actions'

export function Button() {
  return <button onClick={() => create()}>å»ºç«‹</button>
}
```

### å°‡æ“ä½œä½œç‚ºå±¬æ€§å‚³é

æ‚¨ä¹Ÿå¯å°‡ä¼ºæœå™¨æ“ä½œä½œç‚ºå±¬æ€§å‚³éçµ¦å®¢æˆ¶ç«¯å…ƒä»¶ï¼š

```jsx
<ClientComponent updateItemAction={updateItem} />
```

```tsx filename="app/client-component.tsx" switcher
'use client'

export default function ClientComponent({
  updateItemAction,
}: {
  updateItemAction: (formData: FormData) => void
}) {
  return <form action={updateItemAction}>{/* ... */}</form>
}
```

```jsx filename="app/client-component.js" switcher
'use client'

export default function ClientComponent({ updateItemAction }) {
  return <form action={updateItemAction}>{/* ... */}</form>
}
```

é€šå¸¸ Next.js TypeScript æ’ä»¶æœƒæ¨™è¨˜ `client-component.tsx` ä¸­çš„ `updateItemAction`ï¼Œå› ç‚ºé€™é€šå¸¸æ˜¯ç„¡æ³•åœ¨å®¢æˆ¶ç«¯-ä¼ºæœå™¨é‚Šç•Œåºåˆ—åŒ–çš„å‡½å¼ã€‚ä½†åç¨±ä»¥ `action` çµå°¾æˆ–å‘½åç‚º `Action` çš„å±¬æ€§æœƒè¢«å‡å®šç‚ºæ¥æ”¶ä¼ºæœå™¨æ“ä½œã€‚é€™åƒ…æ˜¯å•Ÿç™¼å¼è¦å‰‡ï¼Œå› ç‚º TypeScript æ’ä»¶å¯¦éš›ä¸Šç„¡æ³•åˆ¤æ–·æ˜¯å¦æ¥æ”¶ä¼ºæœå™¨æ“ä½œæˆ–æ™®é€šå‡½å¼ã€‚åŸ·è¡Œæ™‚é¡å‹æª¢æŸ¥ä»æœƒç¢ºä¿æ‚¨ä¸æœƒæ„å¤–å°‡å‡½å¼å‚³éçµ¦å®¢æˆ¶ç«¯å…ƒä»¶ã€‚

## è¡Œç‚º

- ä¼ºæœå™¨æ“ä½œå¯é€é [`<form>` å…ƒç´ ](#forms)çš„ `action` å±¬æ€§å‘¼å«ï¼š
  - ä¼ºæœå™¨å…ƒä»¶é è¨­æ”¯æ´æ¼¸é€²å¢å¼·ï¼Œæ„å‘³è‘—å³ä½¿ JavaScript å°šæœªè¼‰å…¥æˆ–åœç”¨ï¼Œè¡¨å–®ä»æœƒæäº¤ã€‚
  - åœ¨å®¢æˆ¶ç«¯å…ƒä»¶ä¸­ï¼Œå‘¼å«ä¼ºæœå™¨æ“ä½œçš„è¡¨å–®è‹¥ JavaScript å°šæœªè¼‰å…¥ï¼Œæœƒæ’éšŠæäº¤ï¼Œå„ªå…ˆè™•ç†å®¢æˆ¶ç«¯æ°´åˆã€‚
  - æ°´åˆå¾Œï¼Œç€è¦½å™¨ä¸æœƒåœ¨è¡¨å–®æäº¤æ™‚é‡æ–°æ•´ç†ã€‚
- ä¼ºæœå™¨æ“ä½œä¸é™æ–¼ `<form>`ï¼Œå¯å¾äº‹ä»¶è™•ç†ç¨‹åºã€`useEffect`ã€ç¬¬ä¸‰æ–¹å‡½å¼åº«åŠå…¶ä»–è¡¨å–®å…ƒç´ å¦‚ `<button>` å‘¼å«ã€‚
- ä¼ºæœå™¨æ“ä½œèˆ‡ Next.js [å¿«å–èˆ‡é‡æ–°é©—è­‰](/docs/app/deep-dive/caching)æ¶æ§‹æ•´åˆã€‚ç•¶æ“ä½œè¢«å‘¼å«æ™‚ï¼ŒNext.js å¯åœ¨å–®æ¬¡ä¼ºæœå™¨å¾€è¿”ä¸­åŒæ™‚å›å‚³æ›´æ–°çš„ UI èˆ‡æ–°è³‡æ–™ã€‚
- åº•å±¤å¯¦ä½œä¸­ï¼Œæ“ä½œä½¿ç”¨ `POST` æ–¹æ³•ï¼Œä¸”åƒ…æ­¤ HTTP æ–¹æ³•å¯å‘¼å«å®ƒå€‘ã€‚
- ä¼ºæœå™¨æ“ä½œçš„åƒæ•¸èˆ‡å›å‚³å€¼å¿…é ˆå¯è¢« React åºåˆ—åŒ–ã€‚è«‹åƒé–± React æ–‡ä»¶äº†è§£[å¯åºåˆ—åŒ–åƒæ•¸èˆ‡å€¼](https://react.dev/reference/react/use-server#serializable-parameters-and-return-values)æ¸…å–®ã€‚
- ä¼ºæœå™¨æ“ä½œæ˜¯å‡½å¼ï¼Œæ„å‘³è‘—å¯åœ¨æ‡‰ç”¨ç¨‹å¼ä¸­ä»»ä½•åœ°æ–¹é‡è¤‡ä½¿ç”¨ã€‚
- ä¼ºæœå™¨æ“ä½œç¹¼æ‰¿ä½¿ç”¨å®ƒå€‘çš„é é¢æˆ–ä½ˆå±€çš„åŸ·è¡Œç’°å¢ƒã€‚
- ä¼ºæœå™¨æ“ä½œç¹¼æ‰¿ä½¿ç”¨å®ƒå€‘çš„é é¢æˆ–ä½ˆå±€çš„[è·¯ç”±å€æ®µè¨­å®š](/docs/app/api-reference/file-conventions/route-segment-config)ï¼ŒåŒ…æ‹¬ `maxDuration` ç­‰æ¬„ä½ã€‚

## ç¯„ä¾‹

### è¡¨å–®

React æ“´å……äº† HTML [`<form>`](https://developer.mozilla.org/docs/Web/HTML/Element/form) å…ƒç´ ï¼Œå…è¨±é€é `action` å±¬æ€§å‘¼å«ä¼ºæœå™¨æ“ä½œã€‚

åœ¨è¡¨å–®ä¸­å‘¼å«æ™‚ï¼Œæ“ä½œæœƒè‡ªå‹•æ¥æ”¶ [`FormData`](https://developer.mozilla.org/docs/Web/API/FormData/FormData) ç‰©ä»¶ã€‚æ‚¨ç„¡éœ€ä½¿ç”¨ React `useState` ç®¡ç†æ¬„ä½ï¼Œè€Œæ˜¯å¯ä½¿ç”¨åŸç”Ÿ [`FormData æ–¹æ³•](https://developer.mozilla.org/en-US/docs/Web/API/FormData#instance_methods)æå–è³‡æ–™ï¼š

```tsx filename="app/invoices/page.tsx" switcher
export default function Page() {
  async function createInvoice(formData: FormData) {
    'use server'

    const rawFormData = {
      customerId: formData.get('customerId'),
      amount: formData.get('amount'),
      status: formData.get('status'),
    }

    // ç•°å‹•è³‡æ–™
    // é‡æ–°é©—è­‰å¿«å–
  }

  return <form action={createInvoice}>...</form>
}
```

```jsx filename="app/invoices/page.js" switcher
export default function Page() {
  async function createInvoice(formData) {
    'use server'

    const rawFormData = {
      customerId: formData.get('customerId'),
      amount: formData.get('amount'),
      status: formData.get('status'),
    }

    // ç•°å‹•è³‡æ–™
    // é‡æ–°é©—è­‰å¿«å–
  }

  return <form action={createInvoice}>...</form>
}
```

> **å°çŸ¥è­˜ï¼š**
>
> - ç¯„ä¾‹ï¼š[å«è¼‰å…¥èˆ‡éŒ¯èª¤ç‹€æ…‹çš„è¡¨å–®](https://github.com/vercel/next.js/tree/canary/examples/next-forms)
> - è™•ç†å«å¤šæ¬„ä½çš„è¡¨å–®æ™‚ï¼Œå¯è€ƒæ…®ä½¿ç”¨ [`entries()`](https://developer.mozilla.org/en-US/docs/Web/API/FormData/entries) æ–¹æ³•æ­é… JavaScript çš„ [`Object.fromEntries()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/fromEntries)ã€‚ä¾‹å¦‚ï¼š`const rawFormData = Object.fromEntries(formData)`ã€‚éœ€æ³¨æ„ `formData` æœƒåŒ…å«é¡å¤–çš„ `$ACTION_` å±¬æ€§ã€‚
> - åƒé–± [React `<form>` æ–‡ä»¶](https://react.dev/reference/react-dom/components/form#handle-form-submission-with-a-server-action)äº†è§£æ›´å¤šã€‚

### å‚³éé¡å¤–åƒæ•¸

æ‚¨å¯ä½¿ç”¨ JavaScript çš„ `bind` æ–¹æ³•å‚³éé¡å¤–åƒæ•¸çµ¦ä¼ºæœå™¨æ“ä½œã€‚

```tsx filename="app/client-component.tsx" highlight={6} switcher
'use client'

import { updateUser } from './actions'

export function UserProfile({ userId }: { userId: string }) {
  const updateUserWithId = updateUser.bind(null, userId)

  return (
    <form action={updateUserWithId}>
      <input type="text" name="name" />
      <button type="submit">æ›´æ–°ä½¿ç”¨è€…åç¨±</button>
    </form>
  )
}
```

```jsx filename="app/client-component.js" highlight={6} switcher
'use client'

import { updateUser } from './actions'

export function UserProfile({ userId }) {
  const updateUserWithId = updateUser.bind(null, userId)

  return (
    <form action={updateUserWithId}>
      <input type="text" name="name" />
      <button type="submit">æ›´æ–°ä½¿ç”¨è€…åç¨±</button>
    </form>
  )
}
```

ä¼ºæœå™¨æ“ä½œå°‡æ¥æ”¶ `userId` åƒæ•¸ä»¥åŠè¡¨å–®è³‡æ–™ï¼š

```ts filename="app/actions.ts" switcher
'use server'

export async function updateUser(userId: string, formData: FormData) {}
```

```js filename="app/actions.js" switcher
'use server'

export async function updateUser(userId, formData) {}
```

> **å°çŸ¥è­˜ï¼š**
>
> - æ›¿ä»£æ–¹æ¡ˆæ˜¯å°‡åƒæ•¸ä½œç‚ºéš±è—è¼¸å…¥æ¬„ä½å‚³éï¼ˆå¦‚ `<input type="hidden" name="userId" value={userId} />`ï¼‰ã€‚ä½†è©²å€¼æœƒæˆç‚ºæ¸²æŸ“ HTML çš„ä¸€éƒ¨åˆ†ä¸”ä¸æœƒè¢«ç·¨ç¢¼ã€‚
> - `.bind` åœ¨ä¼ºæœå™¨èˆ‡å®¢æˆ¶ç«¯å…ƒä»¶ä¸­å‡å¯ä½¿ç”¨ï¼Œä¹Ÿæ”¯æ´æ¼¸é€²å¢å¼·ã€‚

### å·¢ç‹€è¡¨å–®å…ƒç´ 

æ‚¨ä¹Ÿå¯åœ¨ `<form>` å…§å·¢ç‹€å…ƒç´ å¦‚ `<button>`ã€`<input type="submit">` å’Œ `<input type="image">` ä¸­å‘¼å«ä¼ºæœå™¨æ“ä½œã€‚é€™äº›å…ƒç´ æ¥å— `formAction` å±¬æ€§æˆ–[äº‹ä»¶è™•ç†ç¨‹åº](#event-handlers)ã€‚

é€™åœ¨éœ€è¦æ–¼å–®ä¸€è¡¨å–®ä¸­å‘¼å«å¤šå€‹ä¼ºæœå™¨æ“ä½œæ™‚å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œé™¤äº†ç™¼å¸ƒæŒ‰éˆ•å¤–ï¼Œå¯å»ºç«‹ç‰¹å®š `<button>` å…ƒç´ ç”¨æ–¼å„²å­˜æ–‡ç« è‰ç¨¿ã€‚è©³è¦‹ [React `<form>` æ–‡ä»¶](https://react.dev/reference/react-dom/components/form#handling-multiple-submission-types)ã€‚

### ç¨‹å¼åŒ–è¡¨å–®æäº¤

æ‚¨å¯ä½¿ç”¨ [`requestSubmit()`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/requestSubmit) æ–¹æ³•ä»¥ç¨‹å¼æ–¹å¼è§¸ç™¼è¡¨å–®æäº¤ã€‚ä¾‹å¦‚ï¼Œç•¶ä½¿ç”¨è€…ä½¿ç”¨ `âŒ˜` + `Enter` éµç›¤å¿«æ·éµæäº¤è¡¨å–®æ™‚ï¼Œå¯ç›£è½ `onKeyDown` äº‹ä»¶ï¼š

```tsx filename="app/entry.tsx" switcher
'use client'

export function Entry() {
  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {
    if (
      (e.ctrlKey || e.metaKey) &&
      (e.key === 'Enter' || e.key === 'NumpadEnter')
    ) {
      e.preventDefault()
      e.currentTarget.form?.requestSubmit()
    }
  }

  return (
    <div>
      <textarea name="entry" rows={20} required onKeyDown={handleKeyDown} />
    </div>
  )
}
```

```jsx filename="app/entry.js" switcher
'use client'

export function Entry() {
  const handleKeyDown = (e) => {
    if (
      (e.ctrlKey || e.metaKey) &&
      (e.key === 'Enter' || e.key === 'NumpadEnter')
    ) {
      e.preventDefault()
      e.currentTarget.form?.requestSubmit()
    }
  }

  return (
    <div>
      <textarea name="entry" rows={20} required onKeyDown={handleKeyDown} />
    </div>
  )
}
```

é€™å°‡è§¸ç™¼æœ€è¿‘ `<form>` ç¥–å…ˆçš„æäº¤ï¼Œå¾è€Œå‘¼å«ä¼ºæœå™¨æ“ä½œã€‚

### ä¼ºæœå™¨ç«¯è¡¨å–®é©—è­‰

æ‚¨å¯ä½¿ç”¨ HTML å±¬æ€§å¦‚ `required` å’Œ `type="email"` é€²è¡ŒåŸºæœ¬å®¢æˆ¶ç«¯è¡¨å–®é©—è­‰ã€‚

å°æ–¼æ›´é€²éšçš„ä¼ºæœå™¨ç«¯é©—è­‰ï¼Œå¯ä½¿ç”¨å¦‚ [zod](https://zod.dev/) çš„å‡½å¼åº«åœ¨ç•°å‹•è³‡æ–™å‰é©—è­‰è¡¨å–®æ¬„ä½ï¼š

```tsx filename="app/actions.ts" switcher
'use server'

import { z } from 'zod'

const schema = z.object({
  email: z.string({
    invalid_type_error: 'ç„¡æ•ˆçš„é›»å­éƒµä»¶',
  }),
})

export default async function createUser(formData: FormData) {
  const validatedFields = schema.safeParse({
    email: formData.get('email'),
  })

  // è‹¥è¡¨å–®è³‡æ–™ç„¡æ•ˆå‰‡æå‰è¿”å›
  if (!validatedFields.success) {
    return {
      errors: validatedFields.error.flatten().fieldErrors,
    }
  }

  // ç•°å‹•è³‡æ–™
}
```

```jsx filename="app/actions.js" switcher
'use server'

import { z } from 'zod'

const schema = z.object({
  email: z.string({
    invalid_type_error: 'ç„¡æ•ˆçš„é›»å­éƒµä»¶',
  }),
})

export default async function createsUser(formData) {
  const validatedFields = schema.safeParse({
    email: formData.get('email'),
  })

  // è‹¥è¡¨å–®è³‡æ–™ç„¡æ•ˆå‰‡æå‰è¿”å›
  if (!validatedFields.success) {
    return {
      errors: validatedFields.error.flatten().fieldErrors,
    }
  }

  // ç•°å‹•è³‡æ–™
}
```

åœ¨ä¼ºæœå™¨ç«¯é©—è­‰æ¬„ä½å¾Œï¼Œæ‚¨å¯åœ¨æ“ä½œä¸­å›å‚³å¯åºåˆ—åŒ–ç‰©ä»¶ï¼Œä¸¦ä½¿ç”¨ React `useActionState` é‰¤å­å‘ä½¿ç”¨è€…é¡¯ç¤ºè¨Šæ¯ã€‚

- é€éå°‡æ“ä½œå‚³éçµ¦ `useActionState`ï¼Œæ“ä½œçš„å‡½å¼ç°½åæœƒè®Šæ›´ï¼Œæ¥æ”¶æ–°çš„ `prevState` æˆ– `initialState` åƒæ•¸ä½œç‚ºç¬¬ä¸€å€‹å¼•æ•¸ã€‚
- `useActionState` æ˜¯ React é‰¤å­ï¼Œå› æ­¤å¿…é ˆåœ¨å®¢æˆ¶ç«¯å…ƒä»¶ä¸­ä½¿ç”¨ã€‚

```tsx filename="app/actions.ts" switcher
'use server'

import { redirect } from 'next/navigation'

export async function createUser(prevState: any, formData: FormData) {
  const res = await fetch('https://...')
  const json = await res.json()

  if (!res.ok) {
    return { message: 'è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»å­éƒµä»¶' }
  }

  redirect('/dashboard')
}
```

```jsx filename="app/actions.js" switcher
'use server'

import { redirect } from 'next/navigation'

export async function createUser(prevState, formData) {
  const res = await fetch('https://...')
  const json = await res.json()

  if (!res.ok) {
    return { message: 'è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»å­éƒµä»¶' }
  }

  redirect('/dashboard')
}
```

æ¥è‘—ï¼Œæ‚¨å¯å°‡æ“ä½œå‚³éçµ¦ `useActionState` é‰¤å­ï¼Œä¸¦ä½¿ç”¨å›å‚³çš„ `state` é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ã€‚

```tsx filename="app/ui/signup.tsx" highlight={11,18-20} switcher
'use client'

import { useActionState } from 'react'
import { createUser } from '@/app/actions'

const initialState = {
  message: '',
}

export function Signup() {
  const [state, formAction, pending] = useActionState(createUser, initialState)

  return (
    <form action={formAction}>
      <label htmlFor="email">é›»å­éƒµä»¶</label>
      <input type="text" id="email" name="email" required />
      {/* ... */}
      <p aria-live="polite">{state?.message}</p>
      <button disabled={pending}>è¨»å†Š</button>
    </form>
  )
}
```

```jsx filename="app/ui/signup.js" highlight={11,18-20} switcher
'use client'

import { useActionState } from 'react'
import { createUser } from '@/app/actions'

const initialState = {
  message: '',
}

export function Signup() {
  const [state, formAction, pending] = useActionState(createUser, initialState)

  return (
    <form action={formAction}>
      <label htmlFor="email">é›»å­éƒµä»¶</label>
      <input type="text" id="email" name="email" required />
      {/* ... */}
      <p aria-live="polite">{state?.message}</p>
      <button disabled={pending}>è¨»å†Š</button>
    </form>
  )
}
```

### å¾…è™•ç†ç‹€æ…‹

[`useActionState`](https://react.dev/reference/react/useActionState) é‰¤å­æä¾›äº†ä¸€å€‹ `pending` å¸ƒæ—å€¼ï¼Œå¯ç”¨æ–¼åœ¨å‹•ä½œåŸ·è¡Œæ™‚é¡¯ç¤ºè¼‰å…¥æŒ‡ç¤ºå™¨ã€‚

æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ [`useFormStatus`](https://react.dev/reference/react-dom/hooks/useFormStatus) é‰¤å­åœ¨å‹•ä½œåŸ·è¡Œæ™‚é¡¯ç¤ºè¼‰å…¥æŒ‡ç¤ºå™¨ã€‚ä½¿ç”¨æ­¤é‰¤å­æ™‚ï¼Œéœ€è¦å»ºç«‹ä¸€å€‹ç¨ç«‹çš„å…ƒä»¶ä¾†æ¸²æŸ“è¼‰å…¥æŒ‡ç¤ºå™¨ã€‚ä¾‹å¦‚ï¼Œåœ¨å‹•ä½œå¾…è™•ç†æ™‚ç¦ç”¨æŒ‰éˆ•ï¼š

```tsx filename="app/ui/button.tsx" highlight={6} switcher
'use client'

import { useFormStatus } from 'react-dom'

export function SubmitButton() {
  const { pending } = useFormStatus()

  return (
    <button disabled={pending} type="submit">
      è¨»å†Š
    </button>
  )
}
```

```jsx filename="app/ui/button.js" highlight={6} switcher
'use client'

import { useFormStatus } from 'react-dom'

export function SubmitButton() {
  const { pending } = useFormStatus()

  return (
    <button disabled={pending} type="submit">
      è¨»å†Š
    </button>
  )
}
```

ç„¶å¾Œå¯ä»¥å°‡ `SubmitButton` å…ƒä»¶åµŒå¥—åœ¨è¡¨å–®ä¸­ï¼š

```tsx filename="app/ui/signup.tsx" switcher
import { SubmitButton } from './button'
import { createUser } from '@/app/actions'

export function Signup() {
  return (
    <form action={createUser}>
      {/* å…¶ä»–è¡¨å–®å…ƒç´  */}
      <SubmitButton />
    </form>
  )
}
```

```jsx filename="app/ui/signup.js" switcher
import { SubmitButton } from './button'
import { createUser } from '@/app/actions'

export function Signup() {
  return (
    <form action={createUser}>
      {/* å…¶ä»–è¡¨å–®å…ƒç´  */}
      <SubmitButton />
    </form>
  )
}
```

> **é ˆçŸ¥äº‹é …ï¼š** åœ¨ React 19 ä¸­ï¼Œ`useFormStatus` è¿”å›çš„ç‰©ä»¶åŒ…å«æ›´å¤šéµå€¼ï¼Œå¦‚ dataã€method å’Œ actionã€‚å¦‚æœæœªä½¿ç”¨ React 19ï¼Œå‰‡åƒ…æœ‰ `pending` éµå¯ç”¨ã€‚

### æ¨‚è§€æ›´æ–°

ä½ å¯ä»¥ä½¿ç”¨ React çš„ [`useOptimistic`](https://react.dev/reference/react/useOptimistic) é‰¤å­åœ¨ä¼ºæœå™¨å‹•ä½œå®ŒæˆåŸ·è¡Œå‰æ¨‚è§€åœ°æ›´æ–° UIï¼Œè€Œä¸éœ€ç­‰å¾…å›æ‡‰ï¼š

```tsx filename="app/page.tsx" switcher
'use client'

import { useOptimistic } from 'react'
import { send } from './actions'

type Message = {
  message: string
}

export function Thread({ messages }: { messages: Message[] }) {
  const [optimisticMessages, addOptimisticMessage] = useOptimistic<
    Message[],
    string
  >(messages, (state, newMessage) => [...state, { message: newMessage }])

  const formAction = async (formData: FormData) => {
    const message = formData.get('message') as string
    addOptimisticMessage(message)
    await send(message)
  }

  return (
    <div>
      {optimisticMessages.map((m, i) => (
        <div key={i}>{m.message}</div>
      ))}
      <form action={formAction}>
        <input type="text" name="message" />
        <button type="submit">ç™¼é€</button>
      </form>
    </div>
  )
}
```

```jsx filename="app/page.js" switcher
'use client'

import { useOptimistic } from 'react'
import { send } from './actions'

export function Thread({ messages }) {
  const [optimisticMessages, addOptimisticMessage] = useOptimistic(
    messages,
    (state, newMessage) => [...state, { message: newMessage }]
  )

  const formAction = async (formData) => {
    const message = formData.get('message')
    addOptimisticMessage(message)
    await send(message)
  }

  return (
    <div>
      {optimisticMessages.map((m) => (
        <div>{m.message}</div>
      ))}
      <form action={formAction}>
        <input type="text" name="message" />
        <button type="submit">ç™¼é€</button>
      </form>
    </div>
  )
}
```

### äº‹ä»¶è™•ç†å™¨

é›–ç„¶é€šå¸¸åœ¨ `<form>` å…ƒç´ ä¸­ä½¿ç”¨ä¼ºæœå™¨å‹•ä½œï¼Œä½†å®ƒå€‘ä¹Ÿå¯ä»¥é€éäº‹ä»¶è™•ç†å™¨å¦‚ `onClick` ä¾†è§¸ç™¼ã€‚ä¾‹å¦‚ï¼Œå¢åŠ æŒ‰è®šè¨ˆæ•¸ï¼š

```tsx filename="app/like-button.tsx" switcher
'use client'

import { incrementLike } from './actions'
import { useState } from 'react'

export default function LikeButton({ initialLikes }: { initialLikes: number }) {
  const [likes, setLikes] = useState(initialLikes)

  return (
    <>
      <p>ç¸½æŒ‰è®šæ•¸: {likes}</p>
      <button
        onClick={async () => {
          const updatedLikes = await incrementLike()
          setLikes(updatedLikes)
        }}
      >
        æŒ‰è®š
      </button>
    </>
  )
}
```

```jsx filename="app/like-button.js" switcher
'use client'

import { incrementLike } from './actions'
import { useState } from 'react'

export default function LikeButton({ initialLikes }) {
  const [likes, setLikes] = useState(initialLikes)

  return (
    <>
      <p>ç¸½æŒ‰è®šæ•¸: {likes}</p>
      <button
        onClick={async () => {
          const updatedLikes = await incrementLike()
          setLikes(updatedLikes)
        }}
      >
        æŒ‰è®š
      </button>
    </>
  )
}
```

ä½ ä¹Ÿå¯ä»¥ç‚ºè¡¨å–®å…ƒç´ æ·»åŠ äº‹ä»¶è™•ç†å™¨ï¼Œä¾‹å¦‚åœ¨ `onChange` æ™‚å„²å­˜è¡¨å–®æ¬„ä½ï¼š

```tsx filename="app/ui/edit-post.tsx"
'use client'

import { publishPost, saveDraft } from './actions'

export default function EditPost() {
  return (
    <form action={publishPost}>
      <textarea
        name="content"
        onChange={async (e) => {
          await saveDraft(e.target.value)
        }}
      />
      <button type="submit">ç™¼å¸ƒ</button>
    </form>
  )
}
```

å°æ–¼é€™ç¨®å¯èƒ½å¿«é€Ÿè§¸ç™¼å¤šæ¬¡äº‹ä»¶çš„æƒ…æ³ï¼Œæˆ‘å€‘å»ºè­°ä½¿ç”¨**é˜²æŠ–** (debouncing) ä¾†é¿å…ä¸å¿…è¦çš„ä¼ºæœå™¨å‹•ä½œèª¿ç”¨ã€‚

### `useEffect`

ä½ å¯ä»¥ä½¿ç”¨ React çš„ [`useEffect`](https://react.dev/reference/react/useEffect) é‰¤å­åœ¨å…ƒä»¶æ›è¼‰æˆ–ä¾è³´é …è®ŠåŒ–æ™‚èª¿ç”¨ä¼ºæœå™¨å‹•ä½œã€‚é€™å°æ–¼ä¾è³´å…¨å±€äº‹ä»¶æˆ–éœ€è¦è‡ªå‹•è§¸ç™¼çš„è®Šæ›´éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œ`onKeyDown` è™•ç†æ‡‰ç”¨å¿«æ·éµã€ç„¡é™æ»¾å‹•çš„äº¤é›†è§€å¯Ÿå™¨é‰¤å­ï¼Œæˆ–åœ¨å…ƒä»¶æ›è¼‰æ™‚æ›´æ–°ç€è¦½æ¬¡æ•¸ï¼š

```tsx filename="app/view-count.tsx" switcher
'use client'

import { incrementViews } from './actions'
import { useState, useEffect, useTransition } from 'react'

export default function ViewCount({ initialViews }: { initialViews: number }) {
  const [views, setViews] = useState(initialViews)
  const [isPending, startTransition] = useTransition()

  useEffect(() => {
    startTransition(async () => {
      const updatedViews = await incrementViews()
      setViews(updatedViews)
    })
  }, [])

  // å¯ä»¥ä½¿ç”¨ `isPending` å‘ç”¨æˆ¶æä¾›åé¥‹
  return <p>ç¸½ç€è¦½æ¬¡æ•¸: {views}</p>
}
```

```jsx filename="app/view-count.js" switcher
'use client'

import { incrementViews } from './actions'
import { useState, useEffect, useTransition } from 'react'

export default function ViewCount({ initialViews }) {
  const [views, setViews] = useState(initialViews)
  const [isPending, startTransition] = useTransition()

  useEffect(() => {
    starTransition(async () => {
      const updatedViews = await incrementViews()
      setViews(updatedViews)
    })
  }, [])

  // å¯ä»¥ä½¿ç”¨ `isPending` å‘ç”¨æˆ¶æä¾›åé¥‹
  return <p>ç¸½ç€è¦½æ¬¡æ•¸: {views}</p>
}
```

è«‹è¨˜ä½è€ƒæ…® [`useEffect` çš„è¡Œç‚ºèˆ‡æ³¨æ„äº‹é …](https://react.dev/reference/react/useEffect#caveats)ã€‚

### éŒ¯èª¤è™•ç†

ç•¶éŒ¯èª¤è¢«æ‹‹å‡ºæ™‚ï¼Œå®ƒæœƒè¢«å®¢æˆ¶ç«¯æœ€è¿‘çš„ `error.js` æˆ– `<Suspense>` é‚Šç•Œæ•ç²ã€‚è©³æƒ…è«‹åƒé–±[éŒ¯èª¤è™•ç†](/docs/app/building-your-application/routing/error-handling)ã€‚

> **é ˆçŸ¥äº‹é …ï¼š**
>
> - é™¤äº†æ‹‹å‡ºéŒ¯èª¤å¤–ï¼Œä½ ä¹Ÿå¯ä»¥è¿”å›ä¸€å€‹ç‰©ä»¶ä¾› `useActionState` è™•ç†ã€‚è«‹åƒé–±[ä¼ºæœå™¨ç«¯è¡¨å–®é©—è­‰èˆ‡éŒ¯èª¤è™•ç†](#server-side-form-validation)ã€‚

### é‡æ–°é©—è­‰è³‡æ–™

ä½ å¯ä»¥åœ¨ä¼ºæœå™¨å‹•ä½œä¸­ä½¿ç”¨ [`revalidatePath`](/docs/app/api-reference/functions/revalidatePath) API é‡æ–°é©—è­‰ [Next.js å¿«å–](/docs/app/deep-dive/caching)ï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { revalidatePath } from 'next/cache'

export async function createPost() {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidatePath('/posts')
}
```

```js filename="app/actions.js" switcher
'use server'

import { revalidatePath } from 'next/cache'

export async function createPost() {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidatePath('/posts')
}
```

æˆ–è€…ä½¿ç”¨ [`revalidateTag`](/docs/app/api-reference/functions/revalidateTag) é€éå¿«å–æ¨™ç±¤ä½¿ç‰¹å®šè³‡æ–™ç²å–å¤±æ•ˆï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { revalidateTag } from 'next/cache'

export async function createPost() {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidateTag('posts')
}
```

```js filename="app/actions.js" switcher
'use server'

import { revalidateTag } from 'next/cache'

export async function createPost() {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidateTag('posts')
}
```

### é‡æ–°å°å‘

å¦‚æœå¸Œæœ›åœ¨ä¼ºæœå™¨å‹•ä½œå®Œæˆå¾Œå°‡ç”¨æˆ¶é‡æ–°å°å‘åˆ°ä¸åŒè·¯ç”±ï¼Œå¯ä»¥ä½¿ç”¨ [`redirect`](/docs/app/api-reference/functions/redirect) APIã€‚`redirect` éœ€è¦åœ¨ `try/catch` å€å¡Šå¤–èª¿ç”¨ï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { redirect } from 'next/navigation'
import { revalidateTag } from 'next/cache'

export async function createPost(id: string) {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidateTag('posts') // æ›´æ–°å¿«å–æ–‡ç« 
  redirect(`/post/${id}`) // å°å‘æ–°æ–‡ç« é é¢
}
```

```js filename="app/actions.js" switcher
'use server'

import { redirect } from 'next/navigation'
import { revalidateTag } from 'next/cache'

export async function createPost(id) {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidateTag('posts') // æ›´æ–°å¿«å–æ–‡ç« 
  redirect(`/post/${id}`) // å°å‘æ–°æ–‡ç« é é¢
}
```

### Cookies

ä½ å¯ä»¥ä½¿ç”¨ [`cookies`](/docs/app/api-reference/functions/cookies) API åœ¨ä¼ºæœå™¨å‹•ä½œä¸­ `get`ã€`set` å’Œ `delete` cookiesï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { cookies } from 'next/headers'

export async function exampleAction() {
  const cookieStore = await cookies()

  // ç²å– cookie
  cookieStore.get('name')?.value

  // è¨­å®š cookie
  cookieStore.set('name', 'Delba')

  // åˆªé™¤ cookie
  cookieStore.delete('name')
}
```

```js filename="app/actions.js" switcher
'use server'

import { cookies } from 'next/headers'

export async function exampleAction() {
  // ç²å– cookie
  const cookieStore = await cookies()

  // ç²å– cookie
  cookieStore.get('name')?.value

  // è¨­å®š cookie
  cookieStore.set('name', 'Delba')

  // åˆªé™¤ cookie
  cookieStore.delete('name')
}
```

åƒé–±[å…¶ä»–ç¯„ä¾‹](/docs/app/api-reference/functions/cookies#deleting-cookies)äº†è§£å¦‚ä½•å¾ä¼ºæœå™¨å‹•ä½œåˆªé™¤ cookiesã€‚

## å®‰å…¨æ€§

é è¨­æƒ…æ³ä¸‹ï¼Œç•¶å»ºç«‹ä¸¦åŒ¯å‡ºä¸€å€‹ä¼ºæœå™¨å‹•ä½œæ™‚ï¼Œå®ƒæœƒå»ºç«‹ä¸€å€‹å…¬é–‹çš„ HTTP ç«¯é»ï¼Œæ‡‰ä»¥ç›¸åŒçš„å®‰å…¨å‡è¨­å’Œæˆæ¬Šæª¢æŸ¥ä¾†å°å¾…ã€‚é€™æ„å‘³è‘—ï¼Œå³ä½¿ä¼ºæœå™¨å‹•ä½œæˆ–å·¥å…·å‡½æ•¸æœªåœ¨ç¨‹å¼ç¢¼å…¶ä»–åœ°æ–¹å°å…¥ï¼Œå®ƒä»ç„¶æ˜¯å…¬é–‹å¯è¨ªå•çš„ã€‚

ç‚ºæå‡å®‰å…¨æ€§ï¼ŒNext.js å…·æœ‰ä»¥ä¸‹å…§å»ºåŠŸèƒ½ï¼š

- **å®‰å…¨å‹•ä½œ IDï¼š** Next.js å»ºç«‹åŠ å¯†ã€éç¢ºå®šæ€§çš„ IDï¼Œå…è¨±å®¢æˆ¶ç«¯å¼•ç”¨å’Œèª¿ç”¨ä¼ºæœå™¨å‹•ä½œã€‚é€™äº› ID æœƒåœ¨æ§‹å»ºä¹‹é–“å®šæœŸé‡æ–°è¨ˆç®—ä»¥å¢å¼·å®‰å…¨æ€§ã€‚
- **æ­»ç¢¼æ¶ˆé™¤ï¼š** æœªä½¿ç”¨çš„ä¼ºæœå™¨å‹•ä½œï¼ˆç”±å…¶ ID å¼•ç”¨ï¼‰æœƒå¾å®¢æˆ¶ç«¯å¥—ä»¶ä¸­ç§»é™¤ï¼Œé¿å…ç¬¬ä¸‰æ–¹å…¬é–‹è¨ªå•ã€‚

> **é ˆçŸ¥äº‹é …ï¼š**
>
> ID åœ¨ç·¨è­¯æœŸé–“å»ºç«‹ï¼Œä¸¦å¿«å–æœ€å¤š 14 å¤©ã€‚å®ƒå€‘æœƒåœ¨å•Ÿå‹•æ–°æ§‹å»ºæˆ–æ§‹å»ºå¿«å–å¤±æ•ˆæ™‚é‡æ–°ç”Ÿæˆã€‚
> æ­¤å®‰å…¨æ”¹é€²é™ä½äº†åœ¨ç¼ºå°‘é©—è­‰å±¤çš„æƒ…æ³ä¸‹çš„é¢¨éšªã€‚ç„¶è€Œï¼Œä½ ä»æ‡‰å°‡ä¼ºæœå™¨å‹•ä½œè¦–ç‚ºå…¬é–‹ HTTP ç«¯é»ã€‚

```jsx
// app/actions.js
'use server'

// æ­¤å‹•ä½œ**æœ‰**åœ¨æˆ‘å€‘çš„æ‡‰ç”¨ç¨‹å¼ä¸­ä½¿ç”¨ï¼Œå› æ­¤ Next.js
// æœƒå»ºç«‹ä¸€å€‹å®‰å…¨ ID ä»¥å…è¨±å®¢æˆ¶ç«¯å¼•ç”¨
// ä¸¦èª¿ç”¨ä¼ºæœå™¨å‹•ä½œã€‚
export async function updateUserAction(formData) {}

// æ­¤å‹•ä½œ**æœª**åœ¨æˆ‘å€‘çš„æ‡‰ç”¨ç¨‹å¼ä¸­ä½¿ç”¨ï¼Œå› æ­¤ Next.js
// æœƒåœ¨ `next build` æ™‚è‡ªå‹•ç§»é™¤æ­¤ç¨‹å¼ç¢¼
// ä¸¦ä¸”ä¸æœƒå»ºç«‹å…¬é–‹ç«¯é»ã€‚
export async function deleteUserAction(formData) {}
```

### é©—è­‰èˆ‡æˆæ¬Š

ä½ æ‡‰ç¢ºä¿ç”¨æˆ¶æœ‰æ¬ŠåŸ·è¡Œè©²å‹•ä½œã€‚ä¾‹å¦‚ï¼š

```tsx filename="app/actions.ts"
'use server'

import { auth } from './lib'

export function addItem() {
  const { user } = auth()
  if (!user) {
    throw new Error('ä½ å¿…é ˆç™»å…¥æ‰èƒ½åŸ·è¡Œæ­¤å‹•ä½œ')
  }

  // ...
}
```

### é–‰åŒ…èˆ‡åŠ å¯†

åœ¨å…ƒä»¶å…§å®šç¾©ä¼ºæœå™¨å‹•ä½œæœƒå»ºç«‹ä¸€å€‹[é–‰åŒ…](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures)ï¼Œä½¿å‹•ä½œèƒ½è¨ªå•å¤–éƒ¨å‡½æ•¸çš„ä½œç”¨åŸŸã€‚ä¾‹å¦‚ï¼Œ`publish` å‹•ä½œèƒ½è¨ªå• `publishVersion` è®Šæ•¸ï¼š

```tsx filename="app/page.tsx" switcher
export default async function Page() {
  const publishVersion = await getLatestVersion();

  async function publish() {
    "use server";
    if (publishVersion !== await getLatestVersion()) {
      throw new Error('æŒ‰ä¸‹ç™¼å¸ƒå¾Œç‰ˆæœ¬å·²è®Šæ›´');
    }
    ...
  }

  return (
    <form>
      <button formAction={publish}>ç™¼å¸ƒ</button>
    </form>
  );
}
```

```jsx filename="app/page.js" switcher
export default async function Page() {
  const publishVersion = await getLatestVersion();

  async function publish() {
    "use server";
    if (publishVersion !== await getLatestVersion()) {
      throw new Error('æŒ‰ä¸‹ç™¼å¸ƒå¾Œç‰ˆæœ¬å·²è®Šæ›´');
    }
    ...
  }

  return (
    <form>
      <button formAction={publish}>ç™¼å¸ƒ</button>
    </form>
  );
}
```

é–‰åŒ…åœ¨éœ€è¦æ•æ‰è³‡æ–™çš„_å¿«ç…§_ï¼ˆå¦‚ `publishVersion`ï¼‰ä»¥ä¾¿åœ¨å‹•ä½œèª¿ç”¨æ™‚ä½¿ç”¨æ™‚éå¸¸æœ‰ç”¨ã€‚

ç„¶è€Œï¼Œç‚ºå¯¦ç¾é€™ä¸€é»ï¼Œæ•æ‰çš„è®Šæ•¸æœƒè¢«ç™¼é€åˆ°å®¢æˆ¶ç«¯ä¸¦åœ¨å‹•ä½œèª¿ç”¨æ™‚è¿”å›ä¼ºæœå™¨ã€‚ç‚ºé˜²æ­¢æ•æ„Ÿè³‡æ–™æš´éœ²çµ¦å®¢æˆ¶ç«¯ï¼ŒNext.js æœƒè‡ªå‹•åŠ å¯†é–‰åŒ…è®Šæ•¸ã€‚æ¯æ¬¡æ§‹å»º Next.js æ‡‰ç”¨æ™‚ï¼Œéƒ½æœƒç‚ºæ¯å€‹å‹•ä½œç”Ÿæˆä¸€å€‹æ–°çš„ç§é‘°ã€‚é€™æ„å‘³è‘—å‹•ä½œåªèƒ½åœ¨ç‰¹å®šæ§‹å»ºä¸­èª¿ç”¨ã€‚

> **é ˆçŸ¥äº‹é …ï¼š** æˆ‘å€‘ä¸å»ºè­°åƒ…ä¾è³´åŠ å¯†ä¾†é˜²æ­¢æ•æ„Ÿå€¼æš´éœ²åœ¨å®¢æˆ¶ç«¯ã€‚ç›¸åï¼Œä½ æ‡‰ä½¿ç”¨ [React taint API](/docs/app/api-reference/config/next-config-js/taint) ä¸»å‹•é˜²æ­¢ç‰¹å®šè³‡æ–™ç™¼é€åˆ°å®¢æˆ¶ç«¯ã€‚

### è¦†å¯«åŠ å¯†é‡‘é‘°ï¼ˆé€²éšï¼‰

ç•¶åœ¨å¤šå€‹ä¼ºæœå™¨ä¸Šè‡ªè¨—ç®¡ Next.js æ‡‰ç”¨æ™‚ï¼Œæ¯å€‹ä¼ºæœå™¨å¯¦ä¾‹å¯èƒ½æœ€çµ‚ä½¿ç”¨ä¸åŒçš„åŠ å¯†é‡‘é‘°ï¼Œå°è‡´æ½›åœ¨çš„ä¸ä¸€è‡´ã€‚

ç‚ºç·©è§£æ­¤å•é¡Œï¼Œä½ å¯ä»¥ä½¿ç”¨ `process.env.NEXT_SERVER_ACTIONS_ENCRYPTION_KEY` ç’°å¢ƒè®Šæ•¸è¦†å¯«åŠ å¯†é‡‘é‘°ã€‚æŒ‡å®šæ­¤è®Šæ•¸å¯ç¢ºä¿åŠ å¯†é‡‘é‘°åœ¨æ§‹å»ºä¹‹é–“ä¿æŒæŒä¹…æ€§ï¼Œä¸”æ‰€æœ‰ä¼ºæœå™¨å¯¦ä¾‹ä½¿ç”¨ç›¸åŒçš„é‡‘é‘°ã€‚æ­¤è®Šæ•¸**å¿…é ˆ**ä½¿ç”¨ AES-GCM åŠ å¯†ã€‚

é€™æ˜¯ä¸€å€‹é€²éšä½¿ç”¨æƒ…å¢ƒï¼Œå…¶ä¸­è·¨å¤šå€‹éƒ¨ç½²çš„ä¸€è‡´åŠ å¯†è¡Œç‚ºå°ä½ çš„æ‡‰ç”¨è‡³é—œé‡è¦ã€‚ä½ æ‡‰è€ƒæ…®æ¨™æº–å®‰å…¨å¯¦è¸ï¼Œå¦‚é‡‘é‘°è¼ªæ›å’Œç°½åã€‚

> **é ˆçŸ¥äº‹é …ï¼š** éƒ¨ç½²åˆ° Vercel çš„ Next.js æ‡‰ç”¨æœƒè‡ªå‹•è™•ç†æ­¤å•é¡Œã€‚

### å…è¨±çš„ä¾†æº (é€²éš)

ç”±æ–¼ä¼ºæœå™¨å‹•ä½œ (Server Actions) å¯ä»¥åœ¨ `<form>` å…ƒç´ ä¸­èª¿ç”¨ï¼Œé€™ä½¿å¾—å®ƒå€‘å®¹æ˜“å—åˆ° [CSRF æ”»æ“Š](https://developer.mozilla.org/en-US/docs/Glossary/CSRF) çš„å½±éŸ¿ã€‚

åœ¨åº•å±¤ï¼Œä¼ºæœå™¨å‹•ä½œä½¿ç”¨ `POST` æ–¹æ³•ï¼Œä¸”åƒ…å…è¨±æ­¤ HTTP æ–¹æ³•ä¾†èª¿ç”¨å®ƒå€‘ã€‚é€™åœ¨ç¾ä»£ç€è¦½å™¨ä¸­é˜²æ­¢äº†å¤§å¤šæ•¸ CSRF æ¼æ´ï¼Œç‰¹åˆ¥æ˜¯ç•¶ [SameSite cookies](https://web.dev/articles/samesite-cookies-explained) æˆç‚ºé è¨­å€¼æ™‚ã€‚

ä½œç‚ºé¡å¤–çš„ä¿è­·æªæ–½ï¼ŒNext.js ä¸­çš„ä¼ºæœå™¨å‹•ä½œé‚„æœƒæ¯”è¼ƒ [Origin æ¨™é ­](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin) èˆ‡ [Host æ¨™é ­](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Host) (æˆ– `X-Forwarded-Host`)ã€‚å¦‚æœé€™äº›æ¨™é ­ä¸åŒ¹é…ï¼Œè«‹æ±‚å°‡è¢«ä¸­æ­¢ã€‚æ›å¥è©±èªªï¼Œä¼ºæœå™¨å‹•ä½œåªèƒ½åœ¨èˆ‡è¨—ç®¡å®ƒçš„é é¢ç›¸åŒçš„ä¸»æ©Ÿä¸Šèª¿ç”¨ã€‚

å°æ–¼ä½¿ç”¨åå‘ä»£ç†æˆ–å¤šå±¤å¾Œç«¯æ¶æ§‹ (å…¶ä¸­ä¼ºæœå™¨ API èˆ‡ç”Ÿç”¢ç¶²åŸŸä¸åŒ) çš„å¤§å‹æ‡‰ç”¨ç¨‹å¼ï¼Œå»ºè­°ä½¿ç”¨é…ç½®é¸é … [`serverActions.allowedOrigins`](/docs/app/api-reference/config/next-config-js/serverActions) ä¾†æŒ‡å®šå®‰å…¨ä¾†æºçš„æ¸…å–®ã€‚è©²é¸é …æ¥å—ä¸€å€‹å­—ä¸²é™£åˆ—ã€‚

```js filename="next.config.js"
/** @type {import('next').NextConfig} */
module.exports = {
  experimental: {
    serverActions: {
      allowedOrigins: ['my-proxy.com', '*.my-proxy.com'],
    },
  },
}
```

äº†è§£æ›´å¤šé—œæ–¼ [å®‰å…¨æ€§èˆ‡ä¼ºæœå™¨å‹•ä½œ](https://nextjs.org/blog/security-nextjs-server-components-actions) çš„è³‡è¨Šã€‚

## å…¶ä»–è³‡æº

å¦‚éœ€æ›´å¤šè³‡è¨Šï¼Œè«‹æŸ¥çœ‹ä»¥ä¸‹ React æ–‡ä»¶ï¼š

- [ä¼ºæœå™¨å‹•ä½œ (Server Actions)](https://react.dev/reference/rsc/server-actions)
- [`"use server"`](https://react.dev/reference/react/use-server)
- [`<form>`](https://react.dev/reference/react-dom/components/form)
- [`useFormStatus`](https://react.dev/reference/react-dom/hooks/useFormStatus)
- [`useActionState`](https://react.dev/reference/react/useActionState)
- [`useOptimistic`](https://react.dev/reference/react/useOptimistic)
