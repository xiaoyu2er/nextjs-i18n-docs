---
source-updated-at: 2025-06-01T01:32:20.000Z
translation-updated-at: 2025-06-01T22:33:51.189Z
title: ä¼ºæœå™¨å‹•ä½œ (Server Actions) èˆ‡è³‡æ–™ç•°å‹• (Mutations)
nav_title: ä¼ºæœå™¨å‹•ä½œèˆ‡è³‡æ–™ç•°å‹•
description: å­¸ç¿’å¦‚ä½•ä½¿ç”¨ Next.js è™•ç†è¡¨å–®æäº¤èˆ‡è³‡æ–™ç•°å‹•
related:
  description: äº†è§£å¦‚ä½•åœ¨ Next.js ä¸­è¨­å®šä¼ºæœå™¨å‹•ä½œ
  links:
    - app/api-reference/config/next-config-js/serverActions
---

[ä¼ºæœå™¨å‹•ä½œ (Server Actions)](https://react.dev/reference/rsc/server-actions) æ˜¯åœ¨ä¼ºæœå™¨ä¸ŠåŸ·è¡Œçš„**éåŒæ­¥å‡½å¼**ã€‚å®ƒå€‘å¯ä»¥åœ¨ä¼ºæœå™¨èˆ‡å®¢æˆ¶ç«¯å…ƒä»¶ä¸­å‘¼å«ï¼Œç”¨æ–¼è™•ç† Next.js æ‡‰ç”¨ç¨‹å¼ä¸­çš„è¡¨å–®æäº¤èˆ‡è³‡æ–™ç•°å‹•ã€‚

> **ğŸ¥ è§€çœ‹å½±ç‰‡ï¼š** æ·±å…¥äº†è§£ä½¿ç”¨ä¼ºæœå™¨å‹•ä½œé€²è¡Œè³‡æ–™ç•°å‹• â†’ [YouTube (10 åˆ†é˜)](https://youtu.be/dDpZfOQBMaU?si=cJZHlUu_jFhCzHUg)

## æ…£ä¾‹

ä¼ºæœå™¨å‹•ä½œå¯ä»¥ä½¿ç”¨ React çš„ [`"use server"`](https://react.dev/reference/react/use-server) æŒ‡ä»¤ä¾†å®šç¾©ã€‚æ‚¨å¯ä»¥å°‡æŒ‡ä»¤æ”¾åœ¨ `async` å‡½å¼é ‚éƒ¨ä»¥æ¨™è¨˜è©²å‡½å¼ç‚ºä¼ºæœå™¨å‹•ä½œï¼Œæˆ–æ”¾åœ¨ç¨ç«‹æª”æ¡ˆé ‚éƒ¨ä»¥æ¨™è¨˜è©²æª”æ¡ˆæ‰€æœ‰åŒ¯å‡ºç‚ºä¼ºæœå™¨å‹•ä½œã€‚

### ä¼ºæœå™¨å…ƒä»¶

ä¼ºæœå™¨å…ƒä»¶å¯ä»¥ä½¿ç”¨å‡½å¼å±¤ç´šæˆ–æ¨¡çµ„å±¤ç´šçš„ `"use server"` æŒ‡ä»¤ã€‚è‹¥è¦å…§åµŒä¼ºæœå™¨å‹•ä½œï¼Œè«‹åœ¨å‡½å¼ä¸»é«”é ‚éƒ¨æ·»åŠ  `"use server"`ï¼š

```tsx filename="app/page.tsx" switcher
export default function Page() {
  // ä¼ºæœå™¨å‹•ä½œ
  async function create() {
    'use server'
    // ç•°å‹•è³‡æ–™
  }

  return '...'
}
```

```jsx filename="app/page.js" switcher
export default function Page() {
  // ä¼ºæœå™¨å‹•ä½œ
  async function create() {
    'use server'
    // ç•°å‹•è³‡æ–™
  }

  return '...'
}
```

### å®¢æˆ¶ç«¯å…ƒä»¶

è¦åœ¨[å®¢æˆ¶ç«¯å…ƒä»¶](/docs/app/getting-started/updating-data#server-functions)ä¸­å‘¼å«ä¼ºæœå™¨å‡½å¼ï¼Œè«‹å»ºç«‹æ–°æª”æ¡ˆä¸¦åœ¨å…¶é ‚éƒ¨æ·»åŠ  `"use server"` æŒ‡ä»¤ã€‚æª”æ¡ˆå…§æ‰€æœ‰åŒ¯å‡ºçš„å‡½å¼å°‡è¢«æ¨™è¨˜ç‚ºä¼ºæœå™¨å‡½å¼ï¼Œå¯åœ¨å®¢æˆ¶ç«¯èˆ‡ä¼ºæœå™¨å…ƒä»¶ä¸­é‡è¤‡ä½¿ç”¨ï¼š

```tsx filename="app/actions.ts" switcher
'use server'

export async function create() {}
```

```js filename="app/actions.js" switcher
'use server'

export async function create() {}
```

```tsx filename="app/button.tsx" switcher
'use client'

import { create } from './actions'

export function Button() {
  return <button onClick={() => create()}>Create</button>
}
```

```jsx filename="app/button.js" switcher
'use client'

import { create } from './actions'

export function Button() {
  return <button onClick={() => create()}>Create</button>
}
```

### å°‡å‹•ä½œä½œç‚ºå±¬æ€§å‚³é

æ‚¨ä¹Ÿå¯ä»¥å°‡ä¼ºæœå™¨å‹•ä½œä½œç‚ºå±¬æ€§å‚³éçµ¦å®¢æˆ¶ç«¯å…ƒä»¶ï¼š

```jsx
<ClientComponent updateItemAction={updateItem} />
```

```tsx filename="app/client-component.tsx" switcher
'use client'

export default function ClientComponent({
  updateItemAction,
}: {
  updateItemAction: (formData: FormData) => void
}) {
  return <form action={updateItemAction}>{/* ... */}</form>
}
```

```jsx filename="app/client-component.js" switcher
'use client'

export default function ClientComponent({ updateItemAction }) {
  return <form action={updateItemAction}>{/* ... */}</form>
}
```

é€šå¸¸ï¼ŒNext.js TypeScript æ’ä»¶æœƒæ¨™è¨˜ `client-component.tsx` ä¸­çš„ `updateItemAction`ï¼Œå› ç‚ºå®ƒæ˜¯ä¸€å€‹é€šå¸¸ç„¡æ³•è·¨å®¢æˆ¶ç«¯-ä¼ºæœå™¨é‚Šç•Œåºåˆ—åŒ–çš„å‡½å¼ã€‚ç„¶è€Œï¼Œåç‚º `action` æˆ–ä»¥ `Action` çµå°¾çš„å±¬æ€§è¢«å‡å®šæ¥æ”¶ä¼ºæœå™¨å‹•ä½œã€‚é€™åªæ˜¯ä¸€å€‹å•Ÿç™¼å¼æ–¹æ³•ï¼Œå› ç‚º TypeScript æ’ä»¶å¯¦éš›ä¸Šä¸çŸ¥é“å®ƒæ¥æ”¶çš„æ˜¯ä¼ºæœå™¨å‹•ä½œé‚„æ˜¯æ™®é€šå‡½å¼ã€‚åŸ·è¡Œæ™‚é¡å‹æª¢æŸ¥ä»æœƒç¢ºä¿æ‚¨ä¸æœƒæ„å¤–å°‡å‡½å¼å‚³éçµ¦å®¢æˆ¶ç«¯å…ƒä»¶ã€‚

## è¡Œç‚º

- ä¼ºæœå™¨å‹•ä½œå¯ä»¥ä½¿ç”¨ `<form>` å…ƒç´ ä¸­çš„ `action` å±¬æ€§ä¾†å‘¼å«ã€‚
  - ä¼ºæœå™¨å…ƒä»¶é è¨­æ”¯æ´æ¼¸é€²å¢å¼·ï¼Œæ„å‘³è‘—å³ä½¿ JavaScript å°šæœªè¼‰å…¥æˆ–å·²åœç”¨ï¼Œè¡¨å–®ä»æœƒæäº¤ã€‚
  - åœ¨å®¢æˆ¶ç«¯å…ƒä»¶ä¸­ï¼Œå‘¼å«ä¼ºæœå™¨å‹•ä½œçš„è¡¨å–®æœƒåœ¨ JavaScript å°šæœªè¼‰å…¥æ™‚æ’éšŠæäº¤ï¼Œå„ªå…ˆè€ƒæ…®å®¢æˆ¶ç«¯æ°´åˆ (hydration)ã€‚
  - æ°´åˆå¾Œï¼Œç€è¦½å™¨ä¸æœƒåœ¨è¡¨å–®æäº¤æ™‚é‡æ–°æ•´ç†ã€‚
- ä¼ºæœå™¨å‹•ä½œä¸é™æ–¼ `<form>`ï¼Œå¯ä»¥å¾äº‹ä»¶è™•ç†ç¨‹åºã€`useEffect`ã€ç¬¬ä¸‰æ–¹å‡½å¼åº«å’Œå…¶ä»–è¡¨å–®å…ƒç´ ï¼ˆå¦‚ `<button>`ï¼‰å‘¼å«ã€‚
- ä¼ºæœå™¨å‹•ä½œèˆ‡ Next.js [å¿«å–å’Œé‡æ–°é©—è­‰](/docs/app/deep-dive/caching)æ¶æ§‹æ•´åˆã€‚ç•¶å‹•ä½œè¢«å‘¼å«æ™‚ï¼ŒNext.js å¯ä»¥åœ¨å–®æ¬¡ä¼ºæœå™¨å¾€è¿”ä¸­è¿”å›æ›´æ–°çš„ UI å’Œæ–°è³‡æ–™ã€‚
- åœ¨å¹•å¾Œï¼Œå‹•ä½œä½¿ç”¨ `POST` æ–¹æ³•ï¼Œåªæœ‰æ­¤ HTTP æ–¹æ³•å¯ä»¥å‘¼å«å®ƒå€‘ã€‚
- ä¼ºæœå™¨å‹•ä½œçš„åƒæ•¸å’Œè¿”å›å€¼å¿…é ˆå¯ç”± React åºåˆ—åŒ–ã€‚è«‹åƒé–± React æ–‡ä»¶äº†è§£[å¯åºåˆ—åŒ–çš„åƒæ•¸å’Œå€¼](https://react.dev/reference/react/use-server#serializable-parameters-and-return-values)ã€‚
- ä¼ºæœå™¨å‹•ä½œæ˜¯å‡½å¼ï¼Œé€™æ„å‘³è‘—å®ƒå€‘å¯ä»¥åœ¨æ‡‰ç”¨ç¨‹å¼çš„ä»»ä½•åœ°æ–¹é‡è¤‡ä½¿ç”¨ã€‚
- ä¼ºæœå™¨å‹•ä½œç¹¼æ‰¿å®ƒå€‘æ‰€ä½¿ç”¨é é¢æˆ–ä½ˆå±€çš„åŸ·è¡Œç’°å¢ƒã€‚
- ä¼ºæœå™¨å‹•ä½œç¹¼æ‰¿å®ƒå€‘æ‰€ä½¿ç”¨é é¢æˆ–ä½ˆå±€çš„[è·¯ç”±å€æ®µé…ç½®](/docs/app/api-reference/file-conventions/route-segment-config)ï¼ŒåŒ…æ‹¬ `maxDuration` ç­‰æ¬„ä½ã€‚

## ç¯„ä¾‹

### äº‹ä»¶è™•ç†ç¨‹åº

é›–ç„¶é€šå¸¸åœ¨ `<form>` å…ƒç´ ä¸­ä½¿ç”¨ä¼ºæœå™¨å‹•ä½œï¼Œä½†å®ƒå€‘ä¹Ÿå¯ä»¥èˆ‡ `onClick` ç­‰äº‹ä»¶è™•ç†ç¨‹åºä¸€èµ·å‘¼å«ã€‚ä¾‹å¦‚ï¼Œå¢åŠ æŒ‰è®šè¨ˆæ•¸ï¼š

```tsx filename="app/like-button.tsx" switcher
'use client'

import { incrementLike } from './actions'
import { useState } from 'react'

export default function LikeButton({ initialLikes }: { initialLikes: number }) {
  const [likes, setLikes] = useState(initialLikes)

  return (
    <>
      <p>ç¸½æŒ‰è®šæ•¸: {likes}</p>
      <button
        onClick={async () => {
          const updatedLikes = await incrementLike()
          setLikes(updatedLikes)
        }}
      >
        æŒ‰è®š
      </button>
    </>
  )
}
```

```jsx filename="app/like-button.js" switcher
'use client'

import { incrementLike } from './actions'
import { useState } from 'react'

export default function LikeButton({ initialLikes }) {
  const [likes, setLikes] = useState(initialLikes)

  return (
    <>
      <p>ç¸½æŒ‰è®šæ•¸: {likes}</p>
      <button
        onClick={async () => {
          const updatedLikes = await incrementLike()
          setLikes(updatedLikes)
        }}
      >
        æŒ‰è®š
      </button>
    </>
  )
}
```

æ‚¨ä¹Ÿå¯ä»¥ç‚ºè¡¨å–®å…ƒç´ æ·»åŠ äº‹ä»¶è™•ç†ç¨‹åºï¼Œä¾‹å¦‚åœ¨ `onChange` æ™‚å„²å­˜è¡¨å–®æ¬„ä½ï¼š

```tsx filename="app/ui/edit-post.tsx"
'use client'

import { publishPost, saveDraft } from './actions'

export default function EditPost() {
  return (
    <form action={publishPost}>
      <textarea
        name="content"
        onChange={async (e) => {
          await saveDraft(e.target.value)
        }}
      />
      <button type="submit">ç™¼å¸ƒ</button>
    </form>
  )
}
```

å°æ–¼é€™ç¨®æƒ…æ³ï¼Œç•¶å¯èƒ½å¿«é€Ÿé€£çºŒè§¸ç™¼å¤šå€‹äº‹ä»¶æ™‚ï¼Œæˆ‘å€‘å»ºè­°ä½¿ç”¨**é˜²æŠ– (debouncing)** ä¾†é¿å…ä¸å¿…è¦çš„ä¼ºæœå™¨å‹•ä½œå‘¼å«ã€‚

### `useEffect`

æ‚¨å¯ä»¥ä½¿ç”¨ React çš„ [`useEffect`](https://react.dev/reference/react/useEffect) é‰¤å­åœ¨å…ƒä»¶æ›è¼‰æˆ–ä¾è³´é …è®Šæ›´æ™‚å‘¼å«ä¼ºæœå™¨å‹•ä½œã€‚é€™å°æ–¼ä¾è³´å…¨åŸŸäº‹ä»¶æˆ–éœ€è¦è‡ªå‹•è§¸ç™¼çš„ç•°å‹•å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œ`onKeyDown` ç”¨æ–¼æ‡‰ç”¨ç¨‹å¼å¿«æ·éµã€ç„¡é™æ»¾å‹•çš„äº¤é›†è§€å¯Ÿå™¨é‰¤å­ï¼Œæˆ–åœ¨å…ƒä»¶æ›è¼‰æ™‚æ›´æ–°æª¢è¦–è¨ˆæ•¸ï¼š

```tsx filename="app/view-count.tsx" switcher
'use client'

import { incrementViews } from './actions'
import { useState, useEffect, useTransition } from 'react'

export default function ViewCount({ initialViews }: { initialViews: number }) {
  const [views, setViews] = useState(initialViews)
  const [isPending, startTransition] = useTransition()

  useEffect(() => {
    startTransition(async () => {
      const updatedViews = await incrementViews()
      setViews(updatedViews)
    })
  }, [])

  // æ‚¨å¯ä»¥ä½¿ç”¨ `isPending` å‘ç”¨æˆ¶æä¾›åé¥‹
  return <p>ç¸½æª¢è¦–æ¬¡æ•¸: {views}</p>
}
```

```jsx filename="app/view-count.js" switcher
'use client'

import { incrementViews } from './actions'
import { useState, useEffect, useTransition } from 'react'

export default function ViewCount({ initialViews }) {
  const [views, setViews] = useState(initialViews)
  const [isPending, startTransition] = useTransition()

  useEffect(() => {
    starTransition(async () => {
      const updatedViews = await incrementViews()
      setViews(updatedViews)
    })
  }, [])

  // æ‚¨å¯ä»¥ä½¿ç”¨ `isPending` å‘ç”¨æˆ¶æä¾›åé¥‹
  return <p>ç¸½æª¢è¦–æ¬¡æ•¸: {views}</p>
}
```

è«‹è¨˜ä½è€ƒæ…® `useEffect` çš„[è¡Œç‚ºèˆ‡æ³¨æ„äº‹é …](https://react.dev/reference/react/useEffect#caveats)ã€‚

### éŒ¯èª¤è™•ç†

ç•¶éŒ¯èª¤è¢«æ‹‹å‡ºæ™‚ï¼Œå®ƒå°‡è¢«å®¢æˆ¶ç«¯æœ€è¿‘çš„ `error.js` æˆ– `<Suspense>` é‚Šç•Œæ•ç²ã€‚è«‹åƒé–±[éŒ¯èª¤è™•ç†](/docs/app/getting-started/error-handling)ä»¥ç²å–æ›´å¤šè³‡è¨Šã€‚

> **é ˆçŸ¥ï¼š**
>
> - é™¤äº†æ‹‹å‡ºéŒ¯èª¤å¤–ï¼Œæ‚¨é‚„å¯ä»¥è¿”å›ä¸€å€‹ç‰©ä»¶ä¾› `useActionState` è™•ç†ã€‚

### é‡æ–°é©—è­‰è³‡æ–™

æ‚¨å¯ä»¥åœ¨ä¼ºæœå™¨å‹•ä½œä¸­ä½¿ç”¨ [`revalidatePath`](/docs/app/api-reference/functions/revalidatePath) API é‡æ–°é©—è­‰ [Next.js å¿«å–](/docs/app/deep-dive/caching)ï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { revalidatePath } from 'next/cache'

export async function createPost() {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidatePath('/posts')
}
```

```js filename="app/actions.js" switcher
'use server'

import { revalidatePath } from 'next/cache'

export async function createPost() {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidatePath('/posts')
}
```

æˆ–è€…ä½¿ç”¨ [`revalidateTag`](/docs/app/api-reference/functions/revalidateTag) é€éå¿«å–æ¨™ç±¤ä½¿ç‰¹å®šè³‡æ–™ç²å–å¤±æ•ˆï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { revalidateTag } from 'next/cache'

export async function createPost() {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidateTag('posts')
}
```

```js filename="app/actions.js" switcher
'use server'

import { revalidateTag } from 'next/cache'

export async function createPost() {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidateTag('posts')
}
```

### é‡æ–°å°å‘

å¦‚æœæ‚¨å¸Œæœ›åœ¨ä¼ºæœå™¨å‹•ä½œå®Œæˆå¾Œå°‡ç”¨æˆ¶é‡æ–°å°å‘åˆ°ä¸åŒè·¯ç”±ï¼Œå¯ä»¥ä½¿ç”¨ [`redirect`](/docs/app/api-reference/functions/redirect) APIã€‚`redirect` éœ€è¦åœ¨ `try/catch` å€å¡Šå¤–å‘¼å«ï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { redirect } from 'next/navigation'
import { revalidateTag } from 'next/cache'

export async function createPost(id: string) {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidateTag('posts') // æ›´æ–°å¿«å–æ–‡ç« 
  redirect(`/post/${id}`) // å°å‘æ–°æ–‡ç« é é¢
}
```

```js filename="app/actions.js" switcher
'use server'

import { redirect } from 'next/navigation'
import { revalidateTag } from 'next/cache'

export async function createPost(id) {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidateTag('posts') // æ›´æ–°å¿«å–æ–‡ç« 
  redirect(`/post/${id}`) // å°å‘æ–°æ–‡ç« é é¢
}
```

### Cookies

æ‚¨å¯ä»¥åœ¨ä¼ºæœå™¨å‹•ä½œä¸­ä½¿ç”¨ [`cookies`](/docs/app/api-reference/functions/cookies) API ä¾† `get`ã€`set` å’Œ `delete` cookiesï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { cookies } from 'next/headers'

export async function exampleAction() {
  const cookieStore = await cookies()

  // å–å¾— cookie
  cookieStore.get('name')?.value

  // è¨­å®š cookie
  cookieStore.set('name', 'Delba')

  // åˆªé™¤ cookie
  cookieStore.delete('name')
}
```

```js filename="app/actions.js" switcher
'use server'

import { cookies } from 'next/headers'

export async function exampleAction() {
  // å–å¾— cookie
  const cookieStore = await cookies()

  // å–å¾— cookie
  cookieStore.get('name')?.value

  // è¨­å®š cookie
  cookieStore.set('name', 'Delba')

  // åˆªé™¤ cookie
  cookieStore.delete('name')
}
```

è«‹åƒé–±[å…¶ä»–ç¯„ä¾‹](/docs/app/api-reference/functions/cookies#deleting-cookies)äº†è§£å¦‚ä½•å¾ä¼ºæœå™¨å‹•ä½œåˆªé™¤ cookiesã€‚

## å®‰å…¨æ€§

é è¨­æƒ…æ³ä¸‹ï¼Œç•¶å»ºç«‹ä¸¦åŒ¯å‡ºä¼ºæœå™¨å‹•ä½œæ™‚ï¼Œå®ƒæœƒå»ºç«‹ä¸€å€‹å…¬é–‹çš„ HTTP ç«¯é»ï¼Œæ‡‰ä»¥ç›¸åŒçš„å®‰å…¨å‡è¨­å’Œæˆæ¬Šæª¢æŸ¥ä¾†å°å¾…ã€‚é€™æ„å‘³è‘—ï¼Œå³ä½¿ä¼ºæœå™¨å‹•ä½œæˆ–å·¥å…·å‡½å¼æœªåœ¨ç¨‹å¼ç¢¼çš„å…¶ä»–åœ°æ–¹åŒ¯å…¥ï¼Œå®ƒä»ç„¶æ˜¯å…¬é–‹å¯å­˜å–çš„ã€‚

ç‚ºäº†æé«˜å®‰å…¨æ€§ï¼ŒNext.js å…·æœ‰ä»¥ä¸‹å…§å»ºåŠŸèƒ½ï¼š

- **å®‰å…¨çš„å‹•ä½œ IDï¼š** Next.js å»ºç«‹åŠ å¯†ã€éç¢ºå®šæ€§çš„ IDï¼Œå…è¨±å®¢æˆ¶ç«¯å¼•ç”¨å’Œå‘¼å«ä¼ºæœå™¨å‹•ä½œã€‚é€™äº› ID åœ¨æ§‹å»ºä¹‹é–“å®šæœŸé‡æ–°è¨ˆç®—ä»¥å¢å¼·å®‰å…¨æ€§ã€‚
- **æ­»ç¢¼æ¶ˆé™¤ï¼š** æœªä½¿ç”¨çš„ä¼ºæœå™¨å‹•ä½œï¼ˆç”±å…¶ ID å¼•ç”¨ï¼‰æœƒå¾å®¢æˆ¶ç«¯å¥—ä»¶ä¸­ç§»é™¤ï¼Œä»¥é¿å…ç¬¬ä¸‰æ–¹å…¬é–‹å­˜å–ã€‚

> **é ˆçŸ¥ï¼š**
>
> ID åœ¨ç·¨è­¯æœŸé–“å»ºç«‹ï¼Œä¸¦å¿«å–æœ€å¤š 14 å¤©ã€‚ç•¶å•Ÿå‹•æ–°æ§‹å»ºæˆ–æ§‹å»ºå¿«å–å¤±æ•ˆæ™‚ï¼Œå®ƒå€‘å°‡é‡æ–°ç”Ÿæˆã€‚
> æ­¤å®‰å…¨æ”¹é€²æ¸›å°‘äº†ç¼ºå°‘èº«ä»½é©—è­‰å±¤æƒ…æ³ä¸‹çš„é¢¨éšªã€‚ç„¶è€Œï¼Œæ‚¨ä»æ‡‰å°‡ä¼ºæœå™¨å‹•ä½œè¦–ç‚ºå…¬é–‹ HTTP ç«¯é»ã€‚

```jsx
// app/actions.js
'use server'

// æ­¤å‹•ä½œ**åœ¨**æˆ‘å€‘çš„æ‡‰ç”¨ç¨‹å¼ä¸­ä½¿ç”¨ï¼Œå› æ­¤ Next.js
// å°‡å»ºç«‹å®‰å…¨ ID ä»¥å…è¨±å®¢æˆ¶ç«¯å¼•ç”¨
// å’Œå‘¼å«ä¼ºæœå™¨å‹•ä½œã€‚
export async function updateUserAction(formData) {}

// æ­¤å‹•ä½œ**æœªåœ¨**æˆ‘å€‘çš„æ‡‰ç”¨ç¨‹å¼ä¸­ä½¿ç”¨ï¼Œå› æ­¤ Next.js
// å°‡åœ¨ `next build` æœŸé–“è‡ªå‹•ç§»é™¤æ­¤ç¨‹å¼ç¢¼
// ä¸¦ä¸”ä¸æœƒå»ºç«‹å…¬é–‹ç«¯é»ã€‚
export async function deleteUserAction(formData) {}
```

### èº«ä»½é©—è­‰èˆ‡æˆæ¬Š

æ‚¨æ‡‰ç¢ºä¿ç”¨æˆ¶æœ‰æ¬ŠåŸ·è¡Œè©²å‹•ä½œã€‚ä¾‹å¦‚ï¼š

```tsx filename="app/actions.ts"
'use server'

import { auth } from './lib'

export function addItem() {
  const { user } = auth()
  if (!user) {
    throw new Error('æ‚¨å¿…é ˆç™»å…¥æ‰èƒ½åŸ·è¡Œæ­¤å‹•ä½œ')
  }

  // ...
}
```

### é–‰åŒ…èˆ‡åŠ å¯†

åœ¨å…ƒä»¶å…§å®šç¾©ä¼ºæœå™¨å‹•ä½œæœƒå»ºç«‹ä¸€å€‹[é–‰åŒ… (closure)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures)ï¼Œå…¶ä¸­å‹•ä½œå¯ä»¥å­˜å–å¤–éƒ¨å‡½å¼çš„ç¯„åœã€‚ä¾‹å¦‚ï¼Œ`publish` å‹•ä½œå¯ä»¥å­˜å– `publishVersion` è®Šæ•¸ï¼š

```tsx filename="app/page.tsx" switcher
export default async function Page() {
  const publishVersion = await getLatestVersion();

  async function publish() {
    "use server";
    if (publishVersion !== await getLatestVersion()) {
      throw new Error('è‡ªæŒ‰ä¸‹ç™¼å¸ƒä»¥ä¾†ç‰ˆæœ¬å·²è®Šæ›´');
    }
    ...
  }

  return (
    <form>
      <button formAction={publish}>ç™¼å¸ƒ</button>
    </form>
  );
}
```

```jsx filename="app/page.js" switcher
export default async function Page() {
  const publishVersion = await getLatestVersion();

  async function publish() {
    "use server";
    if (publishVersion !== await getLatestVersion()) {
      throw new Error('è‡ªæŒ‰ä¸‹ç™¼å¸ƒä»¥ä¾†ç‰ˆæœ¬å·²è®Šæ›´');
    }
    ...
  }

  return (
    <form>
      <button formAction={publish}>ç™¼å¸ƒ</button>
    </form>
  );
}
```

é–‰åŒ…åœ¨æ‚¨éœ€è¦æ•ç²è³‡æ–™çš„*å¿«ç…§*ï¼ˆä¾‹å¦‚ `publishVersion`ï¼‰ä»¥ä¾¿åœ¨å‹•ä½œè¢«å‘¼å«æ™‚ä½¿ç”¨æ™‚éå¸¸æœ‰ç”¨ã€‚

ç„¶è€Œï¼Œç‚ºäº†å¯¦ç¾é€™ä¸€é»ï¼Œæ•ç²çš„è®Šæ•¸æœƒè¢«ç™¼é€åˆ°å®¢æˆ¶ç«¯ï¼Œä¸¦åœ¨å‹•ä½œè¢«å‘¼å«æ™‚è¿”å›ä¼ºæœå™¨ã€‚ç‚ºäº†é˜²æ­¢æ•æ„Ÿè³‡æ–™æš´éœ²çµ¦å®¢æˆ¶ç«¯ï¼ŒNext.js æœƒè‡ªå‹•åŠ å¯†é–‰åŒ…è®Šæ•¸ã€‚æ¯æ¬¡æ§‹å»º Next.js æ‡‰ç”¨ç¨‹å¼æ™‚ï¼Œéƒ½æœƒç‚ºæ¯å€‹å‹•ä½œç”Ÿæˆæ–°çš„ç§é‘°ã€‚é€™æ„å‘³è‘—å‹•ä½œåªèƒ½åœ¨ç‰¹å®šæ§‹å»ºä¸­è¢«å‘¼å«ã€‚

> **é ˆçŸ¥ï¼š** æˆ‘å€‘ä¸å»ºè­°åƒ…ä¾è³´åŠ å¯†ä¾†é˜²æ­¢æ•æ„Ÿå€¼æš´éœ²åœ¨å®¢æˆ¶ç«¯ã€‚ç›¸åï¼Œæ‚¨æ‡‰ä½¿ç”¨ [React taint API](/docs/app/api-reference/config/next-config-js/taint) ä¸»å‹•é˜²æ­¢ç‰¹å®šè³‡æ–™ç™¼é€åˆ°å®¢æˆ¶ç«¯ã€‚

### è¦†å¯«åŠ å¯†é‡‘é‘° (é€²éš)

ç•¶æ‚¨åœ¨å¤šå°ä¼ºæœå™¨ä¸Šè‡ªè¡Œè¨—ç®¡ Next.js æ‡‰ç”¨ç¨‹å¼æ™‚ï¼Œæ¯å€‹ä¼ºæœå™¨å¯¦ä¾‹å¯èƒ½æœƒç”¢ç”Ÿä¸åŒçš„åŠ å¯†é‡‘é‘°ï¼Œå°è‡´æ½›åœ¨çš„ä¸ä¸€è‡´å•é¡Œã€‚

ç‚ºè§£æ±ºæ­¤å•é¡Œï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `process.env.NEXT_SERVER_ACTIONS_ENCRYPTION_KEY` ç’°å¢ƒè®Šæ•¸è¦†å¯«åŠ å¯†é‡‘é‘°ã€‚æŒ‡å®šæ­¤è®Šæ•¸å¯ç¢ºä¿æ‚¨çš„åŠ å¯†é‡‘é‘°åœ¨å¤šæ¬¡å»ºç½®é–“ä¿æŒä¸€è‡´æ€§ï¼Œä¸”æ‰€æœ‰ä¼ºæœå™¨å¯¦ä¾‹éƒ½ä½¿ç”¨ç›¸åŒçš„é‡‘é‘°ã€‚æ­¤è®Šæ•¸**å¿…é ˆ**ä½¿ç”¨ AES-GCM åŠ å¯†ã€‚

é€™æ˜¯é€²éšä½¿ç”¨æƒ…å¢ƒï¼Œç•¶æ‚¨çš„æ‡‰ç”¨ç¨‹å¼éœ€è¦ç¢ºä¿åœ¨å¤šå€‹éƒ¨ç½²ç’°å¢ƒä¸­åŠ å¯†è¡Œç‚ºä¸€è‡´æ™‚æ‰éœ€è€ƒæ…®ã€‚æ‚¨æ‡‰éµå¾ªæ¨™æº–å®‰å…¨å¯¦è¸ï¼Œä¾‹å¦‚é‡‘é‘°è¼ªæ›¿å’Œç°½ç« ã€‚

> **é ˆçŸ¥ï¼š** éƒ¨ç½²è‡³ Vercel çš„ Next.js æ‡‰ç”¨ç¨‹å¼æœƒè‡ªå‹•è™•ç†æ­¤å•é¡Œã€‚

### å…è¨±çš„ä¾†æº (é€²éš)

ç”±æ–¼ä¼ºæœå™¨å‹•ä½œ (Server Actions) å¯ä»¥åœ¨ `<form>` å…ƒç´ ä¸­è§¸ç™¼ï¼Œé€™ä½¿å…¶å¯èƒ½é­å— [CSRF æ”»æ“Š](https://developer.mozilla.org/en-US/docs/Glossary/CSRF)ã€‚

åœ¨åº•å±¤ï¼Œä¼ºæœå™¨å‹•ä½œä½¿ç”¨ `POST` æ–¹æ³•ï¼Œä¸”åƒ…å…è¨±æ­¤ HTTP æ–¹æ³•è§¸ç™¼å®ƒå€‘ã€‚é€™åœ¨ç¾ä»£ç€è¦½å™¨ä¸­å¯é˜²æ­¢å¤§å¤šæ•¸ CSRF æ¼æ´ï¼Œç‰¹åˆ¥æ˜¯ç•¶ [SameSite cookies](https://web.dev/articles/samesite-cookies-explained) æˆç‚ºé è¨­å€¼æ™‚ã€‚

ä½œç‚ºé¡å¤–ä¿è­·ï¼ŒNext.js ä¸­çš„ä¼ºæœå™¨å‹•ä½œé‚„æœƒæ¯”å° [Origin æ¨™é ­](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin) èˆ‡ [Host æ¨™é ­](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Host) (æˆ– `X-Forwarded-Host`)ã€‚è‹¥å…©è€…ä¸ç¬¦ï¼Œè«‹æ±‚å°‡è¢«ä¸­æ­¢ã€‚æ›è¨€ä¹‹ï¼Œä¼ºæœå™¨å‹•ä½œåªèƒ½åœ¨èˆ‡å®¿ä¸»é é¢ç›¸åŒçš„ä¸»æ©Ÿä¸Šè§¸ç™¼ã€‚

å°æ–¼ä½¿ç”¨åå‘ä»£ç†æˆ–å¤šå±¤å¾Œç«¯æ¶æ§‹çš„å¤§å‹æ‡‰ç”¨ç¨‹å¼ (ä¼ºæœå™¨ API èˆ‡ç”Ÿç”¢ç¶²åŸŸä¸åŒ)ï¼Œå»ºè­°ä½¿ç”¨ [`serverActions.allowedOrigins`](/docs/app/api-reference/config/next-config-js/serverActions) é…ç½®é¸é …ä¾†æŒ‡å®šå®‰å…¨ä¾†æºæ¸…å–®ã€‚æ­¤é¸é …æ¥å—å­—ä¸²é™£åˆ—ã€‚

```js filename="next.config.js"
/** @type {import('next').NextConfig} */
module.exports = {
  experimental: {
    serverActions: {
      allowedOrigins: ['my-proxy.com', '*.my-proxy.com'],
    },
  },
}
```

äº†è§£æ›´å¤šé—œæ–¼ [å®‰å…¨æ€§èˆ‡ä¼ºæœå™¨å‹•ä½œ](https://nextjs.org/blog/security-nextjs-server-components-actions) çš„è³‡è¨Šã€‚

## å»¶ä¼¸è³‡æº

æ›´å¤šè³‡è¨Šè«‹åƒè€ƒä»¥ä¸‹ React æ–‡ä»¶ï¼š

- [ä¼ºæœå™¨å‹•ä½œ](https://react.dev/reference/rsc/server-actions)
- [`"use server"`](https://react.dev/reference/react/use-server)
- [`<form>`](https://react.dev/reference/react-dom/components/form)
- [`useFormStatus`](https://react.dev/reference/react-dom/hooks/useFormStatus)
- [`useActionState`](https://react.dev/reference/react/useActionState)
- [`useOptimistic`](https://react.dev/reference/react/useOptimistic)
