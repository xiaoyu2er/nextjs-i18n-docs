---
source-updated-at: 2025-05-19T22:31:51.000Z
translation-updated-at: 2025-05-25T21:01:45.026Z
title: 版面配置與模板
description: 在 Next.js 中建立第一個共享版面配置。
---

特殊檔案 [layout.js](#layouts) 和 [template.js](#templates) 可讓您建立路由間共享的使用者介面。本頁將引導您了解如何使用這些特殊檔案以及適用的時機。

## 版面配置 (Layouts)

版面配置是**共享**於多個路由間的使用者介面。在導航時，版面配置會保留狀態、保持互動性且不會重新渲染。版面配置也可以[嵌套](#nesting-layouts)。

您可以透過從 `layout.js` 檔案預設導出 React 元件來定義版面配置。該元件應接受一個 `children` 屬性，該屬性在渲染時會被填入子版面配置（如果存在）或頁面。

例如，以下版面配置將與 `/dashboard` 和 `/dashboard/settings` 頁面共享：

<Image
  alt="layout.js 特殊檔案"
  srcLight="/docs/light/layout-special-file.png"
  srcDark="/docs/dark/layout-special-file.png"
  width="1600"
  height="606"
/>

```tsx filename="app/dashboard/layout.tsx" switcher
export default function DashboardLayout({
  children, // 將是一個頁面或嵌套的版面配置
}: {
  children: React.ReactNode
}) {
  return (
    <section>
      {/* 在此包含共享 UI，例如標頭或側邊欄 */}
      <nav></nav>

      {children}
    </section>
  )
}
```

```jsx filename="app/dashboard/layout.js" switcher
export default function DashboardLayout({
  children, // 將是一個頁面或嵌套的版面配置
}) {
  return (
    <section>
      {/* 在此包含共享 UI，例如標頭或側邊欄 */}
      <nav></nav>

      {children}
    </section>
  )
}
```

### 根版面配置 (Root Layout) (必填)

根版面配置定義於 `app` 目錄的頂層，適用於所有路由。此版面配置是**必填的**，且必須包含 `html` 和 `body` 標籤，讓您可以修改從伺服器返回的初始 HTML。

```tsx filename="app/layout.tsx" switcher
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body>
        {/* 版面配置 UI */}
        <main>{children}</main>
      </body>
    </html>
  )
}
```

```jsx filename="app/layout.js" switcher
export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <body>
        {/* 版面配置 UI */}
        <main>{children}</main>
      </body>
    </html>
  )
}
```

### 嵌套版面配置 (Nesting Layouts)

預設情況下，資料夾層級中的版面配置是**嵌套的**，這意味著它們會透過 `children` 屬性包裹子版面配置。您可以透過在特定路由區段（資料夾）內新增 `layout.js` 來嵌套版面配置。

例如，要為 `/dashboard` 路由建立版面配置，請在 `dashboard` 資料夾內新增一個 `layout.js` 檔案：

<Image
  alt="嵌套版面配置"
  srcLight="/docs/light/nested-layout.png"
  srcDark="/docs/dark/nested-layout.png"
  width="1600"
  height="606"
/>

```tsx filename="app/dashboard/layout.tsx" switcher
export default function DashboardLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return <section>{children}</section>
}
```

```jsx filename="app/dashboard/layout.js" switcher
export default function DashboardLayout({ children }) {
  return <section>{children}</section>
}
```

如果您將上述兩個版面配置結合，根版面配置 (`app/layout.js`) 會包裹儀表板版面配置 (`app/dashboard/layout.js`)，而儀表板版面配置會包裹 `app/dashboard/*` 內的路由區段。

這兩個版面配置會像這樣嵌套：

<Image
  alt="嵌套版面配置"
  srcLight="/docs/light/nested-layouts-ui.png"
  srcDark="/docs/dark/nested-layouts-ui.png"
  width="1600"
  height="1026"
/>

> **須知**：
>
> - 版面配置可使用 `.js`、`.jsx` 或 `.tsx` 副檔名。
> - 只有根版面配置可以包含 `<html>` 和 `<body>` 標籤。
> - 當同一資料夾中同時定義了 `layout.js` 和 `page.js` 檔案時，版面配置會包裹頁面。
> - 版面配置預設為[伺服器元件 (Server Components)](/docs/app/getting-started/server-and-client-components)，但可設為[客戶端元件 (Client Component)](/docs/app/getting-started/server-and-client-components)。
> - 版面配置可以獲取資料。詳見[資料獲取 (Data Fetching)](/docs/app/building-your-application/data-fetching) 章節。
> - 無法在父版面配置與其子元件間傳遞資料。但您可以在路由中多次獲取相同資料，React 會[自動去重複請求](/docs/app/deep-dive/caching#request-memoization)且不影響效能。
> - 版面配置無法存取 `pathname` ([了解更多](/docs/app/api-reference/file-conventions/layout))。但導入的客戶端元件可使用 [`usePathname`](/docs/app/api-reference/functions/use-pathname) 鉤子來存取路徑名稱。
> - 版面配置無法存取其下方的路由區段。要存取所有路由區段，可在客戶端元件中使用 [`useSelectedLayoutSegment`](/docs/app/api-reference/functions/use-selected-layout-segment) 或 [`useSelectedLayoutSegments`](/docs/app/api-reference/functions/use-selected-layout-segments)。
> - 您可以使用[路由群組 (Route Groups)](/docs/app/building-your-application/routing/route-groups) 來選擇特定路由區段是否共享版面配置。
> - 您可以使用[路由群組 (Route Groups)](/docs/app/building-your-application/routing/route-groups) 建立多個根版面配置。參見[此範例](/docs/app/getting-started/project-structure#creating-multiple-root-layouts)。
> - **從 `pages` 目錄遷移：** 根版面配置取代了 [`_app.js`](/docs/pages/building-your-application/routing/custom-app) 和 [`_document.js`](/docs/pages/building-your-application/routing/custom-document) 檔案。[查看遷移指南](/docs/app/guides/migrating/app-router-migration#migrating-_documentjs-and-_appjs)。

## 模板 (Templates)

模板與版面配置類似，它們都會包裹子版面配置或頁面。不同之處在於，版面配置會跨路由持續存在並保持狀態，而模板會在導航時為每個子元件建立新實例。這意味著當使用者在共享模板的路由間導航時，會掛載子元件的新實例、重新建立 DOM 元素、客戶端元件的狀態**不會**保留，且副作用會重新同步。

在某些情況下，您可能需要這些特定行為，此時模板會是比版面配置更合適的選擇。例如：

- 在導航時重新同步 `useEffect`。
- 在導航時重設客戶端子元件的狀態。

您可以透過從 `template.js` 檔案預設導出 React 元件來定義模板。該元件應接受一個 `children` 屬性。

<Image
  alt="template.js 特殊檔案"
  srcLight="/docs/light/template-special-file.png"
  srcDark="/docs/dark/template-special-file.png"
  width="1600"
  height="444"
/>

```tsx filename="app/template.tsx" switcher
export default function Template({ children }: { children: React.ReactNode }) {
  return <div>{children}</div>
}
```

```jsx filename="app/template.js" switcher
export default function Template({ children }) {
  return <div>{children}</div>
}
```

在嵌套方面，`template.js` 會渲染於版面配置與其子元件之間。以下是簡化的輸出：

```jsx filename="Output"
<Layout>
  {/* 注意模板有一個唯一的 key。 */}
  <Template key={routeParam}>{children}</Template>
</Layout>
```

## 範例

### 元資料 (Metadata)

您可以使用[元資料 API (Metadata APIs)](/docs/app/getting-started/metadata-and-og-images) 來修改 `<head>` HTML 元素，例如 `title` 和 `meta`。

元資料可透過在 [`layout.js`](/docs/app/api-reference/file-conventions/layout) 或 [`page.js`](/docs/app/api-reference/file-conventions/page) 檔案中導出 [`metadata` 物件](/docs/app/api-reference/functions/generate-metadata#the-metadata-object) 或 [`generateMetadata` 函式](/docs/app/api-reference/functions/generate-metadata#generatemetadata-function) 來定義。

```tsx filename="app/page.tsx" switcher
import type { Metadata } from 'next'

export const metadata: Metadata = {
  title: 'Next.js',
}

export default function Page() {
  return '...'
}
```

```jsx filename="app/page.js" switcher
export const metadata = {
  title: 'Next.js',
}

export default function Page() {
  return '...'
}
```

> **須知**：您**不應**手動將 `<head>` 標籤（如 `<title>` 和 `<meta>`）添加到根版面配置中。相反，請使用[元資料 API (Metadata API)](/docs/app/api-reference/functions/generate-metadata)，它會自動處理進階需求，例如串流和去重複 `<head>` 元素。

在[API 參考](/docs/app/api-reference/functions/generate-metadata) 中了解更多可用的元資料選項。

### 活動導航連結 (Active Nav Links)

您可以使用 [usePathname()](/docs/app/api-reference/functions/use-pathname) 鉤子來判斷導航連結是否處於活動狀態。

由於 `usePathname()` 是一個客戶端鉤子，您需要將導航連結提取到客戶端元件中，然後可以將其導入到您的版面配置或模板中：

```tsx filename="app/ui/nav-links.tsx" switcher
'use client'

import { usePathname } from 'next/navigation'
import Link from 'next/link'

export function NavLinks() {
  const pathname = usePathname()

  return (
    <nav>
      <Link className={`link ${pathname === '/' ? 'active' : ''}`} href="/">
        首頁
      </Link>

      <Link
        className={`link ${pathname === '/about' ? 'active' : ''}`}
        href="/about"
      >
        關於
      </Link>
    </nav>
  )
}
```

```jsx filename="app/ui/nav-links.js" switcher
'use client'

import { usePathname } from 'next/navigation'
import Link from 'next/link'

export function Links() {
  const pathname = usePathname()

  return (
    <nav>
      <Link className={`link ${pathname === '/' ? 'active' : ''}`} href="/">
        首頁
      </Link>

      <Link
        className={`link ${pathname === '/about' ? 'active' : ''}`}
        href="/about"
      >
        關於
      </Link>
    </nav>
  )
}
```

```tsx filename="app/layout.tsx" switcher
import { NavLinks } from '@/app/ui/nav-links'

export default function Layout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>
        <NavLinks />
        <main>{children}</main>
      </body>
    </html>
  )
}
```

```jsx filename="app/layout.js" switcher
import { NavLinks } from '@/app/ui/nav-links'

export default function Layout({ children }) {
  return (
    <html lang="en">
      <body>
        <NavLinks />
        <main>{children}</main>
      </body>
    </html>
  )
}
```