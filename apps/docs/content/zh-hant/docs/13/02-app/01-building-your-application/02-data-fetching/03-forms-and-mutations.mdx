---
source-updated-at: 2025-05-16T04:52:11.000Z
translation-updated-at: 2025-05-25T21:53:50.560Z
title: è¡¨å–®èˆ‡è³‡æ–™ç•°å‹•
nav_title: è¡¨å–®èˆ‡è³‡æ–™ç•°å‹•
description: å­¸ç¿’å¦‚ä½•ä½¿ç”¨ Next.js è™•ç†è¡¨å–®æäº¤èˆ‡è³‡æ–™ç•°å‹•ã€‚
---

{/* æ­¤æ–‡ä»¶å…§å®¹åœ¨æ‡‰ç”¨ç¨‹å¼è·¯ç”±èˆ‡é é¢è·¯ç”±ä¹‹é–“å…±äº«ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ `<PagesOnly>å…§å®¹</PagesOnly>` å…ƒä»¶ä¾†æ–°å¢å°ˆå±¬æ–¼é é¢è·¯ç”±çš„å…§å®¹ã€‚ä»»ä½•å…±äº«å…§å®¹ä¸æ‡‰åŒ…è£¹åœ¨å…ƒä»¶ä¸­ã€‚ */}

<PagesOnly>

è¡¨å–®è®“æ‚¨èƒ½åœ¨ç¶²é æ‡‰ç”¨ç¨‹å¼ä¸­å»ºç«‹èˆ‡æ›´æ–°è³‡æ–™ã€‚Next.js æä¾›äº†ä½¿ç”¨ **API è·¯ç”±** ä¾†è™•ç†è¡¨å–®æäº¤èˆ‡è³‡æ–™ç•°å‹•çš„å¼·å¤§æ–¹å¼ã€‚

> **é ˆçŸ¥äº‹é …ï¼š**
>
> - æˆ‘å€‘å°‡å¾ˆå¿«å»ºè­° [é€æ­¥æ¡ç”¨](/docs/app/building-your-application/upgrading/app-router-migration) æ‡‰ç”¨ç¨‹å¼è·¯ç”±ï¼Œä¸¦ä½¿ç”¨ [ä¼ºæœå™¨å‹•ä½œ (Server Actions)](/docs/app/building-your-application/data-fetching/forms-and-mutations#how-server-actions-work) ä¾†è™•ç†è¡¨å–®æäº¤èˆ‡è³‡æ–™ç•°å‹•ã€‚ä¼ºæœå™¨å‹•ä½œè®“æ‚¨èƒ½ç›´æ¥å¾å…ƒä»¶å‘¼å«éåŒæ­¥ä¼ºæœå™¨å‡½å¼ï¼Œç„¡éœ€æ‰‹å‹•å»ºç«‹ API è·¯ç”±ã€‚
> - API è·¯ç”± [ä¸æŒ‡å®š CORS æ¨™é ­](https://developer.mozilla.org/docs/Web/HTTP/CORS)ï¼Œé€™æ„å‘³è‘—å®ƒå€‘é è¨­åƒ…é™åŒæºè«‹æ±‚ã€‚
> - ç”±æ–¼ API è·¯ç”±åœ¨ä¼ºæœå™¨ç«¯åŸ·è¡Œï¼Œæˆ‘å€‘èƒ½é€é [ç’°å¢ƒè®Šæ•¸](/docs/pages/building-your-application/configuring/environment-variables) ä½¿ç”¨æ•æ„Ÿå€¼ï¼ˆå¦‚ API é‡‘é‘°ï¼‰è€Œä¸æš´éœ²çµ¦å®¢æˆ¶ç«¯ã€‚é€™å°æ‡‰ç”¨ç¨‹å¼çš„å®‰å…¨æ€§è‡³é—œé‡è¦ã€‚

</PagesOnly>

<AppOnly>

è¡¨å–®è®“æ‚¨èƒ½åœ¨ç¶²é æ‡‰ç”¨ç¨‹å¼ä¸­å»ºç«‹èˆ‡æ›´æ–°è³‡æ–™ã€‚Next.js æä¾›äº†ä½¿ç”¨ **ä¼ºæœå™¨å‹•ä½œ (Server Actions)** ä¾†è™•ç†è¡¨å–®æäº¤èˆ‡è³‡æ–™ç•°å‹•çš„å¼·å¤§æ–¹å¼ã€‚

<details>
  <summary>ç¯„ä¾‹</summary>

- [åŒ…å«è¼‰å…¥èˆ‡éŒ¯èª¤ç‹€æ…‹çš„è¡¨å–®](https://github.com/vercel/next.js/tree/canary/examples/next-forms)

</details>

## ä¼ºæœå™¨å‹•ä½œå¦‚ä½•é‹ä½œ

ä½¿ç”¨ä¼ºæœå™¨å‹•ä½œæ™‚ï¼Œæ‚¨ç„¡éœ€æ‰‹å‹•å»ºç«‹ API ç«¯é»ã€‚ç›¸ååœ°ï¼Œæ‚¨å¯ä»¥å®šç¾©èƒ½ç›´æ¥å¾å…ƒä»¶å‘¼å«çš„éåŒæ­¥ä¼ºæœå™¨å‡½å¼ã€‚

> **ğŸ¥ è§€çœ‹ï¼š** é€éæ‡‰ç”¨ç¨‹å¼è·¯ç”±äº†è§£æ›´å¤šé—œæ–¼è¡¨å–®èˆ‡è³‡æ–™ç•°å‹•çš„å…§å®¹ â†’ [YouTube (10 åˆ†é˜)](https://youtu.be/dDpZfOQBMaU?si=cJZHlUu_jFhCzHUg)ã€‚

ä¼ºæœå™¨å‹•ä½œå¯åœ¨ä¼ºæœå™¨å…ƒä»¶ä¸­å®šç¾©æˆ–å¾å®¢æˆ¶ç«¯å…ƒä»¶å‘¼å«ã€‚åœ¨ä¼ºæœå™¨å…ƒä»¶ä¸­å®šç¾©å‹•ä½œèƒ½è®“è¡¨å–®åœ¨ç„¡éœ€ JavaScript çš„æƒ…æ³ä¸‹é‹ä½œï¼Œå¯¦ç¾æ¼¸é€²å¢å¼·ã€‚

åœ¨ `next.config.js` æª”æ¡ˆä¸­å•Ÿç”¨ä¼ºæœå™¨å‹•ä½œï¼š

```js filename="next.config.js"
module.exports = {
  experimental: {
    serverActions: true,
  },
}
```

> **é ˆçŸ¥äº‹é …ï¼š**
>
> - å¾ä¼ºæœå™¨å…ƒä»¶å‘¼å«ä¼ºæœå™¨å‹•ä½œçš„è¡¨å–®å¯åœ¨ç„¡ JavaScript çš„æƒ…æ³ä¸‹é‹ä½œã€‚
> - å¾å®¢æˆ¶ç«¯å…ƒä»¶å‘¼å«ä¼ºæœå™¨å‹•ä½œçš„è¡¨å–®æœƒåœ¨ JavaScript å°šæœªè¼‰å…¥æ™‚æ’éšŠæäº¤ï¼Œå„ªå…ˆè™•ç†å®¢æˆ¶ç«¯æ°´åˆã€‚
> - ä¼ºæœå™¨å‹•ä½œç¹¼æ‰¿ä½¿ç”¨å®ƒå€‘çš„é é¢æˆ–ä½ˆå±€çš„ [åŸ·è¡Œç’°å¢ƒ (runtime)](/docs/app/building-your-application/rendering/edge-and-nodejs-runtimes)ã€‚
> - ä¼ºæœå™¨å‹•ä½œå¯èˆ‡å®Œå…¨éœæ…‹çš„è·¯ç”±æ­é…ä½¿ç”¨ï¼ˆåŒ…æ‹¬ä½¿ç”¨ ISR é‡æ–°é©—è­‰è³‡æ–™ï¼‰ã€‚

## é‡æ–°é©—è­‰å¿«å–è³‡æ–™

ä¼ºæœå™¨å‹•ä½œèˆ‡ Next.js çš„ [å¿«å–èˆ‡é‡æ–°é©—è­‰](/docs/app/building-your-application/caching) æ¶æ§‹æ·±åº¦æ•´åˆã€‚ç•¶è¡¨å–®æäº¤æ™‚ï¼Œä¼ºæœå™¨å‹•ä½œå¯æ›´æ–°å¿«å–è³‡æ–™ä¸¦é‡æ–°é©—è­‰æ‡‰è®Šæ›´çš„å¿«å–éµã€‚

èˆ‡å‚³çµ±æ‡‰ç”¨ç¨‹å¼å—é™æ–¼æ¯å€‹è·¯ç”±åƒ…èƒ½æœ‰ä¸€å€‹è¡¨å–®ä¸åŒï¼Œä¼ºæœå™¨å‹•ä½œè®“æ¯å€‹è·¯ç”±èƒ½æ“æœ‰å¤šå€‹å‹•ä½œã€‚æ­¤å¤–ï¼Œç€è¦½å™¨åœ¨è¡¨å–®æäº¤æ™‚ç„¡éœ€é‡æ–°æ•´ç†ã€‚åœ¨å–®æ¬¡ç¶²è·¯å¾€è¿”ä¸­ï¼ŒNext.js èƒ½åŒæ™‚å›å‚³æ›´æ–°å¾Œçš„ UI èˆ‡é‡æ–°æ•´ç†çš„è³‡æ–™ã€‚

æŸ¥çœ‹ä»¥ä¸‹ç¯„ä¾‹ä»¥äº†è§£ [å¾ä¼ºæœå™¨å‹•ä½œé‡æ–°é©—è­‰è³‡æ–™](#revalidating-data)ã€‚

</AppOnly>

## ç¯„ä¾‹

### åƒ…ä¼ºæœå™¨è¡¨å–®

<PagesOnly>

ä½¿ç”¨é é¢è·¯ç”±æ™‚ï¼Œæ‚¨éœ€è¦æ‰‹å‹•å»ºç«‹ API ç«¯é»ä¾†å®‰å…¨åœ°åœ¨ä¼ºæœå™¨ä¸Šç•°å‹•è³‡æ–™ã€‚

```ts filename="pages/api/submit.ts" switcher
import type { NextApiRequest, NextApiResponse } from 'next'

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  const data = req.body
  const id = await createItem(data)
  res.status(200).json({ id })
}
```

```js filename="pages/api/submit.js" switcher
export default function handler(req, res) {
  const data = req.body
  const id = await createItem(data)
  res.status(200).json({ id })
}
```

æ¥è‘—ï¼Œå¾å®¢æˆ¶ç«¯ä½¿ç”¨äº‹ä»¶è™•ç†å™¨å‘¼å« API è·¯ç”±ï¼š

```tsx filename="pages/index.tsx" switcher
import { FormEvent } from 'react'

export default function Page() {
  async function onSubmit(event: FormEvent<HTMLFormElement>) {
    event.preventDefault()

    const formData = new FormData(event.currentTarget)
    const response = await fetch('/api/submit', {
      method: 'POST',
      body: formData,
    })

    // å¦‚æœ‰éœ€è¦å¯è™•ç†å›æ‡‰
    const data = await response.json()
    // ...
  }

  return (
    <form onSubmit={onSubmit}>
      <input type="text" name="name" />
      <button type="submit">æäº¤</button>
    </form>
  )
}
```

```jsx filename="pages/index.jsx" switcher
export default function Page() {
  async function onSubmit(event) {
    event.preventDefault()

    const formData = new FormData(event.target)
    const response = await fetch('/api/submit', {
      method: 'POST',
      body: formData,
    })

    // å¦‚æœ‰éœ€è¦å¯è™•ç†å›æ‡‰
    const data = await response.json()
    // ...
  }

  return (
    <form onSubmit={onSubmit}>
      <input type="text" name="name" />
      <button type="submit">æäº¤</button>
    </form>
  )
}
```

</PagesOnly>

<AppOnly>

è¦å»ºç«‹åƒ…ä¼ºæœå™¨è¡¨å–®ï¼Œè«‹åœ¨ä¼ºæœå™¨å…ƒä»¶ä¸­å®šç¾©ä¼ºæœå™¨å‹•ä½œã€‚å‹•ä½œå¯é€éåœ¨å‡½å¼é ‚éƒ¨ä½¿ç”¨ `"use server"` æŒ‡ä»¤å…§è¯å®šç¾©ï¼Œæˆ–åœ¨æª”æ¡ˆé ‚éƒ¨ä½¿ç”¨æŒ‡ä»¤çš„ç¨ç«‹æª”æ¡ˆä¸­å®šç¾©ã€‚

```tsx filename="app/page.tsx" switcher
export default function Page() {
  async function create(formData: FormData) {
    'use server'

    // ç•°å‹•è³‡æ–™
    // é‡æ–°é©—è­‰å¿«å–
  }

  return <form action={create}>...</form>
}
```

```jsx filename="app/page.jsx" switcher
export default function Page() {
  async function create(formData) {
    'use server'

    // ç•°å‹•è³‡æ–™
    // é‡æ–°é©—è­‰å¿«å–
  }

  return <form action={create}>...</form>
}
```

> **é ˆçŸ¥äº‹é …**ï¼š`<form action={create}>` æ¥å— [FormData](https://developer.mozilla.org/docs/Web/API/FormData/FormData) è³‡æ–™é¡å‹ã€‚åœ¨ä¸Šä¾‹ä¸­ï¼Œé€é HTML [`form`](https://developer.mozilla.org/docs/Web/HTML/Element/form) æäº¤çš„ FormData å¯åœ¨ä¼ºæœå™¨å‹•ä½œ `create` ä¸­å­˜å–ã€‚

### é‡æ–°é©—è­‰è³‡æ–™

ä¼ºæœå™¨å‹•ä½œè®“æ‚¨èƒ½æŒ‰éœ€ä½¿ [Next.js å¿«å–](/docs/app/building-your-application/caching) å¤±æ•ˆã€‚æ‚¨å¯ä»¥ä½¿ç”¨ [`revalidatePath`](/docs/app/api-reference/functions/revalidatePath) ä½¿æ•´å€‹è·¯ç”±å€æ®µå¤±æ•ˆï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { revalidatePath } from 'next/cache'

export default async function submit() {
  await submitForm()
  revalidatePath('/')
}
```

```js filename="app/actions.js" switcher
'use server'

import { revalidatePath } from 'next/cache'

export default async function submit() {
  await submitForm()
  revalidatePath('/')
}
```

æˆ–ä½¿ç”¨ [`revalidateTag`](/docs/app/api-reference/functions/revalidateTag) é€éå¿«å–æ¨™ç±¤ä½¿ç‰¹å®šè³‡æ–™ç²å–å¤±æ•ˆï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { revalidateTag } from 'next/cache'

export default async function submit() {
  await addPost()
  revalidateTag('posts')
}
```

```js filename="app/actions.js" switcher
'use server'

import { revalidateTag } from 'next/cache'

export default async function submit() {
  await addPost()
  revalidateTag('posts')
}
```

</AppOnly>

### é‡æ–°å°å‘

<PagesOnly>

è‹¥æ‚¨æƒ³åœ¨ç•°å‹•å¾Œå°‡ä½¿ç”¨è€…é‡æ–°å°å‘è‡³ä¸åŒè·¯ç”±ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ [`redirect`](/docs/pages/building-your-application/routing/api-routes#response-helpers) è‡³ä»»ä½•çµ•å°æˆ–ç›¸å° URLï¼š

```ts filename="pages/api/submit.ts" switcher
import type { NextApiRequest, NextApiResponse } from 'next'

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  const id = await addPost()
  res.redirect(307, `/post/${id}`)
}
```

```js filename="pages/api/submit.js" switcher
export default async function handler(req, res) {
  const id = await addPost()
  res.redirect(307, `/post/${id}`)
}
```

</PagesOnly>

<AppOnly>

è‹¥æ‚¨æƒ³åœ¨ä¼ºæœå™¨å‹•ä½œå®Œæˆå¾Œå°‡ä½¿ç”¨è€…é‡æ–°å°å‘è‡³ä¸åŒè·¯ç”±ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ [`redirect`](/docs/app/api-reference/functions/redirect) èˆ‡ä»»ä½•çµ•å°æˆ–ç›¸å° URLï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { redirect } from 'next/navigation'
import { revalidateTag } from 'next/cache'

export default async function submit() {
  const id = await addPost()
  revalidateTag('posts') // æ›´æ–°å¿«å–æ–‡ç« 
  redirect(`/post/${id}`) // å°èˆªè‡³æ–°è·¯ç”±
}
```

```js filename="app/actions.js" switcher
'use server'

import { redirect } from 'next/navigation'
import { revalidateTag } from 'next/cache'

export default async function submit() {
  const id = await addPost()
  revalidateTag('posts') // æ›´æ–°å¿«å–æ–‡ç« 
  redirect(`/post/${id}`) // å°èˆªè‡³æ–°è·¯ç”±
}
```

</AppOnly>

### è¡¨å–®é©—è­‰

æˆ‘å€‘å»ºè­°ä½¿ç”¨ HTML é©—è­‰å¦‚ `required` å’Œ `type="email"` ä¾†é€²è¡ŒåŸºæœ¬è¡¨å–®é©—è­‰ã€‚

å°æ–¼æ›´é€²éšçš„ä¼ºæœå™¨ç«¯é©—è­‰ï¼Œå¯ä½¿ç”¨æ¶æ§‹é©—è­‰å‡½å¼åº«å¦‚ [zod](https://zod.dev/) ä¾†é©—è­‰è§£æå¾Œè¡¨å–®è³‡æ–™çš„çµæ§‹ï¼š

<PagesOnly>

```ts filename="pages/api/submit.ts" switcher
import type { NextApiRequest, NextApiResponse } from 'next'
import { z } from 'zod'

const schema = z.object({
  // ...
})

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  const parsed = schema.parse(req.body)
  // ...
}
```

```js filename="pages/api/submit.js" switcher
import { z } from 'zod'

const schema = z.object({
  // ...
})

export default async function handler(req, res) {
  const parsed = schema.parse(req.body)
  // ...
}
```

</PagesOnly>

<AppOnly>

```tsx filename="app/actions.ts" switcher
import { z } from 'zod'

const schema = z.object({
  // ...
})

export default async function submit(formData: FormData) {
  const parsed = schema.parse({
    id: formData.get('id'),
  })
  // ...
}
```

```jsx filename="app/actions.js" switcher
import { z } from 'zod'

const schema = z.object({
  // ...
})

export default async function submit(formData) {
  const parsed = schema.parse({
    id: formData.get('id'),
  })
  // ...
}
```

</AppOnly>

### é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹

<AppOnly>

ä½¿ç”¨ `useFormStatus` é‰¤å­ä¾†é¡¯ç¤ºè¡¨å–®åœ¨ä¼ºæœå™¨æäº¤æ™‚çš„è¼‰å…¥ç‹€æ…‹ã€‚`useFormStatus` é‰¤å­åƒ…èƒ½ä½œç‚ºä½¿ç”¨ä¼ºæœå™¨å‹•ä½œçš„ `form` å…ƒç´ çš„å­å…ƒç´ ä½¿ç”¨ã€‚

ä¾‹å¦‚ï¼Œä»¥ä¸‹æäº¤æŒ‰éˆ•ï¼š

```tsx filename="app/submit-button.tsx" switcher
'use client'

import { experimental_useFormStatus as useFormStatus } from 'react-dom'

export function SubmitButton() {
  const { pending } = useFormStatus()

  return (
    <button type="submit" aria-disabled={pending}>
      æ–°å¢
    </button>
  )
}
```

```jsx filename="app/submit-button.jsx" switcher
'use client'

import { experimental_useFormStatus as useFormStatus } from 'react-dom'

export function SubmitButton() {
  const { pending } = useFormStatus()

  return (
    <button type="submit" aria-disabled={pending}>
      æ–°å¢
    </button>
  )
}
```

`<SubmitButton />` æ¥è‘—å¯ç”¨æ–¼å¸¶æœ‰ä¼ºæœå™¨å‹•ä½œçš„è¡¨å–®ä¸­ï¼š

```tsx filename="app/page.tsx" switcher
import { SubmitButton } from '@/app/submit-button'

export default async function Home() {
  return (
    <form action={...}>
      <input type="text" name="field-name" />
      <SubmitButton />
    </form>
  )
}
```

```jsx filename="app/page.jsx" switcher
import { SubmitButton } from '@/app/submit-button'

export default async function Home() {
  return (
    <form action={...}>
      <input type="text" name="field-name" />
      <SubmitButton />
    </form>
  )
}
```

</AppOnly>

<PagesOnly>

æ‚¨å¯ä»¥ä½¿ç”¨ React ç‹€æ…‹ä¾†é¡¯ç¤ºè¡¨å–®åœ¨ä¼ºæœå™¨æäº¤æ™‚çš„è¼‰å…¥ç‹€æ…‹ï¼š

```tsx filename="pages/index.tsx" switcher
import React, { useState, FormEvent } from 'react'

export default function Page() {
  const [isLoading, setIsLoading] = useState<boolean>(false)

  async function onSubmit(event: FormEvent<HTMLFormElement>) {
    event.preventDefault()
    setIsLoading(true) // è«‹æ±‚é–‹å§‹æ™‚è¨­å®šè¼‰å…¥ç‚º true

    try {
      const formData = new FormData(event.currentTarget)
      const response = await fetch('/api/submit', {
        method: 'POST',
        body: formData,
      })

      // å¦‚æœ‰éœ€è¦å¯è™•ç†å›æ‡‰
      const data = await response.json()
      // ...
    } catch (error) {
      // å¦‚æœ‰éœ€è¦å¯è™•ç†éŒ¯èª¤
      console.error(error)
    } finally {
      setIsLoading(false) // è«‹æ±‚å®Œæˆæ™‚è¨­å®šè¼‰å…¥ç‚º false
    }
  }

  return (
    <form onSubmit={onSubmit}>
      <input type="text" name="name" />
      <button type="submit" disabled={isLoading}>
        {isLoading ? 'è¼‰å…¥ä¸­...' : 'æäº¤'}
      </button>
    </form>
  )
}
```

```jsx filename="pages/index.jsx" switcher
import React, { useState } from 'react'

export default function Page() {
  const [isLoading, setIsLoading] = useState(false)

  async function onSubmit(event) {
    event.preventDefault()
    setIsLoading(true) // è«‹æ±‚é–‹å§‹æ™‚è¨­å®šè¼‰å…¥ç‚º true

    try {
      const formData = new FormData(event.currentTarget)
      const response = await fetch('/api/submit', {
        method: 'POST',
        body: formData,
      })

      // å¦‚æœ‰éœ€è¦å¯è™•ç†å›æ‡‰
      const data = await response.json()
      // ...
    } catch (error) {
      // å¦‚æœ‰éœ€è¦å¯è™•ç†éŒ¯èª¤
      console.error(error)
    } finally {
      setIsLoading(false) // è«‹æ±‚å®Œæˆæ™‚è¨­å®šè¼‰å…¥ç‚º false
    }
  }

  return (
    <form onSubmit={onSubmit}>
      <input type="text" name="name" />
      <button type="submit" disabled={isLoading}>
        {isLoading ? 'è¼‰å…¥ä¸­...' : 'æäº¤'}
      </button>
    </form>
  )
}
```

</PagesOnly>

### éŒ¯èª¤è™•ç†

<AppOnly>

ä¼ºæœå™¨å‹•ä½œ (Server Actions) ä¹Ÿå¯ä»¥å›å‚³[å¯åºåˆ—åŒ–ç‰©ä»¶](https://developer.mozilla.org/docs/Glossary/Serialization)ã€‚ä¾‹å¦‚ï¼Œæ‚¨çš„ä¼ºæœå™¨å‹•ä½œå¯ä»¥è™•ç†å»ºç«‹æ–°é …ç›®æ™‚çš„éŒ¯èª¤ï¼š

```ts filename="app/actions.ts" switcher
'use server'

export async function createTodo(prevState: any, formData: FormData) {
  try {
    await createItem(formData.get('todo'))
    return revalidatePath('/')
  } catch (e) {
    return { message: 'Failed to create' }
  }
}
```

```js filename="app/actions.js" switcher
'use server'

export async function createTodo(prevState, formData) {
  try {
    await createItem(formData.get('todo'))
    return revalidatePath('/')
  } catch (e) {
    return { message: 'Failed to create' }
  }
}
```

ç„¶å¾Œï¼Œåœ¨å®¢æˆ¶ç«¯å…ƒä»¶ (Client Component) ä¸­ï¼Œæ‚¨å¯ä»¥è®€å–é€™å€‹å€¼ä¸¦é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ã€‚

```tsx filename="app/add-form.tsx" switcher
'use client'

import { experimental_useFormState as useFormState } from 'react-dom'
import { experimental_useFormStatus as useFormStatus } from 'react-dom'
import { createTodo } from '@/app/actions'

const initialState = {
  message: null,
}

function SubmitButton() {
  const { pending } = useFormStatus()

  return (
    <button type="submit" aria-disabled={pending}>
      Add
    </button>
  )
}

export function AddForm() {
  const [state, formAction] = useFormState(createTodo, initialState)

  return (
    <form action={formAction}>
      <label htmlFor="todo">Enter Task</label>
      <input type="text" id="todo" name="todo" required />
      <SubmitButton />
      <p aria-live="polite" className="sr-only">
        {state?.message}
      </p>
    </form>
  )
}
```

```jsx filename="app/add-form.jsx" switcher
'use client'

import { experimental_useFormState as useFormState } from 'react-dom'
import { experimental_useFormStatus as useFormStatus } from 'react-dom'
import { createTodo } from '@/app/actions'

const initialState = {
  message: null,
}

function SubmitButton() {
  const { pending } = useFormStatus()

  return (
    <button type="submit" aria-disabled={pending}>
      Add
    </button>
  )
}

export function AddForm() {
  const [state, formAction] = useFormState(createTodo, initialState)

  return (
    <form action={formAction}>
      <label htmlFor="todo">Enter Task</label>
      <input type="text" id="todo" name="todo" required />
      <SubmitButton />
      <p aria-live="polite" className="sr-only">
        {state?.message}
      </p>
    </form>
  )
}
```

</AppOnly>

<PagesOnly>

æ‚¨å¯ä»¥ä½¿ç”¨ React ç‹€æ…‹ä¾†é¡¯ç¤ºè¡¨å–®æäº¤å¤±æ•—æ™‚çš„éŒ¯èª¤è¨Šæ¯ï¼š

```tsx filename="pages/index.tsx" switcher
import React, { useState, FormEvent } from 'react'

export default function Page() {
  const [isLoading, setIsLoading] = useState<boolean>(false)
  const [error, setError] = useState<string | null>(null)

  async function onSubmit(event: FormEvent<HTMLFormElement>) {
    event.preventDefault()
    setIsLoading(true)
    setError(null) // ç•¶æ–°è«‹æ±‚é–‹å§‹æ™‚æ¸…é™¤å…ˆå‰çš„éŒ¯èª¤

    try {
      const formData = new FormData(event.currentTarget)
      const response = await fetch('/api/submit', {
        method: 'POST',
        body: formData,
      })

      if (!response.ok) {
        throw new Error('Failed to submit the data. Please try again.')
      }

      // å¦‚æœ‰éœ€è¦ï¼Œè™•ç†å›æ‡‰
      const data = await response.json()
      // ...
    } catch (error) {
      // æ•æ‰éŒ¯èª¤è¨Šæ¯ä»¥é¡¯ç¤ºçµ¦ä½¿ç”¨è€…
      setError(error.message)
      console.error(error)
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <div>
      {error && <div style={{ color: 'red' }}>{error}</div>}
      <form onSubmit={onSubmit}>
        <input type="text" name="name" />
        <button type="submit" disabled={isLoading}>
          {isLoading ? 'Loading...' : 'Submit'}
        </button>
      </form>
    </div>
  )
}
```

```jsx filename="pages/index.jsx" switcher
import React, { useState } from 'react'

export default function Page() {
  const [isLoading, setIsLoading] = useState(false)
  const [error, setError] = useState(null)

  async function onSubmit(event) {
    event.preventDefault()
    setIsLoading(true)
    setError(null) // ç•¶æ–°è«‹æ±‚é–‹å§‹æ™‚æ¸…é™¤å…ˆå‰çš„éŒ¯èª¤

    try {
      const formData = new FormData(event.currentTarget)
      const response = await fetch('/api/submit', {
        method: 'POST',
        body: formData,
      })

      if (!response.ok) {
        throw new Error('Failed to submit the data. Please try again.')
      }

      // å¦‚æœ‰éœ€è¦ï¼Œè™•ç†å›æ‡‰
      const data = await response.json()
      // ...
    } catch (error) {
      // æ•æ‰éŒ¯èª¤è¨Šæ¯ä»¥é¡¯ç¤ºçµ¦ä½¿ç”¨è€…
      setError(error.message)
      console.error(error)
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <div>
      {error && <div style={{ color: 'red' }}>{error}</div>}
      <form onSubmit={onSubmit}>
        <input type="text" name="name" />
        <button type="submit" disabled={isLoading}>
          {isLoading ? 'Loading...' : 'Submit'}
        </button>
      </form>
    </div>
  )
}
```

</PagesOnly>

<AppOnly>

### æ¨‚è§€æ›´æ–° (Optimistic Updates)

ä½¿ç”¨ `useOptimistic` åœ¨ä¼ºæœå™¨å‹•ä½œå®Œæˆå‰æ¨‚è§€åœ°æ›´æ–° UIï¼Œè€Œä¸éœ€ç­‰å¾…å›æ‡‰ï¼š

```tsx filename="app/page.tsx" switcher
'use client'

import { experimental_useOptimistic as useOptimistic } from 'react'
import { send } from './actions'

type Message = {
  message: string
}

export function Thread({ messages }: { messages: Message[] }) {
  const [optimisticMessages, addOptimisticMessage] = useOptimistic<Message[]>(
    messages,
    (state: Message[], newMessage: string) => [
      ...state,
      { message: newMessage },
    ]
  )

  return (
    <div>
      {optimisticMessages.map((m, k) => (
        <div key={k}>{m.message}</div>
      ))}
      <form
        action={async (formData: FormData) => {
          const message = formData.get('message')
          addOptimisticMessage(message)
          await send(message)
        }}
      >
        <input type="text" name="message" />
        <button type="submit">Send</button>
      </form>
    </div>
  )
}
```

```jsx filename="app/page.jsx" switcher
'use client'

import { experimental_useOptimistic as useOptimistic } from 'react'
import { send } from './actions'

export function Thread({ messages }) {
  const [optimisticMessages, addOptimisticMessage] = useOptimistic(
    messages,
    (state, newMessage) => [...state, { message: newMessage }]
  )

  return (
    <div>
      {optimisticMessages.map((m) => (
        <div>{m.message}</div>
      ))}
      <form
        action={async (formData) => {
          const message = formData.get('message')
          addOptimisticMessage(message)
          await send(message)
        }}
      >
        <input type="text" name="message" />
        <button type="submit">Send</button>
      </form>
    </div>
  )
}
```

</AppOnly>

### è¨­å®š Cookie

<PagesOnly>

æ‚¨å¯ä»¥åœ¨ API è·¯ç”±ä¸­ä½¿ç”¨ `setHeader` æ–¹æ³•è¨­å®š cookieï¼š

```ts filename="pages/api/cookie.ts" switcher
import type { NextApiRequest, NextApiResponse } from 'next'

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  res.setHeader('Set-Cookie', 'username=lee; Path=/; HttpOnly')
  res.status(200).send('Cookie has been set.')
}
```

```js filename="pages/api/cookie.js" switcher
export default async function handler(req, res) {
  res.setHeader('Set-Cookie', 'username=lee; Path=/; HttpOnly')
  res.status(200).send('Cookie has been set.')
}
```

</PagesOnly>

<AppOnly>

æ‚¨å¯ä»¥åœ¨ä¼ºæœå™¨å‹•ä½œä¸­ä½¿ç”¨ [`cookies`](/docs/app/api-reference/functions/cookies) å‡½å¼è¨­å®š cookieï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { cookies } from 'next/headers'

export async function create() {
  const cart = await createCart()
  cookies().set('cartId', cart.id)
}
```

```js filename="app/actions.js" switcher
'use server'

import { cookies } from 'next/headers'

export async function create() {
  const cart = await createCart()
  cookies().set('cartId', cart.id)
}
```

</AppOnly>

### è®€å– Cookie

<PagesOnly>

æ‚¨å¯ä»¥åœ¨ API è·¯ç”±ä¸­ä½¿ç”¨ [`cookies`](/docs/pages/building-your-application/routing/api-routes#request-helpers) è«‹æ±‚è¼”åŠ©å·¥å…·è®€å– cookieï¼š

```ts filename="pages/api/cookie.ts" switcher
import type { NextApiRequest, NextApiResponse } from 'next'

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  const auth = req.cookies.authorization
  // ...
}
```

```js filename="pages/api/cookie.js" switcher
export default async function handler(req, res) {
  const auth = req.cookies.authorization
  // ...
}
```

</PagesOnly>

<AppOnly>

æ‚¨å¯ä»¥åœ¨ä¼ºæœå™¨å‹•ä½œä¸­ä½¿ç”¨ [`cookies`](/docs/app/api-reference/functions/cookies) å‡½å¼è®€å– cookieï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { cookies } from 'next/headers'

export async function read() {
  const auth = cookies().get('authorization')?.value
  // ...
}
```

```js filename="app/actions.js" switcher
'use server'

import { cookies } from 'next/headers'

export async function read() {
  const auth = cookies().get('authorization')?.value
  // ...
}
```

</AppOnly>

### åˆªé™¤ Cookie

<PagesOnly>

æ‚¨å¯ä»¥åœ¨ API è·¯ç”±ä¸­ä½¿ç”¨ `setHeader` æ–¹æ³•åˆªé™¤ cookieï¼š

```ts filename="pages/api/cookie.ts" switcher
import type { NextApiRequest, NextApiResponse } from 'next'

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  res.setHeader('Set-Cookie', 'username=; Path=/; HttpOnly; Max-Age=0')
  res.status(200).send('Cookie has been deleted.')
}
```

```js filename="pages/api/cookie.js" switcher
export default async function handler(req, res) {
  res.setHeader('Set-Cookie', 'username=; Path=/; HttpOnly; Max-Age=0')
  res.status(200).send('Cookie has been deleted.')
}
```

</PagesOnly>

<AppOnly>

æ‚¨å¯ä»¥åœ¨ä¼ºæœå™¨å‹•ä½œä¸­ä½¿ç”¨ [`cookies`](/docs/app/api-reference/functions/cookies) å‡½å¼åˆªé™¤ cookieï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { cookies } from 'next/headers'

export async function delete() {
  cookies().delete('name')
  // ...
}
```

```js filename="app/actions.js" switcher
'use server'

import { cookies } from 'next/headers'

export async function delete() {
  cookies().delete('name')
  // ...
}
```

æŸ¥çœ‹[å…¶ä»–ç¯„ä¾‹](/docs/app/api-reference/functions/cookies#deleting-cookies)äº†è§£å¦‚ä½•å¾ä¼ºæœå™¨å‹•ä½œåˆªé™¤ cookieã€‚

</AppOnly>
