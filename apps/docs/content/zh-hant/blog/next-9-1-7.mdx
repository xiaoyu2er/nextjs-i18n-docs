---
source-updated-at: 2025-05-29T18:05:49.000Z
translation-updated-at: 2025-05-29T19:53:14.672Z
title: Next.js 9.1.7 版本更新
description: >-
  Next.js 9.1.7 在堅實的基礎上進一步提升，完善了企業級的 9.1 發佈頻道。升級後可獲得更小的客戶端 JavaScript 套件、重新設計的 CLI 輸出、更快的 FCP/TTI 指標等改進！
author:
  - name: JJ Kasper
    image: /static/team/jj.jpg
  - name: Joe Haddad
    image: /static/team/timer.jpg
  - name: Luis Alvarez
    image: /static/team/lfades.jpg
  - name: Tim Neutkens
    image: /static/team/tim.jpg
date: 2020-01-06T15:45:00.000Z
image: >-
  https://h8DxKfmAPhn8O0p3.public.blob.vercel-storage.com/static/blog/next-9-1-7/twitter-card.png
---

[Next.js 9](/blog/next-9) 於六個月前發佈，隨後三個月前推出了 [Next.js 9.1](/blog/next-9-1)。

這兩次發佈為 Next.js 添加了非常強大的新功能，同時沒有增加基礎的客戶端運行時大小。

此後，我們重點對框架進行了全面優化和改進：[9.1.1](https://github.com/vercel/next.js/releases/tag/v9.1.1)、[9.1.2](https://github.com/vercel/next.js/releases/tag/v9.1.2)、[9.1.3](https://github.com/vercel/next.js/releases/tag/v9.1.3)、[9.1.4](https://github.com/vercel/next.js/releases/tag/v9.1.4)、[9.1.5](https://github.com/vercel/next.js/releases/tag/v9.1.5)、[9.1.6](https://github.com/vercel/next.js/releases/tag/v9.1.6) 和 [9.1.7](https://github.com/vercel/next.js/releases/tag/v9.1.7)。

讓我們深入了解這些版本帶來的改進！

*   **[客戶端 JavaScript 套件縮小 3% - 8%+](#3--8-smaller-client-side-javascript-size)**：我們進一步優化了應用輸出，為簡單示範應用減少了 7.5kB。更複雜的應用可節省高達 8% 或更多。
*   **[重新設計的生產環境構建 CLI 輸出](#redesigned-production-build-cli-output)**：生產構建輸出現在以更易理解的格式顯示 gzip 壓縮後的文件大小。
*   **[新增內建 Polyfill：fetch()、URL 和 Object.assign](#new-built-in-polyfills-fetch-url-and-objectassign)**：應用程式可在舊版瀏覽器中無需擔心兼容性問題地使用 `fetch()` API、`URL` 和 `Object.assign`。
*   **[優化頁面加載：更好的 FCP 和 TTI](#optimized-page-loading-better-fcp-and-tti)**：我們與 Google Chrome 團隊密切合作，最大化頁面加載性能，帶來更佳的使用者體驗。
*   **[支援最新 JavaScript 功能](#support-for-the-latest-javascript-features)**：我們致力於確保您能使用包括 [Optional Chaining](https://github.com/tc39/proposal-optional-chaining)、[Nullish Coalescing](https://github.com/tc39/proposal-nullish-coalescing) 等穩定 ES2020 功能在內的最新 JavaScript 特性。
*   **[零配置部署支援 `next export` 應用](#zero-config-deployment-support-for-next-export-applications)**：使用 `next export` 的應用現在可以零配置部署到 [Vercel](https://vercel.com)。
*   **[React 嚴格模式兼容與啟用選項](#react-strict-mode-compliance-and-opt-in)**：Next.js 的所有客戶端運行時現已兼容 React 的嚴格模式，並新增配置選項以全局啟用此模式。
*   **[針對 React 夜間構建的自動化測試](#automated-testing-against-nightly-react-builds)**：Next.js 現會自動測試與 [React 的 next 頻道](https://reactjs.org/blog/2019/10/22/react-release-channels.html) 的兼容性，確保與未來版本的兼容。

所有這些改進均為非破壞性且完全向後兼容。您只需執行以下命令即可更新：

```bash filename="Terminal"
npm i next@latest react@latest react-dom@latest
```

### [客戶端 JavaScript 套件縮小 3% - 8%+](#3---8-smaller-client-side-javascript-size)

與 Google Chrome 團隊合作，所有 Next.js 應用都將受益於 **7.5kB 或更多** 的大小減少。

基礎應用應可看到 3-4% 的體積縮減，更複雜的應用可能達到 6-8%（或更多）！

9.0.x

9.1.x

差異

基礎應用

68.9kB

66.1kB

**4.1%** _更小_

這些節省部分歸功於 [替換 `url` 套件的客戶端版本](https://github.com/GoogleChromeLabs/native-url) 為基於 [URL API](https://developer.mozilla.org/docs/Web/API/URL) 構建的版本。

更多體積優化通過為常用套件提供內建的小型 polyfill 實現。您可 [在此閱讀更多關於這些 polyfill 的資訊](#new-built-in-polyfills-fetch-url-and-objectassign)。

最後，我們優化了 JSX 輸出，這將根據您應用中 JSX 的數量直接帶來節省。

### [重新設計的生產環境構建 CLI 輸出](#redesigned-production-build-cli-output)

為了清晰起見，我們重新設計了 CLI 的生產構建輸出。由於 Next.js 是混合式應用框架，每個頁面可能具有不同的特性。

新輸出將每個頁面分類為以下之一：

*   **伺服器端渲染 (Server)**：頁面在運行時進行伺服器端渲染，意味著它使用 `getInitialProps` 或 [`getServerProps` (提案)](https://github.com/vercel/next.js/issues/9524)
*   **自動靜態優化 (Static)**：頁面在構建時渲染為靜態 HTML，並將作為靜態文件提供（不使用初始 props）
*   **使用計算數據靜態生成 (SSG)**：頁面在構建時生成為靜態 HTML/JSON，並將作為靜態文件提供（使用 [`getStaticProps` (提案)](https://github.com/vercel/next.js/issues/9524)）

此外，新輸出顯示每個頁面的 Gzip 壓縮大小 — 這些大小不包括所有頁面共享的文件（單獨顯示）。

每個頁面的大小將根據其預期的使用者體驗進行顏色標記：

*   **小於 130kB**：_綠色_ — 在大多數網路和設備條件下，您的應用應該表現良好。
*   **介於 130kB 和 170kB 之間**：_黃色_ — 在 [全球基準設備 + 網路條件](https://infrequently.org/2017/10/can-you-afford-it-real-world-web-performance-budgets/) 下，您的應用接近 5-6 秒的加載時間。
*   **超過 170kB**：_紅色_ — 在 [相同條件](https://infrequently.org/2017/10/can-you-afford-it-real-world-web-performance-budgets/) 下，您的應用可能需要超過 6 秒才能加載。

![新的 Next.js 生產 CLI 輸出](https://h8DxKfmAPhn8O0p3.public.blob.vercel-storage.com/static/blog/next-9-1-7/next-new-output.png)

新的 Next.js 生產 CLI 輸出

我們期待聽到您對新構建輸出的反饋。

不久的將來，Next.js 還將引入大小預算功能，幫助您確保頁面保持在特定大小範圍內。

### [新增內建 Polyfill：fetch()、URL 和 Object.assign](#new-built-in-polyfills-fetch-url-and-objectassign)

在檢查許多用戶的應用和我們的示例時，我們發現大多數都附帶了一組相似的 polyfill。在某些情況下，應用甚至對同一功能有多個重複的 polyfill。

為解決此問題，我們與 Google Chrome 團隊合作，為我們觀察到的三個最常見 API 內建了 polyfill。

通過差異化加載，這些 polyfill **不會為全球 83% 的網路流量加載**。這意味著大多數使用者不會下載這些 polyfill 相關的字節 — 它們僅在必要時才會被下載。

此外，任何我們現在已內建的知名 polyfill 將完全從您的生產構建中消除。這意味著您不會因為某個依賴無意中導入這些 API 的 polyfill 而付出代價。

內建 API 及其取代的 polyfill 列表如下：

*   [**fetch()**](https://developer.mozilla.org/docs/Web/API/Fetch_API) — 取代：`whatwg-fetch` 和 `unfetch`。
*   [**URL**](https://developer.mozilla.org/docs/Web/API/URL) — 取代：[`url` 套件 (Node.js API)](https://nodejs.org/api/url.html)。
*   [**Object.assign()**](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object/assign) — 取代：`object-assign`、`object.assign` 和 `core-js/object/assign`。

如果您在伺服器上使用 `fetch()`，仍然需要導入 `isomorphic-fetch` 或 `isomorphic-unfetch`。

此更改完全是非破壞性的，所有 polyfill 均使用最符合規範的可用版本構建。結果是在現代瀏覽器上，您的生產套件可減少 **高達 18kB 的 JavaScript**。

### [優化頁面加載：更好的 FCP 和 TTI](#optimized-page-loading-better-fcp-and-tti)

Next.js 優化了其預加載實現，以減少 FCP 和整體 TTI。

通過解決瀏覽器錯誤，CSS（當使用時）現在正確優先於 JavaScript。這導致更快的首次內容繪製 (FCP)，為您的終端使用者帶來視覺上更快的網站完成體驗。

此外，我們優化了頁面預取以使用更低優先級的網路請求。

這些請求僅在瀏覽器空閒時間發生，從而實現更快的可交互時間 (TTI)。這是因為瀏覽器會優先使您的應用可交互，而不是樂觀的預取。

![FCP/TTI 優化前後對比](https://h8DxKfmAPhn8O0p3.public.blob.vercel-storage.com/static/blog/next-9-1-7/nextjs-org-scores.png)

FCP/TTI 優化前後對比

### [支援最新 JavaScript 功能](#support-for-the-latest-javascript-features)

Next.js 擁有先進、高度優化的編譯管道，允許您使用最新的 JavaScript 功能。我們最近引入的優化直接促成了 [3-8% 的應用大小減少](#3--8-smaller-client-side-javascript-size)。

這些 JavaScript 功能可以在不擔心瀏覽器兼容性的情況下使用，因為我們會自動將您的代碼編譯以支援所有瀏覽器（不包括已停止支援的版本）。這包括 ES6+ 功能，如 [async/await (ES2017)](https://github.com/tc39/ecmascript-asyncawait)、[Object Rest/Spread Properties (ES2018)](https://github.com/tc39/proposal-object-rest-spread)、[Dynamic `import()` (ES2020)](https://v8.dev/features/dynamic-import) 等！

在此版本中，我們很高興地宣布支援 [Optional Chaining (Stage 4)](https://github.com/tc39/proposal-optional-chaining) 和 [Nullish Coalescing (Stage 4)](https://github.com/tc39/proposal-nullish-coalescing)。

```js filename="pages/index.js"
function Page(props) {
  return (
    <p>{props?.deeply?.nested?.value}</p>
    /* ⬆ 如果 deeply.nested.value 不可用，它將不會渲染 */
  );
}
 
export default Page;
```

> 可選鏈運算符 (`?.`)

```js filename="pages/index.js"
function Page(props) {
  return (
    <p>{props.something ?? 'Default value'}</p>
    /* ⬆ 結果為 "Default value" */
  );
}
 
export default Page;
```

> 空值合併運算符 (`??`)

未來，我們計劃通過自動 [module / nomodule 構建](https://nextjs.org/blog/next-9-1#module--nomodule) 輸出更優化的套件。

### [零配置部署支援 `next export` 應用](#zero-config-deployment-support-for-next-export-applications)

Next.js 的 `next export` 命令現在與 Vercel 的 [零配置](https://vercel.com/blog/zero-config) 開箱即用。在此更改之前，使用 `next export` 的用戶需要創建自定義的 `now.json`。

在 [Vercel](https://vercel.com) 上利用 Next.js 的導出模式非常簡單，只需在 `package.json` 中有以下 `build` 腳本：

```json filename="package.json"
{
  "scripts": {
    "build": "next build && next export"
  }
}
```

然後，您只需 **單一命令** 即可將 Next.js 應用部署到 [Vercel](https://vercel.com)。如果您尚未安裝 [Vercel](https://vercel.com)，可以通過安裝 [Vercel CLI](https://vercel.com/cli) 來完成。

```bash filename="Terminal"
now
```

### [React 嚴格模式兼容與啟用選項](#react-strict-mode-compliance-and-opt-in)

完整的 Next.js 運行時現已兼容嚴格模式。這包括對 Next.js 的 head 管理器 (`<Head>`)、`next/dynamic` 和其他核心功能的更新。這意味著運行時現在使用 hooks 或已棄用生命週期，並使用 React 的新 Context API。

我們還添加了一個方便的啟用選項，讓您為應用啟用嚴格模式。

為此，在您的 `next.config.js` 中配置以下選項：

```js filename="next.config.js"
module.exports = {
  reactStrictMode: true,
};
```

如果您或您的團隊尚未準備好在整個應用中使用嚴格模式，那也沒關係！您可以逐步遷移，[使用 `<React.StrictMode>`](https://reactjs.org/docs/strict-mode.html) 逐頁進行。

雖然 **不是必需的**，但嚴格模式將在未來解鎖許多優化。因此，我們建議您盡早了解它！

### [針對 React 夜間構建的自動化測試](#automated-testing-against-nightly-react-builds)

在與 React 核心團隊的 [密切合作](https://github.com/vercel/next.js/pull/9165) 下，我們現在每 12 小時 [測試](https://github.com/vercel/next.js/pull/9151) Next.js 與 React 的 next 頻道的兼容性。

這些測試幫助確保我們準備好並兼容 React 的未來版本。兼容性是 Next.js 非常重視的事情，我們致力於 Next.js 的長期 API 穩定性。

React 核心團隊已 [記錄此過程](https://reactjs.org/blog/2019/10/22/react-release-channels.html)，希望 React 生態系統中的其他項目也能效仿。

[社區](#community)
-----------------------

我們對即將到來的變化感到興奮，這些變化將改善所有 Next.js 應用的體積和性能。

此外，Next.js 社區仍在擴展：

*   我們已有超過 **865** 位獨立貢獻者。
*   在 GitHub 上，該項目已獲得超過 **43,700** 次星標。
*   [示例目錄](https://github.com/vercel/next.js/tree/canary/examples) 包含超過 **220** 個示例。

Next.js 社區現在擁有超過 **13,600** 名成員。[加入我們！](https://github.com/vercel/next.js/discussions)

我們感謝我們的社區以及所有幫助塑造此版本的外部反饋和貢獻。