---
source-updated-at: 2025-05-29T19:07:21.000Z
translation-updated-at: 2025-05-29T19:59:42.210Z
title: 環境變數
description: 了解如何在 Next.js 應用程式中使用環境變數。
---

Next.js 內建支援環境變數，讓您能夠：

- 使用 `.env.local` 載入環境變數
- 透過 `NEXT_PUBLIC_` 前綴將環境變數公開至瀏覽器端
- 在伺服器與客戶端程式碼中安全地存取環境變數

## 載入環境變數

Next.js 支援從 `.env` 檔案載入環境變數：

```bash filename="Terminal"
# .env.local
DB_HOST=localhost
DB_USER=myuser
DB_PASS=mypassword
```

這些變數會自動載入到 `process.env` 中，可在您的 Next.js 應用程式中使用。

## 公開瀏覽器端環境變數

若要將環境變數公開至瀏覽器端，必須加上 `NEXT_PUBLIC_` 前綴：

```bash filename="Terminal"
# .env.local
NEXT_PUBLIC_ANALYTICS_ID=abcdefghijk
```

## 在程式碼中使用環境變數

您可以在任何地方存取這些環境變數：

```js filename="pages/index.js"
// 伺服器端與客戶端皆可存取
console.log(process.env.NEXT_PUBLIC_ANALYTICS_ID)

// 僅伺服器端可存取
console.log(process.env.DB_HOST)
```

## 預設環境變數

通常您只需要使用 `.env.local`，但我們也支援其他檔案：

- `.env` - 所有環境共用
- `.env.development` - 開發環境
- `.env.production` - 生產環境
- `.env.test` - 測試環境

## 注意事項

<AppOnly>

- 環境變數在構建時會被內聯 (inlined)，這表示 `process.env` 不是標準的 Node.js 環境變數物件
- 如果您需要動態讀取環境變數，請考慮使用我們的 [Runtime Configuration](https://nextjs.org/docs/api-reference/next.config.js/runtime-configuration)

</AppOnly>

<PagesOnly>

- 環境變數在構建時會被內聯 (inlined)，這表示 `process.env` 不是標準的 Node.js 環境變數物件
- 如果您需要動態讀取環境變數，請考慮使用 [`getServerSideProps`](https://nextjs.org/docs/basic-features/data-fetching/get-server-side-props) 或 [`getStaticProps`](https://nextjs.org/docs/basic-features/data-fetching/get-static-props)

</PagesOnly>---
title: Next.js 13.3
description: >-
  Next.js 13.3 引入了動態 Open Graph 圖片、進階靜態匯出、平行路由與攔截路由、OTEL 支援等新功能。
author:
  - name: Delba de Oliveira
    image: /static/team/delba.jpg
  - name: Tim Neutkens
    image: /static/team/tim.jpg
date: 2023-04-06T18:00:00.507Z
image: >-
  https://h8DxKfmAPhn8O0p3.public.blob.vercel-storage.com/static/blog/next-13-3/twitter-card.png
---

Next.js 13.3 新增了多項社群期待的功能，包括：

*   [**檔案式 Metadata API**](#file-based-metadata-api)：動態產生網站地圖 (sitemap)、robots.txt、favicon 等檔案。
*   [**動態 Open Graph 圖片**](#dynamic-open-graph-image-generation)：使用 JSX、HTML 和 CSS 生成 OG 圖片。
*   [**App Router 靜態匯出**](#static-export-for-app-router)：針對伺服器元件 (Server Components) 的靜態/單頁應用 (SPA) 支援。
*   [**平行路由與攔截路由**](#parallel-routes-and-interception)：App Router 的進階路由功能。

立即更新執行：

```bash filename="終端機"
npm i next@latest react@latest react-dom@latest eslint-config-next@latest
```

我們即將在下個次要版本中將 App Router 標記為穩定版，並將重點轉向優化效能、改進行為和修復錯誤。

雖然我們仍在開發如 Mutations 等少數功能，但預計這些不會影響其他 App Router 功能的 API 介面。我們期待看到您使用 App Router 建構的成果，並[歡迎提供意見回饋](https://github.com/vercel/next.js/discussions/41745)。

[檔案式 Metadata API](#file-based-metadata-api)
---------------------------------------------------

在 [Next.js 13.2](https://nextjs.org/blog/next-13-2#built-in-seo-support-with-new-metadata-api) 中，我們宣布了新的 Metadata API，允許您透過從佈局或頁面匯出 Metadata 物件來定義 metadata（例如 HTML `head` 元素中的 `title`、`meta` 和 `link` 標籤）。

```js filename="layout.js 或 page.js"
// 靜態 metadata
export const metadata = {
  title: '首頁',
};
// 輸出：
// <head>
//	 <title>首頁</title>
// </head>
 
// 或動態 metadata
export async function generateMetadata({ params, searchParams }) {
  const product = await getProduct(params.id);
  return { title: product.title };
}
// 輸出：
// <head>
//	 <title>我的獨特產品</title>
// </head>
 
export default function Page() {}
```

除了基於設定的 metadata 外，Metadata API 現在支援新的檔案慣例，讓您可以方便地自訂頁面以提升 SEO 和在網路上的分享效果：

*   `opengraph-image.(jpg|png|svg)`
*   `twitter-image.(jpg|png|svg)`
*   `favicon.ico`
*   `icon.(ico|jpg|png|svg)`
*   `sitemap.(xml|js|jsx|ts|tsx)`
*   `robots.(txt|js|jsx|ts|tsx)`
*   `manifest.(json|js|jsx|ts|tsx)`

例如，您可以使用檔案式 metadata 為應用程式新增 favicon，並為 `/about` 頁面新增 Open Graph 圖片：

```
app
├── favicon.ico
├── layout.js
├── page.js
└── about
    ├── opengraph-image.jpg
    └── page.js
```

Next.js 會自動在生產環境中提供這些檔案（檔案名稱會加上雜湊值以利快取），並更新相關的 `head` 元素，包含正確的 metadata 資訊，例如資源的 URL、檔案類型和圖片尺寸。

```
// 訪問 "/"
<link rel="icon" href="<計算後的URL>"/>
 
// 訪問 "/about"
<link rel="icon" href="<計算後的URL>"/>
<meta property="og:image" content="<計算後的URL>" type="<計算後的類型>" ... />
```

在應用程式中新增靜態檔案通常是最簡單的方法，但有時您可能需要動態建立檔案。每個靜態檔案慣例都有一個對應的動態 `(.js|.jsx|.ts|.tsx)` 變體，讓您可以撰寫程式碼來產生檔案。

例如，雖然您可以新增靜態 `sitemap.xml` 檔案，但大多數網站都有一些頁面是使用外部資料來源動態產生的。要產生動態網站地圖，您可以新增一個 `sitemap.js` 檔案，回傳您的動態路由陣列。

```js filename="app/sitemap.js"
export default async function sitemap() {
  const res = await fetch('https://.../posts');
  const allPosts = await res.json();
 
  const posts = allPosts.map((post) => ({
    url: `https://acme.com/blog/${post.slug}`,
    lastModified: post.publishedAt,
  }));
 
  const routes = ['', '/about', '/blog'].map((route) => ({
    url: `https://acme.com${route}`,
    lastModified: new Date().toISOString(),
  }));
 
  return [...routes, ...posts];
}
```

透過[基於設定](/docs/app/api-reference/file-conventions/metadata#metadata-object)和新的檔案式選項，您現在擁有全面的 Metadata API 來涵蓋靜態和動態 metadata。

Metadata API 在 13.3 版中適用於 App Router (`app`)，不適用於 `pages` 目錄。了解更多關於[檔案式 metadata 並查看 API 參考](/docs/app/api-reference/file-conventions/metadata#file-based-metadata)。

[動態 Open Graph 圖片生成](#dynamic-open-graph-image-generation)
---------------------------------------------------------------------------

六個月前，我們發布了 [@vercel/og](https://vercel.com/blog/introducing-vercel-og-image-generation-fast-dynamic-social-card-images) 和 [Satori](https://github.com/vercel/satori)，這些函式庫讓您可以使用 JSX、HTML 和 CSS 動態生成圖片。

`@vercel/og` 在 [Next.js Conf](https://nextjs.org/conf) 中經過了考驗，為每位與會者生成了超過 10 萬張動態票券圖片。自發布以來，Vercel 客戶廣泛採用，下載量超過 90 萬次，我們很高興能將動態生成圖片的功能帶給所有 Next.js 應用程式，而無需額外的套件。

您現在可以從 `next/server` 匯入 `ImageResponse` 來生成圖片：

```tsx filename="/app/about/opengraph-image.tsx"
import { ImageResponse } from 'next/server';
 
export const size = { width: 1200, height: 600 };
export const alt = '關於 Acme';
export const contentType = 'image/png';
export const runtime = 'edge';
 
export default function og() {
  return new ImageResponse();
  // ...
}
```

`ImageResponse` 與其他 Next.js API（包括路由處理器和檔案式 Metadata）自然整合良好。例如，您可以在 `opengraph-image.tsx` 檔案中使用 `ImageResponse`，在建置時或請求時動態生成 Open Graph 和 Twitter 圖片。

了解更多關於 [Image Response API](/docs/app/building-your-application/optimizing/metadata#dynamic-image-generation)。

[App Router 靜態匯出](#static-export-for-app-router)
-------------------------------------------------------------

Next.js App Router 現在支援完整的靜態匯出。

您可以從靜態網站或單頁應用 (SPA) 開始，之後再選擇升級使用需要伺服器的 Next.js 功能。

執行 `next build` 時，Next.js 會為每個路由生成一個 HTML 檔案。透過將嚴格的 SPA 拆分為獨立的 HTML 檔案，Next.js 可以避免在客戶端載入不必要的 JavaScript 程式碼，減少套件大小並實現更快的頁面載入。

```js filename="next.config.js"
/**
 * @type {import('next').NextConfig}
 */
const nextConfig = {
  output: 'export',
};
 
module.exports = nextConfig;
```

靜態匯出適用於 `app` router 的新功能，包括靜態路由處理器、Open Graph 圖片和 React 伺服器元件 (Server Components)。

例如，伺服器元件會在建置期間執行，類似於傳統的靜態網站生成，將元件渲染為初始頁面載入的靜態 HTML 和客戶端路由導航的靜態 payload。

以前，要在 `pages` 目錄中使用靜態匯出，您需要執行 `next export`。然而，透過 `next.config.js` 選項，當設定 `output: 'export'` 時，`next build` 會輸出一個 `out` 目錄。您可以對 `app` router 和 `pages` 目錄使用相同的設定。這意味著不再需要 `next export`。

透過進階靜態匯出支援，您會在開發過程 (`next dev`) 中更早收到錯誤，例如嘗試使用需要伺服器的動態函式（如 `cookies()` 或 `headers()`）。

了解更多關於 [靜態匯出](/docs/app/building-your-application/deploying/static-exports)。

[平行路由與攔截路由](#parallel-routes-and-interception)
---------------------------------------------------------------------

Next.js 13.3 引入了新的動態慣例，讓您可以實現進階路由案例：**平行路由與攔截路由**。這些功能讓您可以在同一個視圖中顯示多個頁面，例如複雜的儀表板或模態視窗 (modal)。

透過平行路由，您可以同時在 _同一個視圖_ 中渲染一個或多個可以獨立導航的頁面。它也可以用於條件式渲染頁面。

平行路由是使用名為 **「插槽」(slots)** 的 `@folder` 慣例建立的：

```
dashboard
├── @user
│   └── page.js
├── @team
│   └── page.js
├── layout.js
└── page.js
```

相同路由區段的佈局會將插槽作為屬性接收：

```js filename="app/dashboard/layout.js"
export default async function Layout({ children, user, team }) {
  const userType = getCurrentUserType();
 
  return (
    <>
      {userType === 'user' ? user : team}
      {children}
    </>
  );
}
```

在上面的範例中，`@user` 和 `@team` 平行路由插槽（顯式）會根據您的邏輯條件式渲染。`children` 是一個隱式路由插槽，_不需要_ 對應到 `@folder`。例如，`dashboard/page.js` 等同於 `dashboard/@children/page.js`。

攔截路由讓您可以在當前佈局中載入新路由，同時「遮罩」瀏覽器 URL。這在保持當前頁面上下文很重要時非常有用，例如透過模態視窗展開動態中的照片，而動態保持在模態的背景中。

攔截路由可以使用 `(..)` 慣例定義，類似於相對路徑 `../`。您也可以使用 `(...)` 慣例建立相對於 `app` 目錄的路徑。

```
feed
├── @modal
│   └── (..)photo
│       └── [id]
│           └── page.tsx
├── page.tsx
└── layout.tsx
photo
└── [id]
    └── page.tsx
```

在上面的範例中，從使用者個人檔案點擊照片將在客戶端導航期間在模態中開啟照片。然而，重新整理或分享頁面將載入具有預設佈局的照片。

![平行路由與攔截路由實現類似 Instagram 的模態路由。](https://h8DxKfmAPhn8O0p3.public.blob.vercel-storage.com/static/blog/next-13-3/modal-routing.png)

平行路由與攔截路由實現類似 Instagram 的模態路由。

這解決了您在建立模態時可能遇到的挑戰，例如透過 URL 分享模態內容、防止重新整理頁面時丟失上下文，以及透過向後和向前導航關閉和重新開啟模態。

更多範例和行為，請參閱 [平行路由](/docs/app/building-your-application/routing/parallel-routes) 和 [攔截路由文件](/docs/app/building-your-application/routing/intercepting-routes)。

[其他改進](#other-improvements)
-----------------------------------------

*   **設計更新：** Next.js [首頁](https://nextjs.org/) 和 [展示](https://nextjs.org/showcase) 已更新為新設計。
*   **Turbopack：** 新增對中介軟體 (Middleware)、所有 `next/font` 選項和伺服器元件串流的支援，接近測試版（[查看示範](https://twitter.com/padmaia/status/1641130761775464448)）。我們還在成熟的 Next.js 應用程式（如 [vercel.com](https://vercel.com) 和 [nextjs.org](https://nextjs.org/)）上修復了其他錯誤。[了解更多](/docs/architecture/turbopack)。
*   **`next.config.js` 的快速重新整理：** 變更 `next.config.js` 現在會自動重新啟動本地開發伺服器。這擴展了對 `.env`、`.env.*`、`jsconfig.json`、`tsconfig.json` 設定檔的自動重新載入。
*   **無障礙功能：** App Router 現在包含來自 `pages` 的路由宣告。此功能向螢幕閱讀器和其他輔助技術宣告客戶端路由轉換。[了解更多](/docs/accessibility)。
*   **靜態類型連結：** `next.config.js` 中設定的 `redirects` 和 `rewrites` 現在會在類型檢查中考慮。[了解更多](/docs/app/building-your-application/configuring/typescript#statically-typed-links)。
*   **`create-next-app` 的 Tailwind CSS：** 使用 `npx create-next-app@latest` 開始新專案時，您現在可以選擇 Tailwind CSS 或使用 `--tailwind` 標誌，預先配置您的應用程式與此樣式解決方案。
*   **路由處理器：** 使用 `export default` 而不是 [支援的 HTTP 動詞](/docs/app/api-reference/file-conventions/route) 現在會在 `route.ts` 中拋出有用的錯誤。[了解更多關於路由處理器](/docs/app/building-your-application/routing/route-handlers)。
*   **圖片：** `next/image` 現在支援 [`fetchPriority="high"`](https://developer.mozilla.org/docs/Web/HTML/Element/img#:~:text=elementtiming%20attribute%20page.-,fetchpriority,-Experimental) 屬性。
*   **Metadata：** 13.2 中棄用的先前 metadata API (`head.js`) 已被移除。請改用透過 [Metadata](/docs/app/api-reference/file-conventions/metadata) API 內建的 SEO 支援。
*   **選擇退出路由的資料夾：** 在資料夾前加上 \_ 以使其和任何子區段退出路由。例如，`app/_dashboard/page.tsx` 將不可路由。
*   **App Router：** 我們新增了一個新的 `useParams` 客戶端元件鉤子 (hook)，用於讀取給定路由區段的動態參數。[了解更多](/docs/app/api-reference/functions/use-params)。
*   **改進的樣式表載入：** Next.js 現在實作了 React 的 Suspensey CSS，修復了許多關於 CSS 載入和未樣式內容閃爍的問題，特別是在導航期間。
*   **改進的 Not Found 處理：** 除了捕獲預期的 `notFound()` 錯誤外，根 `app/not-found.js` 檔案現在也會處理應用程式中任何未匹配的 URL。這意味著訪問應用程式未處理的 URL 的使用者將看到 `app/not-found.js` 檔案匯出的 UI。[了解更多](/docs/app/api-reference/file-conventions/not-found)。
*   **改進的客戶端路由快取：** `router.refresh()` 現在會使整個快取失效，且搜尋參數現在是快取鍵的一部分，允許在兩個搜尋參數之間導航（例如 `/?search=leerob` 和 `/?search=tim`）以正確還原依賴於參數的內容。

[社群](#community)
-----------------------

Next.js 是超過 2,600 名獨立開發者、Google 和 Meta 等產業合作夥伴以及 Vercel 核心團隊共同努力的成果。每週超過 420 萬次 npm 下載和 104,000+ GitHub stars，Next.js 是建構網路最受歡迎的方式之一。

加入 [GitHub Discussions](https://github.com/vercel/next.js/discussions)、[Reddit](https://www.reddit.com/r/nextjs/) 和 [Discord](https://nextjs.org/discord) 上的社群。

此版本由以下人員帶給您：

*   **Next.js** 團隊：[Andrew](https://github.com/acdlite)、[Balazs](https://github.com/balazsorban44)、[Hannes](https://github.com/hanneslund)、[Jan](https://github.com/jankaifer)、[Jiachi](https://github.com/huozhi)、[Jimmy](https://github.com/feedthejim)、[JJ](https://github.com/ijjk)、[Josh](https://github.com/gnoff)、[Sebastian](https://github.com/sebmarkbage)、[Shu](https://github.com/shuding)、[Steven](https://github.com/styfle)、[Tim](https://github.com/timneutkens) 和 [Wyatt](https://github.com/wyattjoh)。
*   **Turbopack** 團隊：[Alex](https://github.com/alexkirsz)、[Donny](https://github.com/kdy1)、[Justin](https://github.com/jridgewell)、[Leah](https://github.com/forsakenharmony)、[LongYinan](https://github.com/brooooooklyn)、[Maia](https://github.com/padmaia)、[OJ](https://github.com/kwonoj)、[Tobias](https://github.com/sokra) 和 [Will](https://github.com/wbinnssmith)。

以及以下貢獻者：@shuding、@huozhi、@sokra、@hanneslund、@JesseKoldewijn、@kaguya3222、@yangshun、@ijjk、@konomae、@Brooooooklyn、@jridgewell、@zlrlyy、@JohnDaly、@abhiyandhakal、@benjie、@johnnyomair、@nk980113、@dirheimerb、@DerTimonius、@DuCanhGH、@padmaia、@stafyniaksacha、@Gladowar、@zek、@jankaifer、@styfle、@balazsorban44、@wbinnssmith、@chibicode、@ForsakenHarmony、@franktronics、@FSaldanha、@Schniz、@raisedadead、@AdamKatzDev、@wyattjoh、@leerob、@meesvandongen、@vladikoff、@feedthejim、@tka5、@pyjun01、@gdborton、@M3kH、@aretrace、@shivanshubisht、@alexkirsz、@agrattan0820、@vinaykulk621、@heyitsuzair、@mrkldshv、@timneutkens、@furkanmavili、@swaminator、@EndangeredMassa、@DevEsteves、@rishabhpoddar、@schehata、@molebox、@dlehmhus、@akshaynox、@sp00ls、@janicklas-ralph、@tomryanx、@kwonoj、@karlhorky、@kdy1、@dante-robinson、@lachlanjc、@ianmacartney、@hotters、@isaackatayev、@insik-han、@jayair、@ivanhofer、@javivelasco、@SukkaW、@visshaljagtap、@imranbarbhuiya、@nivak-monarch、@HarshaVardhanReddyDuvvuru、@ianldgs、@ricardofiorani、@swarnava 和 @gustavostz。
