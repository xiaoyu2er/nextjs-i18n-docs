---
source-updated-at: 2025-05-16T04:52:11.000Z
translation-updated-at: 2025-05-20T22:58:33.974Z
title: 重定向
description: 为你的 Next.js 应用添加重定向功能。
---

{/* 本文档内容在应用路由和页面路由间共享。如需添加仅适用于页面路由的内容，可使用 `<PagesOnly>内容</PagesOnly>` 组件。所有共享内容不应包裹在任何组件中。 */}

重定向功能允许你将传入的请求路径转向到不同的目标路径。

要使用重定向，可以在 `next.config.js` 中配置 `redirects` 键：

```js filename="next.config.js"
module.exports = {
  async redirects() {
    return [
      {
        source: '/about',
        destination: '/',
        permanent: true,
      },
    ]
  },
}
```

`redirects` 是一个异步函数，需要返回包含 `source`、`destination` 和 `permanent` 属性的对象数组：

- `source`：传入的请求路径模式
- `destination`：要路由到的目标路径
- `permanent`：`true` 或 `false` - 若为 `true` 则使用 308 状态码（指示客户端/搜索引擎永久缓存此重定向），若为 `false` 则使用 307 状态码（临时重定向，不缓存）

> **为什么 Next.js 使用 307 和 308？** 传统上 302 用于临时重定向，301 用于永久重定向，但许多浏览器会将重定向请求方法改为 `GET` 而忽略原始方法。例如，浏览器向 `POST /v1/users` 发起请求并收到 302 状态码和 location `/v2/users` 时，后续请求可能会变成 `GET /v2/users` 而非预期的 `POST /v2/users`。Next.js 使用 307 临时重定向和 308 永久重定向状态码来明确保留原始请求方法。

- `basePath`：`false` 或 `undefined` - 若为 false 则匹配时不包含 `basePath`，仅适用于外部重定向
- `locale`：`false` 或 `undefined` - 匹配时是否排除语言环境
- `has`：包含 `type`、`key` 和 `value` 属性的 [has 对象](#header-cookie-and-query-matching)数组
- `missing`：包含 `type`、`key` 和 `value` 属性的 [missing 对象](#header-cookie-and-query-matching)数组

重定向检查优先于文件系统（包括页面和 `/public` 文件）。

使用页面路由时，除非存在 [中间件](/docs/app/building-your-application/routing/middleware) 且匹配路径，否则重定向不会应用于客户端路由（`Link`、`router.push`）。

应用重定向时，请求中提供的所有查询参数都会传递到目标地址。例如以下重定向配置：

```js
{
  source: '/old-blog/:path*',
  destination: '/blog/:path*',
  permanent: false
}
```

> **须知**：请确保在 `source` 和 `destination` 路径参数中的冒号 `:` 前包含正斜杠 `/`，否则路径将被视为字面字符串，可能导致无限重定向。

当请求 `/old-blog/post-1?hello=world` 时，客户端将被重定向到 `/blog/post-1?hello=world`。

## 路径匹配

支持路径匹配，例如 `/old-blog/:slug` 会匹配 `/old-blog/hello-world`（不匹配嵌套路径）：

```js filename="next.config.js"
module.exports = {
  async redirects() {
    return [
      {
        source: '/old-blog/:slug',
        destination: '/news/:slug', // 匹配的参数可用于目标路径
        permanent: true,
      },
    ]
  },
}
```

### 通配符路径匹配

要匹配通配符路径，可在参数后使用 `*`，例如 `/blog/:slug*` 会匹配 `/blog/a/b/c/d/hello-world`：

```js filename="next.config.js"
module.exports = {
  async redirects() {
    return [
      {
        source: '/blog/:slug*',
        destination: '/news/:slug*', // 匹配的参数可用于目标路径
        permanent: true,
      },
    ]
  },
}
```

### 正则表达式路径匹配

要匹配正则表达式路径，可将正则表达式包裹在参数后的括号中，例如 `/post/:slug(\\d{1,})` 会匹配 `/post/123` 但不匹配 `/post/abc`：

```js filename="next.config.js"
module.exports = {
  async redirects() {
    return [
      {
        source: '/post/:slug(\\d{1,})',
        destination: '/news/:slug', // 匹配的参数可用于目标路径
        permanent: false,
      },
    ]
  },
}
```

以下字符 `(`、`)`、`{`、`}`、`:`、`*`、`+`、`?` 用于正则路径匹配，因此在 `source` 中作为非特殊值使用时，必须通过添加 `\\` 进行转义：

```js filename="next.config.js"
module.exports = {
  async redirects() {
    return [
      {
        // 这将匹配请求 `/english(default)/something`
        source: '/english\\(default\\)/:slug',
        destination: '/en-us/:slug',
        permanent: false,
      },
    ]
  },
}
```

## 请求头、Cookie 和查询参数匹配

若需仅在请求头、cookie 或查询参数也匹配 `has` 字段或不匹配 `missing` 字段时才应用重定向，可配置这些字段。必须同时满足 `source` 和所有 `has` 项匹配，且所有 `missing` 项不匹配才会应用重定向。

`has` 和 `missing` 项可包含以下字段：

- `type`：`String` - 必须是 `header`、`cookie`、`host` 或 `query` 之一
- `key`：`String` - 要匹配的键名
- `value`：`String` 或 `undefined` - 要检查的值（若为 undefined 则匹配任意值）。可使用类似正则的字符串捕获特定值部分，例如对值 `first-(?<paramName>.*)` 匹配 `first-second` 时，目标路径中可使用 `:paramName` 引用 `second`

```js filename="next.config.js"
module.exports = {
  async redirects() {
    return [
      // 当存在 `x-redirect-me` 请求头时应用此重定向
      {
        source: '/:path((?!another-page$).*)',
        has: [
          {
            type: 'header',
            key: 'x-redirect-me',
          },
        ],
        permanent: false,
        destination: '/another-page',
      },
      // 当存在 `x-dont-redirect` 请求头时不应用此重定向
      {
        source: '/:path((?!another-page$).*)',
        missing: [
          {
            type: 'header',
            key: 'x-do-not-redirect',
          },
        ],
        permanent: false,
        destination: '/another-page',
      },
      // 当源路径、查询参数和 cookie 都匹配时应用此重定向
      {
        source: '/specific/:path*',
        has: [
          {
            type: 'query',
            key: 'page',
            // 由于提供了值且未使用命名捕获组（如 `(?<page>home)`），page 值不会出现在目标路径中
            value: 'home',
          },
          {
            type: 'cookie',
            key: 'authorized',
            value: 'true',
          },
        ],
        permanent: false,
        destination: '/another/:path*',
      },
      // 当存在 `x-authorized` 请求头且包含匹配值时应用此重定向
      {
        source: '/',
        has: [
          {
            type: 'header',
            key: 'x-authorized',
            value: '(?<authorized>yes|true)',
          },
        ],
        permanent: false,
        destination: '/home?authorized=:authorized',
      },
      // 当主机名为 `example.com` 时应用此重定向
      {
        source: '/:path((?!another-page$).*)',
        has: [
          {
            type: 'host',
            value: 'example.com',
          },
        ],
        permanent: false,
        destination: '/another-page',
      },
    ]
  },
}
```

### 支持 basePath 的重定向

当结合 [`basePath` 支持](/docs/app/api-reference/config/next-config-js/basePath) 使用重定向时，每个 `source` 和 `destination` 会自动添加 `basePath` 前缀，除非在重定向中设置 `basePath: false`：

```js filename="next.config.js"
module.exports = {
  basePath: '/docs',

  async redirects() {
    return [
      {
        source: '/with-basePath', // 自动变为 /docs/with-basePath
        destination: '/another', // 自动变为 /docs/another
        permanent: false,
      },
      {
        // 由于设置了 basePath: false，不会添加 /docs
        source: '/without-basePath',
        destination: 'https://example.com',
        basePath: false,
        permanent: false,
      },
    ]
  },
}
```

### 支持 i18n 的重定向

<AppOnly>

当结合 [`i18n` 支持](/docs/app/building-your-application/routing/internationalization) 使用重定向时，每个 `source` 和 `destination` 会自动添加配置的 `locales` 前缀，除非在重定向中设置 `locale: false`。若使用 `locale: false`，则必须手动为 `source` 和 `destination` 添加语言环境前缀才能正确匹配。

</AppOnly>

<PagesOnly>

当结合 [`i18n` 支持](/docs/pages/building-your-application/routing/internationalization) 使用重定向时，每个 `source` 和 `destination` 会自动添加配置的 `locales` 前缀，除非在重定向中设置 `locale: false`。若使用 `locale: false`，则必须手动为 `source` 和 `destination` 添加语言环境前缀才能正确匹配。

</PagesOnly>

```js filename="next.config.js"
module.exports = {
  i18n: {
    locales: ['en', 'fr', 'de'],
    defaultLocale: 'en',
  },

  async redirects() {
    return [
      {
        source: '/with-locale', // 自动处理所有语言环境
        destination: '/another', // 自动传递语言环境
        permanent: false,
      },
      {
        // 由于设置了 locale: false，不自动处理语言环境
        source: '/nl/with-locale-manual',
        destination: '/nl/another',
        locale: false,
        permanent: false,
      },
      {
        // 匹配 '/' 因为 `en` 是默认语言环境
        source: '/en',
        destination: '/en/another',
        locale: false,
        permanent: false,
      },
      // 即使设置了 locale: false 也可以匹配所有语言环境
      {
        source: '/:locale/page',
        destination: '/en/newpage',
        permanent: false,
        locale: false,
      },
      {
        // 会被转换为 /(en|fr|de)/(.*)，因此不会像 /:path* 那样匹配顶级 `/` 或 `/fr` 路由
        source: '/(.*)',
        destination: '/another',
        permanent: false,
      },
    ]
  },
}
```

在极少数情况下，可能需要为旧版 HTTP 客户端分配自定义状态码以实现正确重定向。此时可使用 `statusCode` 属性替代 `permanent` 属性（不可同时使用）。为确保 IE11 兼容性，308 状态码会自动添加 `Refresh` 头。

## 其他重定向方式

- 在 [API 路由](/docs/pages/building-your-application/routing/api-routes) 和 [路由处理器](/docs/app/building-your-application/routing/route-handlers) 中，可根据传入请求进行重定向
- 在 [`getStaticProps`](/docs/pages/building-your-application/data-fetching/get-static-props) 和 [`getServerSideProps`](/docs/pages/building-your-application/data-fetching/get-server-side-props) 中，可在请求时重定向特定页面

## 版本历史

| 版本       | 变更                |
| ---------- | ------------------- |
| `v13.3.0` | 新增 `missing` 支持 |
| `v10.2.0` | 新增 `has` 支持     |
| `v9.5.0`  | 新增 `redirects` 功能 |