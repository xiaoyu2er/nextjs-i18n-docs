---
source-updated-at: 2025-06-01T01:32:20.000Z
translation-updated-at: 2025-06-01T22:08:47.472Z
title: å¦‚ä½•è‡ªæ‰˜ç®¡ä½ çš„ Next.js åº”ç”¨
nav_title: è‡ªæ‰˜ç®¡
description: å­¦ä¹ å¦‚ä½•åœ¨ Node.js æœåŠ¡å™¨ã€Docker é•œåƒæˆ–é™æ€ HTML æ–‡ä»¶ï¼ˆé™æ€å¯¼å‡ºï¼‰ä¸Šè‡ªæ‰˜ç®¡ Next.js åº”ç”¨ã€‚
---

{/* æœ¬æ–‡æ¡£å†…å®¹åœ¨åº”ç”¨è·¯ç”±å™¨å’Œé¡µé¢è·¯ç”±å™¨ä¹‹é—´å…±äº«ã€‚ä½ å¯ä»¥ä½¿ç”¨ `<PagesOnly>å†…å®¹</PagesOnly>` ç»„ä»¶æ·»åŠ ç‰¹å®šäºé¡µé¢è·¯ç”±å™¨çš„å†…å®¹ã€‚ä»»ä½•å…±äº«å†…å®¹ä¸åº”åŒ…è£¹åœ¨ç»„ä»¶ä¸­ã€‚ */}

å½“ä½ [éƒ¨ç½²](/docs/app/getting-started/deploying) Next.js åº”ç”¨æ—¶ï¼Œå¯èƒ½éœ€è¦æ ¹æ®åŸºç¡€è®¾æ–½é…ç½®ä¸åŒåŠŸèƒ½çš„å¤„ç†æ–¹å¼ã€‚

> **ğŸ¥ è§‚çœ‹è§†é¢‘ï¼š** äº†è§£æ›´å¤šå…³äºè‡ªæ‰˜ç®¡ Next.js çš„å†…å®¹ â†’ [YouTube (45åˆ†é’Ÿ)](https://www.youtube.com/watch?v=sIVL4JMqRfc)ã€‚

## å›¾ç‰‡ä¼˜åŒ–

é€šè¿‡ `next/image` å®ç°çš„[å›¾ç‰‡ä¼˜åŒ–](/docs/app/api-reference/components/image)åœ¨ä½¿ç”¨ `next start` éƒ¨ç½²æ—¶å¯é›¶é…ç½®è‡ªæ‰˜ç®¡ã€‚å¦‚æœå¸Œæœ›ä½¿ç”¨å•ç‹¬çš„æœåŠ¡ä¼˜åŒ–å›¾ç‰‡ï¼Œå¯ä»¥[é…ç½®å›¾ç‰‡åŠ è½½å™¨](/docs/app/api-reference/components/image#loader)ã€‚

é€šè¿‡é™æ€å¯¼å‡º ([static export](/docs/app/guides/static-exports#image-optimization)) ä½¿ç”¨å›¾ç‰‡ä¼˜åŒ–æ—¶ï¼Œéœ€è¦åœ¨ `next.config.js` ä¸­å®šä¹‰è‡ªå®šä¹‰å›¾ç‰‡åŠ è½½å™¨ã€‚è¯·æ³¨æ„ï¼Œå›¾ç‰‡æ˜¯åœ¨è¿è¡Œæ—¶ä¼˜åŒ–ï¼Œè€Œéæ„å»ºæ—¶ã€‚

> **é¡»çŸ¥ï¼š**
>
> - åœ¨åŸºäº glibc çš„ Linux ç³»ç»Ÿä¸Šï¼Œå›¾ç‰‡ä¼˜åŒ–å¯èƒ½éœ€è¦[é¢å¤–é…ç½®](https://sharp.pixelplumbing.com/install#linux-memory-allocator)ä»¥é˜²æ­¢å†…å­˜ä½¿ç”¨è¿‡å¤šã€‚
> - äº†è§£æ›´å¤šå…³äº[ä¼˜åŒ–å›¾ç‰‡çš„ç¼“å­˜è¡Œä¸º](/docs/app/api-reference/components/image#minimumcachettl)ä»¥åŠå¦‚ä½•é…ç½® TTLã€‚
> - ä½ ä¹Ÿå¯ä»¥[ç¦ç”¨å›¾ç‰‡ä¼˜åŒ–](/docs/app/api-reference/components/image#unoptimized)å¹¶ä¿ç•™ä½¿ç”¨ `next/image` çš„å…¶ä»–ä¼˜åŠ¿ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ é€‰æ‹©è‡ªè¡Œå•ç‹¬ä¼˜åŒ–å›¾ç‰‡ã€‚

## ä¸­é—´ä»¶

[ä¸­é—´ä»¶](/docs/app/building-your-application/routing/middleware)åœ¨ä½¿ç”¨ `next start` éƒ¨ç½²æ—¶å¯é›¶é…ç½®è‡ªæ‰˜ç®¡ã€‚ç”±äºå®ƒéœ€è¦è®¿é—®ä¼ å…¥è¯·æ±‚ï¼Œå› æ­¤ä¸æ”¯æŒ[é™æ€å¯¼å‡º](/docs/app/guides/static-exports)ã€‚

ä¸­é—´ä»¶ä½¿ç”¨ [Edge è¿è¡Œæ—¶](/docs/app/api-reference/edge)ï¼Œè¿™æ˜¯æ‰€æœ‰å¯ç”¨ Node.js API çš„å­é›†ï¼Œæœ‰åŠ©äºç¡®ä¿ä½å»¶è¿Ÿï¼Œå› ä¸ºå®ƒå¯èƒ½åœ¨åº”ç”¨ä¸­çš„æ¯ä¸ªè·¯ç”±æˆ–èµ„æºå‰è¿è¡Œã€‚å¦‚æœä¸å¸Œæœ›è¿™æ ·ï¼Œå¯ä»¥ä½¿ç”¨[å®Œæ•´çš„ Node.js è¿è¡Œæ—¶](/blog/next-15-2#nodejs-middleware-experimental)æ¥è¿è¡Œä¸­é—´ä»¶ã€‚

å¦‚æœä½ æƒ³æ·»åŠ éœ€è¦æ‰€æœ‰ Node.js API çš„é€»è¾‘ï¼ˆæˆ–ä½¿ç”¨å¤–éƒ¨åŒ…ï¼‰ï¼Œå¯ä»¥è€ƒè™‘å°†æ­¤é€»è¾‘ç§»è‡³[å¸ƒå±€](/docs/app/api-reference/file-conventions/layout)ä½œä¸º[æœåŠ¡å™¨ç»„ä»¶](/docs/app/getting-started/server-and-client-components)ã€‚ä¾‹å¦‚ï¼Œæ£€æŸ¥[æ ‡å¤´](/docs/app/api-reference/functions/headers)å’Œ[é‡å®šå‘](/docs/app/api-reference/functions/redirect)ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æ ‡å¤´ã€Cookie æˆ–æŸ¥è¯¢å‚æ•°é€šè¿‡ `next.config.js` è¿›è¡Œ[é‡å®šå‘](/docs/app/api-reference/config/next-config-js/redirects#header-cookie-and-query-matching)æˆ–[é‡å†™](/docs/app/api-reference/config/next-config-js/rewrites#header-cookie-and-query-matching)ã€‚å¦‚æœè¿™ä¸èµ·ä½œç”¨ï¼Œè¿˜å¯ä»¥ä½¿ç”¨[è‡ªå®šä¹‰æœåŠ¡å™¨](/docs/pages/guides/custom-server)ã€‚

## ç¯å¢ƒå˜é‡

Next.js æ”¯æŒæ„å»ºæ—¶å’Œè¿è¡Œæ—¶ç¯å¢ƒå˜é‡ã€‚

**é»˜è®¤æƒ…å†µä¸‹ï¼Œç¯å¢ƒå˜é‡ä»…åœ¨æœåŠ¡å™¨ç«¯å¯ç”¨**ã€‚è¦å°†ç¯å¢ƒå˜é‡æš´éœ²ç»™æµè§ˆå™¨ï¼Œå¿…é¡»æ·»åŠ  `NEXT_PUBLIC_` å‰ç¼€ã€‚ç„¶è€Œï¼Œè¿™äº›å…¬å…±ç¯å¢ƒå˜é‡ä¼šåœ¨ `next build` æœŸé—´å†…è”åˆ° JavaScript åŒ…ä¸­ã€‚

<PagesOnly>

è¦è¯»å–è¿è¡Œæ—¶ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ `getServerSideProps` æˆ–[é€æ­¥é‡‡ç”¨åº”ç”¨è·¯ç”±å™¨](/docs/app/guides/migrating/app-router-migration)ã€‚

</PagesOnly>

<AppOnly>

ä½ å¯ä»¥åœ¨åŠ¨æ€æ¸²æŸ“æœŸé—´å®‰å…¨åœ°åœ¨æœåŠ¡å™¨ä¸Šè¯»å–ç¯å¢ƒå˜é‡ã€‚

```tsx filename="app/page.ts" switcher
import { connection } from 'next/server'

export default async function Component() {
  await connection()
  // cookiesã€headers å’Œå…¶ä»–åŠ¨æ€ API
  // ä¹Ÿä¼šé€‰æ‹©åŠ¨æ€æ¸²æŸ“ï¼Œæ„å‘³ç€
  // è¿™ä¸ªç¯å¢ƒå˜é‡åœ¨è¿è¡Œæ—¶è¢«è¯„ä¼°
  const value = process.env.MY_VALUE
  // ...
}
```

```jsx filename="app/page.js" switcher
import { connection } from 'next/server'

export default async function Component() {
  await connection()
  // cookiesã€headers å’Œå…¶ä»–åŠ¨æ€ API
  // ä¹Ÿä¼šé€‰æ‹©åŠ¨æ€æ¸²æŸ“ï¼Œæ„å‘³ç€
  // è¿™ä¸ªç¯å¢ƒå˜é‡åœ¨è¿è¡Œæ—¶è¢«è¯„ä¼°
  const value = process.env.MY_VALUE
  // ...
}
```

</AppOnly>

è¿™å…è®¸ä½ ä½¿ç”¨å•ä¸€çš„ Docker é•œåƒï¼Œåœ¨ä¸åŒç¯å¢ƒä¸­ä½¿ç”¨ä¸åŒçš„å€¼è¿›è¡Œå‡çº§ã€‚

> **é¡»çŸ¥ï¼š**
>
> - ä½ å¯ä»¥ä½¿ç”¨ [`register` å‡½æ•°](/docs/app/guides/instrumentation)åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶è¿è¡Œä»£ç ã€‚
> - æˆ‘ä»¬ä¸å»ºè®®ä½¿ç”¨ [runtimeConfig](/docs/pages/api-reference/config/next-config-js/runtime-configuration) é€‰é¡¹ï¼Œå› ä¸ºå®ƒä¸é€‚ç”¨äºç‹¬ç«‹è¾“å‡ºæ¨¡å¼ã€‚ç›¸åï¼Œæˆ‘ä»¬å»ºè®®[é€æ­¥é‡‡ç”¨](/docs/app/guides/migrating/app-router-migration)åº”ç”¨è·¯ç”±å™¨ã€‚

## ç¼“å­˜å’Œ ISR

Next.js å¯ä»¥ç¼“å­˜å“åº”ã€ç”Ÿæˆçš„é™æ€é¡µé¢ã€æ„å»ºè¾“å‡ºä»¥åŠå…¶ä»–é™æ€èµ„æºï¼Œå¦‚å›¾ç‰‡ã€å­—ä½“å’Œè„šæœ¬ã€‚

ç¼“å­˜å’Œé‡æ–°éªŒè¯é¡µé¢ï¼ˆä½¿ç”¨[å¢é‡é™æ€å†ç”Ÿ (ISR)](/docs/app/guides/incremental-static-regeneration)ï¼‰ä½¿ç”¨**ç›¸åŒçš„å…±äº«ç¼“å­˜**ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤ç¼“å­˜å­˜å‚¨åœ¨ Next.js æœåŠ¡å™¨çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆç£ç›˜ï¼‰ä¸Šã€‚**è¿™åœ¨è‡ªæ‰˜ç®¡æ—¶è‡ªåŠ¨å·¥ä½œ**ï¼Œé€‚ç”¨äºé¡µé¢è·¯ç”±å™¨å’Œåº”ç”¨è·¯ç”±å™¨ã€‚

å¦‚æœä½ æƒ³å°†ç¼“å­˜çš„é¡µé¢å’Œæ•°æ®æŒä¹…åŒ–åˆ°æŒä¹…å­˜å‚¨ä¸­ï¼Œæˆ–åœ¨å¤šä¸ªå®¹å™¨æˆ– Next.js åº”ç”¨å®ä¾‹ä¹‹é—´å…±äº«ç¼“å­˜ï¼Œå¯ä»¥é…ç½® Next.js ç¼“å­˜ä½ç½®ã€‚

### è‡ªåŠ¨ç¼“å­˜

- Next.js ä¸ºçœŸæ­£ä¸å¯å˜çš„èµ„æºè®¾ç½® `Cache-Control` æ ‡å¤´ä¸º `public, max-age=31536000, immutable`ã€‚è¿™ä¸èƒ½è¢«è¦†ç›–ã€‚è¿™äº›ä¸å¯å˜æ–‡ä»¶åœ¨æ–‡ä»¶åä¸­åŒ…å« SHA å“ˆå¸Œï¼Œå› æ­¤å¯ä»¥å®‰å…¨åœ°æ— é™æœŸç¼“å­˜ã€‚ä¾‹å¦‚ï¼Œ[é™æ€å›¾ç‰‡å¯¼å…¥](/docs/app/getting-started/images#local-images)ã€‚ä½ å¯ä»¥ä¸ºå›¾ç‰‡[é…ç½® TTL](/docs/app/api-reference/components/image#minimumcachettl)ã€‚
- å¢é‡é™æ€å†ç”Ÿ (ISR) è®¾ç½® `Cache-Control` æ ‡å¤´ä¸º `s-maxage: <revalidate in getStaticProps>, stale-while-revalidate`ã€‚æ­¤é‡æ–°éªŒè¯æ—¶é—´åœ¨ä½ çš„ [`getStaticProps` å‡½æ•°](/docs/pages/building-your-application/data-fetching/get-static-props)ä¸­ä»¥ç§’ä¸ºå•ä½å®šä¹‰ã€‚å¦‚æœè®¾ç½® `revalidate: false`ï¼Œå®ƒå°†é»˜è®¤ä¸ºä¸€å¹´çš„ç¼“å­˜æŒç»­æ—¶é—´ã€‚
- åŠ¨æ€æ¸²æŸ“çš„é¡µé¢è®¾ç½® `Cache-Control` æ ‡å¤´ä¸º `private, no-cache, no-store, max-age=0, must-revalidate` ä»¥é˜²æ­¢ç”¨æˆ·ç‰¹å®šæ•°æ®è¢«ç¼“å­˜ã€‚è¿™é€‚ç”¨äºåº”ç”¨è·¯ç”±å™¨å’Œé¡µé¢è·¯ç”±å™¨ã€‚è¿™è¿˜åŒ…æ‹¬[è‰ç¨¿æ¨¡å¼](/docs/app/guides/draft-mode)ã€‚

### é™æ€èµ„æº

å¦‚æœä½ æƒ³åœ¨ä¸åŒçš„åŸŸæˆ– CDN ä¸Šæ‰˜ç®¡é™æ€èµ„æºï¼Œå¯ä»¥åœ¨ `next.config.js` ä¸­ä½¿ç”¨ `assetPrefix` [é…ç½®](/docs/app/api-reference/config/next-config-js/assetPrefix)ã€‚Next.js åœ¨æ£€ç´¢ JavaScript æˆ– CSS æ–‡ä»¶æ—¶å°†ä½¿ç”¨æ­¤èµ„æºå‰ç¼€ã€‚å°†èµ„æºåˆ†ç¦»åˆ°ä¸åŒåŸŸçš„ç¼ºç‚¹æ˜¯é¢å¤–çš„ DNS å’Œ TLS è§£ææ—¶é—´ã€‚

[äº†è§£æ›´å¤šå…³äº `assetPrefix`](/docs/app/api-reference/config/next-config-js/assetPrefix)ã€‚

### é…ç½®ç¼“å­˜

é»˜è®¤æƒ…å†µä¸‹ï¼Œç”Ÿæˆçš„ç¼“å­˜èµ„æºå°†å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼ˆé»˜è®¤ä¸º 50MBï¼‰å’Œç£ç›˜ä¸Šã€‚å¦‚æœä½ ä½¿ç”¨ Kubernetes ç­‰å®¹å™¨ç¼–æ’å¹³å°æ‰˜ç®¡ Next.jsï¼Œæ¯ä¸ª pod éƒ½ä¼šæœ‰ç¼“å­˜çš„å‰¯æœ¬ã€‚ä¸ºäº†é˜²æ­¢æ˜¾ç¤ºè¿‡æ—¶æ•°æ®ï¼ˆå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ç¼“å­˜ä¸åœ¨ pod ä¹‹é—´å…±äº«ï¼‰ï¼Œä½ å¯ä»¥é…ç½® Next.js ç¼“å­˜ä»¥æä¾›ç¼“å­˜å¤„ç†ç¨‹åºå¹¶ç¦ç”¨å†…å­˜ç¼“å­˜ã€‚

åœ¨è‡ªæ‰˜ç®¡æ—¶é…ç½® ISR/æ•°æ®ç¼“å­˜ä½ç½®ï¼Œå¯ä»¥åœ¨ `next.config.js` æ–‡ä»¶ä¸­é…ç½®è‡ªå®šä¹‰å¤„ç†ç¨‹åºï¼š

```jsx filename="next.config.js"
module.exports = {
  cacheHandler: require.resolve('./cache-handler.js'),
  cacheMaxMemorySize: 0, // ç¦ç”¨é»˜è®¤çš„å†…å­˜ç¼“å­˜
}
```

ç„¶åï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `cache-handler.js`ï¼Œä¾‹å¦‚ï¼š

```jsx filename="cache-handler.js"
const cache = new Map()

module.exports = class CacheHandler {
  constructor(options) {
    this.options = options
  }

  async get(key) {
    // è¿™å¯ä»¥å­˜å‚¨åœ¨ä»»ä½•åœ°æ–¹ï¼Œå¦‚æŒä¹…å­˜å‚¨
    return cache.get(key)
  }

  async set(key, data, ctx) {
    // è¿™å¯ä»¥å­˜å‚¨åœ¨ä»»ä½•åœ°æ–¹ï¼Œå¦‚æŒä¹…å­˜å‚¨
    cache.set(key, {
      value: data,
      lastModified: Date.now(),
      tags: ctx.tags,
    })
  }

  async revalidateTag(tags) {
    // tags æ˜¯å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„
    tags = [tags].flat()
    // éå†ç¼“å­˜ä¸­çš„æ‰€æœ‰æ¡ç›®
    for (let [key, value] of cache) {
      // å¦‚æœå€¼çš„æ ‡ç­¾åŒ…å«æŒ‡å®šçš„æ ‡ç­¾ï¼Œåˆ é™¤æ­¤æ¡ç›®
      if (value.tags.some((tag) => tags.includes(tag))) {
        cache.delete(key)
      }
    }
  }

  // å¦‚æœä½ æƒ³ä¸ºå•ä¸ªè¯·æ±‚è®¾ç½®ä¸´æ—¶å†…å­˜ç¼“å­˜ï¼Œå¹¶åœ¨ä¸‹ä¸€ä¸ªè¯·æ±‚å‰é‡ç½®
  // å¯ä»¥åˆ©ç”¨æ­¤æ–¹æ³•
  resetRequestCache() {}
}
```

ä½¿ç”¨è‡ªå®šä¹‰ç¼“å­˜å¤„ç†ç¨‹åºå¯ä»¥ç¡®ä¿æ‰€æœ‰æ‰˜ç®¡ Next.js åº”ç”¨çš„ pod ä¹‹é—´çš„ä¸€è‡´æ€§ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å°†ç¼“å­˜å€¼ä¿å­˜åœ¨ä»»ä½•åœ°æ–¹ï¼Œå¦‚ [Redis](https://github.com/vercel/next.js/tree/canary/examples/cache-handler-redis) æˆ– AWS S3ã€‚

> **é¡»çŸ¥ï¼š**
>
> - `revalidatePath` æ˜¯ç¼“å­˜æ ‡ç­¾ä¸Šçš„ä¾¿åˆ©å±‚ã€‚è°ƒç”¨ `revalidatePath` å°†ä½¿ç”¨æä¾›çš„é¡µé¢çš„ç‰¹æ®Šé»˜è®¤æ ‡ç­¾è°ƒç”¨ `revalidateTag` å‡½æ•°ã€‚

## æ„å»ºç¼“å­˜

Next.js åœ¨ `next build` æœŸé—´ç”Ÿæˆä¸€ä¸ª IDï¼Œä»¥æ ‡è¯†æ­£åœ¨æœåŠ¡çš„åº”ç”¨ç‰ˆæœ¬ã€‚ç›¸åŒçš„æ„å»ºåº”è¯¥ç”¨äºå¯åŠ¨å¤šä¸ªå®¹å™¨ã€‚

å¦‚æœä½ ä¸ºç¯å¢ƒçš„æ¯ä¸ªé˜¶æ®µé‡æ–°æ„å»ºï¼Œéœ€è¦åœ¨å®¹å™¨ä¹‹é—´ä½¿ç”¨ä¸€è‡´çš„æ„å»º IDã€‚åœ¨ `next.config.js` ä¸­ä½¿ç”¨ `generateBuildId` å‘½ä»¤ï¼š

```jsx filename="next.config.js"
module.exports = {
  generateBuildId: async () => {
    // è¿™å¯ä»¥æ˜¯ä»»ä½•å†…å®¹ï¼Œä½¿ç”¨æœ€æ–°çš„ git å“ˆå¸Œ
    return process.env.GIT_HASH
  },
}
```

## ç‰ˆæœ¬åå·®

Next.js ä¼šè‡ªåŠ¨ç¼“è§£å¤§å¤šæ•°[ç‰ˆæœ¬åå·®](https://www.industrialempathy.com/posts/version-skew/)çš„æƒ…å†µï¼Œå¹¶åœ¨æ£€æµ‹åˆ°æ–°èµ„æºæ—¶è‡ªåŠ¨é‡æ–°åŠ è½½åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ `deploymentId` ä¸åŒ¹é…ï¼Œé¡µé¢ä¹‹é—´çš„è½¬æ¢å°†æ‰§è¡Œç¡¬å¯¼èˆªè€Œéä½¿ç”¨é¢„å–çš„å€¼ã€‚

å½“åº”ç”¨é‡æ–°åŠ è½½æ—¶ï¼Œå¦‚æœæœªè®¾è®¡ä¸ºåœ¨é¡µé¢å¯¼èˆªä¹‹é—´æŒä¹…åŒ–çŠ¶æ€ï¼Œå¯èƒ½ä¼šä¸¢å¤±åº”ç”¨çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ URL çŠ¶æ€æˆ–æœ¬åœ°å­˜å‚¨å°†åœ¨é¡µé¢åˆ·æ–°åä¿ç•™çŠ¶æ€ã€‚ç„¶è€Œï¼Œåƒ `useState` è¿™æ ·çš„ç»„ä»¶çŠ¶æ€ä¼šåœ¨è¿™ç§å¯¼èˆªä¸­ä¸¢å¤±ã€‚

<AppOnly>

## æµå¼ä¼ è¾“å’Œ Suspense

Next.js åº”ç”¨è·¯ç”±å™¨åœ¨è‡ªæ‰˜ç®¡æ—¶æ”¯æŒ[æµå¼å“åº”](/docs/app/building-your-application/routing/loading-ui-and-streaming)ã€‚å¦‚æœä½¿ç”¨ Nginx æˆ–ç±»ä¼¼ä»£ç†ï¼Œéœ€è¦é…ç½®å®ƒç¦ç”¨ç¼“å†²ä»¥å¯ç”¨æµå¼ä¼ è¾“ã€‚

ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡å°† `X-Accel-Buffering` è®¾ç½®ä¸º `no` æ¥ç¦ç”¨ Nginx ä¸­çš„ç¼“å†²ï¼š

```js filename="next.config.js"
module.exports = {
  async headers() {
    return [
      {
        source: '/:path*{/}?',
        headers: [
          {
            key: 'X-Accel-Buffering',
            value: 'no',
          },
        ],
      },
    ]
  },
}
```

## éƒ¨åˆ†é¢„æ¸²æŸ“

[éƒ¨åˆ†é¢„æ¸²æŸ“ï¼ˆå®éªŒæ€§ï¼‰](/docs/app/getting-started/partial-prerendering)é»˜è®¤ä¸ Next.js ä¸€èµ·å·¥ä½œï¼Œå¹¶éä»…é™ CDN çš„åŠŸèƒ½ã€‚è¿™åŒ…æ‹¬ä½œä¸º Node.js æœåŠ¡å™¨ï¼ˆé€šè¿‡ `next start`ï¼‰éƒ¨ç½²ä»¥åŠä½¿ç”¨ Docker å®¹å™¨æ—¶ã€‚

## ä¸ CDN ä¸€èµ·ä½¿ç”¨

å½“åœ¨ Next.js åº”ç”¨å‰ä½¿ç”¨ CDN æ—¶ï¼Œé¡µé¢åœ¨è®¿é—®åŠ¨æ€ API æ—¶å°†åŒ…å« `Cache-Control: private` å“åº”æ ‡å¤´ã€‚è¿™ç¡®ä¿ç”Ÿæˆçš„ HTML é¡µé¢è¢«æ ‡è®°ä¸ºä¸å¯ç¼“å­˜ã€‚å¦‚æœé¡µé¢å®Œå…¨é¢„æ¸²æŸ“ä¸ºé™æ€ï¼Œå®ƒå°†åŒ…å« `Cache-Control: public` ä»¥å…è®¸é¡µé¢åœ¨ CDN ä¸Šç¼“å­˜ã€‚

å¦‚æœä¸éœ€è¦é™æ€å’ŒåŠ¨æ€ç»„ä»¶çš„æ··åˆï¼Œå¯ä»¥å°†æ•´ä¸ªè·¯ç”±è®¾ä¸ºé™æ€ï¼Œå¹¶åœ¨ CDN ä¸Šç¼“å­˜è¾“å‡º HTMLã€‚å¦‚æœåœ¨è¿è¡Œ `next build` æ—¶ä¸ä½¿ç”¨åŠ¨æ€ APIï¼Œè¿™æ˜¯é»˜è®¤è¡Œä¸ºã€‚

éšç€éƒ¨åˆ†é¢„æ¸²æŸ“è¶‹äºç¨³å®šï¼Œæˆ‘ä»¬å°†é€šè¿‡éƒ¨ç½²é€‚é…å™¨ API æä¾›æ”¯æŒã€‚

</AppOnly>

<AppOnly>

## `after`

[`after`](/docs/app/api-reference/functions/after) åœ¨ä½¿ç”¨ `next start` è‡ªæ‰˜ç®¡æ—¶å®Œå…¨æ”¯æŒã€‚

åœæ­¢æœåŠ¡å™¨æ—¶ï¼Œé€šè¿‡å‘é€ `SIGINT` æˆ– `SIGTERM` ä¿¡å·å¹¶ç­‰å¾…ï¼Œç¡®ä¿ä¼˜é›…å…³é—­ã€‚è¿™å…è®¸ Next.js æœåŠ¡å™¨ç­‰å¾… `after` å†…éƒ¨ä½¿ç”¨çš„å¾…å¤„ç†å›è°ƒå‡½æ•°æˆ– Promise å®Œæˆã€‚

</AppOnly>

<PagesOnly>

## æ‰‹åŠ¨ä¼˜é›…å…³é—­

è‡ªæ‰˜ç®¡æ—¶ï¼Œä½ å¯èƒ½å¸Œæœ›åœ¨æœåŠ¡å™¨é€šè¿‡ `SIGTERM` æˆ– `SIGINT` ä¿¡å·å…³é—­æ—¶è¿è¡Œä»£ç ã€‚

ä½ å¯ä»¥å°†ç¯å¢ƒå˜é‡ `NEXT_MANUAL_SIG_HANDLE` è®¾ç½®ä¸º `true`ï¼Œç„¶ååœ¨ `_document.js` æ–‡ä»¶ä¸­ä¸ºè¯¥ä¿¡å·æ³¨å†Œå¤„ç†ç¨‹åºã€‚ä½ éœ€è¦ç›´æ¥åœ¨ `package.json` è„šæœ¬ä¸­æ³¨å†Œç¯å¢ƒå˜é‡ï¼Œè€Œä¸æ˜¯åœ¨ `.env` æ–‡ä»¶ä¸­ã€‚

> **é¡»çŸ¥**ï¼šæ‰‹åŠ¨ä¿¡å·å¤„ç†åœ¨ `next dev` ä¸­ä¸å¯ç”¨ã€‚

```json filename="package.json"
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "NEXT_MANUAL_SIG_HANDLE=true next start"
  }
}
```

```js filename="pages/_document.js"
if (process.env.NEXT_MANUAL_SIG_HANDLE) {
  process.on('SIGTERM', () => {
    console.log('Received SIGTERM: cleaning up')
    process.exit(0)
  })
  process.on('SIGINT', () => {
    console.log('Received SIGINT: cleaning up')
    process.exit(0)
  })
}
```

</PagesOnly>