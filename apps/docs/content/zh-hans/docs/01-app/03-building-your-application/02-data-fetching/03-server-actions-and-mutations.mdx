---
source-updated-at: 2025-05-25T15:16:02.000Z
translation-updated-at: 2025-05-25T20:30:03.863Z
title: æœåŠ¡ç«¯æ“ä½œä¸æ•°æ®å˜æ›´
nav_title: æœåŠ¡ç«¯æ“ä½œä¸æ•°æ®å˜æ›´
description: äº†è§£å¦‚ä½•ä½¿ç”¨ Next.js å¤„ç†è¡¨å•æäº¤å’Œæ•°æ®å˜æ›´ã€‚
related:
  description: äº†è§£å¦‚ä½•åœ¨ Next.js ä¸­é…ç½®æœåŠ¡ç«¯æ“ä½œ
  links:
    - app/api-reference/config/next-config-js/serverActions
---

[æœåŠ¡ç«¯æ“ä½œ (Server Actions)](https://react.dev/reference/rsc/server-actions) æ˜¯åœ¨æœåŠ¡ç«¯æ‰§è¡Œçš„**å¼‚æ­¥å‡½æ•°**ã€‚å®ƒä»¬å¯ä»¥åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ç»„ä»¶ä¸­è°ƒç”¨ï¼Œç”¨äºå¤„ç† Next.js åº”ç”¨ä¸­çš„è¡¨å•æäº¤å’Œæ•°æ®å˜æ›´ã€‚

> **ğŸ¥ è§‚çœ‹è§†é¢‘:** äº†è§£æ›´å¤šå…³äºæœåŠ¡ç«¯æ“ä½œçš„æ•°æ®å˜æ›´ â†’ [YouTube (10åˆ†é’Ÿ)](https://youtu.be/dDpZfOQBMaU?si=cJZHlUu_jFhCzHUg).

## çº¦å®š

å¯ä»¥é€šè¿‡ React çš„ [`"use server"`](https://react.dev/reference/react/use-server) æŒ‡ä»¤å®šä¹‰æœåŠ¡ç«¯æ“ä½œã€‚æ‚¨å¯ä»¥å°†è¯¥æŒ‡ä»¤æ”¾åœ¨ `async` å‡½æ•°é¡¶éƒ¨ä»¥æ ‡è®°è¯¥å‡½æ•°ä¸ºæœåŠ¡ç«¯æ“ä½œï¼Œæˆ–è€…æ”¾åœ¨å•ç‹¬æ–‡ä»¶é¡¶éƒ¨ä»¥æ ‡è®°è¯¥æ–‡ä»¶æ‰€æœ‰å¯¼å‡ºä¸ºæœåŠ¡ç«¯æ“ä½œã€‚

### æœåŠ¡ç«¯ç»„ä»¶

æœåŠ¡ç«¯ç»„ä»¶å¯ä»¥ä½¿ç”¨å‡½æ•°çº§æˆ–æ¨¡å—çº§çš„ `"use server"` æŒ‡ä»¤ã€‚è¦å†…è”å®šä¹‰æœåŠ¡ç«¯æ“ä½œï¼Œè¯·åœ¨å‡½æ•°ä½“é¡¶éƒ¨æ·»åŠ  `"use server"`ï¼š

```tsx filename="app/page.tsx" switcher
export default function Page() {
  // æœåŠ¡ç«¯æ“ä½œ
  async function create() {
    'use server'
    // æ•°æ®å˜æ›´
  }

  return '...'
}
```

```jsx filename="app/page.js" switcher
export default function Page() {
  // æœåŠ¡ç«¯æ“ä½œ
  async function create() {
    'use server'
    // æ•°æ®å˜æ›´
  }

  return '...'
}
```

### å®¢æˆ·ç«¯ç»„ä»¶

è¦åœ¨[å®¢æˆ·ç«¯ç»„ä»¶](/docs/app/getting-started/updating-data#server-functions)ä¸­è°ƒç”¨æœåŠ¡ç«¯å‡½æ•°ï¼Œéœ€åˆ›å»ºæ–°æ–‡ä»¶å¹¶åœ¨é¡¶éƒ¨æ·»åŠ  `"use server"` æŒ‡ä»¤ã€‚è¯¥æ–‡ä»¶å†…æ‰€æœ‰å¯¼å‡ºå‡½æ•°éƒ½å°†è¢«æ ‡è®°ä¸ºå¯åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç»„ä»¶ä¸­å¤ç”¨çš„æœåŠ¡ç«¯å‡½æ•°ï¼š

```tsx filename="app/actions.ts" switcher
'use server'

export async function create() {}
```

```js filename="app/actions.js" switcher
'use server'

export async function create() {}
```

```tsx filename="app/button.tsx" switcher
'use client'

import { create } from './actions'

export function Button() {
  return <button onClick={() => create()}>åˆ›å»º</button>
}
```

```jsx filename="app/button.js" switcher
'use client'

import { create } from './actions'

export function Button() {
  return <button onClick={() => create()}>åˆ›å»º</button>
}
```

### å°†æ“ä½œä½œä¸ºå±æ€§ä¼ é€’

æ‚¨ä¹Ÿå¯ä»¥å°†æœåŠ¡ç«¯æ“ä½œä½œä¸ºå±æ€§ä¼ é€’ç»™å®¢æˆ·ç«¯ç»„ä»¶ï¼š

```jsx
<ClientComponent updateItemAction={updateItem} />
```

```tsx filename="app/client-component.tsx" switcher
'use client'

export default function ClientComponent({
  updateItemAction,
}: {
  updateItemAction: (formData: FormData) => void
}) {
  return <form action={updateItemAction}>{/* ... */}</form>
}
```

```jsx filename="app/client-component.js" switcher
'use client'

export default function ClientComponent({ updateItemAction }) {
  return <form action={updateItemAction}>{/* ... */}</form>
}
```

é€šå¸¸ï¼ŒNext.js TypeScript æ’ä»¶ä¼šæ ‡è®° `client-component.tsx` ä¸­çš„ `updateItemAction`ï¼Œå› ä¸ºå‡½æ•°é€šå¸¸æ— æ³•è·¨å®¢æˆ·ç«¯-æœåŠ¡ç«¯è¾¹ç•Œåºåˆ—åŒ–ã€‚ä½†ä»¥ `action` ç»“å°¾æˆ–å‘½åçš„å±æ€§ä¼šè¢«å‡å®šä¸ºæ¥æ”¶æœåŠ¡ç«¯æ“ä½œã€‚è¿™åªæ˜¯å¯å‘å¼è§„åˆ™ï¼Œå› ä¸º TypeScript æ’ä»¶å®é™…ä¸Šæ— æ³•åˆ¤æ–­æ¥æ”¶çš„æ˜¯æœåŠ¡ç«¯æ“ä½œè¿˜æ˜¯æ™®é€šå‡½æ•°ã€‚è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥ä»ä¼šç¡®ä¿æ‚¨ä¸ä¼šæ„å¤–å°†å‡½æ•°ä¼ é€’ç»™å®¢æˆ·ç«¯ç»„ä»¶ã€‚

## è¡Œä¸ºç‰¹æ€§

- æœåŠ¡ç«¯æ“ä½œå¯é€šè¿‡ [`<form>` å…ƒç´ ](#forms) çš„ `action` å±æ€§è°ƒç”¨ï¼š
  - æœåŠ¡ç«¯ç»„ä»¶é»˜è®¤æ”¯æŒæ¸è¿›å¢å¼ºï¼Œå³ä½¿ JavaScript æœªåŠ è½½æˆ–ç¦ç”¨ï¼Œè¡¨å•ä»å¯æäº¤ã€‚
  - åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­ï¼Œè°ƒç”¨æœåŠ¡ç«¯æ“ä½œçš„è¡¨å•ä¼šåœ¨ JavaScript æœªåŠ è½½æ—¶æ’é˜Ÿæäº¤ï¼Œä¼˜å…ˆè¿›è¡Œå®¢æˆ·ç«¯æ°´åˆã€‚
  - æ°´åˆåï¼Œè¡¨å•æäº¤ä¸ä¼šå¯¼è‡´æµè§ˆå™¨åˆ·æ–°ã€‚
- æœåŠ¡ç«¯æ“ä½œä¸ä»…é™äº `<form>`ï¼Œå¯ä»äº‹ä»¶å¤„ç†å™¨ã€`useEffect`ã€ç¬¬ä¸‰æ–¹åº“åŠå…¶ä»–è¡¨å•å…ƒç´ ï¼ˆå¦‚ `<button>`ï¼‰è°ƒç”¨ã€‚
- æœåŠ¡ç«¯æ“ä½œä¸ Next.js [ç¼“å­˜å’Œé‡æ–°éªŒè¯](/docs/app/deep-dive/caching) æ¶æ„é›†æˆã€‚æ“ä½œè°ƒç”¨æ—¶ï¼ŒNext.js å¯åœ¨å•æ¬¡æœåŠ¡ç«¯å¾€è¿”ä¸­è¿”å›æ›´æ–°çš„ UI å’Œæ–°æ•°æ®ã€‚
- åº•å±‚å®ç°ä½¿ç”¨ `POST` æ–¹æ³•ï¼Œä»…æ­¤ HTTP æ–¹æ³•å¯è°ƒç”¨æ“ä½œã€‚
- æœåŠ¡ç«¯æ“ä½œçš„å‚æ•°å’Œè¿”å›å€¼å¿…é¡»å¯è¢« React åºåˆ—åŒ–ã€‚å‚è§ React æ–‡æ¡£äº†è§£ [å¯åºåˆ—åŒ–å‚æ•°å’Œå€¼](https://react.dev/reference/react/use-server#serializable-parameters-and-return-values)ã€‚
- æœåŠ¡ç«¯æ“ä½œæ˜¯å‡½æ•°ï¼Œæ„å‘³ç€å¯åœ¨åº”ç”¨ä¸­ä»»ä½•ä½ç½®å¤ç”¨ã€‚
- æœåŠ¡ç«¯æ“ä½œç»§æ‰¿æ‰€åœ¨é¡µé¢æˆ–å¸ƒå±€çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚
- æœåŠ¡ç«¯æ“ä½œç»§æ‰¿æ‰€åœ¨é¡µé¢æˆ–å¸ƒå±€çš„ [è·¯ç”±æ®µé…ç½®](/docs/app/api-reference/file-conventions/route-segment-config)ï¼ŒåŒ…æ‹¬ `maxDuration` ç­‰å­—æ®µã€‚

## ç¤ºä¾‹

### è¡¨å•

React æ‰©å±•äº† HTML [`<form>`](https://developer.mozilla.org/docs/Web/HTML/Element/form) å…ƒç´ ï¼Œå…è®¸é€šè¿‡ `action` å±æ€§è°ƒç”¨æœåŠ¡ç«¯æ“ä½œã€‚

è¡¨å•ä¸­è°ƒç”¨æ—¶ï¼Œæ“ä½œè‡ªåŠ¨æ¥æ”¶ [`FormData`](https://developer.mozilla.org/docs/Web/API/FormData/FormData) å¯¹è±¡ã€‚æ— éœ€ä½¿ç”¨ React `useState` ç®¡ç†å­—æ®µï¼Œå¯ç›´æ¥ä½¿ç”¨åŸç”Ÿ [FormData æ–¹æ³•](https://developer.mozilla.org/en-US/docs/Web/API/FormData#instance_methods) æå–æ•°æ®ï¼š

```tsx filename="app/invoices/page.tsx" switcher
export default function Page() {
  async function createInvoice(formData: FormData) {
    'use server'

    const rawFormData = {
      customerId: formData.get('customerId'),
      amount: formData.get('amount'),
      status: formData.get('status'),
    }

    // æ•°æ®å˜æ›´
    // é‡æ–°éªŒè¯ç¼“å­˜
  }

  return <form action={createInvoice}>...</form>
}
```

```jsx filename="app/invoices/page.js" switcher
export default function Page() {
  async function createInvoice(formData) {
    'use server'

    const rawFormData = {
      customerId: formData.get('customerId'),
      amount: formData.get('amount'),
      status: formData.get('status'),
    }

    // æ•°æ®å˜æ›´
    // é‡æ–°éªŒè¯ç¼“å­˜
  }

  return <form action={createInvoice}>...</form>
}
```

> **é¡»çŸ¥ï¼š**
>
> - ç¤ºä¾‹: [å¸¦åŠ è½½å’Œé”™è¯¯çŠ¶æ€çš„è¡¨å•](https://github.com/vercel/next.js/tree/canary/examples/next-forms)
> - å¤„ç†å¤šå­—æ®µè¡¨å•æ—¶ï¼Œå¯è€ƒè™‘ä½¿ç”¨ [`entries()`](https://developer.mozilla.org/en-US/docs/Web/API/FormData/entries) æ–¹æ³•é…åˆ JavaScript çš„ [`Object.fromEntries()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/fromEntries)ã€‚ä¾‹å¦‚ï¼š`const rawFormData = Object.fromEntries(formData)`ã€‚æ³¨æ„ `formData` ä¼šåŒ…å«é¢å¤–çš„ `$ACTION_` å±æ€§ã€‚
> - å‚é˜… [React `<form>` æ–‡æ¡£](https://react.dev/reference/react-dom/components/form#handle-form-submission-with-a-server-action) äº†è§£æ›´å¤šã€‚

### ä¼ é€’é¢å¤–å‚æ•°

å¯é€šè¿‡ JavaScript `bind` æ–¹æ³•å‘æœåŠ¡ç«¯æ“ä½œä¼ é€’é¢å¤–å‚æ•°ã€‚

```tsx filename="app/client-component.tsx" highlight={6} switcher
'use client'

import { updateUser } from './actions'

export function UserProfile({ userId }: { userId: string }) {
  const updateUserWithId = updateUser.bind(null, userId)

  return (
    <form action={updateUserWithId}>
      <input type="text" name="name" />
      <button type="submit">æ›´æ–°ç”¨æˆ·å</button>
    </form>
  )
}
```

```jsx filename="app/client-component.js" highlight={6} switcher
'use client'

import { updateUser } from './actions'

export function UserProfile({ userId }) {
  const updateUserWithId = updateUser.bind(null, userId)

  return (
    <form action={updateUserWithId}>
      <input type="text" name="name" />
      <button type="submit">æ›´æ–°ç”¨æˆ·å</button>
    </form>
  )
}
```

æœåŠ¡ç«¯æ“ä½œå°†æ¥æ”¶ `userId` å‚æ•°åŠè¡¨å•æ•°æ®ï¼š

```ts filename="app/actions.ts" switcher
'use server'

export async function updateUser(userId: string, formData: FormData) {}
```

```js filename="app/actions.js" switcher
'use server'

export async function updateUser(userId, formData) {}
```

> **é¡»çŸ¥**:
>
> - æ›¿ä»£æ–¹æ¡ˆæ˜¯å°†å‚æ•°ä½œä¸ºéšè—è¾“å…¥å­—æ®µä¼ é€’ï¼ˆå¦‚ `<input type="hidden" name="userId" value={userId} />`ï¼‰ã€‚ä½†å€¼ä¼šæˆä¸ºæ¸²æŸ“ HTML çš„ä¸€éƒ¨åˆ†ä¸”ä¸ä¼šè¢«ç¼–ç ã€‚
> - `.bind` åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ç»„ä»¶ä¸­å‡æœ‰æ•ˆï¼Œä¹Ÿæ”¯æŒæ¸è¿›å¢å¼ºã€‚

### åµŒå¥—è¡¨å•å…ƒç´ 

ä¹Ÿå¯åœ¨ `<form>` å†…çš„åµŒå¥—å…ƒç´ ï¼ˆå¦‚ `<button>`ã€`<input type="submit">` å’Œ `<input type="image">`ï¼‰ä¸­è°ƒç”¨æœåŠ¡ç«¯æ“ä½œã€‚è¿™äº›å…ƒç´ æ¥å— `formAction` å±æ€§æˆ–[äº‹ä»¶å¤„ç†å™¨](#event-handlers)ã€‚

è¿™åœ¨éœ€è¦å•è¡¨å•å†…è°ƒç”¨å¤šä¸ªæœåŠ¡ç«¯æ“ä½œæ—¶å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œé™¤äº†å‘å¸ƒæŒ‰é’®å¤–ï¼Œå¯ä¸ºä¿å­˜è‰ç¨¿åˆ›å»ºç‰¹å®š `<button>` å…ƒç´ ã€‚è¯¦è§ [React `<form>` æ–‡æ¡£](https://react.dev/reference/react-dom/components/form#handling-multiple-submission-types)ã€‚

### ç¼–ç¨‹å¼è¡¨å•æäº¤

å¯ä½¿ç”¨ [`requestSubmit()`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/requestSubmit) æ–¹æ³•ç¼–ç¨‹è§¦å‘è¡¨å•æäº¤ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·ä½¿ç”¨ `âŒ˜` + `Enter` å¿«æ·é”®æäº¤æ—¶ï¼Œå¯ç›‘å¬ `onKeyDown` äº‹ä»¶ï¼š

```tsx filename="app/entry.tsx" switcher
'use client'

export function Entry() {
  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {
    if (
      (e.ctrlKey || e.metaKey) &&
      (e.key === 'Enter' || e.key === 'NumpadEnter')
    ) {
      e.preventDefault()
      e.currentTarget.form?.requestSubmit()
    }
  }

  return (
    <div>
      <textarea name="entry" rows={20} required onKeyDown={handleKeyDown} />
    </div>
  )
}
```

```jsx filename="app/entry.js" switcher
'use client'

export function Entry() {
  const handleKeyDown = (e) => {
    if (
      (e.ctrlKey || e.metaKey) &&
      (e.key === 'Enter' || e.key === 'NumpadEnter')
    ) {
      e.preventDefault()
      e.currentTarget.form?.requestSubmit()
    }
  }

  return (
    <div>
      <textarea name="entry" rows={20} required onKeyDown={handleKeyDown} />
    </div>
  )
}
```

è¿™å°†è§¦å‘æœ€è¿‘ `<form>` ç¥–å…ˆçš„æäº¤ï¼Œä»è€Œè°ƒç”¨æœåŠ¡ç«¯æ“ä½œã€‚

### æœåŠ¡ç«¯è¡¨å•éªŒè¯

å¯ä½¿ç”¨ `required` å’Œ `type="email"` ç­‰ HTML å±æ€§è¿›è¡ŒåŸºæœ¬å®¢æˆ·ç«¯éªŒè¯ã€‚

æ›´é«˜çº§çš„æœåŠ¡ç«¯éªŒè¯å¯ä½¿ç”¨ [zod](https://zod.dev/) ç­‰åº“åœ¨æ•°æ®å˜æ›´å‰éªŒè¯è¡¨å•å­—æ®µï¼š

```tsx filename="app/actions.ts" switcher
'use server'

import { z } from 'zod'

const schema = z.object({
  email: z.string({
    invalid_type_error: 'æ— æ•ˆé‚®ç®±',
  }),
})

export default async function createUser(formData: FormData) {
  const validatedFields = schema.safeParse({
    email: formData.get('email'),
  })

  // è¡¨å•æ•°æ®æ— æ•ˆæ—¶æå‰è¿”å›
  if (!validatedFields.success) {
    return {
      errors: validatedFields.error.flatten().fieldErrors,
    }
  }

  // æ•°æ®å˜æ›´
}
```

```jsx filename="app/actions.js" switcher
'use server'

import { z } from 'zod'

const schema = z.object({
  email: z.string({
    invalid_type_error: 'æ— æ•ˆé‚®ç®±',
  }),
})

export default async function createsUser(formData) {
  const validatedFields = schema.safeParse({
    email: formData.get('email'),
  })

  // è¡¨å•æ•°æ®æ— æ•ˆæ—¶æå‰è¿”å›
  if (!validatedFields.success) {
    return {
      errors: validatedFields.error.flatten().fieldErrors,
    }
  }

  // æ•°æ®å˜æ›´
}
```

æœåŠ¡ç«¯éªŒè¯å­—æ®µåï¼Œå¯åœ¨æ“ä½œä¸­è¿”å›å¯åºåˆ—åŒ–å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ React `useActionState` é’©å­å‘ç”¨æˆ·æ˜¾ç¤ºæ¶ˆæ¯ã€‚

- å°†æ“ä½œä¼ é€’ç»™ `useActionState` åï¼Œå‡½æ•°ç­¾åä¼šæ–°å¢é¦–ä¸ªå‚æ•° `prevState` æˆ– `initialState`ã€‚
- `useActionState` æ˜¯ React é’©å­ï¼Œå› æ­¤å¿…é¡»åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­ä½¿ç”¨ã€‚

```tsx filename="app/actions.ts" switcher
'use server'

import { redirect } from 'next/navigation'

export async function createUser(prevState: any, formData: FormData) {
  const res = await fetch('https://...')
  const json = await res.json()

  if (!res.ok) {
    return { message: 'è¯·è¾“å…¥æœ‰æ•ˆé‚®ç®±' }
  }

  redirect('/dashboard')
}
```

```jsx filename="app/actions.js" switcher
'use server'

import { redirect } from 'next/navigation'

export async function createUser(prevState, formData) {
  const res = await fetch('https://...')
  const json = await res.json()

  if (!res.ok) {
    return { message: 'è¯·è¾“å…¥æœ‰æ•ˆé‚®ç®±' }
  }

  redirect('/dashboard')
}
```

ç„¶åå¯å°†æ“ä½œä¼ é€’ç»™ `useActionState` é’©å­ï¼Œä½¿ç”¨è¿”å›çš„ `state` æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ã€‚

```tsx filename="app/ui/signup.tsx" highlight={11,18-20} switcher
'use client'

import { useActionState } from 'react'
import { createUser } from '@/app/actions'

const initialState = {
  message: '',
}

export function Signup() {
  const [state, formAction, pending] = useActionState(createUser, initialState)

  return (
    <form action={formAction}>
      <label htmlFor="email">é‚®ç®±</label>
      <input type="text" id="email" name="email" required />
      {/* ... */}
      <p aria-live="polite">{state?.message}</p>
      <button disabled={pending}>æ³¨å†Œ</button>
    </form>
  )
}
```

```jsx filename="app/ui/signup.js" highlight={11,18-20} switcher
'use client'

import { useActionState } from 'react'
import { createUser } from '@/app/actions'

const initialState = {
  message: '',
}

export function Signup() {
  const [state, formAction, pending] = useActionState(createUser, initialState)

  return (
    <form action={formAction}>
      <label htmlFor="email">é‚®ç®±</label>
      <input type="text" id="email" name="email" required />
      {/* ... */}
      <p aria-live="polite">{state?.message}</p>
      <button disabled={pending}>æ³¨å†Œ</button>
    </form>
  )
}
```

### æŒ‚èµ·çŠ¶æ€

[`useActionState`](https://react.dev/reference/react/useActionState) é’©å­æä¾›äº†ä¸€ä¸ª `pending` å¸ƒå°”å€¼ï¼Œå¯ç”¨äºåœ¨æ“ä½œæ‰§è¡ŒæœŸé—´æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨ã€‚

æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ [`useFormStatus`](https://react.dev/reference/react-dom/hooks/useFormStatus) é’©å­åœ¨æ“ä½œæ‰§è¡ŒæœŸé—´æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨ã€‚ä½¿ç”¨æ­¤é’©å­æ—¶ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ç»„ä»¶æ¥æ¸²æŸ“åŠ è½½æŒ‡ç¤ºå™¨ã€‚ä¾‹å¦‚ï¼Œåœ¨æ“ä½œæŒ‚èµ·æ—¶ç¦ç”¨æŒ‰é’®ï¼š

```tsx filename="app/ui/button.tsx" highlight={6} switcher
'use client'

import { useFormStatus } from 'react-dom'

export function SubmitButton() {
  const { pending } = useFormStatus()

  return (
    <button disabled={pending} type="submit">
      æ³¨å†Œ
    </button>
  )
}
```

```jsx filename="app/ui/button.js" highlight={6} switcher
'use client'

import { useFormStatus } from 'react-dom'

export function SubmitButton() {
  const { pending } = useFormStatus()

  return (
    <button disabled={pending} type="submit">
      æ³¨å†Œ
    </button>
  )
}
```

ç„¶åå¯ä»¥å°† `SubmitButton` ç»„ä»¶åµŒå¥—åœ¨è¡¨å•ä¸­ï¼š

```tsx filename="app/ui/signup.tsx" switcher
import { SubmitButton } from './button'
import { createUser } from '@/app/actions'

export function Signup() {
  return (
    <form action={createUser}>
      {/* å…¶ä»–è¡¨å•å…ƒç´  */}
      <SubmitButton />
    </form>
  )
}
```

```jsx filename="app/ui/signup.js" switcher
import { SubmitButton } from './button'
import { createUser } from '@/app/actions'

export function Signup() {
  return (
    <form action={createUser}>
      {/* å…¶ä»–è¡¨å•å…ƒç´  */}
      <SubmitButton />
    </form>
  )
}
```

> **é¡»çŸ¥ï¼š** åœ¨ React 19 ä¸­ï¼Œ`useFormStatus` è¿”å›çš„å¯¹è±¡åŒ…å«é¢å¤–çš„é”®ï¼Œå¦‚ dataã€method å’Œ actionã€‚å¦‚æœæ‚¨æœªä½¿ç”¨ React 19ï¼Œåˆ™ä»… `pending` é”®å¯ç”¨ã€‚

### ä¹è§‚æ›´æ–°

æ‚¨å¯ä»¥ä½¿ç”¨ React çš„ [`useOptimistic`](https://react.dev/reference/react/useOptimistic) é’©å­åœ¨æœåŠ¡å™¨æ“ä½œå®Œæˆæ‰§è¡Œå‰ä¹è§‚åœ°æ›´æ–° UIï¼Œè€Œä¸æ˜¯ç­‰å¾…å“åº”ï¼š

```tsx filename="app/page.tsx" switcher
'use client'

import { useOptimistic } from 'react'
import { send } from './actions'

type Message = {
  message: string
}

export function Thread({ messages }: { messages: Message[] }) {
  const [optimisticMessages, addOptimisticMessage] = useOptimistic<
    Message[],
    string
  >(messages, (state, newMessage) => [...state, { message: newMessage }])

  const formAction = async (formData: FormData) => {
    const message = formData.get('message') as string
    addOptimisticMessage(message)
    await send(message)
  }

  return (
    <div>
      {optimisticMessages.map((m, i) => (
        <div key={i}>{m.message}</div>
      ))}
      <form action={formAction}>
        <input type="text" name="message" />
        <button type="submit">å‘é€</button>
      </form>
    </div>
  )
}
```

```jsx filename="app/page.js" switcher
'use client'

import { useOptimistic } from 'react'
import { send } from './actions'

export function Thread({ messages }) {
  const [optimisticMessages, addOptimisticMessage] = useOptimistic(
    messages,
    (state, newMessage) => [...state, { message: newMessage }]
  )

  const formAction = async (formData) => {
    const message = formData.get('message')
    addOptimisticMessage(message)
    await send(message)
  }

  return (
    <div>
      {optimisticMessages.map((m) => (
        <div>{m.message}</div>
      ))}
      <form action={formAction}>
        <input type="text" name="message" />
        <button type="submit">å‘é€</button>
      </form>
    </div>
  )
}
```

### äº‹ä»¶å¤„ç†ç¨‹åº

è™½ç„¶é€šå¸¸åœ¨ `<form>` å…ƒç´ ä¸­ä½¿ç”¨æœåŠ¡å™¨æ“ä½œï¼Œä½†å®ƒä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `onClick` ç­‰äº‹ä»¶å¤„ç†ç¨‹åºè°ƒç”¨ã€‚ä¾‹å¦‚ï¼Œå¢åŠ ç‚¹èµæ•°ï¼š

```tsx filename="app/like-button.tsx" switcher
'use client'

import { incrementLike } from './actions'
import { useState } from 'react'

export default function LikeButton({ initialLikes }: { initialLikes: number }) {
  const [likes, setLikes] = useState(initialLikes)

  return (
    <>
      <p>æ€»ç‚¹èµæ•°ï¼š{likes}</p>
      <button
        onClick={async () => {
          const updatedLikes = await incrementLike()
          setLikes(updatedLikes)
        }}
      >
        ç‚¹èµ
      </button>
    </>
  )
}
```

```jsx filename="app/like-button.js" switcher
'use client'

import { incrementLike } from './actions'
import { useState } from 'react'

export default function LikeButton({ initialLikes }) {
  const [likes, setLikes] = useState(initialLikes)

  return (
    <>
      <p>æ€»ç‚¹èµæ•°ï¼š{likes}</p>
      <button
        onClick={async () => {
          const updatedLikes = await incrementLike()
          setLikes(updatedLikes)
        }}
      >
        ç‚¹èµ
      </button>
    </>
  )
}
```

æ‚¨è¿˜å¯ä»¥ä¸ºè¡¨å•å…ƒç´ æ·»åŠ äº‹ä»¶å¤„ç†ç¨‹åºï¼Œä¾‹å¦‚åœ¨ `onChange` æ—¶ä¿å­˜è¡¨å•å­—æ®µï¼š

```tsx filename="app/ui/edit-post.tsx"
'use client'

import { publishPost, saveDraft } from './actions'

export default function EditPost() {
  return (
    <form action={publishPost}>
      <textarea
        name="content"
        onChange={async (e) => {
          await saveDraft(e.target.value)
        }}
      />
      <button type="submit">å‘å¸ƒ</button>
    </form>
  )
}
```

å¯¹äºæ­¤ç±»å¯èƒ½å¿«é€Ÿè§¦å‘å¤šä¸ªäº‹ä»¶çš„æƒ…å†µï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨**é˜²æŠ–**æ¥é¿å…ä¸å¿…è¦çš„æœåŠ¡å™¨æ“ä½œè°ƒç”¨ã€‚

### `useEffect`

æ‚¨å¯ä»¥ä½¿ç”¨ React çš„ [`useEffect`](https://react.dev/reference/react/useEffect) é’©å­åœ¨ç»„ä»¶æŒ‚è½½æˆ–ä¾èµ–é¡¹æ›´æ”¹æ—¶è°ƒç”¨æœåŠ¡å™¨æ“ä½œã€‚è¿™å¯¹äºä¾èµ–äºå…¨å±€äº‹ä»¶æˆ–éœ€è¦è‡ªåŠ¨è§¦å‘çš„å˜æ›´éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œ`onKeyDown` ç”¨äºåº”ç”¨å¿«æ·é”®ã€æ— é™æ»šåŠ¨çš„äº¤å‰è§‚å¯Ÿå™¨é’©å­ï¼Œæˆ–åœ¨ç»„ä»¶æŒ‚è½½æ—¶æ›´æ–°è§†å›¾è®¡æ•°ï¼š

```tsx filename="app/view-count.tsx" switcher
'use client'

import { incrementViews } from './actions'
import { useState, useEffect, useTransition } from 'react'

export default function ViewCount({ initialViews }: { initialViews: number }) {
  const [views, setViews] = useState(initialViews)
  const [isPending, startTransition] = useTransition()

  useEffect(() => {
    startTransition(async () => {
      const updatedViews = await incrementViews()
      setViews(updatedViews)
    })
  }, [])

  // å¯ä»¥ä½¿ç”¨ `isPending` å‘ç”¨æˆ·æä¾›åé¦ˆ
  return <p>æ€»æµè§ˆé‡ï¼š{views}</p>
}
```

```jsx filename="app/view-count.js" switcher
'use client'

import { incrementViews } from './actions'
import { useState, useEffect, useTransition } from 'react'

export default function ViewCount({ initialViews }) {
  const [views, setViews] = useState(initialViews)
  const [isPending, startTransition] = useTransition()

  useEffect(() => {
    starTransition(async () => {
      const updatedViews = await incrementViews()
      setViews(updatedViews)
    })
  }, [])

  // å¯ä»¥ä½¿ç”¨ `isPending` å‘ç”¨æˆ·æä¾›åé¦ˆ
  return <p>æ€»æµè§ˆé‡ï¼š{views}</p>
}
```

è¯·è®°ä½è€ƒè™‘ [`useEffect` çš„è¡Œä¸ºå’Œæ³¨æ„äº‹é¡¹](https://react.dev/reference/react/useEffect#caveats)ã€‚

### é”™è¯¯å¤„ç†

å½“æŠ›å‡ºé”™è¯¯æ—¶ï¼Œå®ƒå°†è¢«å®¢æˆ·ç«¯æœ€è¿‘çš„ `error.js` æˆ– `<Suspense>` è¾¹ç•Œæ•è·ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[é”™è¯¯å¤„ç†](/docs/app/building-your-application/routing/error-handling)ã€‚

> **é¡»çŸ¥ï¼š**
>
> - é™¤äº†æŠ›å‡ºé”™è¯¯å¤–ï¼Œæ‚¨è¿˜å¯ä»¥è¿”å›ä¸€ä¸ªå¯¹è±¡ä¾› `useActionState` å¤„ç†ã€‚è¯·å‚é˜…[æœåŠ¡ç«¯éªŒè¯å’Œé”™è¯¯å¤„ç†](#server-side-form-validation)ã€‚

### é‡æ–°éªŒè¯æ•°æ®

æ‚¨å¯ä»¥åœ¨æœåŠ¡å™¨æ“ä½œä¸­ä½¿ç”¨ [`revalidatePath`](/docs/app/api-reference/functions/revalidatePath) API é‡æ–°éªŒè¯ [Next.js ç¼“å­˜](/docs/app/deep-dive/caching)ï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { revalidatePath } from 'next/cache'

export async function createPost() {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidatePath('/posts')
}
```

```js filename="app/actions.js" switcher
'use server'

import { revalidatePath } from 'next/cache'

export async function createPost() {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidatePath('/posts')
}
```

æˆ–è€…ä½¿ç”¨ [`revalidateTag`](/docs/app/api-reference/functions/revalidateTag) é€šè¿‡ç¼“å­˜æ ‡ç­¾ä½¿ç‰¹å®šæ•°æ®è·å–å¤±æ•ˆï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { revalidateTag } from 'next/cache'

export async function createPost() {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidateTag('posts')
}
```

```js filename="app/actions.js" switcher
'use server'

import { revalidateTag } from 'next/cache'

export async function createPost() {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidateTag('posts')
}
```

### é‡å®šå‘

å¦‚æœæ‚¨å¸Œæœ›åœ¨æœåŠ¡å™¨æ“ä½œå®Œæˆåå°†ç”¨æˆ·é‡å®šå‘åˆ°ä¸åŒçš„è·¯ç”±ï¼Œå¯ä»¥ä½¿ç”¨ [`redirect`](/docs/app/api-reference/functions/redirect) APIã€‚`redirect` éœ€è¦åœ¨ `try/catch` å—å¤–éƒ¨è°ƒç”¨ï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { redirect } from 'next/navigation'
import { revalidateTag } from 'next/cache'

export async function createPost(id: string) {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidateTag('posts') // æ›´æ–°ç¼“å­˜çš„å¸–å­
  redirect(`/post/${id}`) // å¯¼èˆªåˆ°æ–°å¸–å­é¡µé¢
}
```

```js filename="app/actions.js" switcher
'use server'

import { redirect } from 'next/navigation'
import { revalidateTag } from 'next/cache'

export async function createPost(id) {
  try {
    // ...
  } catch (error) {
    // ...
  }

  revalidateTag('posts') // æ›´æ–°ç¼“å­˜çš„å¸–å­
  redirect(`/post/${id}`) // å¯¼èˆªåˆ°æ–°å¸–å­é¡µé¢
}
```

### Cookies

æ‚¨å¯ä»¥åœ¨æœåŠ¡å™¨æ“ä½œä¸­ä½¿ç”¨ [`cookies`](/docs/app/api-reference/functions/cookies) API æ¥ `get`ã€`set` å’Œ `delete` cookiesï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { cookies } from 'next/headers'

export async function exampleAction() {
  const cookieStore = await cookies()

  // è·å– cookie
  cookieStore.get('name')?.value

  // è®¾ç½® cookie
  cookieStore.set('name', 'Delba')

  // åˆ é™¤ cookie
  cookieStore.delete('name')
}
```

```js filename="app/actions.js" switcher
'use server'

import { cookies } from 'next/headers'

export async function exampleAction() {
  // è·å– cookie
  const cookieStore = await cookies()

  // è·å– cookie
  cookieStore.get('name')?.value

  // è®¾ç½® cookie
  cookieStore.set('name', 'Delba')

  // åˆ é™¤ cookie
  cookieStore.delete('name')
}
```

æœ‰å…³ä»æœåŠ¡å™¨æ“ä½œä¸­åˆ é™¤ cookies çš„æ›´å¤šç¤ºä¾‹ï¼Œè¯·å‚é˜…[å…¶ä»–ç¤ºä¾‹](/docs/app/api-reference/functions/cookies#deleting-cookies)ã€‚

## å®‰å…¨æ€§

é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“åˆ›å»ºå¹¶å¯¼å‡ºä¸€ä¸ªæœåŠ¡å™¨æ“ä½œæ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªå…¬å…± HTTP ç«¯ç‚¹ï¼Œåº”ä½¿ç”¨ç›¸åŒçš„å®‰å…¨å‡è®¾å’Œæˆæƒæ£€æŸ¥è¿›è¡Œå¤„ç†ã€‚è¿™æ„å‘³ç€ï¼Œå³ä½¿æœåŠ¡å™¨æ“ä½œæˆ–å®ç”¨å‡½æ•°æœªåœ¨ä»£ç çš„å…¶ä»–åœ°æ–¹å¯¼å…¥ï¼Œå®ƒä»ç„¶æ˜¯å…¬å¼€å¯è®¿é—®çš„ã€‚

ä¸ºäº†æé«˜å®‰å…¨æ€§ï¼ŒNext.js å…·æœ‰ä»¥ä¸‹å†…ç½®åŠŸèƒ½ï¼š

- **å®‰å…¨æ“ä½œ ID**ï¼šNext.js åˆ›å»ºåŠ å¯†çš„ã€éç¡®å®šæ€§çš„ IDï¼Œå…è®¸å®¢æˆ·ç«¯å¼•ç”¨å’Œè°ƒç”¨æœåŠ¡å™¨æ“ä½œã€‚è¿™äº› ID åœ¨æ„å»ºä¹‹é—´å®šæœŸé‡æ–°è®¡ç®—ä»¥å¢å¼ºå®‰å…¨æ€§ã€‚
- **æ­»ä»£ç æ¶ˆé™¤**ï¼šæœªä½¿ç”¨çš„æœåŠ¡å™¨æ“ä½œï¼ˆé€šè¿‡å…¶ ID å¼•ç”¨ï¼‰å°†ä»å®¢æˆ·ç«¯åŒ…ä¸­åˆ é™¤ï¼Œä»¥é¿å…ç¬¬ä¸‰æ–¹å…¬å¼€è®¿é—®ã€‚

> **é¡»çŸ¥**ï¼š
>
> ID åœ¨ç¼–è¯‘æœŸé—´åˆ›å»ºï¼Œå¹¶æœ€å¤šç¼“å­˜ 14 å¤©ã€‚å®ƒä»¬å°†åœ¨å¯åŠ¨æ–°æ„å»ºæˆ–æ„å»ºç¼“å­˜å¤±æ•ˆæ—¶é‡æ–°ç”Ÿæˆã€‚
> æ­¤å®‰å…¨æ”¹è¿›åœ¨ç¼ºå°‘èº«ä»½éªŒè¯å±‚çš„æƒ…å†µä¸‹é™ä½äº†é£é™©ã€‚ä½†æ˜¯ï¼Œæ‚¨ä»åº”å°†æœåŠ¡å™¨æ“ä½œè§†ä¸ºå…¬å…± HTTP ç«¯ç‚¹ã€‚

```jsx
// app/actions.js
'use server'

// æ­¤æ“ä½œ**å·²**åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ï¼Œå› æ­¤ Next.js
// å°†åˆ›å»ºä¸€ä¸ªå®‰å…¨ ID ä»¥å…è®¸å®¢æˆ·ç«¯å¼•ç”¨
// å¹¶è°ƒç”¨æœåŠ¡å™¨æ“ä½œã€‚
export async function updateUserAction(formData) {}

// æ­¤æ“ä½œ**æœª**åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ï¼Œå› æ­¤ Next.js
// å°†åœ¨ `next build` æœŸé—´è‡ªåŠ¨åˆ é™¤æ­¤ä»£ç 
// å¹¶ä¸”ä¸ä¼šåˆ›å»ºå…¬å…±ç«¯ç‚¹ã€‚
export async function deleteUserAction(formData) {}
```

### èº«ä»½éªŒè¯å’Œæˆæƒ

æ‚¨åº”ç¡®ä¿ç”¨æˆ·æœ‰æƒæ‰§è¡Œæ“ä½œã€‚ä¾‹å¦‚ï¼š

```tsx filename="app/actions.ts"
'use server'

import { auth } from './lib'

export function addItem() {
  const { user } = auth()
  if (!user) {
    throw new Error('æ‚¨å¿…é¡»ç™»å½•æ‰èƒ½æ‰§è¡Œæ­¤æ“ä½œ')
  }

  // ...
}
```

### é—­åŒ…å’ŒåŠ å¯†

åœ¨ç»„ä»¶å†…å®šä¹‰æœåŠ¡å™¨æ“ä½œä¼šåˆ›å»ºä¸€ä¸ª[é—­åŒ…](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures)ï¼Œå…¶ä¸­æ“ä½œå¯ä»¥è®¿é—®å¤–éƒ¨å‡½æ•°çš„ä½œç”¨åŸŸã€‚ä¾‹å¦‚ï¼Œ`publish` æ“ä½œå¯ä»¥è®¿é—® `publishVersion` å˜é‡ï¼š

```tsx filename="app/page.tsx" switcher
export default async function Page() {
  const publishVersion = await getLatestVersion();

  async function publish() {
    "use server";
    if (publishVersion !== await getLatestVersion()) {
      throw new Error('è‡ªæŒ‰ä¸‹å‘å¸ƒä»¥æ¥ç‰ˆæœ¬å·²æ›´æ”¹');
    }
    ...
  }

  return (
    <form>
      <button formAction={publish}>å‘å¸ƒ</button>
    </form>
  );
}
```

```jsx filename="app/page.js" switcher
export default async function Page() {
  const publishVersion = await getLatestVersion();

  async function publish() {
    "use server";
    if (publishVersion !== await getLatestVersion()) {
      throw new Error('è‡ªæŒ‰ä¸‹å‘å¸ƒä»¥æ¥ç‰ˆæœ¬å·²æ›´æ”¹');
    }
    ...
  }

  return (
    <form>
      <button formAction={publish}>å‘å¸ƒ</button>
    </form>
  );
}
```

é—­åŒ…åœ¨éœ€è¦æ•è·æ•°æ®çš„**å¿«ç…§**ï¼ˆä¾‹å¦‚ `publishVersion`ï¼‰ä»¥ä¾¿åœ¨æ“ä½œè°ƒç”¨æ—¶ä½¿ç”¨éå¸¸æœ‰ç”¨ã€‚

ç„¶è€Œï¼Œä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæ•è·çš„å˜é‡ä¼šå‘é€åˆ°å®¢æˆ·ç«¯å¹¶åœ¨æ“ä½œè°ƒç”¨æ—¶è¿”å›æœåŠ¡å™¨ã€‚ä¸ºäº†é˜²æ­¢æ•æ„Ÿæ•°æ®æš´éœ²ç»™å®¢æˆ·ç«¯ï¼ŒNext.js ä¼šè‡ªåŠ¨åŠ å¯†é—­åŒ…å˜é‡ã€‚æ¯æ¬¡æ„å»º Next.js åº”ç”¨ç¨‹åºæ—¶ï¼Œéƒ½ä¼šä¸ºæ¯ä¸ªæ“ä½œç”Ÿæˆä¸€ä¸ªæ–°çš„ç§é’¥ã€‚è¿™æ„å‘³ç€æ“ä½œåªèƒ½é’ˆå¯¹ç‰¹å®šæ„å»ºè°ƒç”¨ã€‚

> **é¡»çŸ¥ï¼š** æˆ‘ä»¬ä¸å»ºè®®ä»…ä¾èµ–åŠ å¯†æ¥é˜²æ­¢æ•æ„Ÿå€¼æš´éœ²åœ¨å®¢æˆ·ç«¯ã€‚ç›¸åï¼Œæ‚¨åº”ä½¿ç”¨ [React taint APIs](/docs/app/api-reference/config/next-config-js/taint) ä¸»åŠ¨é˜²æ­¢ç‰¹å®šæ•°æ®å‘é€åˆ°å®¢æˆ·ç«¯ã€‚

### è¦†ç›–åŠ å¯†å¯†é’¥ï¼ˆé«˜çº§ï¼‰

åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šè‡ªæ‰˜ç®¡ Next.js åº”ç”¨ç¨‹åºæ—¶ï¼Œæ¯ä¸ªæœåŠ¡å™¨å®ä¾‹å¯èƒ½æœ€ç»ˆä½¿ç”¨ä¸åŒçš„åŠ å¯†å¯†é’¥ï¼Œä»è€Œå¯¼è‡´æ½œåœ¨çš„ä¸ä¸€è‡´ã€‚

ä¸ºäº†ç¼“è§£è¿™ç§æƒ…å†µï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `process.env.NEXT_SERVER_ACTIONS_ENCRYPTION_KEY` ç¯å¢ƒå˜é‡è¦†ç›–åŠ å¯†å¯†é’¥ã€‚æŒ‡å®šæ­¤å˜é‡å¯ç¡®ä¿æ‚¨çš„åŠ å¯†å¯†é’¥åœ¨æ„å»ºä¹‹é—´ä¿æŒä¸€è‡´ï¼Œå¹¶ä¸”æ‰€æœ‰æœåŠ¡å™¨å®ä¾‹ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ã€‚æ­¤å˜é‡**å¿…é¡»**æ˜¯ AES-GCM åŠ å¯†çš„ã€‚

è¿™æ˜¯ä¸€ä¸ªé«˜çº§ç”¨ä¾‹ï¼Œå…¶ä¸­è·¨å¤šä¸ªéƒ¨ç½²çš„ä¸€è‡´åŠ å¯†è¡Œä¸ºå¯¹æ‚¨çš„åº”ç”¨ç¨‹åºè‡³å…³é‡è¦ã€‚æ‚¨åº”è€ƒè™‘æ ‡å‡†çš„å®‰å…¨å®è·µï¼Œå¦‚å¯†é’¥è½®æ¢å’Œç­¾åã€‚

> **é¡»çŸ¥ï¼š** éƒ¨ç½²åˆ° Vercel çš„ Next.js åº”ç”¨ç¨‹åºä¼šè‡ªåŠ¨å¤„ç†æ­¤é—®é¢˜ã€‚

### å…è®¸çš„æ¥æºï¼ˆé«˜çº§é…ç½®ï¼‰

ç”±äºæœåŠ¡ç«¯æ“ä½œ (Server Actions) å¯ä»¥é€šè¿‡ `<form>` å…ƒç´ è°ƒç”¨ï¼Œè¿™ä½¿å¾—å®ƒä»¬å®¹æ˜“å—åˆ° [CSRF æ”»å‡»](https://developer.mozilla.org/en-US/docs/Glossary/CSRF) çš„å¨èƒã€‚

åœ¨åº•å±‚å®ç°ä¸­ï¼ŒæœåŠ¡ç«¯æ“ä½œä½¿ç”¨ `POST` æ–¹æ³•ï¼Œå¹¶ä¸”ä»…å…è®¸é€šè¿‡è¯¥ HTTP æ–¹æ³•è¿›è¡Œè°ƒç”¨ã€‚è¿™ä¸€æœºåˆ¶é…åˆç°ä»£æµè§ˆå™¨é»˜è®¤å¯ç”¨çš„ [SameSite Cookie](https://web.dev/articles/samesite-cookies-explained)ï¼Œèƒ½å¤Ÿæœ‰æ•ˆé˜²èŒƒå¤§å¤šæ•° CSRF æ¼æ´ã€‚

ä½œä¸ºé¢å¤–çš„å®‰å…¨æªæ–½ï¼ŒNext.js ä¸­çš„æœåŠ¡ç«¯æ“ä½œè¿˜ä¼šæ¯”è¾ƒ [Origin æ ‡å¤´](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin) ä¸ [Host æ ‡å¤´](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Host)ï¼ˆæˆ– `X-Forwarded-Host`ï¼‰ã€‚å¦‚æœä¸¤è€…ä¸åŒ¹é…ï¼Œè¯·æ±‚å°†è¢«ä¸­æ­¢ã€‚æ¢å¥è¯è¯´ï¼ŒæœåŠ¡ç«¯æ“ä½œåªèƒ½ç”±æ‰˜ç®¡å®ƒçš„é¡µé¢æ‰€åœ¨çš„ä¸»æœºå‘èµ·è°ƒç”¨ã€‚

å¯¹äºä½¿ç”¨åå‘ä»£ç†æˆ–å¤šå±‚åç«¯æ¶æ„ï¼ˆæœåŠ¡å™¨ API ä¸ç”Ÿäº§åŸŸåä¸åŒï¼‰çš„å¤§å‹åº”ç”¨ï¼Œå»ºè®®é€šè¿‡é…ç½®é¡¹ [`serverActions.allowedOrigins`](/docs/app/api-reference/config/next-config-js/serverActions) æŒ‡å®šå®‰å…¨æ¥æºåˆ—è¡¨ã€‚è¯¥é€‰é¡¹æ¥å—å­—ç¬¦ä¸²æ•°ç»„ä½œä¸ºå‚æ•°ã€‚

```js filename="next.config.js"
/** @type {import('next').NextConfig} */
module.exports = {
  experimental: {
    serverActions: {
      allowedOrigins: ['my-proxy.com', '*.my-proxy.com'],
    },
  },
}
```

äº†è§£æ›´å¤šå…³äº [å®‰å…¨æ€§ä¸æœåŠ¡ç«¯æ“ä½œ](https://nextjs.org/blog/security-nextjs-server-components-actions) çš„å†…å®¹ã€‚

## æ‰©å±•èµ„æº

æ›´å¤šä¿¡æ¯è¯·å‚é˜…ä»¥ä¸‹ React æ–‡æ¡£ï¼š

- [æœåŠ¡ç«¯æ“ä½œ](https://react.dev/reference/rsc/server-actions)
- [`"use server"`](https://react.dev/reference/react/use-server)
- [`<form>`](https://react.dev/reference/react-dom/components/form)
- [`useFormStatus`](https://react.dev/reference/react-dom/hooks/useFormStatus)
- [`useActionState`](https://react.dev/reference/react/useActionState)
- [`useOptimistic`](https://react.dev/reference/react/useOptimistic)
