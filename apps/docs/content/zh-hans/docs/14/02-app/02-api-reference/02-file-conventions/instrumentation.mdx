---
source-updated-at: 2025-05-16T04:52:11.000Z
translation-updated-at: 2025-05-21T20:34:33.718Z
title: instrumentation.js
description: 关于 instrumentation.js 文件的 API 参考文档。
related:
  title: 了解更多关于 Instrumentation 的信息
  links:
    - app/building-your-application/optimizing/instrumentation
---

`instrumentation.js|ts` 文件用于将监控和日志工具集成到您的应用中。这使您可以追踪应用的性能和行为，并在生产环境中调试问题。

要使用该文件，请将其放置在应用的**根目录**下，或者如果使用了 [`src` 文件夹](/docs/app/building-your-application/configuring/src-directory)，则放置在该文件夹内。

## 配置选项

Instrumentation 目前是一项实验性功能。要使用 `instrumentation` 文件，您必须在 `next.config.js` 中显式启用 [`experimental.instrumentationHook = true;`](/docs/app/api-reference/next-config-js/instrumentationHook)：

```js filename="next.config.js"
module.exports = {
  experimental: {
    instrumentationHook: true,
  },
}
```

## 导出项

### `register` (必填)

该文件导出一个 `register` 函数，该函数在初始化新的 Next.js 服务器实例时**仅调用一次**。`register` 可以是异步函数。

```ts filename="instrumentation.ts" switcher
import { registerOTel } from '@vercel/otel'

export function register() {
  registerOTel('next-app')
}
```

```js filename="instrumentation.js" switcher
import { registerOTel } from '@vercel/otel'

export function register() {
  registerOTel('next-app')
}
```

## 版本历史

| 版本       | 变更内容                                                 |
| ---------- | -------------------------------------------------------- |
| `v14.0.4`  | 为 `instrumentation` 添加了 Turbopack 支持               |
| `v13.2.0`  | 作为实验性功能引入了 `instrumentation`                   |