---
source-updated-at: 2025-05-29T18:05:49.000Z
translation-updated-at: 2025-05-29T19:43:02.711Z
title: Next.js 10.1 版本发布
description: >-
  Next.js 10.1 带来了 3 倍速的热更新、58% 更小的安装体积、56% 更少的依赖项、WebAssembly 图像优化、增强的 next/image 支持等多项改进！
author:
  - name: Belén Curcio
    image: /static/team/bel.png
  - name: JJ Kasper
    image: /static/team/jj.jpg
  - name: Joe Haddad
    image: /static/team/timer.jpg
  - name: Lee Robinson
    image: /static/team/lee.jpg
  - name: Luis Alvarez
    image: /static/team/lfades.jpg
  - name: Shu Ding
    image: /static/team/shu.jpg
  - name: Steven
    image: /static/team/styfle.png
  - name: Tim Neutkens
    image: /static/team/tim.jpg
date: 2021-03-29T14:00:00.507Z
image: >-
  https://h8DxKfmAPhn8O0p3.public.blob.vercel-storage.com/static/blog/next-10-1/twitter-card.png
---

我们很高兴推出 Next.js 10.1，主要特性包括：

*   **[3 倍速热更新](#3x-faster-refresh)**：无需任何改动即可实现 200 毫秒的极速刷新
*   **[安装时间优化](#improved-installation-time)**：安装体积缩小 58%，依赖项减少 56%
*   **[`next/image` 增强](#nextimage-improvements)**：支持 Apple Silicon (M1) 芯片，新增多种布局和加载器选项
*   **[Next.js Commerce Shopify 集成](#nextjs-commerce-shopify-integration)**：为可组合电商应用提供灵活数据层
*   **[自定义 500 页面](#custom-500-page)**：为错误页面添加品牌标识
*   **[严格的 PostCSS 配置加载](#strict-postcss-configuration-loading)**：通过 Webpack 5 实现更优缓存
*   **[支持 `tsconfig.json` 的 `extends` 配置](#support-for-extends-in-tsconfigjson)**：为大型 TypeScript 应用提供可扩展配置
*   **[预览模式检测](#detect-when-preview-mode-is-enabled)**：在预览状态下条件性显示内容
*   **[路由方法自动滚动至顶部](#router-methods-scroll-to-top)**：所有路由跳转保持一致的自动滚动行为
*   **[文档改进](#documentation-improvements)**：增量式迁移指南和 Docker 部署方案

[3 倍速热更新](#3x-faster-refresh)
---------------------------------------

自 [v9.4](https://nextjs.org/blog/next-9-4) 版本起，Next.js 将 Facebook 的 [快速刷新 (Fast Refresh)](/docs/architecture/fast-refresh) 技术引入开源世界，实现了对 React 组件编辑的即时反馈。

这意味着 Next.js 只会更新您编辑的文件代码，且仅重新渲染该组件，同时保持组件状态不变。此特性支持样式（行内样式、CSS-in-JS 或 CSS/Sass Modules）、标记、事件处理函数以及副作用（通过 `useEffect`）。

现在，我们让每次编辑的刷新速度 **再提升 200 毫秒**，且 **无需您修改任何代码**。平均而言，这使快速刷新速度提升了 3 倍。

想要更快的性能和构建速度？立即通过新的 `future` 标志启用 Webpack 5。该标志目前是候选版本 (RC)，Webpack 5 将很快成为默认配置。启用后请[向我们反馈](https://github.com/vercel/next.js/discussions/23498)。

```js filename="next.config.js"
module.exports = {
  future: {
    webpack5: true,
  },
};
```

要了解 Webpack 5 如何以向后兼容的方式应用于您的应用，请查阅[相关文档](/docs/messages/webpack5)。

[安装时间优化](#improved-installation-time)
---------------------------------------------------------

我们优化了 Next.js 的依赖关系图，显著减少了安装时间和依赖体积。现在创建 Next.js 项目（无论是本地还是 CI/CD 流程）都比以往更加快速。

10.0

10.1

差值

平均安装时间

~15s

~5s

提速 3 倍

安装体积

96.5MB

39.9MB

缩小 58%

依赖项数量

424

187

减少 56%

作为依赖优化计划的一部分，我们还更新或替换了已被作者标记为废弃的 npm 包（包括依赖树深处的包）。全新安装 Next.js 10.1 时将不再出现包警告。

[`next/image` 增强](#nextimage-improvements)
----------------------------------------------------

### [Apple Silicon 支持](#apple-silicon-support)

[Next.js 10](https://nextjs.org/blog/next-10) 发布时，图像优化功能依赖原生模块。这导致安装时间较长，且原生依赖占 Next.js 总安装体积的 50%。现在，`next/image` 的自动图像优化功能已改用 [WebAssembly](https://web.dev/squoosh-v2/) 实现，在 `next dev` 和 `next start` 下开箱即用。通过 WASM 技术，我们减少了约 30MB 的安装体积，并新增了对 [Apple Silicon](https://www.apple.com/mac/m1/) M1 芯片 MacBook 的支持。

我们正通过 [SIMD](https://v8.dev/features/simd) 扩展和多线程技术持续优化 WebAssembly 性能。

#### [新增布局选项](#additional-layouts)

根据用户反馈，我们为 `next/image` 新增了多种布局：

*   `layout=fill`：无需提供 `width` 和 `height` 参数（[示例](https://image-component.nextjs.gallery/layout-fill)）
*   `layout=fixed`：原生 `img` 标签行为（[示例](https://image-component.nextjs.gallery/layout-fixed)）
*   `layout=responsive`：弹性宽度固定宽高比（[示例](https://image-component.nextjs.gallery/layout-responsive)）
*   `layout=intrinsic`：不扩展但可收缩的固定宽高比（[示例](https://image-component.nextjs.gallery/layout-intrinsic)）
*   `objectFit=cover`：背景图像处理（[示例](https://image-component.nextjs.gallery/background)）

更多信息请参阅 [`layout` 文档](/docs/pages/api-reference/components/image#layout)。

#### [图像优化支持增强](#improved-image-optimization-support)

我们扩展了 `next/image` 的[内置图像加载器](/docs/pages/building-your-application/optimizing/images#loader)，现在通过 `loader` 属性可以使用**任何自定义加载器或 CDN 提供商**进行图像优化。

```js filename="components/my-image.js"
import Image from 'next/image';
 
const myLoader = ({ src, width, quality }) => {
  return `https://example.com/${src}?w=${width}&q=${quality || 75}`;
};
 
const MyImage = (props) => {
  return (
    <Image
      loader={myLoader}
      src="/me.png"
      alt="Picture of the author"
      width={500}
      height={500}
    />
  );
};
```

详情请查看 [`next/image` 文档](/docs/pages/api-reference/components/image#loader)。

[Next.js Commerce Shopify 集成](#nextjs-commerce-shopify-integration)
----------------------------------------------------------------------------

电商行业是采用 Next.js 增长最快的领域之一。Apple、Wal-Mart、McDonald's 和 Nike 等企业都信赖 Next.js。

我们为您提供了构建电商应用的高性能起点——[Next.js Commerce](https://nextjs.org/commerce)。在收到大量 Shopify 集成请求后，我们将其升级为**供应商无关的 UI 架构**，支持接入任何无头电商方案。

切换供应商只需[单行配置变更](https://github.com/vercel/commerce#configuration)。我们还创建了功能 API，允许根据用例启用/禁用特定功能，同时保持顶级性能。

![Next.js Commerce 全球 Lighthouse 性能指标](https://h8DxKfmAPhn8O0p3.public.blob.vercel-storage.com/static/blog/next-10-1/lighthouse.png)

Next.js Commerce 全球 Lighthouse 性能指标

开发者只需点击几下即可克隆、部署并完全定制自己的电商店铺。访问 [nextjs.org/commerce](http://nextjs.org/commerce) 了解更多，或体验我们的 [Shopify 演示站](https://shopify.demo.vercel.store/)。更多电商平台支持即将推出。

[自定义 500 页面](#custom-500-page)
-----------------------------------

现在可以创建 `pages/500.js` 来自定义服务器错误页面的品牌展示。与 `pages/404.js` 类似，该文件会在构建时静态生成。

```js filename="pages/500.js"
export default function Custom500() {
  return <h1>500 - 服务器发生错误</h1>;
}
```

[严格的 PostCSS 配置加载](#strict-postcss-configuration-loading)
-----------------------------------------------------------------------------

如果使用 PostCSS 和 Webpack 5，可通过新的 `future` 标志启用缓存优化：

```js filename="next.config.js"
module.exports = {
  future: {
    webpack5: true,
    strictPostcssConfiguration: true,
  },
};
```

立即试用并反馈意见。更多信息请参阅 [PostCSS 配置文档](/docs/pages/building-your-application/configuring/post-css)。

[支持 `tsconfig.json` 的 `extends` 配置](#support-for-extends-in-tsconfigjson)
--------------------------------------------------------------------------------

现在可以在 Next.js 使用的 `tsconfig.json` 中通过 `extends` 继承其他配置。例如继承项目中的 `tsconfig.base.json`：

```json filename="tsconfig.json"
{
  "extends": "./tsconfig.base.json"
}
```

详情请查看 [TypeScript 文档](/docs/pages/building-your-application/configuring/typescript)。

[预览模式检测](#detect-when-preview-mode-is-enabled)
---------------------------------------------------------------------------

现在可以检测预览模式状态，从而为编辑人员特殊渲染某些组件：

```js filename="components/MyComponent.js"
import { useRouter } from 'next/router';
 
function MyComponent() {
  const { isPreview } = useRouter();
  return <>{isPreview ? <h1>预览模式已启用</h1> : null}</>;
}
```

更多信息请参阅[预览模式文档](/docs/pages/building-your-application/configuring/preview-mode)。

[路由方法自动滚动至顶部](#router-methods-scroll-to-top)
-------------------------------------------------------------

使用 `next/link` 导航时，Next.js 会自动滚动到页面顶部。Next.js 10.1 起，`router.push` 和 `router.replace` 也将保持相同行为。可通过 `scroll` 选项禁用自动滚动。

详情请查看 [`next/router` 文档](/docs/pages/api-reference/functions/use-router)。

[文档改进](#documentation-improvements)
---------------------------------------------------------

我们新增了多项指南和文档：

*   [渐进式采用 Next.js](/docs/migrating/incremental-adoption)
*   [从 Gatsby 迁移](/docs/migrating/from-gatsby)
*   [从 Create React App 迁移](/docs/app/building-your-application/upgrading/from-create-react-app)
*   [从 React Router 迁移](/docs/migrating/from-react-router)
*   [身份验证方案](/docs/pages/building-your-application/routing/authenticating)
*   [Docker 部署指南](/docs/pages/building-your-application/deploying#docker-image)

[社区生态](#community)
-----------------------

Next.js 的采用率持续增长：

*   自 10.0 版本以来新增 **240+** 贡献者，总贡献者数达 **1,540+**
*   GitHub 星标数超过 **64,950**

加入 [GitHub Discussions](https://github.com/vercel/next.js/discussions) 与 Next.js 社区互动，或参与官方 [Next.js Discord](https://nextjs.org/discord)。

### [致谢](#credits)

感谢所有帮助塑造此版本的外部反馈和贡献者（此处保留原始贡献者名单）