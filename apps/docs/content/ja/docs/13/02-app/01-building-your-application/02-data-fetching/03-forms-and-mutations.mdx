---
source-updated-at: 2025-05-16T04:52:11.000Z
translation-updated-at: 2025-06-06T17:30:37.143Z
title: ãƒ•ã‚©ãƒ¼ãƒ ã¨ãƒ‡ãƒ¼ã‚¿å¤‰æ›´ (Forms and Mutations)
nav_title: ãƒ•ã‚©ãƒ¼ãƒ ã¨ãƒ‡ãƒ¼ã‚¿å¤‰æ›´
description: Next.js ã§ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã¨ãƒ‡ãƒ¼ã‚¿å¤‰æ›´ã‚’å‡¦ç†ã™ã‚‹æ–¹æ³•ã‚’å­¦ã³ã¾ã™ã€‚
---

{/* ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å†…å®¹ã¯ App Router ã¨ Pages Router ã§å…±æœ‰ã•ã‚Œã¦ã„ã¾ã™ã€‚Pages Router å›ºæœ‰ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¿½åŠ ã™ã‚‹å ´åˆã¯ `<PagesOnly>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</PagesOnly>` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚å…±æœ‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ãƒ©ãƒƒãƒ—ã—ãªã„ã§ãã ã•ã„ã€‚ */}

<PagesOnly>

ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆã‚„æ›´æ–°ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚Next.js ã§ã¯ **API Routes** ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã¨ãƒ‡ãƒ¼ã‚¿å¤‰æ›´ã‚’å¼·åŠ›ã«å‡¦ç†ã§ãã¾ã™ã€‚

> **çŸ¥ã£ã¦ãŠãã¨è‰¯ã„ã“ã¨:**
>
> - è¿‘ã„å°†æ¥ã€ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã¨ãƒ‡ãƒ¼ã‚¿å¤‰æ›´ã«ã¯ [App Router ã®æ®µéšçš„å°å…¥](/docs/app/building-your-application/upgrading/app-router-migration) ã¨ [Server Actions](/docs/app/building-your-application/data-fetching/forms-and-mutations#how-server-actions-work) ã®ä½¿ç”¨ã‚’æ¨å¥¨ã™ã‚‹äºˆå®šã§ã™ã€‚Server Actions ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€API Route ã‚’æ‰‹å‹•ã§ä½œæˆã›ãšã«ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ç›´æ¥å‘¼ã³å‡ºã›ã‚‹éåŒæœŸã‚µãƒ¼ãƒãƒ¼é–¢æ•°ã‚’å®šç¾©ã§ãã¾ã™ã€‚
> - API Routes ã¯ [CORS ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æŒ‡å®šã—ã¾ã›ã‚“](https://developer.mozilla.org/docs/Web/HTTP/CORS)ã€‚ã¤ã¾ã‚Šã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§åŒä¸€ã‚ªãƒªã‚¸ãƒ³ã«é™å®šã•ã‚Œã¾ã™ã€‚
> - API Routes ã¯ã‚µãƒ¼ãƒãƒ¼ã§å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€[ç’°å¢ƒå¤‰æ•°](/docs/pages/building-your-application/configuring/environment-variables) ã‚’é€šã˜ã¦ï¼ˆAPIã‚­ãƒ¼ãªã©ã®ï¼‰æ©Ÿå¯†æƒ…å ±ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å…¬é–‹ã›ãšã«ä½¿ç”¨ã§ãã¾ã™ã€‚ã“ã‚Œã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«ãŠã„ã¦é‡è¦ã§ã™ã€‚

</PagesOnly>

<AppOnly>

ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆã‚„æ›´æ–°ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚Next.js ã§ã¯ **Server Actions** ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã¨ãƒ‡ãƒ¼ã‚¿å¤‰æ›´ã‚’å¼·åŠ›ã«å‡¦ç†ã§ãã¾ã™ã€‚

<details>
  <summary>ä¾‹</summary>

- [ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼†ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã®ã‚ã‚‹ãƒ•ã‚©ãƒ¼ãƒ ](https://github.com/vercel/next.js/tree/canary/examples/next-forms)

</details>

## Server Actions ã®ä»•çµ„ã¿

Server Actions ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’æ‰‹å‹•ã§ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä»£ã‚ã‚Šã«ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ç›´æ¥å‘¼ã³å‡ºã›ã‚‹éåŒæœŸã‚µãƒ¼ãƒãƒ¼é–¢æ•°ã‚’å®šç¾©ã§ãã¾ã™ã€‚

> **ğŸ¥ å‹•ç”»ã§å­¦ã¶:** App Router ã§ã®ãƒ•ã‚©ãƒ¼ãƒ ã¨ãƒ‡ãƒ¼ã‚¿å¤‰æ›´ã«ã¤ã„ã¦ â†’ [YouTube (10åˆ†)](https://youtu.be/dDpZfOQBMaU?si=cJZHlUu_jFhCzHUg)ã€‚

Server Actions ã¯ Server Components ã§å®šç¾©ã—ãŸã‚Šã€Client Components ã‹ã‚‰å‘¼ã³å‡ºã—ãŸã‚Šã§ãã¾ã™ã€‚Server Component ã§ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®šç¾©ã™ã‚‹ã¨ã€JavaScriptãŒãªãã¦ã‚‚ãƒ•ã‚©ãƒ¼ãƒ ãŒæ©Ÿèƒ½ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã€ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ã‚¨ãƒ³ãƒãƒ³ã‚¹ãƒ¡ãƒ³ãƒˆã‚’å®Ÿç¾ã—ã¾ã™ã€‚

`next.config.js` ãƒ•ã‚¡ã‚¤ãƒ«ã§ Server Actions ã‚’æœ‰åŠ¹ã«ã—ã¾ã™:

```js filename="next.config.js"
module.exports = {
  experimental: {
    serverActions: true,
  },
}
```

> **çŸ¥ã£ã¦ãŠãã¨è‰¯ã„ã“ã¨:**
>
> - Server Components ã‹ã‚‰ Server Actions ã‚’å‘¼ã³å‡ºã™ãƒ•ã‚©ãƒ¼ãƒ ã¯ã€JavaScriptãŒãªãã¦ã‚‚æ©Ÿèƒ½ã—ã¾ã™ã€‚
> - Client Components ã‹ã‚‰ Server Actions ã‚’å‘¼ã³å‡ºã™ãƒ•ã‚©ãƒ¼ãƒ ã¯ã€JavaScriptãŒã¾ã èª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„å ´åˆã€é€ä¿¡ã‚’ã‚­ãƒ¥ãƒ¼ã«å…¥ã‚Œã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å„ªå…ˆã—ã¾ã™ã€‚
> - Server Actions ã¯ä½¿ç”¨ã•ã‚Œã‚‹ãƒšãƒ¼ã‚¸ã‚„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã® [ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ](/docs/app/building-your-application/rendering/edge-and-nodejs-runtimes) ã‚’ç¶™æ‰¿ã—ã¾ã™ã€‚
> - Server Actions ã¯å®Œå…¨ã«é™çš„ãªãƒ«ãƒ¼ãƒˆï¼ˆISRã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ã®å†æ¤œè¨¼ã‚’å«ã‚€ï¼‰ã§ã‚‚å‹•ä½œã—ã¾ã™ã€‚

## ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‡ãƒ¼ã‚¿ã®å†æ¤œè¨¼

Server Actions ã¯ Next.js ã® [ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨å†æ¤œè¨¼](/docs/app/building-your-application/caching) ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨æ·±ãçµ±åˆã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ•ã‚©ãƒ¼ãƒ ãŒé€ä¿¡ã•ã‚Œã‚‹ã¨ã€Server Action ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã€å¤‰æ›´ãŒå¿…è¦ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã‚’å†æ¤œè¨¼ã§ãã¾ã™ã€‚

å¾“æ¥ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚ˆã†ã«ãƒ«ãƒ¼ãƒˆã”ã¨ã«1ã¤ã®ãƒ•ã‚©ãƒ¼ãƒ ã«åˆ¶é™ã•ã‚Œã‚‹ã®ã§ã¯ãªãã€Server Actions ã§ã¯ãƒ«ãƒ¼ãƒˆã”ã¨ã«è¤‡æ•°ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æŒã¤ã“ã¨ãŒã§ãã¾ã™ã€‚ã•ã‚‰ã«ã€ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã«ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚Next.js ã¯1å›ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¾€å¾©ã§ã€æ›´æ–°ã•ã‚ŒãŸUIã¨ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®ä¸¡æ–¹ã‚’è¿”ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

[Server Actions ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å†æ¤œè¨¼](#revalidating-data) ã®ä¾‹ã‚’ã”è¦§ãã ã•ã„ã€‚

</AppOnly>

## ä¾‹

### ã‚µãƒ¼ãƒãƒ¼å°‚ç”¨ãƒ•ã‚©ãƒ¼ãƒ 

<PagesOnly>

Pages Router ã§ã¯ã€ã‚µãƒ¼ãƒãƒ¼ä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚’å®‰å…¨ã«å¤‰æ›´ã™ã‚‹ãŸã‚ã«ã€æ‰‹å‹•ã§APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```ts filename="pages/api/submit.ts" switcher
import type { NextApiRequest, NextApiResponse } from 'next'

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  const data = req.body
  const id = await createItem(data)
  res.status(200).json({ id })
}
```

```js filename="pages/api/submit.js" switcher
export default function handler(req, res) {
  const data = req.body
  const id = await createItem(data)
  res.status(200).json({ id })
}
```

æ¬¡ã«ã€ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰API Routeã‚’å‘¼ã³å‡ºã—ã¾ã™:

```tsx filename="pages/index.tsx" switcher
import { FormEvent } from 'react'

export default function Page() {
  async function onSubmit(event: FormEvent<HTMLFormElement>) {
    event.preventDefault()

    const formData = new FormData(event.currentTarget)
    const response = await fetch('/api/submit', {
      method: 'POST',
      body: formData,
    })

    // å¿…è¦ã«å¿œã˜ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å‡¦ç†
    const data = await response.json()
    // ...
  }

  return (
    <form onSubmit={onSubmit}>
      <input type="text" name="name" />
      <button type="submit">Submit</button>
    </form>
  )
}
```

```jsx filename="pages/index.jsx" switcher
export default function Page() {
  async function onSubmit(event) {
    event.preventDefault()

    const formData = new FormData(event.target)
    const response = await fetch('/api/submit', {
      method: 'POST',
      body: formData,
    })

    // å¿…è¦ã«å¿œã˜ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å‡¦ç†
    const data = await response.json()
    // ...
  }

  return (
    <form onSubmit={onSubmit}>
      <input type="text" name="name" />
      <button type="submit">Submit</button>
    </form>
  )
}
```

</PagesOnly>

<AppOnly>

ã‚µãƒ¼ãƒãƒ¼å°‚ç”¨ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆã™ã‚‹ã«ã¯ã€Server Component ã§ Server Action ã‚’å®šç¾©ã—ã¾ã™ã€‚ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€é–¢æ•°ã®å…ˆé ­ã« `"use server"` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’ä»˜ã‘ã¦ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã§å®šç¾©ã™ã‚‹ã‹ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’ä»˜ã‘ã¦åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«å®šç¾©ã§ãã¾ã™ã€‚

```tsx filename="app/page.tsx" switcher
export default function Page() {
  async function create(formData: FormData) {
    'use server'

    // ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›´
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å†æ¤œè¨¼
  }

  return <form action={create}>...</form>
}
```

```jsx filename="app/page.jsx" switcher
export default function Page() {
  async function create(formData) {
    'use server'

    // ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›´
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å†æ¤œè¨¼
  }

  return <form action={create}>...</form>
}
```

> **çŸ¥ã£ã¦ãŠãã¨è‰¯ã„ã“ã¨**: `<form action={create}>` ã¯ [FormData](https://developer.mozilla.org/docs/Web/API/FormData/FormData) ãƒ‡ãƒ¼ã‚¿å‹ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚ä¸Šè¨˜ã®ä¾‹ã§ã¯ã€HTML [`form`](https://developer.mozilla.org/docs/Web/HTML/Element/form) çµŒç”±ã§é€ä¿¡ã•ã‚ŒãŸ FormData ãŒã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ `create` ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚

### ãƒ‡ãƒ¼ã‚¿ã®å†æ¤œè¨¼

Server Actions ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€[Next.js ã‚­ãƒ£ãƒƒã‚·ãƒ¥](/docs/app/building-your-application/caching) ã‚’ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ã§ç„¡åŠ¹åŒ–ã§ãã¾ã™ã€‚[`revalidatePath`](/docs/app/api-reference/functions/revalidatePath) ã§ãƒ«ãƒ¼ãƒˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆå…¨ä½“ã‚’ç„¡åŠ¹åŒ–ã§ãã¾ã™:

```ts filename="app/actions.ts" switcher
'use server'

import { revalidatePath } from 'next/cache'

export default async function submit() {
  await submitForm()
  revalidatePath('/')
}
```

```js filename="app/actions.js" switcher
'use server'

import { revalidatePath } from 'next/cache'

export default async function submit() {
  await submitForm()
  revalidatePath('/')
}
```

ã¾ãŸã¯ã€[`revalidateTag`](/docs/app/api-reference/functions/revalidateTag) ã‚’ä½¿ç”¨ã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¿ã‚°ã§ç‰¹å®šã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã‚’ç„¡åŠ¹åŒ–ã§ãã¾ã™:

```ts filename="app/actions.ts" switcher
'use server'

import { revalidateTag } from 'next/cache'

export default async function submit() {
  await addPost()
  revalidateTag('posts')
}
```

```js filename="app/actions.js" switcher
'use server'

import { revalidateTag } from 'next/cache'

export default async function submit() {
  await addPost()
  revalidateTag('posts')
}
```

</AppOnly>

### ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

<PagesOnly>

å¤‰æ›´å¾Œã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’åˆ¥ã®ãƒ«ãƒ¼ãƒˆã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ãŸã„å ´åˆã¯ã€[`redirect`](/docs/pages/building-your-application/routing/api-routes#response-helpers) ã‚’ä½¿ç”¨ã—ã¦çµ¶å¯¾URLã¾ãŸã¯ç›¸å¯¾URLã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã§ãã¾ã™:

```ts filename="pages/api/submit.ts" switcher
import type { NextApiRequest, NextApiResponse } from 'next'

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  const id = await addPost()
  res.redirect(307, `/post/${id}`)
}
```

```js filename="pages/api/submit.js" switcher
export default async function handler(req, res) {
  const id = await addPost()
  res.redirect(307, `/post/${id}`)
}
```

</PagesOnly>

<AppOnly>

Server Action å®Œäº†å¾Œã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’åˆ¥ã®ãƒ«ãƒ¼ãƒˆã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ãŸã„å ´åˆã¯ã€[`redirect`](/docs/app/api-reference/functions/redirect) ã¨ä»»æ„ã®çµ¶å¯¾URLã¾ãŸã¯ç›¸å¯¾URLã‚’ä½¿ç”¨ã§ãã¾ã™:

```ts filename="app/actions.ts" switcher
'use server'

import { redirect } from 'next/navigation'
import { revalidateTag } from 'next/cache'

export default async function submit() {
  const id = await addPost()
  revalidateTag('posts') // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸæŠ•ç¨¿ã‚’æ›´æ–°
  redirect(`/post/${id}`) // æ–°ã—ã„ãƒ«ãƒ¼ãƒˆã«ç§»å‹•
}
```

```js filename="app/actions.js" switcher
'use server'

import { redirect } from 'next/navigation'
import { revalidateTag } from 'next/cache'

export default async function submit() {
  const id = await addPost()
  revalidateTag('posts') // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸæŠ•ç¨¿ã‚’æ›´æ–°
  redirect(`/post/${id}`) // æ–°ã—ã„ãƒ«ãƒ¼ãƒˆã«ç§»å‹•
}
```

</AppOnly>

### ãƒ•ã‚©ãƒ¼ãƒ æ¤œè¨¼

åŸºæœ¬çš„ãªãƒ•ã‚©ãƒ¼ãƒ æ¤œè¨¼ã«ã¯ã€`required` ã‚„ `type="email"` ãªã©ã®HTMLæ¤œè¨¼ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

ã‚ˆã‚Šé«˜åº¦ãªã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰æ¤œè¨¼ã«ã¯ã€[zod](https://zod.dev/) ãªã©ã®ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦ã€è§£æã•ã‚ŒãŸãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ ã‚’æ¤œè¨¼ã—ã¾ã™:

<PagesOnly>

```ts filename="pages/api/submit.ts" switcher
import type { NextApiRequest, NextApiResponse } from 'next'
import { z } from 'zod'

const schema = z.object({
  // ...
})

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  const parsed = schema.parse(req.body)
  // ...
}
```

```js filename="pages/api/submit.js" switcher
import { z } from 'zod'

const schema = z.object({
  // ...
})

export default async function handler(req, res) {
  const parsed = schema.parse(req.body)
  // ...
}
```

</PagesOnly>

<AppOnly>

```tsx filename="app/actions.ts" switcher
import { z } from 'zod'

const schema = z.object({
  // ...
})

export default async function submit(formData: FormData) {
  const parsed = schema.parse({
    id: formData.get('id'),
  })
  // ...
}
```

```jsx filename="app/actions.js" switcher
import { z } from 'zod'

const schema = z.object({
  // ...
})

export default async function submit(formData) {
  const parsed = schema.parse({
    id: formData.get('id'),
  })
  // ...
}
```

</AppOnly>

### ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®è¡¨ç¤º

<AppOnly>

`useFormStatus` ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ•ã‚©ãƒ¼ãƒ ãŒã‚µãƒ¼ãƒãƒ¼ã§é€ä¿¡ã•ã‚Œã¦ã„ã‚‹é–“ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚`useFormStatus` ãƒ•ãƒƒã‚¯ã¯ã€Server Action ã‚’ä½¿ç”¨ã™ã‚‹ `form` è¦ç´ ã®å­ã¨ã—ã¦ã®ã¿ä½¿ç”¨ã§ãã¾ã™ã€‚

ä¾‹ãˆã°ã€æ¬¡ã®é€ä¿¡ãƒœã‚¿ãƒ³:

```tsx filename="app/submit-button.tsx" switcher
'use client'

import { experimental_useFormStatus as useFormStatus } from 'react-dom'

export function SubmitButton() {
  const { pending } = useFormStatus()

  return (
    <button type="submit" aria-disabled={pending}>
      Add
    </button>
  )
}
```

```jsx filename="app/submit-button.jsx" switcher
'use client'

import { experimental_useFormStatus as useFormStatus } from 'react-dom'

export function SubmitButton() {
  const { pending } = useFormStatus()

  return (
    <button type="submit" aria-disabled={pending}>
      Add
    </button>
  )
}
```

`<SubmitButton />` ã¯ Server Action ã‚’æŒã¤ãƒ•ã‚©ãƒ¼ãƒ ã§ä½¿ç”¨ã§ãã¾ã™:

```tsx filename="app/page.tsx" switcher
import { SubmitButton } from '@/app/submit-button'

export default async function Home() {
  return (
    <form action={...}>
      <input type="text" name="field-name" />
      <SubmitButton />
    </form>
  )
}
```

```jsx filename="app/page.jsx" switcher
import { SubmitButton } from '@/app/submit-button'

export default async function Home() {
  return (
    <form action={...}>
      <input type="text" name="field-name" />
      <SubmitButton />
    </form>
  )
}
```

</AppOnly>

<PagesOnly>

React ã® state ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ•ã‚©ãƒ¼ãƒ ãŒã‚µãƒ¼ãƒãƒ¼ã§é€ä¿¡ã•ã‚Œã¦ã„ã‚‹é–“ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚’è¡¨ç¤ºã§ãã¾ã™:

```tsx filename="pages/index.tsx" switcher
import React, { useState, FormEvent } from 'react'

export default function Page() {
  const [isLoading, setIsLoading] = useState<boolean>(false)

  async function onSubmit(event: FormEvent<HTMLFormElement>) {
    event.preventDefault()
    setIsLoading(true) // ãƒªã‚¯ã‚¨ã‚¹ãƒˆé–‹å§‹æ™‚ã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’trueã«è¨­å®š

    try {
      const formData = new FormData(event.currentTarget)
      const response = await fetch('/api/submit', {
        method: 'POST',
        body: formData,
      })

      // å¿…è¦ã«å¿œã˜ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å‡¦ç†
      const data = await response.json()
      // ...
    } catch (error) {
      // å¿…è¦ã«å¿œã˜ã¦ã‚¨ãƒ©ãƒ¼ã‚’å‡¦ç†
      console.error(error)
    } finally {
      setIsLoading(false) // ãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Œäº†æ™‚ã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’falseã«è¨­å®š
    }
  }

  return (
    <form onSubmit={onSubmit}>
      <input type="text" name="name" />
      <button type="submit" disabled={isLoading}>
        {isLoading ? 'èª­ã¿è¾¼ã¿ä¸­...' : 'é€ä¿¡'}
      </button>
    </form>
  )
}
```

```jsx filename="pages/index.jsx" switcher
import React, { useState } from 'react'

export default function Page() {
  const [isLoading, setIsLoading] = useState(false)

  async function onSubmit(event) {
    event.preventDefault()
    setIsLoading(true) // ãƒªã‚¯ã‚¨ã‚¹ãƒˆé–‹å§‹æ™‚ã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’trueã«è¨­å®š

    try {
      const formData = new FormData(event.currentTarget)
      const response = await fetch('/api/submit', {
        method: 'POST',
        body: formData,
      })

      // å¿…è¦ã«å¿œã˜ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å‡¦ç†
      const data = await response.json()
      // ...
    } catch (error) {
      // å¿…è¦ã«å¿œã˜ã¦ã‚¨ãƒ©ãƒ¼ã‚’å‡¦ç†
      console.error(error)
    } finally {
      setIsLoading(false) // ãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Œäº†æ™‚ã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’falseã«è¨­å®š
    }
  }

  return (
    <form onSubmit={onSubmit}>
      <input type="text" name="name" />
      <button type="submit" disabled={isLoading}>
        {isLoading ? 'èª­ã¿è¾¼ã¿ä¸­...' : 'é€ä¿¡'}
      </button>
    </form>
  )
}
```

</PagesOnly>

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

<AppOnly>

ã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ (Server Actions) ã¯[ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºå¯èƒ½ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ](https://developer.mozilla.org/docs/Glossary/Serialization)ã‚’è¿”ã™ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€æ–°ã—ã„ã‚¢ã‚¤ãƒ†ãƒ ä½œæˆæ™‚ã®ã‚¨ãƒ©ãƒ¼ã‚’å‡¦ç†ã™ã‚‹ã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š

```ts filename="app/actions.ts" switcher
'use server'

export async function createTodo(prevState: any, formData: FormData) {
  try {
    await createItem(formData.get('todo'))
    return revalidatePath('/')
  } catch (e) {
    return { message: 'Failed to create' }
  }
}
```

```js filename="app/actions.js" switcher
'use server'

export async function createTodo(prevState, formData) {
  try {
    await createItem(formData.get('todo'))
    return revalidatePath('/')
  } catch (e) {
    return { message: 'Failed to create' }
  }
}
```

ãã—ã¦ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (Client Component) ã‹ã‚‰ã“ã®å€¤ã‚’èª­ã¿å–ã‚Šã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚

```tsx filename="app/add-form.tsx" switcher
'use client'

import { experimental_useFormState as useFormState } from 'react-dom'
import { experimental_useFormStatus as useFormStatus } from 'react-dom'
import { createTodo } from '@/app/actions'

const initialState = {
  message: null,
}

function SubmitButton() {
  const { pending } = useFormStatus()

  return (
    <button type="submit" aria-disabled={pending}>
      è¿½åŠ 
    </button>
  )
}

export function AddForm() {
  const [state, formAction] = useFormState(createTodo, initialState)

  return (
    <form action={formAction}>
      <label htmlFor="todo">ã‚¿ã‚¹ã‚¯ã‚’å…¥åŠ›</label>
      <input type="text" id="todo" name="todo" required />
      <SubmitButton />
      <p aria-live="polite" className="sr-only">
        {state?.message}
      </p>
    </form>
  )
}
```

```jsx filename="app/add-form.jsx" switcher
'use client'

import { experimental_useFormState as useFormState } from 'react-dom'
import { experimental_useFormStatus as useFormStatus } from 'react-dom'
import { createTodo } from '@/app/actions'

const initialState = {
  message: null,
}

function SubmitButton() {
  const { pending } = useFormStatus()

  return (
    <button type="submit" aria-disabled={pending}>
      è¿½åŠ 
    </button>
  )
}

export function AddForm() {
  const [state, formAction] = useFormState(createTodo, initialState)

  return (
    <form action={formAction}>
      <label htmlFor="todo">ã‚¿ã‚¹ã‚¯ã‚’å…¥åŠ›</label>
      <input type="text" id="todo" name="todo" required />
      <SubmitButton />
      <p aria-live="polite" className="sr-only">
        {state?.message}
      </p>
    </form>
  )
}
```

</AppOnly>

<PagesOnly>

ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ãŒå¤±æ•—ã—ãŸå ´åˆã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ã€React ã®çŠ¶æ…‹ (state) ã‚’ä½¿ç”¨ã§ãã¾ã™ï¼š

```tsx filename="pages/index.tsx" switcher
import React, { useState, FormEvent } from 'react'

export default function Page() {
  const [isLoading, setIsLoading] = useState<boolean>(false)
  const [error, setError] = useState<string | null>(null)

  async function onSubmit(event: FormEvent<HTMLFormElement>) {
    event.preventDefault()
    setIsLoading(true)
    setError(null) // æ–°ã—ã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆé–‹å§‹æ™‚ã«ä»¥å‰ã®ã‚¨ãƒ©ãƒ¼ã‚’ã‚¯ãƒªã‚¢

    try {
      const formData = new FormData(event.currentTarget)
      const response = await fetch('/api/submit', {
        method: 'POST',
        body: formData,
      })

      if (!response.ok) {
        throw new Error('ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚')
      }

      // å¿…è¦ã«å¿œã˜ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å‡¦ç†
      const data = await response.json()
      // ...
    } catch (error) {
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¡¨ç¤ºã™ã‚‹ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—
      setError(error.message)
      console.error(error)
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <div>
      {error && <div style={{ color: 'red' }}>{error}</div>}
      <form onSubmit={onSubmit}>
        <input type="text" name="name" />
        <button type="submit" disabled={isLoading}>
          {isLoading ? 'èª­ã¿è¾¼ã¿ä¸­...' : 'é€ä¿¡'}
        </button>
      </form>
    </div>
  )
}
```

```jsx filename="pages/index.jsx" switcher
import React, { useState } from 'react'

export default function Page() {
  const [isLoading, setIsLoading] = useState(false)
  const [error, setError] = useState(null)

  async function onSubmit(event) {
    event.preventDefault()
    setIsLoading(true)
    setError(null) // æ–°ã—ã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆé–‹å§‹æ™‚ã«ä»¥å‰ã®ã‚¨ãƒ©ãƒ¼ã‚’ã‚¯ãƒªã‚¢

    try {
      const formData = new FormData(event.currentTarget)
      const response = await fetch('/api/submit', {
        method: 'POST',
        body: formData,
      })

      if (!response.ok) {
        throw new Error('ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚')
      }

      // å¿…è¦ã«å¿œã˜ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å‡¦ç†
      const data = await response.json()
      // ...
    } catch (error) {
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¡¨ç¤ºã™ã‚‹ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—
      setError(error.message)
      console.error(error)
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <div>
      {error && <div style={{ color: 'red' }}>{error}</div>}
      <form onSubmit={onSubmit}>
        <input type="text" name="name" />
        <button type="submit" disabled={isLoading}>
          {isLoading ? 'èª­ã¿è¾¼ã¿ä¸­...' : 'é€ä¿¡'}
        </button>
      </form>
    </div>
  )
}
```

</PagesOnly>

<AppOnly>

### æ¥½è¦³çš„æ›´æ–° (Optimistic Updates)

ã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ (Server Action) ã®å®Œäº†ã‚’å¾…ãŸãšã«UIã‚’æ›´æ–°ã™ã‚‹ã«ã¯ã€`useOptimistic` ã‚’ä½¿ç”¨ã—ã¾ã™ï¼š

```tsx filename="app/page.tsx" switcher
'use client'

import { experimental_useOptimistic as useOptimistic } from 'react'
import { send } from './actions'

type Message = {
  message: string
}

export function Thread({ messages }: { messages: Message[] }) {
  const [optimisticMessages, addOptimisticMessage] = useOptimistic<Message[]>(
    messages,
    (state: Message[], newMessage: string) => [
      ...state,
      { message: newMessage },
    ]
  )

  return (
    <div>
      {optimisticMessages.map((m, k) => (
        <div key={k}>{m.message}</div>
      ))}
      <form
        action={async (formData: FormData) => {
          const message = formData.get('message')
          addOptimisticMessage(message)
          await send(message)
        }}
      >
        <input type="text" name="message" />
        <button type="submit">é€ä¿¡</button>
      </form>
    </div>
  )
}
```

```jsx filename="app/page.jsx" switcher
'use client'

import { experimental_useOptimistic as useOptimistic } from 'react'
import { send } from './actions'

export function Thread({ messages }) {
  const [optimisticMessages, addOptimisticMessage] = useOptimistic(
    messages,
    (state, newMessage) => [...state, { message: newMessage }]
  )

  return (
    <div>
      {optimisticMessages.map((m) => (
        <div>{m.message}</div>
      ))}
      <form
        action={async (formData) => {
          const message = formData.get('message')
          addOptimisticMessage(message)
          await send(message)
        }}
      >
        <input type="text" name="message" />
        <button type="submit">é€ä¿¡</button>
      </form>
    </div>
  )
}
```

</AppOnly>

### ã‚¯ãƒƒã‚­ãƒ¼ã®è¨­å®š

<PagesOnly>

APIãƒ«ãƒ¼ãƒˆ (API Route) å†…ã§ `setHeader` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã‚¯ãƒƒã‚­ãƒ¼ã‚’è¨­å®šã§ãã¾ã™ï¼š

```ts filename="pages/api/cookie.ts" switcher
import type { NextApiRequest, NextApiResponse } from 'next'

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  res.setHeader('Set-Cookie', 'username=lee; Path=/; HttpOnly')
  res.status(200).send('ã‚¯ãƒƒã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¾ã—ãŸã€‚')
}
```

```js filename="pages/api/cookie.js" switcher
export default async function handler(req, res) {
  res.setHeader('Set-Cookie', 'username=lee; Path=/; HttpOnly')
  res.status(200).send('ã‚¯ãƒƒã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¾ã—ãŸã€‚')
}
```

</PagesOnly>

<AppOnly>

ã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ (Server Action) å†…ã§ [`cookies`](/docs/app/api-reference/functions/cookies) é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ã‚¯ãƒƒã‚­ãƒ¼ã‚’è¨­å®šã§ãã¾ã™ï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { cookies } from 'next/headers'

export async function create() {
  const cart = await createCart()
  cookies().set('cartId', cart.id)
}
```

```js filename="app/actions.js" switcher
'use server'

import { cookies } from 'next/headers'

export async function create() {
  const cart = await createCart()
  cookies().set('cartId', cart.id)
}
```

</AppOnly>

### ã‚¯ãƒƒã‚­ãƒ¼ã®èª­ã¿å–ã‚Š

<PagesOnly>

[`cookies`](/docs/pages/building-your-application/routing/api-routes#request-helpers) ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’ä½¿ç”¨ã—ã¦APIãƒ«ãƒ¼ãƒˆå†…ã§ã‚¯ãƒƒã‚­ãƒ¼ã‚’èª­ã¿å–ã‚Œã¾ã™ï¼š

```ts filename="pages/api/cookie.ts" switcher
import type { NextApiRequest, NextApiResponse } from 'next'

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  const auth = req.cookies.authorization
  // ...
}
```

```js filename="pages/api/cookie.js" switcher
export default async function handler(req, res) {
  const auth = req.cookies.authorization
  // ...
}
```

</PagesOnly>

<AppOnly>

ã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å†…ã§ [`cookies`](/docs/app/api-reference/functions/cookies) é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ã‚¯ãƒƒã‚­ãƒ¼ã‚’èª­ã¿å–ã‚Œã¾ã™ï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { cookies } from 'next/headers'

export async function read() {
  const auth = cookies().get('authorization')?.value
  // ...
}
```

```js filename="app/actions.js" switcher
'use server'

import { cookies } from 'next/headers'

export async function read() {
  const auth = cookies().get('authorization')?.value
  // ...
}
```

</AppOnly>

### ã‚¯ãƒƒã‚­ãƒ¼ã®å‰Šé™¤

<PagesOnly>

APIãƒ«ãƒ¼ãƒˆå†…ã§ `setHeader` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã‚¯ãƒƒã‚­ãƒ¼ã‚’å‰Šé™¤ã§ãã¾ã™ï¼š

```ts filename="pages/api/cookie.ts" switcher
import type { NextApiRequest, NextApiResponse } from 'next'

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  res.setHeader('Set-Cookie', 'username=; Path=/; HttpOnly; Max-Age=0')
  res.status(200).send('ã‚¯ãƒƒã‚­ãƒ¼ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚')
}
```

```js filename="pages/api/cookie.js" switcher
export default async function handler(req, res) {
  res.setHeader('Set-Cookie', 'username=; Path=/; HttpOnly; Max-Age=0')
  res.status(200).send('ã‚¯ãƒƒã‚­ãƒ¼ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚')
}
```

</PagesOnly>

<AppOnly>

ã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å†…ã§ [`cookies`](/docs/app/api-reference/functions/cookies) é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ã‚¯ãƒƒã‚­ãƒ¼ã‚’å‰Šé™¤ã§ãã¾ã™ï¼š

```ts filename="app/actions.ts" switcher
'use server'

import { cookies } from 'next/headers'

export async function delete() {
  cookies().delete('name')
  // ...
}
```

```js filename="app/actions.js" switcher
'use server'

import { cookies } from 'next/headers'

export async function delete() {
  cookies().delete('name')
  // ...
}
```

ã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰ã®ã‚¯ãƒƒã‚­ãƒ¼å‰Šé™¤ã®[è¿½åŠ ä¾‹](/docs/app/api-reference/functions/cookies#deleting-cookies)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

</AppOnly>
