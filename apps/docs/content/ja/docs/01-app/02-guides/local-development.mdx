---
source-updated-at: 2025-05-19T22:31:51.000Z
translation-updated-at: 2025-06-02T19:59:08.481Z
title: ローカル開発環境を最適化する方法
nav_title: 開発環境
description: Next.js を使用してローカル開発環境を最適化する方法について学びましょう。
---

Next.js は優れた開発者体験を提供するように設計されています。アプリケーションが成長するにつれて、ローカル開発中のコンパイル時間が遅くなることに気付くかもしれません。このガイドでは、コンパイル時のパフォーマンスに関する一般的な問題を特定し、修正する方法を説明します。

## ローカル開発と本番環境の違い

`next dev` を使用した開発プロセスは、`next build` や `next start` とは異なります。

`next dev` は、アプリケーション内のルートを開いたりナビゲートしたりする際にコンパイルします。これにより、アプリケーション内のすべてのルートがコンパイルされるのを待たずに開発サーバーを起動できるため、より高速でメモリ使用量も少なくなります。本番ビルドを実行すると、ファイルのミニファイやコンテンツハッシュの作成など、ローカル開発では不要な最適化が適用されます。

## ローカル開発のパフォーマンス向上

### 1. コンピューターのアンチウイルスを確認する

アンチウイルスソフトウェアがファイルアクセスを遅くしている可能性があります。

プロジェクトフォルダをアンチウイルスの除外リストに追加してみてください。Windows マシンでより一般的ですが、アンチウイルスツールがインストールされているシステムではすべて推奨します。

### 2. Next.js を更新し、Turbopack を有効にする

最新バージョンの Next.js を使用していることを確認してください。新しいバージョンにはパフォーマンス改善が含まれていることがよくあります。

Turbopack は Next.js に統合された新しいバンドラーで、ローカルパフォーマンスを向上させることができます。

```bash
npm install next@latest
npm run dev --turbopack
```

[Turbopack の詳細についてはこちら](/blog/turbopack-for-development-stable)。[アップグレードガイド](/docs/app/guides/upgrading) や codemods も参照してください。

### 3. インポートを確認する

コードのインポート方法は、コンパイルやバンドリング時間に大きく影響します。[パッケージバンドリングの最適化](/docs/app/guides/package-bundling) について学び、[Dependency Cruiser](https://github.com/sverweij/dependency-cruiser) や [Madge](https://github.com/pahen/madge) などのツールを試してみてください。

### アイコンライブラリ

`@material-ui/icons` や `react-icons` などのライブラリは、使用しているアイコンが少数であっても数千のアイコンをインポートする可能性があります。必要なアイコンのみをインポートするようにしてください：

```jsx
// このようにする代わりに：
import { Icon1, Icon2 } from 'react-icons/md'

// このようにします：
import Icon1 from 'react-icons/md/Icon1'
import Icon2 from 'react-icons/md/Icon2'
```

`react-icons` のようなライブラリには多くの異なるアイコンセットが含まれています。1つのセットを選択し、そのセットに統一してください。

例えば、アプリケーションが `react-icons` を使用していて、以下のすべてをインポートしている場合：

- `pi` (Phosphor Icons)
- `md` (Material Design Icons)
- `tb` (tabler-icons)
- `cg` (cssgg)

これらを組み合わせると、各セットから1つだけインポートしている場合でも、コンパイラーが処理しなければならないモジュールは数万になります。

### バレルファイル

「バレルファイル」とは、他のファイルから多くの項目をエクスポートするファイルのことです。コンパイラーがモジュールスコープの副作用を見つけるために解析しなければならないため、ビルドが遅くなる可能性があります。

可能な場合は、特定のファイルから直接インポートするようにしてください。[バレルファイルの詳細](https://vercel.com/blog/how-we-optimized-package-imports-in-next-js) と Next.js の組み込み最適化について学びましょう。

### パッケージインポートの最適化

Next.js は特定のパッケージのインポートを自動的に最適化できます。バレルファイルを使用するパッケージを使用している場合は、`next.config.js` に追加してください：

```jsx
module.exports = {
  experimental: {
    optimizePackageImports: ['package-name'],
  },
}
```

Turbopack はインポートを自動的に分析して最適化します。この設定は必要ありません。

### 4. Tailwind CSS の設定を確認する

Tailwind CSS を使用している場合は、正しく設定されていることを確認してください。

よくある間違いは、`content` 配列を設定する際に、スキャンすべきでない `node_modules` や他の大きなディレクトリを含めてしまうことです。

Tailwind CSS バージョン 3.4.8 以降では、ビルドを遅くする可能性のある設定について警告が表示されます。

1. `tailwind.config.js` で、スキャンするファイルを具体的に指定します：

   ```jsx
   module.exports = {
     content: [
       './src/**/*.{js,ts,jsx,tsx}', // 良い例
       // これは範囲が広すぎる可能性があります
       // `packages/**/node_modules` にもマッチします
       // '../../packages/**/*.{js,ts,jsx,tsx}',
     ],
   }
   ```

2. 不要なファイルをスキャンしないようにします：

   ```jsx
   module.exports = {
     content: [
       // より良い例 - 'src' フォルダのみをスキャン
       '../../packages/ui/src/**/*.{js,ts,jsx,tsx}',
     ],
   }
   ```

### 5. カスタム webpack 設定を確認する

カスタム webpack 設定を追加している場合、コンパイルが遅くなっている可能性があります。

ローカル開発に本当に必要かどうかを検討してください。特定のツールを本番ビルドのみに含めるか、Turbopack に移行して [ローダー](/docs/app/api-reference/config/next-config-js/turbopack#supported-loaders) を使用することを検討してください。

### 6. メモリ使用量を最適化する

アプリケーションが非常に大きい場合、より多くのメモリが必要になることがあります。

[メモリ使用量の最適化について詳しく学ぶ](/docs/app/guides/memory-usage)。

### 7. サーバーコンポーネントとデータフェッチ

サーバーコンポーネントへの変更は、新しい変更を表示するためにローカルでページ全体を再レンダリングする原因となり、コンポーネントの新しいデータをフェッチする必要があります。

実験的な `serverComponentsHmrCache` オプションを使用すると、ローカル開発中の Hot Module Replacement (HMR) 更新にわたってサーバーコンポーネントの `fetch` レスポンスをキャッシュできます。これにより、レスポンスが高速化され、課金対象の API 呼び出しのコストが削減されます。

[実験的なオプションについて詳しく学ぶ](/docs/app/api-reference/config/next-config-js/serverComponentsHmrCache)。

## 問題を見つけるためのツール

### 詳細なフェッチログ

`next.config.js` ファイルで `logging.fetches` オプションを使用すると、開発中に何が起こっているかについての詳細な情報を見ることができます：

```js
module.exports = {
  logging: {
    fetches: {
      fullUrl: true,
    },
  },
}
```

[フェッチログの詳細について学ぶ](/docs/app/api-reference/config/next-config-js/logging)。

## Turbopack トレーシング

Turbopack トレーシングは、ローカル開発中のアプリケーションのパフォーマンスを理解するのに役立つツールです。
各モジュールのコンパイルにかかった時間とそれらの関係についての詳細な情報を提供します。

1. Next.js の最新バージョンがインストールされていることを確認します。
1. Turbopack トレースファイルを生成します：

   ```bash
   NEXT_TURBOPACK_TRACING=1 npm run dev
   ```

1. アプリケーションを操作したり、ファイルを編集して問題を再現します。
1. Next.js 開発サーバーを停止します。
1. `.next` フォルダに `trace-turbopack` というファイルが作成されます。
1. `next internal trace [path-to-file]` を使用してファイルを解釈できます：

   ```bash
   next internal trace .next/trace-turbopack
   ```

   `trace` が利用できないバージョンでは、コマンド名は `turbo-trace-server` でした：

   ```bash
   next internal turbo-trace-server .next/trace-turbopack
   ```

1. トレースサーバーが起動したら、https://trace.nextjs.org/ でトレースを表示できます。
1. デフォルトでは、トレースビューアはタイミングを集約します。個々の時間を見るには、ビューアの右上にある「Aggregated in order」から「Spans in order」に切り替えます。

## まだ問題が解決しない場合

[Turbopack トレーシング](#turbopack-tracing) セクションで生成されたトレースファイルを [GitHub Discussions](https://github.com/vercel/next.js/discussions) または [Discord](https://nextjs.org/discord) で共有してください。