---
source-updated-at: 2025-06-02T15:30:01.000Z
translation-updated-at: 2025-06-02T20:10:15.700Z
title: Конфигурация сегментов маршрута
description: Узнайте, как настраивать параметры для сегментов маршрута в Next.js.
---

> Параметры, описанные на этой странице, отключаются, если включен флаг [`dynamicIO`](/docs/app/api-reference/config/next-config-js/dynamicIO), и в будущем будут устаревшими.

Опции сегмента маршрута позволяют настроить поведение [Страницы](/docs/app/api-reference/file-conventions/layout), [Макета](/docs/app/api-reference/file-conventions/layout) или [Обработчика маршрута](/docs/app/building-your-application/routing/route-handlers) путем прямого экспорта следующих переменных:

| Опция                                  | Тип                                                                                                                      | По умолчанию               |
| --------------------------------------- | ------------------------------------------------------------------------------------------------------------------------- | -------------------------- |
| [`experimental_ppr`](#experimental_ppr) | `boolean`                                                                                                                 |
| [`dynamic`](#dynamic)                   | `'auto' \| 'force-dynamic' \| 'error' \| 'force-static'`                                                                  | `'auto'`                   |
| [`dynamicParams`](#dynamicparams)       | `boolean`                                                                                                                 | `true`                     |
| [`revalidate`](#revalidate)             | `false \| 0 \| number`                                                                                                    | `false`                    |
| [`fetchCache`](#fetchcache)             | `'auto' \| 'default-cache' \| 'only-cache' \| 'force-cache' \| 'force-no-store' \| 'default-no-store' \| 'only-no-store'` | `'auto'`                   |
| [`runtime`](#runtime)                   | `'nodejs' \| 'edge'`                                                                                                      | `'nodejs'`                 |
| [`preferredRegion`](#preferredregion)   | `'auto' \| 'global' \| 'home' \| string \| string[]`                                                                      | `'auto'`                   |
| [`maxDuration`](#maxduration)           | `number`                                                                                                                  | Устанавливается платформой развертывания |

## Опции

### `experimental_ppr`

Включает [Частичный предварительный рендеринг (PPR)](/docs/app/getting-started/partial-prerendering) для макета или страницы.

```tsx filename="layout.tsx | page.tsx " switcher
export const experimental_ppr = true
// true | false
```

```jsx filename="layout.js | page.js " switcher
export const experimental_ppr = true
// true | false
```

### `dynamic`

Изменяет динамическое поведение макета или страницы на полностью статическое или полностью динамическое.

```tsx filename="layout.tsx | page.tsx | route.ts" switcher
export const dynamic = 'auto'
// 'auto' | 'force-dynamic' | 'error' | 'force-static'
```

```js filename="layout.js | page.js | route.js" switcher
export const dynamic = 'auto'
// 'auto' | 'force-dynamic' | 'error' | 'force-static'
```

> **Полезно знать**: Новая модель в директории `app` предпочитает детальный контроль кэширования на уровне запросов `fetch` вместо бинарной модели "все или ничего" `getServerSideProps` и `getStaticProps` на уровне страниц в директории `pages`. Опция `dynamic` позволяет вернуться к предыдущей модели для удобства и упрощает миграцию.

- **`'auto'`** (по умолчанию): Опция по умолчанию, которая кэширует максимально возможное количество данных без предотвращения динамического поведения компонентов.
- **`'force-dynamic'`**: Принудительно включает [динамический рендеринг](/docs/app/getting-started/partial-prerendering#dynamic-rendering), что приводит к рендерингу маршрутов для каждого пользователя во время запроса. Эквивалентно:
  - Установке параметра `{ cache: 'no-store', next: { revalidate: 0 } }` для каждого запроса `fetch()` в макете или странице.
  - Установке конфигурации сегмента `export const fetchCache = 'force-no-store'`.
- **`'error'`**: Принудительно включает статический рендеринг и кэширует данные макета или страницы, вызывая ошибку, если какие-либо компоненты используют [Динамические API](/docs/app/getting-started/partial-prerendering#dynamic-rendering) или некэшированные данные. Эквивалентно:
  - `getStaticProps()` в директории `pages`.
  - Установке параметра `{ cache: 'force-cache' }` для каждого запроса `fetch()` в макете или странице.
  - Установке конфигурации сегмента `fetchCache = 'only-cache', dynamicParams = false`.
  - `dynamic = 'error'` изменяет значение по умолчанию `dynamicParams` с `true` на `false`. Можно вернуть динамический рендеринг страниц для динамических параметров, не сгенерированных `generateStaticParams`, вручную установив `dynamicParams = true`.
- **`'force-static'`**: Принудительно включает статический рендеринг и кэширует данные макета или страницы, заставляя [`cookies`](/docs/app/api-reference/functions/cookies), [`headers()`](/docs/app/api-reference/functions/headers) и [`useSearchParams()`](/docs/app/api-reference/functions/use-search-params) возвращать пустые значения. Можно использовать [`revalidate`](#revalidate), [`revalidatePath`](/docs/app/api-reference/functions/revalidatePath) или [`revalidateTag`](/docs/app/api-reference/functions/revalidateTag) в страницах или макетах, отрендеренных с `force-static`.

> **Полезно знать**:
>
> - Инструкции по [миграции](/docs/app/guides/migrating/app-router-migration#step-6-migrating-data-fetching-methods) с `getServerSideProps` и `getStaticProps` на `dynamic: 'force-dynamic'` и `dynamic: 'error'` можно найти в [руководстве по обновлению](/docs/app/guides/migrating/app-router-migration#step-6-migrating-data-fetching-methods).

### `dynamicParams`

Управляет поведением при посещении динамического сегмента, который не был сгенерирован с помощью [generateStaticParams](/docs/app/api-reference/functions/generate-static-params).

```tsx filename="layout.tsx | page.tsx" switcher
export const dynamicParams = true // true | false,
```

```js filename="layout.js | page.js | route.js" switcher
export const dynamicParams = true // true | false,
```

- **`true`** (по умолчанию): Динамические сегменты, не включенные в `generateStaticParams`, генерируются по запросу.
- **`false`**: Динамические сегменты, не включенные в `generateStaticParams`, возвращают 404.

> **Полезно знать**:
>
> - Эта опция заменяет опцию `fallback: true | false | blocking` из `getStaticPaths` в директории `pages`.
> - Для статического рендеринга всех путей при первом посещении необходимо вернуть пустой массив в `generateStaticParams` или использовать `export const dynamic = 'force-static'`.
> - При `dynamicParams = true` сегмент использует [Потоковый рендеринг на сервере (Streaming Server Rendering)](/docs/app/building-your-application/routing/loading-ui-and-streaming#streaming-with-suspense).

### `revalidate`

Устанавливает время повторной валидации по умолчанию для макета или страницы. Эта опция не переопределяет значение `revalidate`, установленное отдельными запросами `fetch`.

```tsx filename="layout.tsx | page.tsx | route.ts" switcher
export const revalidate = false
// false | 0 | number
```

```js filename="layout.js | page.js | route.js" switcher
export const revalidate = false
// false | 0 | number
```

- **`false`** (по умолчанию): Эвристика по умолчанию для кэширования любых запросов `fetch`, которые устанавливают параметр `cache` в `'force-cache'` или обнаруживаются до использования [Динамических API](/docs/app/getting-started/partial-prerendering#dynamic-rendering#dynamic-apis). Семантически эквивалентно `revalidate: Infinity`, что означает, что ресурс должен кэшироваться бессрочно. Отдельные запросы `fetch` могут использовать `cache: 'no-store'` или `revalidate: 0`, чтобы избежать кэширования и сделать маршрут динамически отрендеренным. Или установить `revalidate` в положительное число меньше значения по умолчанию маршрута, чтобы увеличить частоту повторной валидации.
- **`0`**: Гарантирует, что макет или страница всегда [рендерятся динамически](/docs/app/getting-started/partial-prerendering#dynamic-rendering), даже если не обнаружены Динамические API или некэшированные запросы данных. Эта опция изменяет значение по умолчанию для запросов `fetch`, которые не устанавливают параметр `cache` в `'no-store'`, но оставляет запросы `fetch` с `'force-cache'` или положительным `revalidate` без изменений.
- **`number`**: (в секундах) Устанавливает частоту повторной валидации по умолчанию для макета или страницы в `n` секунд.

> **Полезно знать**:
>
> - Значение `revalidate` должно быть статически анализируемым. Например, `revalidate = 600` допустимо, но `revalidate = 60 * 10` — нет.
> - Значение `revalidate` недоступно при использовании `runtime = 'edge'`.
> - В режиме разработки страницы всегда рендерятся по запросу и никогда не кэшируются. Это позволяет сразу видеть изменения без ожидания периода повторной валидации.

#### Частота повторной валидации

- Наименьшее значение `revalidate` среди всех макетов и страниц одного маршрута определяет частоту повторной валидации для всего маршрута. Это гарантирует, что дочерние страницы повторно валидируются так же часто, как и их родительские макеты.
- Отдельные запросы `fetch` могут установить значение `revalidate` меньше значения по умолчанию маршрута, чтобы увеличить частоту повторной валидации всего маршрута. Это позволяет динамически выбирать более частую повторную валидацию для определенных маршрутов на основе некоторых критериев.

### `fetchCache`

<details>
  <summary>Это расширенная опция, которую следует использовать только при необходимости переопределить поведение по умолчанию.</summary>

По умолчанию Next.js **будет кэшировать** любые запросы `fetch()`, которые доступны **до** использования [Динамических API](/docs/app/getting-started/partial-prerendering#dynamic-rendering#dynamic-apis), и **не будет кэшировать** запросы `fetch`, обнаруженные **после** использования Динамических API.

`fetchCache` позволяет переопределить параметр `cache` по умолчанию для всех запросов `fetch` в макете или странице.

```tsx filename="layout.tsx | page.tsx | route.ts" switcher
export const fetchCache = 'auto'
// 'auto' | 'default-cache' | 'only-cache'
// 'force-cache' | 'force-no-store' | 'default-no-store' | 'only-no-store'
```

```js filename="layout.js | page.js | route.js" switcher
export const fetchCache = 'auto'
// 'auto' | 'default-cache' | 'only-cache'
// 'force-cache' | 'force-no-store' | 'default-no-store' | 'only-no-store'
```

- **`'auto'`** (по умолчанию): Опция по умолчанию для кэширования запросов `fetch` перед Динамическими API с предоставленным параметром `cache` и отсутствия кэширования запросов `fetch` после Динамических API.
- **`'default-cache'`**: Позволяет передавать любой параметр `cache` в `fetch`, но если параметр не указан, устанавливает `cache` в `'force-cache'`. Это означает, что даже запросы `fetch` после Динамических API считаются статическими.
- **`'only-cache'`**: Гарантирует, что все запросы `fetch` используют кэширование, изменяя значение по умолчанию на `cache: 'force-cache'`, если параметр не указан, и вызывая ошибку, если любой запрос `fetch` использует `cache: 'no-store'`.
- **`'force-cache'`**: Гарантирует, что все запросы `fetch` используют кэширование, устанавливая параметр `cache` всех запросов `fetch` в `'force-cache'`.
- **`'default-no-store'`**: Позволяет передавать любой параметр `cache` в `fetch`, но если параметр не указан, устанавливает `cache` в `'no-store'`. Это означает, что даже запросы `fetch` перед Динамическими API считаются динамическими.
- **`'only-no-store'`**: Гарантирует, что все запросы `fetch` не используют кэширование, изменяя значение по умолчанию на `cache: 'no-store'`, если параметр не указан, и вызывая ошибку, если любой запрос `fetch` использует `cache: 'force-cache'`.
- **`'force-no-store'`**: Гарантирует, что все запросы `fetch` не используют кэширование, устанавливая параметр `cache` всех запросов `fetch` в `'no-store'`. Это заставляет все запросы `fetch` повторно выполняться при каждом запросе, даже если они предоставляют параметр `'force-cache'`.

#### Поведение между сегментами маршрута

- Любые параметры, установленные для всех макетов и страниц одного маршрута, должны быть совместимы друг с другом.
  - Если указаны и `'only-cache'`, и `'force-cache'`, то `'force-cache'` имеет приоритет. Если указаны и `'only-no-store'`, и `'force-no-store'`, то `'force-no-store'` имеет приоритет. Параметр `force-*` изменяет поведение всего маршрута, поэтому один сегмент с `'force-*'` предотвратит любые ошибки, вызванные `'only-*'`.
  - Цель параметров `'only-*'` и `'force-*'` — гарантировать, что весь маршрут либо полностью статический, либо полностью динамический. Это означает:
    - Комбинация `'only-cache'` и `'only-no-store'` в одном маршруте недопустима.
    - Комбинация `'force-cache'` и `'force-no-store'` в одном маршруте недопустима.
  - Родительский элемент не может указывать `'default-no-store'`, если дочерний элемент указывает `'auto'` или `'*-cache'`, так как это может привести к разному поведению одного и того же запроса `fetch`.
- Рекомендуется оставлять общие родительские макеты с параметром `'auto'` и настраивать параметры там, где дочерние сегменты отличаются.

</details>

### `runtime`

Рекомендуется использовать среду выполнения Node.js для рендеринга приложения и среду выполнения Edge для Middleware.

```tsx filename="layout.tsx | page.tsx | route.ts" switcher
export const runtime = 'nodejs'
// 'nodejs' | 'edge'
```

```js filename="layout.js | page.js | route.js" switcher
export const runtime = 'nodejs'
// 'nodejs' | 'edge'
```

- **`'nodejs'`** (по умолчанию)
- **`'edge'`**

### `preferredRegion`

```tsx filename="layout.tsx | page.tsx | route.ts" switcher
export const preferredRegion = 'auto'
// 'auto' | 'global' | 'home' | ['iad1', 'sfo1']
```

```js filename="layout.js | page.js | route.js" switcher
export const preferredRegion = 'auto'
// 'auto' | 'global' | 'home' | ['iad1', 'sfo1']
```

Поддержка `preferredRegion` и доступных регионов зависит от платформы развертывания.

> **Полезно знать**:
>
> - Если `preferredRegion` не указан, он наследуется от ближайшего родительского макета.
> - Корневой макет по умолчанию использует все регионы.

### `maxDuration`

По умолчанию Next.js не ограничивает выполнение логики на стороне сервера (рендеринг страницы или обработка API).
Платформы развертывания могут использовать `maxDuration` из выходных данных сборки Next.js для добавления конкретных ограничений выполнения.

**Примечание**: Для этой настройки требуется Next.js `13.4.10` или выше.

```tsx filename="layout.tsx | page.tsx | route.ts" switcher
export const maxDuration = 5
```

```js filename="layout.js | page.js | route.js" switcher
export const maxDuration = 5
```

> **Полезно знать**:
>
> - При использовании [Серверных действий (Server Actions)](/docs/app/building-your-application/data-fetching/server-actions-and-mutations) установите `maxDuration` на уровне страницы, чтобы изменить таймаут по умолчанию для всех Серверных действий, используемых на странице.

### `generateStaticParams`

Функция `generateStaticParams` может использоваться в сочетании с [динамическими сегментами маршрута](/docs/app/api-reference/file-conventions/dynamic-routes) для определения списка параметров сегмента маршрута, которые будут статически сгенерированы во время сборки, а не по запросу.

Подробнее см. в [справочнике API](/docs/app/api-reference/functions/generate-static-params).

## История версий

| Версия      |                                                                                                                                                                                                                |
| ------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `v15.0.0-RC` | `export const runtime = "experimental-edge"` устарел. Доступен [кодмод](/docs/app/guides/upgrading/codemods#transform-app-router-route-segment-config-runtime-value-from-experimental-edge-to-edge). |